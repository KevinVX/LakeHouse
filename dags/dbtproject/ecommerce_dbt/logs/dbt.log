[0m18:57:30.462289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce95b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df88100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df887c0>]}


============================== 18:57:30.465096 | 02c0752c-48f5-4642-9aa0-d037b9d8617a ==============================
[0m18:57:30.465096 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:57:30.465455 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error': 'None', 'fail_fast': 'False', 'introspect': 'True', 'debug': 'False', 'invocation_command': 'dbt init', 'write_json': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'log_path': 'logs', 'version_check': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'no_print': 'None', 'profiles_dir': '/Users/airscholar/.dbt', 'empty': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True'}
[0m18:57:30.473543 [info ] [MainThread]: Creating dbt configuration folder at /Users/airscholar/.dbt
[0m18:57:43.527034 [error] [MainThread]: Encountered an error:

[0m18:57:43.531735 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/dbt/cli/requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/dbt/cli/main.py", line 483, in init
    results = task.run()
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/dbt/task/init.py", line 324, in run
    project_name = self.get_valid_project_name()
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/dbt/task/init.py", line 278, in get_valid_project_name
    name = click.prompt("Enter a name for your project (letters, digits, underscore)")
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/click/termui.py", line 168, in prompt
    value = prompt_func(prompt)
  File "/Users/airscholar/PycharmProjects/DistributedLakehouse/.venv/lib/python3.10/site-packages/click/termui.py", line 151, in prompt_func
    raise Abort() from None
click.exceptions.Abort

[0m18:57:43.569939 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": false, "command_wall_clock_time": 13.164267, "process_in_blocks": "0", "process_kernel_time": 0.197135, "process_mem_max_rss": "101908480", "process_out_blocks": "0", "process_user_time": 0.967561}
[0m18:57:43.576270 [debug] [MainThread]: Command `dbt init` failed at 18:57:43.573684 after 13.17 seconds
[0m18:57:43.583487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce95b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df8a620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df8e5c0>]}
[0m18:57:43.585813 [debug] [MainThread]: Flushing usage events
[0m18:40:30.845901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04860c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c2330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c22a0>]}


============================== 18:40:30.884779 | 0e9f6866-d1f0-4587-a088-d64bb6c2a0c7 ==============================
[0m18:40:30.884779 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:40:30.888297 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'version_check': 'True', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:40:30.895267 [info ] [MainThread]: target not specified in profile 'ecommerce_dbt', using 'default'
[0m18:40:30.896118 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'ecommerce_dbt' does not have a target named 'default'. The valid target names for this profile are:
   - trino
   - target
[0m18:40:30.898758 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.20051868, "process_in_blocks": "37000", "process_kernel_time": 0.580722, "process_mem_max_rss": "297796", "process_out_blocks": "3014", "process_user_time": 2.352026}
[0m18:40:30.899510 [debug] [MainThread]: Command `cli seed` failed at 18:40:30.899263 after 0.20 seconds
[0m18:40:30.900121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff032f500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0036090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0034a40>]}
[0m18:40:30.905076 [debug] [MainThread]: Flushing usage events
[0m18:40:31.472766 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:40:54.413588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff082f440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff10292e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e01d0>]}


============================== 18:40:54.438682 | fabd89e3-6b2a-474e-817d-8ce785073854 ==============================
[0m18:40:54.438682 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:40:54.440377 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_format': 'default', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'version_check': 'True', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'no_print': 'None', 'partial_parse': 'True'}
[0m18:40:54.449398 [info ] [MainThread]: target not specified in profile 'ecommerce_dbt', using 'default'
[0m18:40:54.450437 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'ecommerce_dbt' does not have a target named 'default'. The valid target names for this profile are:
   - trino
   - target
[0m18:40:54.453215 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.1452468, "process_in_blocks": "22872", "process_kernel_time": 0.309022, "process_mem_max_rss": "295288", "process_out_blocks": "3", "process_user_time": 2.036595}
[0m18:40:54.454076 [debug] [MainThread]: Command `cli run` failed at 18:40:54.453885 after 0.15 seconds
[0m18:40:54.454587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06a1ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff025d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0558cb0>]}
[0m18:40:54.455103 [debug] [MainThread]: Flushing usage events
[0m18:40:54.920118 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:41:12.786043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03a69f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b1e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b2bd0>]}


============================== 18:41:12.798917 | f0da82d0-a8c6-49e1-ae80-6809848b6353 ==============================
[0m18:41:12.798917 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:41:12.800619 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:41:12.804954 [info ] [MainThread]: target not specified in profile 'ecommerce_dbt', using 'default'
[0m18:41:12.805524 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'ecommerce_dbt' does not have a target named 'default'. The valid target names for this profile are:
   - trino
   - target
[0m18:41:12.807582 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.15523216, "process_in_blocks": "14920", "process_kernel_time": 0.412472, "process_mem_max_rss": "295632", "process_out_blocks": "3", "process_user_time": 1.809686}
[0m18:41:12.808118 [debug] [MainThread]: Command `cli run` failed at 18:41:12.807960 after 0.16 seconds
[0m18:41:12.808541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03a69f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a11ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01610a0>]}
[0m18:41:12.808995 [debug] [MainThread]: Flushing usage events
[0m18:41:13.268368 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:42:28.098442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04529f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b07950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1ded580>]}


============================== 18:42:28.110567 | 1f41a421-2ff3-4d78-a326-cd21305657ff ==============================
[0m18:42:28.110567 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:42:28.111497 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'version_check': 'True', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:42:28.368808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04e1dc0>]}
[0m18:42:28.440067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02d3e60>]}
[0m18:42:28.440897 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:42:28.745331 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:42:28.746559 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m18:42:28.746996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12b8ce0>]}
[0m18:42:30.605715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef6c6720>]}
[0m18:42:30.941722 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:42:30.944715 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:42:30.958592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4accbf0>]}
[0m18:42:30.959781 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:42:30.960167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ae3a10>]}
[0m18:42:30.965264 [info ] [MainThread]: 
[0m18:42:30.966126 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m18:42:30.966623 [info ] [MainThread]: 
[0m18:42:30.967716 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:42:30.976990 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:42:31.021728 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:42:31.022913 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:42:31.023432 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:42:31.023786 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:42:31.025767 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4a54110>]}
[0m18:42:35.415042 [debug] [ThreadPool]: SQL status: SUCCESS in 4.389 seconds
[0m18:42:35.425036 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:42:35.428214 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_bronze)
[0m18:42:35.429898 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "bronze"
"
[0m18:42:35.445624 [debug] [ThreadPool]: Using trino connection "create_iceberg_bronze"
[0m18:42:35.446446 [debug] [ThreadPool]: On create_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_bronze"} */
create schema if not exists "iceberg"."bronze"
[0m18:42:35.446856 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:42:36.721356 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 1.274 seconds
[0m18:42:36.724593 [debug] [ThreadPool]: On create_iceberg_bronze: COMMIT
[0m18:42:36.725326 [debug] [ThreadPool]: On create_iceberg_bronze: Close
[0m18:42:36.740228 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_bronze, now list_iceberg_gold)
[0m18:42:36.747321 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_bronze'
[0m18:42:36.767193 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_silver'
[0m18:42:36.769170 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:42:36.776828 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:42:36.775732 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:42:36.777781 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:42:36.778281 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:42:36.779089 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:42:36.779701 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:42:36.780250 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:42:36.780714 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:43:15.657344 [debug] [ThreadPool]: SQL status: SUCCESS in 38.852 seconds
[0m18:43:15.644648 [debug] [ThreadPool]: SQL status: SUCCESS in 38.845 seconds
[0m18:43:15.651070 [debug] [ThreadPool]: SQL status: SUCCESS in 38.871 seconds
[0m18:43:15.691367 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:43:15.693710 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:43:15.694351 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:43:15.696149 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:43:15.696756 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:43:15.697623 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:43:15.717273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffee903560>]}
[0m18:43:15.724883 [debug] [MainThread]: On master: COMMIT
[0m18:43:15.792282 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m18:43:15.793466 [debug] [Thread-2 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:43:15.801986 [debug] [Thread-3 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m18:43:15.802592 [info ] [Thread-1 (]: 1 of 4 START seed file bronze.raw_customer_events .............................. [RUN]
[0m18:43:15.803788 [info ] [Thread-2 (]: 2 of 4 START seed file bronze.raw_inventory_snapshots .......................... [RUN]
[0m18:43:15.805722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_gold, now seed.ecommerce_dbt.raw_customer_events)
[0m18:43:15.804877 [info ] [Thread-3 (]: 3 of 4 START seed file bronze.raw_payment_transactions ......................... [RUN]
[0m18:43:15.806694 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m18:43:15.807865 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m18:43:15.808558 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now seed.ecommerce_dbt.raw_payment_transactions)
[0m18:43:15.809057 [debug] [Thread-2 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:43:15.810763 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m18:43:15.811302 [debug] [Thread-3 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m18:43:15.811848 [debug] [Thread-2 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:43:15.825153 [debug] [Thread-3 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m18:43:19.361467 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:43:19.363594 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_customer_events"} */

    create table "iceberg"."bronze"."raw_customer_events" ("event_id" VARCHAR,"customer_id" VARCHAR,"session_id" VARCHAR,"event_type" VARCHAR,"event_timestamp" TIMESTAMP,"page_url" VARCHAR,"product_id" VARCHAR,"category_id" VARCHAR,"referrer_source" VARCHAR,"device_type" VARCHAR,"user_agent" VARCHAR,"ip_address" VARCHAR)
[0m18:43:19.364456 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:43:20.436475 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:43:20.444988 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_payment_transactions"} */

    create table "iceberg"."bronze"."raw_payment_transactions" ("transaction_id" VARCHAR,"order_id" VARCHAR,"customer_id" VARCHAR,"payment_method" VARCHAR,"payment_status" VARCHAR,"amount" DOUBLE,"currency" VARCHAR,"transaction_timestamp" TIMESTAMP,"processor_response_code" INTEGER,"gateway_fee" DOUBLE,"merchant_id" VARCHAR,"billing_country" VARCHAR,"risk_score" INTEGER)
[0m18:43:20.452495 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:43:20.620621 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:43:20.624949 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_inventory_snapshots"} */

    create table "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id" VARCHAR,"product_id" VARCHAR,"warehouse_id" VARCHAR,"snapshot_date" DATE,"quantity_on_hand" INTEGER,"quantity_reserved" INTEGER,"quantity_available" INTEGER,"reorder_point" INTEGER,"reorder_quantity" INTEGER,"supplier_id" VARCHAR,"last_received_date" DATE,"unit_cost" DOUBLE)
[0m18:43:20.625685 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:43:22.805293 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 3.439 seconds
[0m18:43:22.928271 [debug] [Thread-2 (]: SQL status: CREATE TABLE in 2.302 seconds
[0m18:43:22.993799 [debug] [Thread-3 (]: SQL status: CREATE TABLE in 2.541 seconds
[0m18:43:30.806328 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:43:30.820713 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:43:31.249063 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:43:31.256076 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:43:31.585810 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:43:31.632320 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:44:08.115521 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 36.812 seconds
[0m18:44:08.108133 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 36.445 seconds
[0m18:44:08.123843 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 37.270 seconds
[0m18:44:19.193840 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:44:19.211195 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:44:19.248346 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:44:19.266552 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:44:19.382831 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:44:19.383767 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:44:49.831207 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 30.562 seconds
[0m18:44:53.390444 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 33.989 seconds
[0m18:44:53.396885 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 34.100 seconds
[0m18:44:59.916521 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:44:59.927282 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:45:03.056666 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:45:03.076876 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:45:03.099935 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:45:03.108974 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:45:33.618542 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 30.424 seconds
[0m18:45:33.858775 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 30.731 seconds
[0m18:45:33.873545 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 33.937 seconds
[0m18:45:54.836461 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:45:54.864687 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:45:55.271130 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:45:55.286213 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:45:55.567272 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:45:55.568080 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:47:03.936856 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 68.647 seconds
[0m18:47:03.917907 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 69.023 seconds
[0m18:47:03.922076 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 68.342 seconds
[0m18:47:22.297028 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:47:22.315425 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:47:22.496345 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:47:22.497887 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:47:22.623546 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:47:22.625257 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:47:46.723396 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 24.097 seconds
[0m18:47:46.716627 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 24.378 seconds
[0m18:47:47.136122 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 24.635 seconds
[0m18:47:51.964432 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:47:51.972244 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:47:52.100145 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:47:52.113705 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:47:52.131952 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:47:52.144376 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:48:04.367737 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 12.237 seconds
[0m18:48:04.695418 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 12.716 seconds
[0m18:48:04.747061 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 12.601 seconds
[0m18:48:14.119602 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:48:14.170584 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:48:14.494745 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:48:14.512683 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:48:15.840032 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:48:15.841417 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:48:29.978237 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 15.449 seconds
[0m18:48:29.994745 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 15.806 seconds
[0m18:48:30.150250 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 14.307 seconds
[0m18:48:34.556454 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:48:34.565195 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:48:34.549000 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:48:34.595825 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:48:34.932508 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:48:34.933584 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:48:46.193492 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 11.249 seconds
[0m18:48:46.484499 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 11.908 seconds
[0m18:48:47.095104 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 12.455 seconds
[0m18:48:55.076576 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:48:55.117749 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:48:55.283186 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:48:55.300438 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:48:55.345168 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:48:55.352904 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:49:07.822548 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 12.518 seconds
[0m18:49:07.833439 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 12.702 seconds
[0m18:49:07.955787 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 12.595 seconds
[0m18:49:12.769210 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:49:12.819950 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m18:49:12.967988 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:49:12.968976 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:49:13.037080 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:49:13.037851 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:49:22.909465 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 10.056 seconds
[0m18:49:22.946116 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 9.961 seconds
[0m18:49:22.981800 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 9.943 seconds
[0m18:49:23.063259 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m18:49:23.365063 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: COMMIT
[0m18:49:23.431613 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: Close
[0m18:49:23.546510 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffee94e150>]}
[0m18:49:23.578958 [info ] [Thread-2 (]: 2 of 4 OK loaded seed file bronze.raw_inventory_snapshots ...................... [[32mCREATE 10000[0m in 367.66s]
[0m18:49:23.589233 [debug] [Thread-2 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:49:23.625847 [debug] [Thread-2 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m18:49:23.629038 [info ] [Thread-2 (]: 4 of 4 START seed file bronze.raw_support_tickets .............................. [RUN]
[0m18:49:23.642618 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_support_tickets)
[0m18:49:23.644237 [debug] [Thread-2 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m18:49:23.652549 [debug] [Thread-2 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m18:49:40.241397 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m18:49:40.286581 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_support_tickets"} */

    create table "iceberg"."bronze"."raw_support_tickets" ("ticket_id" VARCHAR,"customer_id" VARCHAR,"order_id" VARCHAR,"ticket_type" VARCHAR,"priority" VARCHAR,"status" VARCHAR,"created_timestamp" TIMESTAMP,"first_response_timestamp" TIMESTAMP,"resolution_timestamp" TIMESTAMP,"agent_id" VARCHAR,"satisfaction_score" INTEGER,"subject" VARCHAR,"channel" VARCHAR)
[0m18:49:40.302113 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:49:42.013742 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:49:42.035486 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:49:42.353626 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:49:42.355055 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:49:42.586209 [debug] [Thread-2 (]: SQL status: CREATE TABLE in 2.284 seconds
[0m18:49:45.078290 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m18:49:45.081155 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m18:50:10.153403 [debug] [Thread-3 (]: SQL status: INSERT (1_000 rows) in 27.694 seconds
[0m18:50:12.012821 [debug] [Thread-2 (]: SQL status: INSERT (1_000 rows) in 26.883 seconds
[0m18:50:12.443741 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 30.345 seconds
[0m18:50:26.714682 [debug] [Thread-3 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m18:50:26.734039 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m18:50:27.127505 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:50:27.135133 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:50:27.216465 [debug] [Thread-2 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m18:50:27.220246 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m18:50:29.247170 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: ROLLBACK
[0m18:50:29.291920 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: Close
[0m18:50:29.286684 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_support_tickets: ROLLBACK
[0m18:50:29.309630 [debug] [Thread-2 (]: On seed.ecommerce_dbt.raw_support_tickets: Close
[0m18:50:29.353183 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: ROLLBACK
[0m18:50:29.354488 [debug] [Thread-3 (]: On seed.ecommerce_dbt.raw_payment_transactions: Close
[0m18:50:29.649908 [debug] [Thread-1 (]: Database Error in seed raw_customer_events (seeds/raw_customer_events.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff86efec00>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:29.637383 [debug] [Thread-3 (]: Database Error in seed raw_payment_transactions (seeds/raw_payment_transactions.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff87017bc0>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:29.645053 [debug] [Thread-2 (]: Database Error in seed raw_support_tickets (seeds/raw_support_tickets.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff870158e0>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:29.830921 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fff86f18d70>]}
[0m18:50:29.824404 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fff86f19670>]}
[0m18:50:29.847623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f41a421-2ff3-4d78-a326-cd21305657ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fff86f98aa0>]}
[0m18:50:29.922084 [error] [Thread-3 (]: 3 of 4 ERROR loading seed file bronze.raw_payment_transactions ................. [[31mERROR[0m in 433.86s]
[0m18:50:29.914691 [error] [Thread-2 (]: 4 of 4 ERROR loading seed file bronze.raw_support_tickets ...................... [[31mERROR[0m in 66.05s]
[0m18:50:29.941729 [debug] [Thread-3 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m18:50:29.917514 [error] [Thread-1 (]: 1 of 4 ERROR loading seed file bronze.raw_customer_events ...................... [[31mERROR[0m in 433.85s]
[0m18:50:29.958798 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m18:50:29.937690 [debug] [Thread-2 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m18:50:29.963695 [debug] [Thread-6 (]: Marking all children of 'seed.ecommerce_dbt.raw_payment_transactions' to be skipped because of status 'error'.  Reason: Database Error in seed raw_payment_transactions (seeds/raw_payment_transactions.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff87017bc0>: Failed to establish a new connection: [Errno 111] Connection refused')).
[0m18:50:30.010239 [debug] [Thread-6 (]: Marking all children of 'seed.ecommerce_dbt.raw_customer_events' to be skipped because of status 'error'.  Reason: Database Error in seed raw_customer_events (seeds/raw_customer_events.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff86efec00>: Failed to establish a new connection: [Errno 111] Connection refused')).
[0m18:50:30.013817 [debug] [Thread-6 (]: Marking all children of 'seed.ecommerce_dbt.raw_support_tickets' to be skipped because of status 'error'.  Reason: Database Error in seed raw_support_tickets (seeds/raw_support_tickets.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff870158e0>: Failed to establish a new connection: [Errno 111] Connection refused')).
[0m18:50:30.173690 [debug] [MainThread]: On master: COMMIT
[0m18:50:30.178242 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:50:30.179977 [debug] [MainThread]: Connection 'seed.ecommerce_dbt.raw_customer_events' was properly closed.
[0m18:50:30.181610 [debug] [MainThread]: Connection 'seed.ecommerce_dbt.raw_payment_transactions' was properly closed.
[0m18:50:30.182737 [debug] [MainThread]: Connection 'seed.ecommerce_dbt.raw_support_tickets' was properly closed.
[0m18:50:30.192146 [info ] [MainThread]: 
[0m18:50:30.210343 [info ] [MainThread]: Finished running 4 seeds in 0 hours 7 minutes and 59.22 seconds (479.22s).
[0m18:50:30.268802 [debug] [MainThread]: Command end result
[0m18:50:30.532261 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:50:30.595032 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:50:30.665948 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m18:50:30.666818 [info ] [MainThread]: 
[0m18:50:30.669700 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m18:50:30.671384 [info ] [MainThread]: 
[0m18:50:30.673945 [error] [MainThread]: [31mFailure in seed raw_payment_transactions (seeds/raw_payment_transactions.csv)[0m
[0m18:50:30.675906 [error] [MainThread]:   Database Error in seed raw_payment_transactions (seeds/raw_payment_transactions.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff87017bc0>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:30.677735 [info ] [MainThread]: 
[0m18:50:30.678699 [error] [MainThread]: [31mFailure in seed raw_customer_events (seeds/raw_customer_events.csv)[0m
[0m18:50:30.679463 [error] [MainThread]:   Database Error in seed raw_customer_events (seeds/raw_customer_events.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff86efec00>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:30.680770 [info ] [MainThread]: 
[0m18:50:30.681672 [error] [MainThread]: [31mFailure in seed raw_support_tickets (seeds/raw_support_tickets.csv)[0m
[0m18:50:30.682678 [error] [MainThread]:   Database Error in seed raw_support_tickets (seeds/raw_support_tickets.csv)
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fff870158e0>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:30.684718 [info ] [MainThread]: 
[0m18:50:30.686929 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=3 SKIP=0 NO-OP=0 TOTAL=4
[0m18:50:30.706204 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 482.6582, "process_in_blocks": "4829232", "process_kernel_time": 30.904799, "process_mem_max_rss": "374168", "process_out_blocks": "4146", "process_user_time": 137.34723}
[0m18:50:30.715878 [debug] [MainThread]: Command `cli seed` failed at 18:50:30.714979 after 482.68 seconds
[0m18:50:30.720455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff026d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01ac620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01ac6e0>]}
[0m18:50:30.721451 [debug] [MainThread]: Flushing usage events
[0m18:50:31.925897 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:50:38.576003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19ecdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06a3020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06a2f90>]}


============================== 18:50:38.595764 | 34debc76-e703-44e5-89e3-968975ea61a6 ==============================
[0m18:50:38.595764 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:50:38.598198 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_format': 'default', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'version_check': 'True', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'no_print': 'None', 'partial_parse': 'True'}
[0m18:50:38.915241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34debc76-e703-44e5-89e3-968975ea61a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff03410>]}
[0m18:50:39.009472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34debc76-e703-44e5-89e3-968975ea61a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff001ce90>]}
[0m18:50:39.011007 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:50:39.341523 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:50:39.505514 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:50:39.506883 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:50:39.602027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '34debc76-e703-44e5-89e3-968975ea61a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd4e300>]}
[0m18:50:39.724132 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:50:39.728262 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:50:39.745933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '34debc76-e703-44e5-89e3-968975ea61a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f3260>]}
[0m18:50:39.747118 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:50:39.749468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34debc76-e703-44e5-89e3-968975ea61a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81c1a0>]}
[0m18:50:39.754147 [info ] [MainThread]: 
[0m18:50:39.755370 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m18:50:39.756088 [info ] [MainThread]: 
[0m18:50:39.757599 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:50:39.769830 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:50:39.809010 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:50:39.809797 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:50:39.810166 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:50:39.810510 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:50:39.812514 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '34debc76-e703-44e5-89e3-968975ea61a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef516e70>]}
[0m18:50:40.990416 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:50:41.002279 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:50:41.003418 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m18:50:41.005873 [info ] [MainThread]: 
[0m18:50:41.008094 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.25 seconds (1.25s).
[0m18:50:41.011758 [error] [MainThread]: Encountered an error:
Database Error
  failed to execute: HTTPConnectionPool(host='trino-coordinator', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7fffef683e90>: Failed to establish a new connection: [Errno 111] Connection refused'))
[0m18:50:41.017201 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.537881, "process_in_blocks": "316392", "process_kernel_time": 1.934749, "process_mem_max_rss": "286560", "process_out_blocks": "1158", "process_user_time": 2.896091}
[0m18:50:41.020180 [debug] [MainThread]: Command `cli run` failed at 18:50:41.019243 after 2.54 seconds
[0m18:50:41.022987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1d010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81e870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef831b50>]}
[0m18:50:41.025873 [debug] [MainThread]: Flushing usage events
[0m18:50:41.681776 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:51:05.611876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0159fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff015ad20>]}


============================== 18:51:05.654412 | f862292e-6fb8-4dc9-b308-aea509cefa00 ==============================
[0m18:51:05.654412 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:51:05.656034 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:51:06.085226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f862292e-6fb8-4dc9-b308-aea509cefa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01d3530>]}
[0m18:51:06.337757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f862292e-6fb8-4dc9-b308-aea509cefa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04eedb0>]}
[0m18:51:06.342177 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:51:07.103611 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:51:07.448578 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:51:07.450072 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:51:07.593008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f862292e-6fb8-4dc9-b308-aea509cefa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefce3500>]}
[0m18:51:07.802014 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:51:07.831059 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:51:07.914226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f862292e-6fb8-4dc9-b308-aea509cefa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ff170>]}
[0m18:51:07.916779 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:51:07.924439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f862292e-6fb8-4dc9-b308-aea509cefa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82bf20>]}
[0m18:51:07.943075 [info ] [MainThread]: 
[0m18:51:07.945881 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m18:51:07.947063 [info ] [MainThread]: 
[0m18:51:07.951224 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:51:07.980882 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:51:08.081617 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:51:08.082418 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:51:08.082889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:08.083328 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:51:08.085902 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'f862292e-6fb8-4dc9-b308-aea509cefa00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef524590>]}
[0m18:51:08.994144 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250922_185108_00000_hju39
[0m18:51:08.995511 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INTERNAL_ERROR, name=SERVER_STARTING_UP, message="Trino server is still initializing", query_id=20250922_185108_00000_hju39)
[0m18:51:08.996495 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:51:09.001615 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:51:09.002470 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m18:51:09.005494 [info ] [MainThread]: 
[0m18:51:09.007461 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.06 seconds (1.06s).
[0m18:51:09.009967 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INTERNAL_ERROR, name=SERVER_STARTING_UP, message="Trino server is still initializing", query_id=20250922_185108_00000_hju39)
[0m18:51:09.016169 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5503747, "process_in_blocks": "227672", "process_kernel_time": 3.483397, "process_mem_max_rss": "286504", "process_out_blocks": "1159", "process_user_time": 5.797558}
[0m18:51:09.023583 [debug] [MainThread]: Command `cli run` failed at 18:51:09.022097 after 3.56 seconds
[0m18:51:09.026730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef828290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82bc50>]}
[0m18:51:09.027401 [debug] [MainThread]: Flushing usage events
[0m18:51:09.600892 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:51:32.002445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff015bda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff015a7b0>]}


============================== 18:51:32.016310 | a713945a-11e1-4693-802f-30e04f758252 ==============================
[0m18:51:32.016310 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:51:32.017183 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:51:32.296307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff18ed250>]}
[0m18:51:32.368351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b2ade0>]}
[0m18:51:32.369736 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:51:32.670055 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:51:32.822109 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:51:32.823317 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:51:32.900578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2f950>]}
[0m18:51:32.997569 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:51:33.000807 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:51:33.015688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ff3b0>]}
[0m18:51:33.018852 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:51:33.020658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023ef00>]}
[0m18:51:33.025580 [info ] [MainThread]: 
[0m18:51:33.027223 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m18:51:33.028977 [info ] [MainThread]: 
[0m18:51:33.030314 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:51:33.039595 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:51:33.071069 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:51:33.071625 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:51:33.071926 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:33.072244 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:51:33.073558 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef857470>]}
[0m18:51:37.084253 [debug] [ThreadPool]: SQL status: SUCCESS in 4.010 seconds
[0m18:51:37.091734 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:51:37.108756 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m18:51:37.117993 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_bronze'
[0m18:51:37.145578 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_silver'
[0m18:51:37.147508 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:51:37.148605 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:51:37.152979 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:51:37.153519 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:51:37.155014 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:37.154467 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:51:37.154020 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:51:37.157612 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:37.158478 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:59.742743 [debug] [ThreadPool]: SQL status: SUCCESS in 22.537 seconds
[0m18:51:59.768879 [debug] [ThreadPool]: SQL status: SUCCESS in 22.553 seconds
[0m18:52:00.064865 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:52:00.140658 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:52:00.152535 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:52:00.153773 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:52:00.190027 [debug] [ThreadPool]: SQL status: SUCCESS in 23.031 seconds
[0m18:52:00.251064 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:52:00.253692 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:52:00.333565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff07fb0>]}
[0m18:52:00.417750 [debug] [MainThread]: On master: COMMIT
[0m18:52:00.776526 [debug] [Thread-3 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m18:52:00.770606 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m18:52:00.778291 [debug] [Thread-2 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:52:00.798176 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m18:52:00.815856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now model.ecommerce_dbt.bronze_customer_events)
[0m18:52:00.804481 [info ] [Thread-3 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m18:52:00.808100 [info ] [Thread-2 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m18:52:00.826607 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_iceberg_gold, now model.ecommerce_dbt.bronze_payment_transactions)
[0m18:52:00.827283 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m18:52:00.828418 [debug] [Thread-3 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m18:52:00.827846 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m18:52:00.856690 [debug] [Thread-2 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:52:01.083298 [debug] [Thread-2 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:52:01.082900 [debug] [Thread-3 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:52:01.084821 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m18:52:01.105484 [debug] [Thread-3 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m18:52:01.120738 [debug] [Thread-2 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:52:01.128962 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m18:52:02.077672 [debug] [Thread-2 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:52:02.082297 [debug] [Thread-3 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:52:02.084360 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m18:52:02.111594 [debug] [Thread-3 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:52:02.113146 [debug] [Thread-3 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m18:52:02.113931 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m18:52:02.128153 [debug] [Thread-2 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:52:02.119456 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:52:02.129536 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m18:52:02.134151 [debug] [Thread-2 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m18:52:02.151672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:02.164579 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:55:01.656369 [debug] [Thread-3 (]: Trino adapter: Trino query id: 20250922_185202_00006_hju39
[0m18:55:01.730254 [debug] [Thread-3 (]: Trino adapter: Trino error: TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting task status http://192.168.97.9:8080/v1/task/20250922_185202_00006_hju39.1.0.0 - 41 failures, failure duration 61.45s, total failed request time 89.79s)", query_id=20250922_185202_00006_hju39)
[0m18:55:01.775950 [debug] [Thread-3 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m18:55:01.780671 [debug] [Thread-3 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m18:55:01.947644 [debug] [Thread-3 (]: Database Error in model bronze_payment_transactions (models/bronze/bronze_payment_transactions.sql)
  TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting task status http://192.168.97.9:8080/v1/task/20250922_185202_00006_hju39.1.0.0 - 41 failures, failure duration 61.45s, total failed request time 89.79s)", query_id=20250922_185202_00006_hju39)
  compiled code at target/run/ecommerce_dbt/models/bronze/bronze_payment_transactions.sql
[0m18:55:02.056719 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef423200>]}
[0m18:55:02.140249 [error] [Thread-3 (]: 3 of 4 ERROR creating sql table model bronze.bronze_payment_transactions ....... [[31mERROR[0m in 181.13s]
[0m18:55:02.173509 [debug] [Thread-3 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m18:55:02.190426 [debug] [Thread-3 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m18:55:02.202588 [info ] [Thread-3 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m18:55:02.207424 [debug] [Thread-6 (]: Marking all children of 'model.ecommerce_dbt.bronze_payment_transactions' to be skipped because of status 'error'.  Reason: Database Error in model bronze_payment_transactions (models/bronze/bronze_payment_transactions.sql)
  TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting task status http://192.168.97.9:8080/v1/task/20250922_185202_00006_hju39.1.0.0 - 41 failures, failure duration 61.45s, total failed request time 89.79s)", query_id=20250922_185202_00006_hju39)
  compiled code at target/run/ecommerce_dbt/models/bronze/bronze_payment_transactions.sql.
[0m18:55:02.223703 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m18:55:02.226179 [debug] [Thread-3 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m18:55:02.413115 [debug] [Thread-3 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:55:02.473269 [debug] [Thread-3 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m18:55:02.620355 [debug] [Thread-3 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m18:55:02.671043 [debug] [Thread-3 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m18:55:02.675236 [debug] [Thread-3 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m18:55:02.676595 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:55:03.776616 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20250922_185202_00005_hju39
[0m18:55:03.778903 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting info for task http://192.168.97.7:8080/v1/task/20250922_185202_00005_hju39.1.0.0 - 16 failures, failure duration 60.93s, total failed request time 37.18s)", query_id=20250922_185202_00005_hju39)
[0m18:55:03.780459 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m18:55:03.781474 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m18:55:03.794361 [debug] [Thread-1 (]: Database Error in model bronze_customer_events (models/bronze/bronze_customer_events.sql)
  TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting info for task http://192.168.97.7:8080/v1/task/20250922_185202_00005_hju39.1.0.0 - 16 failures, failure duration 60.93s, total failed request time 37.18s)", query_id=20250922_185202_00005_hju39)
  compiled code at target/run/ecommerce_dbt/models/bronze/bronze_customer_events.sql
[0m18:55:03.800153 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeeb333b0>]}
[0m18:55:03.804961 [error] [Thread-1 (]: 1 of 4 ERROR creating sql table model bronze.bronze_customer_events ............ [[31mERROR[0m in 182.99s]
[0m18:55:03.810399 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m18:55:03.813290 [debug] [Thread-6 (]: Marking all children of 'model.ecommerce_dbt.bronze_customer_events' to be skipped because of status 'error'.  Reason: Database Error in model bronze_customer_events (models/bronze/bronze_customer_events.sql)
  TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting info for task http://192.168.97.7:8080/v1/task/20250922_185202_00005_hju39.1.0.0 - 16 failures, failure duration 60.93s, total failed request time 37.18s)", query_id=20250922_185202_00005_hju39)
  compiled code at target/run/ecommerce_dbt/models/bronze/bronze_customer_events.sql.
[0m18:55:04.368121 [debug] [Thread-2 (]: Trino adapter: Trino query id: 20250922_185202_00007_hju39
[0m18:55:04.375986 [debug] [Thread-2 (]: Trino adapter: Trino error: TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting task status http://192.168.97.7:8080/v1/task/20250922_185202_00007_hju39.2.0.0 - 43 failures, failure duration 62.56s, total failed request time 90.65s)", query_id=20250922_185202_00007_hju39)
[0m18:55:04.380120 [debug] [Thread-2 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m18:55:04.383413 [debug] [Thread-2 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m18:55:04.399532 [debug] [Thread-2 (]: Database Error in model bronze_inventory_snapshots (models/bronze/bronze_inventory_snapshots.sql)
  TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting task status http://192.168.97.7:8080/v1/task/20250922_185202_00007_hju39.2.0.0 - 43 failures, failure duration 62.56s, total failed request time 90.65s)", query_id=20250922_185202_00007_hju39)
  compiled code at target/run/ecommerce_dbt/models/bronze/bronze_inventory_snapshots.sql
[0m18:55:04.409075 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef855640>]}
[0m18:55:04.412985 [error] [Thread-2 (]: 2 of 4 ERROR creating sql table model bronze.bronze_inventory_snapshots ........ [[31mERROR[0m in 183.58s]
[0m18:55:04.415623 [debug] [Thread-2 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:55:04.417040 [debug] [Thread-6 (]: Marking all children of 'model.ecommerce_dbt.bronze_inventory_snapshots' to be skipped because of status 'error'.  Reason: Database Error in model bronze_inventory_snapshots (models/bronze/bronze_inventory_snapshots.sql)
  TrinoQueryError(type=INTERNAL_ERROR, name=TOO_MANY_REQUESTS_FAILED, message="Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes. (getting task status http://192.168.97.7:8080/v1/task/20250922_185202_00007_hju39.2.0.0 - 43 failures, failure duration 62.56s, total failed request time 90.65s)", query_id=20250922_185202_00007_hju39)
  compiled code at target/run/ecommerce_dbt/models/bronze/bronze_inventory_snapshots.sql.
[0m18:55:20.163755 [debug] [Thread-3 (]: SQL status: CREATE TABLE (1_000 rows) in 17.355 seconds
[0m18:55:23.160732 [debug] [Thread-3 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m18:55:23.457437 [debug] [Thread-3 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m18:55:24.099215 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a713945a-11e1-4693-802f-30e04f758252', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeeb33560>]}
[0m18:55:24.145720 [info ] [Thread-3 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (1_000 rows)[0m in 21.41s]
[0m18:55:24.211138 [debug] [Thread-3 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m18:55:27.380072 [debug] [MainThread]: On master: COMMIT
[0m18:55:28.277036 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:55:28.326352 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m18:55:28.327334 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_customer_events' was properly closed.
[0m18:55:28.328298 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_inventory_snapshots' was properly closed.
[0m18:55:29.796349 [info ] [MainThread]: 
[0m18:58:37.459493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b727e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0114da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bb110>]}


============================== 18:58:37.508948 | b434b18e-ad03-4d49-8372-7cff0625d332 ==============================
[0m18:58:37.508948 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:58:37.519028 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'empty': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'debug': 'False', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'no_print': 'None', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True'}
[0m18:58:38.167503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff083b830>]}
[0m18:58:38.628093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff91490>]}
[0m18:58:38.644154 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:58:39.427744 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:58:39.610322 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:58:39.611902 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:58:39.689153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe1ad20>]}
[0m18:58:39.800931 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:58:39.807954 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:58:39.832365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef6cbf20>]}
[0m18:58:39.833772 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:58:39.834256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8b0050>]}
[0m18:58:39.841339 [info ] [MainThread]: 
[0m18:58:39.842179 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m18:58:39.842720 [info ] [MainThread]: 
[0m18:58:39.844969 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:58:39.856005 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:58:39.893785 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:58:39.894564 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:58:39.895016 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:58:39.895339 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:58:39.897054 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef905e20>]}
[0m18:58:41.875183 [debug] [ThreadPool]: SQL status: SUCCESS in 1.979 seconds
[0m18:58:41.879582 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:58:41.882215 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_bronze)
[0m18:58:41.883490 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "bronze"
"
[0m18:58:41.892346 [debug] [ThreadPool]: Using trino connection "create_iceberg_bronze"
[0m18:58:41.892883 [debug] [ThreadPool]: On create_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_bronze"} */
create schema if not exists "iceberg"."bronze"
[0m18:58:41.893224 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:58:42.867284 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.973 seconds
[0m18:58:42.871336 [debug] [ThreadPool]: On create_iceberg_bronze: COMMIT
[0m18:58:42.872159 [debug] [ThreadPool]: On create_iceberg_bronze: Close
[0m18:58:42.881731 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_bronze, now list_iceberg_gold)
[0m18:58:42.908424 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:58:42.909115 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:58:42.909463 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:58:48.239401 [debug] [ThreadPool]: SQL status: SUCCESS in 5.328 seconds
[0m18:58:48.253418 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:58:48.254383 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:58:48.258083 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m18:58:48.269712 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:58:48.270847 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:58:48.271409 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:58:50.260458 [debug] [ThreadPool]: SQL status: SUCCESS in 1.988 seconds
[0m18:58:50.268135 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:58:50.270527 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:58:50.276067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m18:58:50.287943 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:58:50.288748 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:58:50.289224 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:58:52.774553 [debug] [ThreadPool]: SQL status: SUCCESS in 2.480 seconds
[0m18:58:52.792362 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:58:52.795059 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:58:52.812530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef905910>]}
[0m18:58:52.829963 [debug] [MainThread]: On master: COMMIT
[0m18:58:52.941518 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m18:58:52.949416 [info ] [Thread-1 (]: 1 of 4 START seed file bronze.raw_customer_events .............................. [RUN]
[0m18:58:52.950916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m18:58:52.961265 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m18:58:52.962561 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m18:58:54.440209 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:58:54.446607 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_customer_events"} */

    create table "iceberg"."bronze"."raw_customer_events" ("event_id" VARCHAR,"customer_id" VARCHAR,"session_id" VARCHAR,"event_type" VARCHAR,"event_timestamp" TIMESTAMP,"page_url" VARCHAR,"product_id" VARCHAR,"category_id" VARCHAR,"referrer_source" VARCHAR,"device_type" VARCHAR,"user_agent" VARCHAR,"ip_address" VARCHAR)
[0m18:58:54.449885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:58.984481 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 4.527 seconds
[0m18:59:00.814285 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:00.816108 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:08.757936 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.940 seconds
[0m18:59:09.827570 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:09.828498 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:17.489268 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.658 seconds
[0m18:59:19.182158 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:19.184201 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:24.863137 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.669 seconds
[0m18:59:26.724051 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:26.725387 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:37.607415 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 10.876 seconds
[0m18:59:39.099375 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:39.101436 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:41.935252 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 2.832 seconds
[0m18:59:43.012924 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:43.013598 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:46.708847 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.695 seconds
[0m18:59:47.844235 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:47.845190 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:51.489961 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.643 seconds
[0m18:59:53.191986 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:53.193534 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m18:59:56.835434 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.640 seconds
[0m18:59:58.047040 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m18:59:58.048129 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m19:00:02.047115 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.997 seconds
[0m19:00:03.539376 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m19:00:03.540814 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m19:00:10.287055 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.739 seconds
[0m19:00:12.744950 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m19:00:12.748788 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m19:00:18.815725 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.064 seconds
[0m19:00:20.535722 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m19:00:20.536583 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m19:00:24.606681 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.068 seconds
[0m19:00:24.638885 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_customer_events"
[0m19:00:24.671841 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: COMMIT
[0m19:00:24.679866 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: Close
[0m19:00:24.685175 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef885fa0>]}
[0m19:00:24.686956 [info ] [Thread-1 (]: 1 of 4 OK loaded seed file bronze.raw_customer_events .......................... [[32mCREATE 12000[0m in 91.73s]
[0m19:00:24.691031 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m19:00:24.692116 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:00:24.694123 [info ] [Thread-1 (]: 2 of 4 START seed file bronze.raw_inventory_snapshots .......................... [RUN]
[0m19:00:24.695218 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m19:00:24.695883 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:00:24.696359 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:00:25.340464 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:25.341140 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_inventory_snapshots"} */

    create table "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id" VARCHAR,"product_id" VARCHAR,"warehouse_id" VARCHAR,"snapshot_date" DATE,"quantity_on_hand" INTEGER,"quantity_reserved" INTEGER,"quantity_available" INTEGER,"reorder_point" INTEGER,"reorder_quantity" INTEGER,"supplier_id" VARCHAR,"last_received_date" DATE,"unit_cost" DOUBLE)
[0m19:00:25.341633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:00:25.596984 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.255 seconds
[0m19:00:26.644729 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:26.645538 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:00:31.192817 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.544 seconds
[0m19:00:32.243134 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:32.243903 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:00:35.941805 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.696 seconds
[0m19:00:37.277243 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:37.278331 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:00:40.759676 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.479 seconds
[0m19:00:41.806401 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:41.807305 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:00:47.332193 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.522 seconds
[0m19:00:49.456191 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:49.462963 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:00:54.704426 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.237 seconds
[0m19:00:55.743405 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:00:55.744348 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:00:59.996216 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.247 seconds
[0m19:01:01.502464 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:01:01.503715 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:01:04.721001 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.213 seconds
[0m19:01:05.892531 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:01:05.893599 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:01:09.061923 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.166 seconds
[0m19:01:10.053229 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:01:10.053894 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:01:13.110823 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.055 seconds
[0m19:01:14.343363 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:01:14.344700 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m19:01:18.010215 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.664 seconds
[0m19:01:18.016319 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m19:01:18.025176 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: COMMIT
[0m19:01:18.029879 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: Close
[0m19:01:18.034982 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02fa120>]}
[0m19:01:18.036838 [info ] [Thread-1 (]: 2 of 4 OK loaded seed file bronze.raw_inventory_snapshots ...................... [[32mCREATE 10000[0m in 53.34s]
[0m19:01:18.041203 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:01:18.042194 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:01:18.043812 [info ] [Thread-1 (]: 3 of 4 START seed file bronze.raw_payment_transactions ......................... [RUN]
[0m19:01:18.044800 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m19:01:18.045270 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m19:01:18.045774 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m19:01:19.013324 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:19.013924 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_payment_transactions"} */

    create table "iceberg"."bronze"."raw_payment_transactions" ("transaction_id" VARCHAR,"order_id" VARCHAR,"customer_id" VARCHAR,"payment_method" VARCHAR,"payment_status" VARCHAR,"amount" DOUBLE,"currency" VARCHAR,"transaction_timestamp" TIMESTAMP,"processor_response_code" INTEGER,"gateway_fee" DOUBLE,"merchant_id" VARCHAR,"billing_country" VARCHAR,"risk_score" INTEGER)
[0m19:01:19.014302 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:01:19.217245 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.203 seconds
[0m19:01:20.459830 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:20.461005 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:26.377516 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.910 seconds
[0m19:01:28.032683 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:28.034462 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:32.047712 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.011 seconds
[0m19:01:33.784189 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:33.785321 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:37.445923 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.658 seconds
[0m19:01:38.690383 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:38.691228 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:42.162130 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.469 seconds
[0m19:01:43.352750 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:43.353711 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:47.294936 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.939 seconds
[0m19:01:48.552343 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:48.554030 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:51.843595 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.287 seconds
[0m19:01:54.140567 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:54.141705 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:01:57.706843 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.561 seconds
[0m19:01:59.732764 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:01:59.734472 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:04.362901 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.626 seconds
[0m19:02:05.660128 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:05.661197 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:09.080724 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.418 seconds
[0m19:02:10.165941 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:10.166789 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:13.505021 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.336 seconds
[0m19:02:15.169184 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:15.170023 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:18.693619 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.520 seconds
[0m19:02:19.964095 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:19.965139 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:24.389249 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.421 seconds
[0m19:02:25.533576 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:25.534265 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:28.735496 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.195 seconds
[0m19:02:29.855254 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:29.855963 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:33.963259 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.103 seconds
[0m19:02:36.159031 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:36.160290 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m19:02:40.184680 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.022 seconds
[0m19:02:40.190456 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_payment_transactions"
[0m19:02:40.208915 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: COMMIT
[0m19:02:40.211627 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: Close
[0m19:02:40.214300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffee942cf0>]}
[0m19:02:40.216186 [info ] [Thread-1 (]: 3 of 4 OK loaded seed file bronze.raw_payment_transactions ..................... [[32mCREATE 15000[0m in 82.17s]
[0m19:02:40.219428 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:02:40.220349 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m19:02:40.221826 [info ] [Thread-1 (]: 4 of 4 START seed file bronze.raw_support_tickets .............................. [RUN]
[0m19:02:40.222698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m19:02:40.223160 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m19:02:40.223771 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m19:02:40.622569 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:02:40.623095 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_support_tickets"} */

    create table "iceberg"."bronze"."raw_support_tickets" ("ticket_id" VARCHAR,"customer_id" VARCHAR,"order_id" VARCHAR,"ticket_type" VARCHAR,"priority" VARCHAR,"status" VARCHAR,"created_timestamp" TIMESTAMP,"first_response_timestamp" TIMESTAMP,"resolution_timestamp" TIMESTAMP,"agent_id" VARCHAR,"satisfaction_score" INTEGER,"subject" VARCHAR,"channel" VARCHAR)
[0m19:02:40.623516 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:02:40.754676 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.131 seconds
[0m19:02:41.853260 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:02:41.854020 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:02:45.854971 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.994 seconds
[0m19:02:47.079519 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:02:47.080395 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:02:50.453237 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.371 seconds
[0m19:02:51.983788 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:02:51.984710 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:02:56.529082 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.542 seconds
[0m19:02:57.830255 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:02:57.832870 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:03:01.126416 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.291 seconds
[0m19:03:02.325464 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:03:02.326401 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:03:05.920300 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.590 seconds
[0m19:03:07.058522 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:03:07.059898 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:03:11.627816 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.566 seconds
[0m19:03:14.051967 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:03:14.053539 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:03:17.892215 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.836 seconds
[0m19:03:19.359786 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m19:03:19.360786 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m19:03:22.721092 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.356 seconds
[0m19:03:22.727513 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_support_tickets"
[0m19:03:22.737057 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: COMMIT
[0m19:03:22.739841 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: Close
[0m19:03:22.745550 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b434b18e-ad03-4d49-8372-7cff0625d332', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffc6fff290>]}
[0m19:03:22.748036 [info ] [Thread-1 (]: 4 of 4 OK loaded seed file bronze.raw_support_tickets .......................... [[32mCREATE 8000[0m in 42.52s]
[0m19:03:22.750499 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m19:03:22.774174 [debug] [MainThread]: On master: COMMIT
[0m19:03:22.775676 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:03:22.776070 [debug] [MainThread]: Connection 'seed.ecommerce_dbt.raw_support_tickets' was properly closed.
[0m19:03:22.780423 [info ] [MainThread]: 
[0m19:03:22.781977 [info ] [MainThread]: Finished running 4 seeds in 0 hours 4 minutes and 42.93 seconds (282.93s).
[0m19:03:22.785476 [debug] [MainThread]: Command end result
[0m19:03:22.819430 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:03:22.834061 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:03:22.863050 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:03:22.863571 [info ] [MainThread]: 
[0m19:03:22.864924 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:03:22.865658 [info ] [MainThread]: 
[0m19:03:22.867285 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:03:22.871518 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 285.67773, "process_in_blocks": "1025648", "process_kernel_time": 3.063323, "process_mem_max_rss": "343760", "process_out_blocks": "6528", "process_user_time": 74.66147}
[0m19:03:22.872476 [debug] [MainThread]: Command `cli seed` succeeded at 19:03:22.872338 after 285.68 seconds
[0m19:03:22.873256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03273b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1102270>]}
[0m19:03:22.873666 [debug] [MainThread]: Flushing usage events
[0m19:03:23.637709 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:03:30.338133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0e91670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12f72f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12f4650>]}


============================== 19:03:30.357650 | bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31 ==============================
[0m19:03:30.357650 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:03:30.358615 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:03:30.643753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0dc4aa0>]}
[0m19:03:30.718010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff015d0a0>]}
[0m19:03:30.718949 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:03:31.066240 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:03:31.235798 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:03:31.236842 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:03:31.307664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe7f6e0>]}
[0m19:03:31.403838 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:03:31.406259 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:03:31.418065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ff200>]}
[0m19:03:31.419154 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:03:31.423208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82bfb0>]}
[0m19:03:31.426616 [info ] [MainThread]: 
[0m19:03:31.427493 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:03:31.428262 [info ] [MainThread]: 
[0m19:03:31.429662 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:03:31.444890 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:03:31.487512 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:03:31.488204 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:03:31.488613 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:03:31.488933 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:03:31.490402 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef84b3b0>]}
[0m19:03:32.518448 [debug] [ThreadPool]: SQL status: SUCCESS in 1.026 seconds
[0m19:03:32.522585 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:03:32.530026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:03:32.557822 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:03:32.558375 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:03:32.558750 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:33.362442 [debug] [ThreadPool]: SQL status: SUCCESS in 0.803 seconds
[0m19:03:33.366971 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:03:33.367757 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:03:33.368963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:03:33.374776 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:03:33.375401 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:03:33.375726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:34.101973 [debug] [ThreadPool]: SQL status: SUCCESS in 0.726 seconds
[0m19:03:34.104881 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:03:34.105762 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:03:34.108486 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:03:34.114596 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:03:34.115075 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:03:34.115364 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:34.389040 [debug] [ThreadPool]: SQL status: SUCCESS in 0.273 seconds
[0m19:03:34.391787 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:03:34.392278 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:03:34.397855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff196a3c0>]}
[0m19:03:34.401933 [debug] [MainThread]: On master: COMMIT
[0m19:03:34.413471 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:03:34.414657 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m19:03:34.415478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m19:03:34.419397 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:03:34.431038 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:03:34.433225 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:03:34.487928 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:03:34.490812 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:03:34.491341 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m19:03:34.491726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:48.996311 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 14.501 seconds
[0m19:03:49.065678 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m19:03:49.066604 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m19:03:49.080236 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefefea20>]}
[0m19:03:49.084404 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 14.65s]
[0m19:03:49.087035 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:03:49.089821 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:03:49.091584 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m19:03:49.093031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:03:49.095402 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:03:49.104747 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:03:49.107089 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:03:49.113594 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:03:49.118529 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:03:49.119377 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m19:03:49.120173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:53.989306 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 4.867 seconds
[0m19:03:53.998689 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m19:03:53.999260 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m19:03:54.002480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff79429c0>]}
[0m19:03:54.005246 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 4.91s]
[0m19:03:54.006796 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:03:54.007837 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:03:54.013668 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m19:03:54.015088 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:03:54.015771 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:03:54.030330 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:03:54.032178 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:03:54.043929 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:03:54.059700 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:03:54.061793 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m19:03:54.065951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:56.599478 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.534 seconds
[0m19:03:56.608559 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m19:03:56.609190 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m19:03:56.611875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef67aed0>]}
[0m19:03:56.613753 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 2.60s]
[0m19:03:56.617867 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:03:56.618656 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:03:56.619575 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m19:03:56.620169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:03:56.620555 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:03:56.628860 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:03:56.630312 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:03:56.634295 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:03:56.637737 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:03:56.638340 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m19:03:56.638963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:58.708441 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.068 seconds
[0m19:03:58.721823 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m19:03:58.722386 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m19:03:58.724621 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bda4cdfa-6d97-4dfd-9a3b-04aa9e47bb31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef672e70>]}
[0m19:03:58.726333 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.10s]
[0m19:03:58.727154 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:03:58.750618 [debug] [MainThread]: On master: COMMIT
[0m19:03:58.752178 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:03:58.752565 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m19:03:58.754454 [info ] [MainThread]: 
[0m19:03:58.755154 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 27.32 seconds (27.32s).
[0m19:03:58.757891 [debug] [MainThread]: Command end result
[0m19:03:58.806037 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:03:58.824565 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:03:58.848733 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:03:58.849313 [info ] [MainThread]: 
[0m19:03:58.850887 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:03:58.851609 [info ] [MainThread]: 
[0m19:03:58.852524 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:03:58.856373 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 28.60531, "process_in_blocks": "290728", "process_kernel_time": 1.539831, "process_mem_max_rss": "288580", "process_out_blocks": "2272", "process_user_time": 3.478314}
[0m19:03:58.858482 [debug] [MainThread]: Command `cli run` succeeded at 19:03:58.858217 after 28.61 seconds
[0m19:03:58.860656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0026db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd57a30e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m19:03:58.861398 [debug] [MainThread]: Flushing usage events
[0m19:03:59.674147 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:04:04.344602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f9040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b2000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b25d0>]}


============================== 19:04:04.358204 | d8ebb0e2-b5da-486f-a11d-8cbcfecb52e3 ==============================
[0m19:04:04.358204 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:04:04.359632 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:04:04.622377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff09610>]}
[0m19:04:04.697200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0039490>]}
[0m19:04:04.698163 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:04:04.988672 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:04:05.133430 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:04:05.134216 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:04:05.198447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2baa0>]}
[0m19:04:05.351159 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:04:05.354968 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:04:05.367462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ff650>]}
[0m19:04:05.368646 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:04:05.369838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff101eed0>]}
[0m19:04:05.372456 [info ] [MainThread]: 
[0m19:04:05.373040 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:04:05.373492 [info ] [MainThread]: 
[0m19:04:05.375009 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:04:05.383108 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:04:05.412919 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:04:05.413539 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:04:05.413940 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:04:05.414253 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:04:05.415998 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5217c0>]}
[0m19:04:05.774376 [debug] [ThreadPool]: SQL status: SUCCESS in 0.360 seconds
[0m19:04:05.777121 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:04:05.778824 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_silver)
[0m19:04:05.779869 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "silver"
"
[0m19:04:05.785979 [debug] [ThreadPool]: Using trino connection "create_iceberg_silver"
[0m19:04:05.786428 [debug] [ThreadPool]: On create_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_silver"} */
create schema if not exists "iceberg"."silver"
[0m19:04:05.786741 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:05.861427 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.075 seconds
[0m19:04:05.862705 [debug] [ThreadPool]: On create_iceberg_silver: COMMIT
[0m19:04:05.863046 [debug] [ThreadPool]: On create_iceberg_silver: Close
[0m19:04:05.867405 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_silver, now list_iceberg_gold)
[0m19:04:05.882775 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:04:05.883282 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:04:05.883675 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:06.270542 [debug] [ThreadPool]: SQL status: SUCCESS in 0.387 seconds
[0m19:04:06.272422 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:04:06.272900 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:04:06.273848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:04:06.278784 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:04:06.279352 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:04:06.279712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:06.558889 [debug] [ThreadPool]: SQL status: SUCCESS in 0.279 seconds
[0m19:04:06.561126 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:04:06.562035 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:04:06.563114 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:04:06.569611 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:04:06.572052 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:04:06.572388 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:06.823881 [debug] [ThreadPool]: SQL status: SUCCESS in 0.251 seconds
[0m19:04:06.827199 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:04:06.828487 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:04:06.832755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff196a660>]}
[0m19:04:06.835960 [debug] [MainThread]: On master: COMMIT
[0m19:04:06.848517 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:04:06.849848 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m19:04:06.853841 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:04:06.855277 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:04:06.860965 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:04:06.862290 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:04:06.903463 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:04:06.909151 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:04:06.909594 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m19:04:06.910003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:10.865823 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 3.953 seconds
[0m19:04:10.927203 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m19:04:10.928314 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m19:04:10.936572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2b1d0>]}
[0m19:04:10.950787 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 4.08s]
[0m19:04:10.992907 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:04:11.004709 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:04:11.067890 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m19:04:11.072554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m19:04:11.086084 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:04:11.368847 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:04:11.390646 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:04:11.426896 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:04:11.481621 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:04:11.487152 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m19:04:11.492965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:21.568805 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 10.075 seconds
[0m19:04:21.577700 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m19:04:21.578307 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m19:04:21.580847 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5b2690>]}
[0m19:04:21.582811 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 10.51s]
[0m19:04:21.584051 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:04:21.585082 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:04:21.586893 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m19:04:21.587769 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:04:21.588460 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:04:21.600675 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:04:21.601859 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:04:21.605724 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:04:21.617693 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:04:21.618413 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m19:04:21.618951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:25.825033 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.203 seconds
[0m19:04:25.845582 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m19:04:25.846386 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m19:04:25.849314 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4127b0>]}
[0m19:04:25.851702 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 4.26s]
[0m19:04:25.853912 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:04:25.854965 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:04:25.855761 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m19:04:25.856681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m19:04:25.857297 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:04:25.873097 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:04:25.876895 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:04:25.889153 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:04:25.926232 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:04:25.930227 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m19:04:25.933803 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:30.163601 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 4.228 seconds
[0m19:04:30.172594 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m19:04:30.173250 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m19:04:30.176722 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ebb0e2-b5da-486f-a11d-8cbcfecb52e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4127b0>]}
[0m19:04:30.178893 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 4.32s]
[0m19:04:30.181494 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:04:30.192503 [debug] [MainThread]: On master: COMMIT
[0m19:04:30.193593 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:04:30.193955 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m19:04:30.195987 [info ] [MainThread]: 
[0m19:04:30.196519 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 24.82 seconds (24.82s).
[0m19:04:30.199820 [debug] [MainThread]: Command end result
[0m19:04:30.238760 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:04:30.255431 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:04:30.278675 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:04:30.279258 [info ] [MainThread]: 
[0m19:04:30.279993 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:04:30.280606 [info ] [MainThread]: 
[0m19:04:30.281418 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:04:30.285291 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 26.015602, "process_in_blocks": "95688", "process_kernel_time": 0.852173, "process_mem_max_rss": "288512", "process_out_blocks": "2409", "process_user_time": 3.785954}
[0m19:04:30.287327 [debug] [MainThread]: Command `cli run` succeeded at 19:04:30.287200 after 26.02 seconds
[0m19:04:30.288497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff085edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c89190>]}
[0m19:04:30.288999 [debug] [MainThread]: Flushing usage events
[0m19:04:31.044864 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:04:37.253905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f51c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bf560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bd130>]}


============================== 19:04:37.264556 | e27a8324-5b72-4e6e-a98b-3fc155f24b4b ==============================
[0m19:04:37.264556 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:04:37.265294 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:04:37.542624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00be0f0>]}
[0m19:04:37.630564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0765d60>]}
[0m19:04:37.631441 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:04:37.952564 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:04:38.076161 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:04:38.076960 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:04:38.139166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefce94c0>]}
[0m19:04:38.249963 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:04:38.252395 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:04:38.262511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7fb620>]}
[0m19:04:38.263445 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:04:38.264005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef827f20>]}
[0m19:04:38.267237 [info ] [MainThread]: 
[0m19:04:38.267810 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:04:38.268276 [info ] [MainThread]: 
[0m19:04:38.269076 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:04:38.276408 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:04:38.303340 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:04:38.303814 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:04:38.304096 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:04:38.304343 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:04:38.305858 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefce8470>]}
[0m19:04:38.749951 [debug] [ThreadPool]: SQL status: SUCCESS in 0.445 seconds
[0m19:04:38.754299 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:04:38.757449 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_gold)
[0m19:04:38.759190 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "gold"
"
[0m19:04:38.768896 [debug] [ThreadPool]: Using trino connection "create_iceberg_gold"
[0m19:04:38.769501 [debug] [ThreadPool]: On create_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_gold"} */
create schema if not exists "iceberg"."gold"
[0m19:04:38.769866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:38.965571 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.195 seconds
[0m19:04:38.967604 [debug] [ThreadPool]: On create_iceberg_gold: COMMIT
[0m19:04:38.968130 [debug] [ThreadPool]: On create_iceberg_gold: Close
[0m19:04:38.975120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_gold, now list_iceberg_gold)
[0m19:04:39.052357 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:04:39.053297 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:04:39.054102 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:43.412919 [debug] [ThreadPool]: SQL status: SUCCESS in 4.341 seconds
[0m19:04:43.515619 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:04:43.517100 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:04:43.529061 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:04:43.588274 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:04:43.590734 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:04:43.592891 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:44.404808 [debug] [ThreadPool]: SQL status: SUCCESS in 0.813 seconds
[0m19:04:44.407295 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:04:44.408203 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:04:44.409014 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:04:44.417968 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:04:44.418841 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:04:44.419255 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:04:44.922842 [debug] [ThreadPool]: SQL status: SUCCESS in 0.503 seconds
[0m19:04:44.925523 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:04:44.926070 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:04:44.931937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef823d10>]}
[0m19:04:44.936375 [debug] [MainThread]: On master: COMMIT
[0m19:04:44.975900 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:04:44.977827 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m19:04:44.979730 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m19:04:44.980604 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:04:44.995340 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:04:45.006041 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:04:45.076611 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:04:45.080996 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:04:45.081770 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m19:04:45.082216 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:48.308907 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 3.224 seconds
[0m19:04:48.337967 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m19:04:48.338562 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m19:04:48.344865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd331d0>]}
[0m19:04:48.346717 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 3.36s]
[0m19:04:48.353520 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:04:48.356019 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:04:48.358007 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m19:04:48.362463 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:04:48.363282 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:04:48.370678 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:04:48.372692 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:04:48.377382 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:04:48.388511 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:04:48.389840 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m19:04:48.390567 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:50.801544 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.410 seconds
[0m19:04:50.807677 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m19:04:50.808384 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m19:04:50.810490 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef427380>]}
[0m19:04:50.811845 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.45s]
[0m19:04:50.812605 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:04:50.815409 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:04:50.815825 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m19:04:50.816263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m19:04:50.816980 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:04:50.823239 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:04:50.824344 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:04:50.827264 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m19:04:50.833339 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:04:50.833829 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m19:04:50.834269 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:52.388574 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.554 seconds
[0m19:04:52.392150 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m19:04:52.392943 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m19:04:52.394839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27a8324-5b72-4e6e-a98b-3fc155f24b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef472780>]}
[0m19:04:52.396051 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.58s]
[0m19:04:52.397393 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:04:52.405238 [debug] [MainThread]: On master: COMMIT
[0m19:04:52.407541 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:04:52.408550 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m19:04:52.414817 [info ] [MainThread]: 
[0m19:04:52.416015 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 14.14 seconds (14.14s).
[0m19:04:52.418218 [debug] [MainThread]: Command end result
[0m19:04:52.446909 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:04:52.452882 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:04:52.469924 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:04:52.470362 [info ] [MainThread]: 
[0m19:04:52.472028 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:04:52.473167 [info ] [MainThread]: 
[0m19:04:52.475047 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m19:04:52.477474 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.289391, "process_in_blocks": "72256", "process_kernel_time": 0.571163, "process_mem_max_rss": "287068", "process_out_blocks": "2289", "process_user_time": 3.243354}
[0m19:04:52.478550 [debug] [MainThread]: Command `cli run` succeeded at 19:04:52.478417 after 15.29 seconds
[0m19:04:52.479307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff015a2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef68f9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef68e870>]}
[0m19:04:52.479665 [debug] [MainThread]: Flushing usage events
[0m19:04:53.169793 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:04:59.185125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0e1edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04e2000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff07e0440>]}


============================== 19:04:59.221038 | 8ea8570e-a459-4ccb-964f-2cb8b8a2d405 ==============================
[0m19:04:59.221038 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:04:59.225867 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:04:59.739363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff18ed580>]}
[0m19:04:59.943705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00e1850>]}
[0m19:04:59.945501 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:05:00.686256 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:05:01.015016 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:05:01.016933 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:05:01.168233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2f500>]}
[0m19:05:01.211656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa61b0>]}
[0m19:05:01.213306 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:05:01.214546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0096ff0>]}
[0m19:05:01.223058 [info ] [MainThread]: 
[0m19:05:01.225028 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:05:01.226386 [info ] [MainThread]: 
[0m19:05:01.229872 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:05:01.249789 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m19:05:01.357159 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:05:01.358225 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:05:01.358750 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:05:01.359102 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:05:01.360917 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82a270>]}
[0m19:05:02.264118 [debug] [ThreadPool]: SQL status: SUCCESS in 0.904 seconds
[0m19:05:02.273763 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:05:02.274876 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:05:02.281987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:05:02.296530 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:05:02.297507 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:05:02.298128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:05:04.972533 [debug] [ThreadPool]: SQL status: SUCCESS in 2.673 seconds
[0m19:05:04.989384 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:05:04.991121 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:05:04.994393 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:05:05.019264 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:05:05.020230 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:05:05.020766 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:05:06.100760 [debug] [ThreadPool]: SQL status: SUCCESS in 1.078 seconds
[0m19:05:06.112202 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:05:06.113231 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:05:06.123234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ea8570e-a459-4ccb-964f-2cb8b8a2d405', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1972c00>]}
[0m19:05:06.150652 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m19:05:06.153314 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m19:05:06.156813 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m19:05:06.169023 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m19:05:06.177303 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m19:05:06.189943 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:05:06.204072 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m19:05:06.207825 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:05:06.217620 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:05:06.219504 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:05:06.220319 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:05:06.221944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m19:05:06.223438 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m19:05:06.226756 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m19:05:06.231090 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:05:06.232664 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m19:05:06.235120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m19:05:06.237679 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m19:05:06.242511 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m19:05:06.244646 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m19:05:06.246342 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:05:06.249040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m19:05:06.252679 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:05:06.272560 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:05:06.276422 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:05:06.280309 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:05:06.281120 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:05:06.282990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:05:06.286137 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:05:06.295982 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:05:06.297572 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:05:06.299570 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:05:06.300336 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:05:06.301589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:05:06.302166 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:05:06.316501 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:05:06.318355 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:05:06.320228 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:05:06.321120 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:05:06.324087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:05:06.325316 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:05:06.331570 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:05:06.333835 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:05:06.338355 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:05:06.340728 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:05:06.343778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:05:06.348781 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:05:06.355387 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:05:06.356919 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:05:06.357986 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:05:06.358545 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:05:06.359112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m19:05:06.360436 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:05:06.399376 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m19:05:06.403086 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:05:06.406100 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:05:06.408821 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:05:06.410579 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m19:05:06.412167 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:05:06.422668 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m19:05:06.424046 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:05:06.426046 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:05:06.427041 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:05:06.428225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m19:05:06.429191 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:05:06.437579 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m19:05:06.438935 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:05:06.440345 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:05:06.441112 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:05:06.442535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m19:05:06.443451 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:05:06.459704 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m19:05:06.461649 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:05:06.463425 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:05:06.464202 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:05:06.466024 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m19:05:06.467403 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:05:06.473405 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:05:06.475082 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:05:06.476319 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:05:06.476996 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:05:06.480882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m19:05:06.482534 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:05:06.490129 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m19:05:06.491892 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:05:06.493752 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:05:06.494805 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:05:06.495513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m19:05:06.496031 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:05:06.501261 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m19:05:06.502941 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:05:06.503855 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:05:06.504817 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:05:06.505468 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m19:05:06.505901 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:05:06.512271 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m19:05:06.514494 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:05:06.516195 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:05:06.516810 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:05:06.517392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m19:05:06.517840 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:05:06.523061 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m19:05:06.524448 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:05:06.525483 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:05:06.526001 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:05:06.526570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:05:06.527055 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:05:06.535956 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:05:06.537866 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:05:06.539356 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:05:06.544226 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:05:06.548133 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m19:05:06.550341 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:05:06.570500 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m19:05:06.574647 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:05:06.578976 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:05:06.581251 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:05:06.584363 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m19:05:06.585442 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:05:06.611592 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m19:05:06.615139 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:05:06.621471 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:05:06.625751 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:05:06.629564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m19:05:06.633534 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:05:06.652824 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m19:05:06.657193 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:05:06.659842 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:05:06.660938 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:05:06.663957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m19:05:06.665259 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:05:06.673956 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:05:06.676293 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:05:06.682475 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:05:06.683971 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:05:06.685853 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m19:05:06.686685 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:05:06.695412 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m19:05:06.696983 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:05:06.700977 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:05:06.702891 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:05:06.704978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m19:05:06.706607 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:05:06.714090 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m19:05:06.715832 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:05:06.718229 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:05:06.718987 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:05:06.721218 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m19:05:06.723567 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:05:06.737460 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m19:05:06.740468 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:05:06.747003 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:05:06.749464 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:05:06.750553 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m19:05:06.751183 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:05:06.756764 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:05:06.758202 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:05:06.759851 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:05:06.761465 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:05:06.763241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m19:05:06.765160 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:05:06.774429 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:05:06.776829 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:05:06.778760 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:05:06.779768 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:05:06.780789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:05:06.781776 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:05:06.788655 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:05:06.790360 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:05:06.791563 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:05:06.797522 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:05:06.801267 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m19:05:06.817888 [debug] [MainThread]: Command end result
[0m19:05:07.267261 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:05:07.275665 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:05:07.306045 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:05:07.324260 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m19:05:07.326905 [info ] [MainThread]: Building catalog
[0m19:05:07.340058 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m19:05:07.449659 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m19:05:07.452563 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m19:05:07.455554 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:05:29.196606 [debug] [ThreadPool]: SQL status: SUCCESS in 21.739 seconds
[0m19:05:29.226783 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m19:05:29.299179 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:05:29.342316 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:05:29.357634 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:05:29.358144 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:05:29.375251 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 30.346388, "process_in_blocks": "68848", "process_kernel_time": 1.141936, "process_mem_max_rss": "287988", "process_out_blocks": "5916", "process_user_time": 5.854577}
[0m19:05:29.379618 [debug] [MainThread]: Command `cli docs generate` succeeded at 19:05:29.379100 after 30.36 seconds
[0m19:05:29.382902 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m19:05:29.384012 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m19:05:29.386660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0271a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff07ff1d0>]}
[0m19:05:29.388407 [debug] [MainThread]: Flushing usage events
[0m19:05:29.977504 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:13:17.359237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0e22db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f5520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023a0f0>]}


============================== 19:13:17.381789 | aae6897b-3f15-4be5-b501-a18f9219c585 ==============================
[0m19:13:17.381789 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:13:17.383990 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:13:17.672344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00be360>]}
[0m19:13:17.768072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0966b70>]}
[0m19:13:17.769081 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:13:18.300228 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:13:18.928812 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:13:18.930672 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:13:19.229234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcc6030>]}
[0m19:13:19.854239 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:13:19.864496 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:13:19.936732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef807230>]}
[0m19:13:19.968239 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:13:19.974458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82c110>]}
[0m19:13:20.143543 [info ] [MainThread]: 
[0m19:13:20.144504 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:13:20.145002 [info ] [MainThread]: 
[0m19:13:20.146347 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:13:20.219248 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:13:20.625400 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:13:20.626499 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:13:20.627032 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:13:20.627575 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:13:20.629124 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef525d60>]}
[0m19:13:24.731328 [debug] [ThreadPool]: SQL status: SUCCESS in 4.100 seconds
[0m19:13:24.744112 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:13:24.766863 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:13:24.810946 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:13:24.811841 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:13:24.812337 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:13:30.280442 [debug] [ThreadPool]: SQL status: SUCCESS in 5.466 seconds
[0m19:13:30.296917 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:13:30.298355 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:13:30.302501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:13:30.329273 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:13:30.330258 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:13:30.331356 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:13:31.531108 [debug] [ThreadPool]: SQL status: SUCCESS in 1.199 seconds
[0m19:13:31.534016 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:13:31.534558 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:13:31.536030 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:13:31.550913 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:13:31.551880 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:13:31.552590 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:13:32.091036 [debug] [ThreadPool]: SQL status: SUCCESS in 0.535 seconds
[0m19:13:32.106173 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:13:32.108391 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:13:32.135435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff08410>]}
[0m19:13:32.143504 [debug] [MainThread]: On master: COMMIT
[0m19:13:32.182157 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:13:32.185097 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m19:13:32.188078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m19:13:32.190663 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:13:32.224666 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:13:32.227678 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:13:32.335862 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:13:32.342741 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:13:32.343492 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m19:13:32.344074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:13:43.048642 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 10.697 seconds
[0m19:13:43.119903 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:13:43.121320 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:13:44.057997 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.936 seconds
[0m19:13:44.062307 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:13:44.062862 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m19:13:44.225360 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.162 seconds
[0m19:13:44.241742 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:13:44.245591 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:13:44.246127 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:13:44.318518 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.072 seconds
[0m19:13:44.372984 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m19:13:44.374223 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m19:13:44.387844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff076b0>]}
[0m19:13:44.390737 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 12.19s]
[0m19:13:44.393769 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:13:44.395759 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:13:44.396835 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m19:13:44.400630 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:13:44.402053 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:13:44.407358 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:13:44.409078 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:13:44.422916 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:13:44.428011 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:13:44.428568 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m19:13:44.429300 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:13:48.827104 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 4.396 seconds
[0m19:13:48.859063 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:13:48.859809 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:13:49.422872 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.562 seconds
[0m19:13:49.429029 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:13:49.429815 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m19:13:49.770791 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.340 seconds
[0m19:13:49.774991 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:13:49.776241 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:13:49.776657 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:13:49.868670 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.091 seconds
[0m19:13:49.872057 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m19:13:49.872591 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m19:13:49.875400 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4517f0>]}
[0m19:13:49.877397 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 5.47s]
[0m19:13:49.878459 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:13:49.879113 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:13:49.879810 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m19:13:49.881548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:13:49.882584 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:13:49.893712 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:13:49.894932 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:13:49.898306 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:13:49.900735 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:13:49.901088 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m19:13:49.901486 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:13:54.396408 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.484 seconds
[0m19:13:54.463361 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:13:54.464148 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:13:55.516108 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 1.050 seconds
[0m19:13:55.529920 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:13:55.531092 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m19:13:55.761275 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.229 seconds
[0m19:13:55.768772 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:13:55.772401 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:13:55.772973 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:13:55.920163 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.147 seconds
[0m19:13:55.937399 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m19:13:55.938606 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m19:13:55.962840 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4ffaa0>]}
[0m19:13:55.966982 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 6.06s]
[0m19:13:55.970052 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:13:55.972204 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:13:55.974943 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m19:13:55.976243 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:13:55.981547 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:13:56.019064 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:13:56.021872 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:13:56.025819 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:13:56.030773 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:13:56.031412 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m19:13:56.032538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:13:58.770144 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.736 seconds
[0m19:13:58.786650 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:13:58.787886 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:13:58.895570 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.107 seconds
[0m19:13:58.899708 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:13:58.900266 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m19:13:59.083574 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.182 seconds
[0m19:13:59.098369 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:13:59.102368 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:13:59.104970 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:13:59.271568 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.165 seconds
[0m19:13:59.276904 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m19:13:59.277770 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m19:13:59.280346 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aae6897b-3f15-4be5-b501-a18f9219c585', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef476600>]}
[0m19:13:59.282212 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 3.30s]
[0m19:13:59.284533 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:13:59.316871 [debug] [MainThread]: On master: COMMIT
[0m19:13:59.319546 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:13:59.320016 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m19:13:59.323956 [info ] [MainThread]: 
[0m19:13:59.325865 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 39.18 seconds (39.18s).
[0m19:13:59.329277 [debug] [MainThread]: Command end result
[0m19:13:59.368402 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:13:59.382648 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:13:59.420984 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:13:59.421587 [info ] [MainThread]: 
[0m19:13:59.422324 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:13:59.423226 [info ] [MainThread]: 
[0m19:13:59.424255 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:13:59.428356 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 42.160976, "process_in_blocks": "182968", "process_kernel_time": 4.234229, "process_mem_max_rss": "285568", "process_out_blocks": "2286", "process_user_time": 5.627971}
[0m19:13:59.433036 [debug] [MainThread]: Command `cli run` succeeded at 19:13:59.432165 after 42.17 seconds
[0m19:13:59.445976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b32c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02702f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff07474a0>]}
[0m19:13:59.447090 [debug] [MainThread]: Flushing usage events
[0m19:14:00.701671 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:14:10.365741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff042b980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0456540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bfef0>]}


============================== 19:14:10.388951 | 03f47409-5436-4d74-9077-53f127203e12 ==============================
[0m19:14:10.388951 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:14:10.390664 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:14:10.653753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe21bb0>]}
[0m19:14:10.761625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff042b980>]}
[0m19:14:10.763140 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:14:11.194017 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:14:11.346496 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:14:11.347267 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:14:11.419217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef806c00>]}
[0m19:14:11.516138 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:14:11.519343 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:14:11.535812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b5f0>]}
[0m19:14:11.536928 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:14:11.537995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef837ef0>]}
[0m19:14:11.543517 [info ] [MainThread]: 
[0m19:14:11.545153 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:14:11.546140 [info ] [MainThread]: 
[0m19:14:11.547265 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:14:11.560110 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:14:11.606772 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:14:11.607516 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:14:11.607951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:14:11.608265 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:14:11.610027 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef857470>]}
[0m19:14:12.417988 [debug] [ThreadPool]: SQL status: SUCCESS in 0.808 seconds
[0m19:14:12.424492 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:14:12.430838 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:14:12.451292 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:14:12.451979 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:14:12.452429 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:14:13.420325 [debug] [ThreadPool]: SQL status: SUCCESS in 0.967 seconds
[0m19:14:13.424492 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:14:13.425132 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:14:13.426536 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:14:13.442261 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:14:13.443107 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:14:13.443659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:14:14.204035 [debug] [ThreadPool]: SQL status: SUCCESS in 0.759 seconds
[0m19:14:14.219980 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:14:14.220778 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:14:14.222478 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:14:14.237144 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:14:14.238476 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:14:14.240130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:14:14.738069 [debug] [ThreadPool]: SQL status: SUCCESS in 0.498 seconds
[0m19:14:14.741704 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:14:14.742350 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:14:14.746762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef837fe0>]}
[0m19:14:14.748823 [debug] [MainThread]: On master: COMMIT
[0m19:14:14.772261 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:14:14.774025 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m19:14:14.778241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:14:14.778762 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:14:14.786704 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:14:14.788228 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:14:14.845156 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:14:14.851308 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:14:14.851760 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m19:14:14.852163 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:14:18.230466 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 3.374 seconds
[0m19:14:18.261166 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:14:18.261775 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:14:18.377538 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.115 seconds
[0m19:14:18.381739 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:14:18.382164 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m19:14:18.464038 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.081 seconds
[0m19:14:18.475130 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:14:18.479077 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:14:18.479546 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:14:18.529824 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.050 seconds
[0m19:14:18.555871 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m19:14:18.556379 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m19:14:18.560491 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef462b70>]}
[0m19:14:18.562108 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 3.78s]
[0m19:14:18.564078 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:14:18.564893 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:14:18.566034 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m19:14:18.566728 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m19:14:18.567100 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:14:18.571124 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:14:18.572846 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:14:18.577855 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:14:18.589824 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:14:18.590483 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m19:14:18.591017 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:14:24.239853 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 5.639 seconds
[0m19:14:24.290509 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:14:24.291522 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:14:24.488868 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.197 seconds
[0m19:14:24.494978 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:14:24.497076 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m19:14:24.843088 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.344 seconds
[0m19:14:24.854801 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:14:24.857924 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:14:24.860264 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:14:24.992108 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.129 seconds
[0m19:14:25.001890 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m19:14:25.003811 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m19:14:25.013170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef42d400>]}
[0m19:14:25.017958 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 6.44s]
[0m19:14:25.023600 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:14:25.027475 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:14:25.034152 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m19:14:25.035858 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:14:25.038468 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:14:25.054238 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:14:25.056701 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:14:25.060830 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:14:25.075126 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:14:25.076097 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m19:14:25.076884 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:14:29.856606 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.778 seconds
[0m19:14:29.879301 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:14:29.879866 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:14:29.969216 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.089 seconds
[0m19:14:29.973266 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:14:29.973692 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m19:14:30.093038 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.119 seconds
[0m19:14:30.096315 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:14:30.097115 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:14:30.097454 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:14:30.247796 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.150 seconds
[0m19:14:30.257817 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m19:14:30.259675 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m19:14:30.266447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa48500>]}
[0m19:14:30.271311 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.23s]
[0m19:14:30.274377 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:14:30.275221 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:14:30.276494 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m19:14:30.277549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m19:14:30.278392 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:14:30.298068 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:14:30.313780 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:14:30.320421 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:14:30.336369 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:14:30.337694 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m19:14:30.338835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:14:44.159935 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 13.812 seconds
[0m19:14:44.229413 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:14:44.230287 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:14:44.375879 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.145 seconds
[0m19:14:44.382108 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:14:44.382994 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m19:14:44.516646 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.133 seconds
[0m19:14:44.526485 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:14:44.527704 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:14:44.528215 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:14:44.962548 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.433 seconds
[0m19:14:44.979215 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m19:14:44.982852 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m19:14:44.994587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03f47409-5436-4d74-9077-53f127203e12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2dd2b0>]}
[0m19:14:44.998166 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 14.71s]
[0m19:14:45.004218 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:14:45.058113 [debug] [MainThread]: On master: COMMIT
[0m19:14:45.062316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:14:45.063325 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m19:14:45.071772 [info ] [MainThread]: 
[0m19:14:45.075723 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 33.52 seconds (33.52s).
[0m19:14:45.123893 [debug] [MainThread]: Command end result
[0m19:14:45.189340 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:14:45.209549 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:14:45.288741 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:14:45.289643 [info ] [MainThread]: 
[0m19:14:45.292768 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:14:45.294393 [info ] [MainThread]: 
[0m19:14:45.296738 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:14:45.312652 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 35.0239, "process_in_blocks": "276672", "process_kernel_time": 2.947101, "process_mem_max_rss": "287448", "process_out_blocks": "2421", "process_user_time": 6.063444}
[0m19:14:45.316345 [debug] [MainThread]: Command `cli run` succeeded at 19:14:45.315870 after 35.04 seconds
[0m19:14:45.319158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02745c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0163aa0>]}
[0m19:14:45.320619 [debug] [MainThread]: Flushing usage events
[0m19:14:46.334186 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:14:54.584692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06be8a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bfe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bfbf0>]}


============================== 19:14:54.599434 | e3da9a7e-e39b-4d42-9ccc-2990a958642a ==============================
[0m19:14:54.599434 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:14:54.600820 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:14:54.886911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff0e4e0>]}
[0m19:14:54.979690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0041c70>]}
[0m19:14:54.980811 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:14:55.270351 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:14:55.481520 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:14:55.482562 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:14:55.561158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd61610>]}
[0m19:14:55.665248 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:14:55.668541 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:14:55.683308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b1d0>]}
[0m19:14:55.684389 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:14:55.685414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8341a0>]}
[0m19:14:55.688049 [info ] [MainThread]: 
[0m19:14:55.689074 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:14:55.689864 [info ] [MainThread]: 
[0m19:14:55.690958 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:14:55.698590 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:14:55.730978 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:14:55.731583 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:14:55.731893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:14:55.732169 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:14:55.733602 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52c9e0>]}
[0m19:14:56.369398 [debug] [ThreadPool]: SQL status: SUCCESS in 0.636 seconds
[0m19:14:56.372738 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:14:56.377906 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:14:56.396391 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:14:56.397123 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:14:56.397590 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:14:57.020775 [debug] [ThreadPool]: SQL status: SUCCESS in 0.623 seconds
[0m19:14:57.022998 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:14:57.023419 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:14:57.024319 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:14:57.028658 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:14:57.030454 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:14:57.030822 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:14:57.388751 [debug] [ThreadPool]: SQL status: SUCCESS in 0.358 seconds
[0m19:14:57.390923 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:14:57.391344 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:14:57.392101 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:14:57.397501 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:14:57.397951 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:14:57.398262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:14:57.709998 [debug] [ThreadPool]: SQL status: SUCCESS in 0.311 seconds
[0m19:14:57.712705 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:14:57.713168 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:14:57.715477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff79bb5f0>]}
[0m19:14:57.716922 [debug] [MainThread]: On master: COMMIT
[0m19:14:57.725568 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:14:57.726486 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m19:14:57.729305 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m19:14:57.729984 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:14:57.745192 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:14:57.747311 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:14:57.816926 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:14:57.822212 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:14:57.822939 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m19:14:57.823767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:15:00.511851 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 2.686 seconds
[0m19:15:00.542342 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:15:00.543094 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:15:00.671354 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.128 seconds
[0m19:15:00.680957 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:15:00.681843 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m19:15:00.772719 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.090 seconds
[0m19:15:00.784238 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:15:00.786528 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:15:00.786954 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:15:00.845648 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.058 seconds
[0m19:15:00.881634 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m19:15:00.884128 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m19:15:00.893783 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c2be90>]}
[0m19:15:00.895421 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 3.16s]
[0m19:15:00.896622 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:15:00.900668 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:00.901510 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m19:15:00.902934 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:15:00.903607 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:00.910101 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:00.911754 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:00.918025 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:00.927189 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:00.927853 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m19:15:00.928390 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:15:06.863576 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 5.933 seconds
[0m19:15:06.883755 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:06.884442 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:15:06.975197 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.090 seconds
[0m19:15:06.978490 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:06.978870 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m19:15:07.054323 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.075 seconds
[0m19:15:07.058878 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:15:07.059756 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:07.060176 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:15:07.117319 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.056 seconds
[0m19:15:07.121237 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m19:15:07.121611 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m19:15:07.124032 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcca270>]}
[0m19:15:07.125245 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 6.22s]
[0m19:15:07.127702 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:07.128243 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:15:07.128700 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m19:15:07.129197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m19:15:07.130422 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:15:07.149903 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:15:07.151731 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:15:07.155053 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m19:15:07.159351 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:15:07.159879 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m19:15:07.160343 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:15:10.198411 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 3.034 seconds
[0m19:15:10.225394 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:15:10.226679 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:15:10.338306 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.111 seconds
[0m19:15:10.342678 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:15:10.343143 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m19:15:10.467385 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.124 seconds
[0m19:15:10.471079 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:15:10.472093 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:15:10.472512 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:15:10.522498 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.049 seconds
[0m19:15:10.527875 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m19:15:10.528516 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m19:15:10.530517 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3da9a7e-e39b-4d42-9ccc-2990a958642a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa0bb60>]}
[0m19:15:10.531983 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 3.40s]
[0m19:15:10.534749 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:15:10.563122 [debug] [MainThread]: On master: COMMIT
[0m19:15:10.568615 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:15:10.569392 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m19:15:10.577274 [info ] [MainThread]: 
[0m19:15:10.581709 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 14.88 seconds (14.88s).
[0m19:15:10.587287 [debug] [MainThread]: Command end result
[0m19:15:10.648890 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:15:10.659515 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:15:10.692529 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:15:10.693118 [info ] [MainThread]: 
[0m19:15:10.694891 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:15:10.695516 [info ] [MainThread]: 
[0m19:15:10.696351 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m19:15:10.701344 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 16.200535, "process_in_blocks": "269672", "process_kernel_time": 1.946277, "process_mem_max_rss": "288652", "process_out_blocks": "2297", "process_user_time": 3.929277}
[0m19:15:10.703669 [debug] [MainThread]: Command `cli run` succeeded at 19:15:10.703546 after 16.21 seconds
[0m19:15:10.705578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0552ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1300800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c51c40>]}
[0m19:15:10.705991 [debug] [MainThread]: Flushing usage events
[0m19:15:11.687408 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:15:16.943986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0167050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0166180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01672f0>]}


============================== 19:15:17.078538 | 5fecfde1-186e-4ef2-9ee5-602527f13031 ==============================
[0m19:15:17.078538 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:15:17.088377 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:15:18.057026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0046030>]}
[0m19:15:18.322750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd0d0a0>]}
[0m19:15:18.328931 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:15:20.272627 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:15:20.601389 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:15:20.604285 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:15:20.759534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff009ac90>]}
[0m19:15:20.804999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa2b6b0>]}
[0m19:15:20.806185 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:15:20.810296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff14560>]}
[0m19:15:20.823891 [info ] [MainThread]: 
[0m19:15:20.825000 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:15:20.826085 [info ] [MainThread]: 
[0m19:15:20.830105 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:15:20.853049 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m19:15:20.966554 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:15:20.967454 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:15:20.968010 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:15:20.968363 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:15:20.969736 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4df2f0>]}
[0m19:15:26.476091 [debug] [ThreadPool]: SQL status: SUCCESS in 5.504 seconds
[0m19:15:26.487007 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:15:26.487870 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:15:26.491011 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:15:26.511478 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:15:26.512262 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:15:26.512737 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:15:27.369414 [debug] [ThreadPool]: SQL status: SUCCESS in 0.856 seconds
[0m19:15:27.374500 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:15:27.375381 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:15:27.376689 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:15:27.384247 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:15:27.385018 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:15:27.385726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:15:28.368430 [debug] [ThreadPool]: SQL status: SUCCESS in 0.981 seconds
[0m19:15:28.380367 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:15:28.381137 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:15:28.388521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fecfde1-186e-4ef2-9ee5-602527f13031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff10dd0>]}
[0m19:15:28.419619 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m19:15:28.422760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m19:15:28.424668 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m19:15:28.437654 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m19:15:28.439693 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m19:15:28.440708 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:15:28.443474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m19:15:28.445360 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:15:28.450402 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:15:28.451956 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:15:28.452708 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:15:28.453390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m19:15:28.454115 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m19:15:28.456578 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m19:15:28.457690 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:15:28.458345 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m19:15:28.459590 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m19:15:28.461060 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m19:15:28.463952 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m19:15:28.465036 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m19:15:28.465647 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:15:28.466231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m19:15:28.466790 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:15:28.474609 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:15:28.476197 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:15:28.476984 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:15:28.477388 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:15:28.477917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:15:28.478494 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:15:28.481634 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:15:28.482431 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:15:28.483078 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:15:28.483496 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:15:28.483966 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:15:28.484383 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:15:28.487272 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:15:28.487993 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:15:28.488690 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:15:28.489081 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:15:28.489543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:15:28.490025 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:15:28.493195 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:15:28.494060 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:15:28.494780 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:15:28.495171 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:15:28.495719 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:15:28.496111 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:15:28.500389 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:15:28.501540 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:15:28.502134 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:15:28.502509 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:15:28.502882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m19:15:28.503179 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:15:28.519718 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m19:15:28.520972 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:15:28.521695 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:15:28.522069 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:15:28.522524 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m19:15:28.522881 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:15:28.527000 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m19:15:28.527888 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:15:28.528530 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:15:28.528942 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:15:28.529367 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m19:15:28.529696 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:15:28.533314 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m19:15:28.534888 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:15:28.535582 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:15:28.536064 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:15:28.536714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m19:15:28.537209 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:15:28.545481 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m19:15:28.546841 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:15:28.548046 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:15:28.548742 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:15:28.549594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m19:15:28.550378 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:15:28.554076 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:15:28.555053 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:15:28.555781 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:15:28.556347 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:15:28.558787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m19:15:28.559921 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:15:28.569140 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m19:15:28.570430 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:15:28.571410 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:15:28.572060 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:15:28.572562 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m19:15:28.573158 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:15:28.579941 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m19:15:28.580874 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:15:28.581968 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:15:28.585922 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:15:28.587055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m19:15:28.588703 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:15:28.593807 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m19:15:28.595141 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:15:28.596362 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:15:28.597238 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:15:28.598227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m19:15:28.598991 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:15:28.606203 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m19:15:28.607419 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:15:28.608511 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:15:28.609000 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:15:28.609524 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:15:28.609975 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:15:28.616229 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:15:28.617983 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:15:28.619070 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:15:28.619593 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:15:28.620343 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m19:15:28.621331 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:15:28.630333 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m19:15:28.631406 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:15:28.632208 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:15:28.632900 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:15:28.633724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m19:15:28.634198 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:15:28.638194 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m19:15:28.639081 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:15:28.639785 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:15:28.640212 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:15:28.640657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m19:15:28.641048 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:15:28.645108 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m19:15:28.645957 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:15:28.646720 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:15:28.647178 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:15:28.647678 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m19:15:28.648035 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:15:28.651376 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:15:28.652707 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:15:28.653405 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:15:28.653795 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:15:28.654236 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m19:15:28.654722 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:15:28.658426 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m19:15:28.659212 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:15:28.659857 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:15:28.660235 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:15:28.660663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m19:15:28.661050 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:15:28.664601 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m19:15:28.665648 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:15:28.666440 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:15:28.666864 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:15:28.667316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m19:15:28.667664 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:15:28.671041 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m19:15:28.671770 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:15:28.672458 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:15:28.672872 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:15:28.673281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m19:15:28.673617 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:15:28.677098 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:15:28.677928 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:15:28.678646 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:15:28.679079 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:15:28.679514 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m19:15:28.679858 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:15:28.683196 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:15:28.683875 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:15:28.684492 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:15:28.684851 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:28.685970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:15:28.687149 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:28.693005 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:15:28.694073 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:28.694860 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:15:28.698240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:15:28.699235 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m19:15:28.705082 [debug] [MainThread]: Command end result
[0m19:15:28.822421 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:15:28.835578 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:15:28.856885 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:15:28.867236 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m19:15:28.867845 [info ] [MainThread]: Building catalog
[0m19:15:28.876171 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m19:15:28.928807 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m19:15:28.929864 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m19:15:28.930937 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:15:55.112274 [debug] [ThreadPool]: SQL status: SUCCESS in 26.174 seconds
[0m19:15:55.155063 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m19:15:55.230632 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:15:55.284166 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:15:55.319810 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:15:55.321673 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:15:55.342348 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 38.602627, "process_in_blocks": "98272", "process_kernel_time": 2.632679, "process_mem_max_rss": "285316", "process_out_blocks": "5916", "process_user_time": 5.812716}
[0m19:15:55.350569 [debug] [MainThread]: Command `cli docs generate` succeeded at 19:15:55.347716 after 38.61 seconds
[0m19:15:55.354151 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m19:15:55.355607 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m19:15:55.360483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c2aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c2a720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06947d0>]}
[0m19:15:55.364121 [debug] [MainThread]: Flushing usage events
[0m19:15:56.521860 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:16:14.402941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06ab2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06a9220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06ab410>]}


============================== 19:16:14.424475 | a7d2ddfa-201c-44a1-93ad-edc230c4ce71 ==============================
[0m19:16:14.424475 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:16:14.425302 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'debug': 'False', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'no_print': 'None', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True'}
[0m19:16:14.689381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff18dd460>]}
[0m19:16:14.780949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff025d970>]}
[0m19:16:14.782291 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:16:15.105701 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:16:15.272946 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:16:15.273909 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:16:15.344719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefea7e00>]}
[0m19:16:15.466789 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:16:15.469541 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:16:15.484613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f7200>]}
[0m19:16:15.485847 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:16:15.487050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81ff20>]}
[0m19:16:15.489791 [info ] [MainThread]: 
[0m19:16:15.490193 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:16:15.490556 [info ] [MainThread]: 
[0m19:16:15.491533 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:16:15.499186 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:16:15.529283 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:16:15.529784 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:16:15.530074 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:16:15.530326 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:16:15.531769 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcd17c0>]}
[0m19:16:16.028162 [debug] [ThreadPool]: SQL status: SUCCESS in 0.497 seconds
[0m19:16:16.031812 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:16:16.037763 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:16:16.053359 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:16:16.053874 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:16:16.054200 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:16:16.764734 [debug] [ThreadPool]: SQL status: SUCCESS in 0.710 seconds
[0m19:16:16.770890 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:16:16.771595 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:16:16.773037 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:16:16.790242 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:16:16.790855 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:16:16.791232 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:16:17.361377 [debug] [ThreadPool]: SQL status: SUCCESS in 0.569 seconds
[0m19:16:17.366322 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:16:17.366961 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:16:17.368582 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:16:17.387171 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:16:17.395729 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:16:17.396661 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:16:19.434039 [debug] [ThreadPool]: SQL status: SUCCESS in 2.035 seconds
[0m19:16:19.460050 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:16:19.462258 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:16:19.475806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff195abd0>]}
[0m19:16:19.488778 [debug] [MainThread]: On master: COMMIT
[0m19:16:19.669155 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:16:19.702691 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m19:16:19.707834 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m19:16:19.719432 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:16:19.780285 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:16:19.786770 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:16:20.011119 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:16:20.020669 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:16:20.021646 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m19:16:20.022354 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:16:27.685887 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 7.661 seconds
[0m19:16:27.723370 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:16:27.724142 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:16:27.834301 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.110 seconds
[0m19:16:27.837667 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:16:27.838567 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m19:16:27.931705 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.093 seconds
[0m19:16:27.943041 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:16:27.946036 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:16:27.946580 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:16:28.219111 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.272 seconds
[0m19:16:28.260233 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m19:16:28.260975 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m19:16:28.271196 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefeff410>]}
[0m19:16:28.273538 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 8.56s]
[0m19:16:28.276014 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:16:28.276794 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:16:28.278738 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m19:16:28.279659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:16:28.280211 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:16:28.286880 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:16:28.288152 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:16:28.291447 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:16:28.294189 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:16:28.294666 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m19:16:28.295091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:16:31.087347 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 2.791 seconds
[0m19:16:31.110618 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:16:31.112110 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:16:31.222820 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.110 seconds
[0m19:16:31.227186 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:16:31.227775 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m19:16:31.323525 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.095 seconds
[0m19:16:31.328822 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:16:31.330427 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:16:31.331087 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:16:31.400745 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.069 seconds
[0m19:16:31.408312 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m19:16:31.416864 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m19:16:31.419519 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef41b5f0>]}
[0m19:16:31.421239 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 3.14s]
[0m19:16:31.423374 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:16:31.424190 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:16:31.425439 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m19:16:31.426315 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:16:31.426836 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:16:31.435748 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:16:31.437342 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:16:31.441705 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:16:31.445666 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:16:31.446332 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m19:16:31.446958 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:16:40.924322 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 9.442 seconds
[0m19:16:41.073776 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:16:41.075389 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:16:41.933312 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.857 seconds
[0m19:16:41.944259 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:16:41.947172 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m19:16:44.439130 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 2.486 seconds
[0m19:16:44.520730 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:16:44.527007 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:16:44.529374 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:16:45.433832 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.902 seconds
[0m19:16:45.478097 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m19:16:45.479350 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m19:16:45.483721 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef48f6b0>]}
[0m19:16:45.491647 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 14.06s]
[0m19:16:45.498260 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:16:45.506306 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:16:45.511010 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m19:16:45.519264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:16:45.522961 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:16:45.570672 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:16:45.576390 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:16:45.585868 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:16:45.592811 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:16:45.593489 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m19:16:45.594148 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:16:52.459755 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 6.860 seconds
[0m19:16:52.522589 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:16:52.523446 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:16:52.789752 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.265 seconds
[0m19:16:52.800494 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:16:52.801203 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m19:16:52.924519 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.123 seconds
[0m19:16:52.930079 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:16:52.931458 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:16:52.931825 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:16:52.999283 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.067 seconds
[0m19:16:53.003573 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m19:16:53.004161 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m19:16:53.007695 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7d2ddfa-201c-44a1-93ad-edc230c4ce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa1d90>]}
[0m19:16:53.009921 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 7.49s]
[0m19:16:53.013431 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:16:53.040149 [debug] [MainThread]: On master: COMMIT
[0m19:16:53.041728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:16:53.042215 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m19:16:53.045630 [info ] [MainThread]: 
[0m19:16:53.047196 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 37.55 seconds (37.55s).
[0m19:16:53.050034 [debug] [MainThread]: Command end result
[0m19:16:53.091045 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:16:53.107017 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:16:53.149602 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:16:53.150599 [info ] [MainThread]: 
[0m19:16:53.152757 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:16:53.154006 [info ] [MainThread]: 
[0m19:16:53.155084 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:16:53.162346 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 38.87581, "process_in_blocks": "220432", "process_kernel_time": 1.78916, "process_mem_max_rss": "287136", "process_out_blocks": "2286", "process_user_time": 5.109565}
[0m19:16:53.164145 [debug] [MainThread]: Command `cli run` succeeded at 19:16:53.163978 after 38.88 seconds
[0m19:16:53.165829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02b5640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m19:16:53.166307 [debug] [MainThread]: Flushing usage events
[0m19:16:53.966133 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:16:59.529073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1ca3140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022e480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022c4d0>]}


============================== 19:16:59.550941 | 7d1ba599-3a84-4b3f-af55-486381c29355 ==============================
[0m19:16:59.550941 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:16:59.552241 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:16:59.876427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff06420>]}
[0m19:16:59.969145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00d9b80>]}
[0m19:16:59.970107 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:17:00.456631 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:17:00.644346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:17:00.645398 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:17:00.722568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd564e0>]}
[0m19:17:00.835758 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:17:00.839980 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:17:00.854137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7fb230>]}
[0m19:17:00.855285 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:17:00.856846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81ff20>]}
[0m19:17:00.859974 [info ] [MainThread]: 
[0m19:17:00.861135 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:17:00.861653 [info ] [MainThread]: 
[0m19:17:00.862571 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:17:00.871691 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:17:00.910932 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:17:00.911553 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:17:00.911925 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:17:00.912219 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:17:00.913900 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83e450>]}
[0m19:17:01.499336 [debug] [ThreadPool]: SQL status: SUCCESS in 0.587 seconds
[0m19:17:01.502531 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:17:01.507699 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:17:01.529533 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:17:01.530141 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:17:01.530509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:02.687422 [debug] [ThreadPool]: SQL status: SUCCESS in 1.156 seconds
[0m19:17:02.697981 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:17:02.698668 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:17:02.699953 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:17:02.707863 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:17:02.718405 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:17:02.719165 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:03.309532 [debug] [ThreadPool]: SQL status: SUCCESS in 0.590 seconds
[0m19:17:03.314574 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:17:03.315650 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:17:03.318838 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:17:03.330829 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:17:03.331445 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:17:03.331885 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:05.118080 [debug] [ThreadPool]: SQL status: SUCCESS in 1.769 seconds
[0m19:17:05.143459 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:17:05.144557 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:17:05.151260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff195ae10>]}
[0m19:17:05.165528 [debug] [MainThread]: On master: COMMIT
[0m19:17:05.207063 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:05.211889 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m19:17:05.221425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:17:05.222161 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:05.300475 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:05.312594 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:05.510593 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:05.533952 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:05.554066 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m19:17:05.561351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:11.865529 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 6.303 seconds
[0m19:17:11.893579 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:11.894313 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:17:12.007541 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.113 seconds
[0m19:17:12.019708 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:12.020568 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m19:17:12.200083 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.179 seconds
[0m19:17:12.223463 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:17:12.227101 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:12.227702 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:17:12.331132 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.103 seconds
[0m19:17:12.364700 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m19:17:12.365288 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m19:17:12.377931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef44a1b0>]}
[0m19:17:12.380587 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 7.15s]
[0m19:17:12.384120 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:12.384999 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:17:12.386668 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m19:17:12.387394 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m19:17:12.387842 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:17:12.393183 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:17:12.395079 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:17:12.399757 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:17:12.407611 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:17:12.408570 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m19:17:12.409186 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:15.927716 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 3.517 seconds
[0m19:17:15.940969 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:17:15.941572 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:17:16.093063 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.151 seconds
[0m19:17:16.098428 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:17:16.099066 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m19:17:16.194468 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.095 seconds
[0m19:17:16.199189 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:17:16.200308 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:17:16.200842 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:17:16.286004 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.085 seconds
[0m19:17:16.294708 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m19:17:16.295608 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m19:17:16.299257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff7942390>]}
[0m19:17:16.301278 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 3.91s]
[0m19:17:16.302272 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:17:16.306456 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:17:16.309242 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m19:17:16.310520 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:17:16.311065 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:17:16.323875 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:17:16.325672 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:17:16.333212 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:17:16.345584 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:17:16.346403 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m19:17:16.347216 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:20.909957 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.557 seconds
[0m19:17:20.954347 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:17:20.969991 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:17:21.185097 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.209 seconds
[0m19:17:21.210635 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:17:21.211368 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m19:17:21.502175 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.289 seconds
[0m19:17:21.517557 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:17:21.527354 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:17:21.531564 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:17:22.322160 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.767 seconds
[0m19:17:22.379008 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m19:17:22.381350 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m19:17:22.407806 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd1ac90>]}
[0m19:17:22.417201 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 6.09s]
[0m19:17:22.425159 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:17:22.431923 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:17:22.433558 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m19:17:22.438819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m19:17:22.442317 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:17:22.518585 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:17:22.528796 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:17:22.542219 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:17:22.591811 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:17:22.593845 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m19:17:22.598491 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:26.090728 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 3.491 seconds
[0m19:17:26.118492 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:17:26.119148 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:17:26.224726 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.105 seconds
[0m19:17:26.228450 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:17:26.228916 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m19:17:26.353612 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.124 seconds
[0m19:17:26.357570 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:17:26.358565 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:17:26.358942 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:17:26.416401 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m19:17:26.419987 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m19:17:26.420529 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m19:17:26.423150 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d1ba599-3a84-4b3f-af55-486381c29355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3d23f0>]}
[0m19:17:26.425140 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 3.99s]
[0m19:17:26.428630 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:17:26.448556 [debug] [MainThread]: On master: COMMIT
[0m19:17:26.450779 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:17:26.451398 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m19:17:26.455264 [info ] [MainThread]: 
[0m19:17:26.456919 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 25.59 seconds (25.59s).
[0m19:17:26.461530 [debug] [MainThread]: Command end result
[0m19:17:26.501713 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:17:26.516446 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:17:26.549565 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:17:26.550088 [info ] [MainThread]: 
[0m19:17:26.551163 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:17:26.551811 [info ] [MainThread]: 
[0m19:17:26.552970 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:17:26.559616 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.103949, "process_in_blocks": "322864", "process_kernel_time": 2.056874, "process_mem_max_rss": "287356", "process_out_blocks": "2421", "process_user_time": 4.707036}
[0m19:17:26.561456 [debug] [MainThread]: Command `cli run` succeeded at 19:17:26.561313 after 27.11 seconds
[0m19:17:26.563086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02becf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c3d700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c3c650>]}
[0m19:17:26.563521 [debug] [MainThread]: Flushing usage events
[0m19:17:27.297661 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:17:33.108868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19eee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05cb920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c3a10>]}


============================== 19:17:33.130468 | 982fc632-8d24-42a2-9f4d-4758ee3aae1e ==============================
[0m19:17:33.130468 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:17:33.131315 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:17:33.424307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0cd75f0>]}
[0m19:17:33.515785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1ee10>]}
[0m19:17:33.516828 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:17:33.948405 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:17:34.148681 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:17:34.149585 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:17:34.231398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80fc50>]}
[0m19:17:34.391097 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:17:34.401458 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:17:34.426171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef839340>]}
[0m19:17:34.427823 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:17:34.429696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef825340>]}
[0m19:17:34.433893 [info ] [MainThread]: 
[0m19:17:34.435136 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:17:34.436030 [info ] [MainThread]: 
[0m19:17:34.437530 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:17:34.449244 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:17:34.509042 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:17:34.510108 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:17:34.511917 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:17:34.512500 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:17:34.516780 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52c860>]}
[0m19:17:35.682489 [debug] [ThreadPool]: SQL status: SUCCESS in 1.166 seconds
[0m19:17:35.691729 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:17:35.714534 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:17:35.749713 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:17:35.751086 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:17:35.752163 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:37.686711 [debug] [ThreadPool]: SQL status: SUCCESS in 1.934 seconds
[0m19:17:37.693617 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:17:37.694094 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:17:37.696458 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:17:37.707155 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:17:37.707650 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:17:37.708042 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:38.089324 [debug] [ThreadPool]: SQL status: SUCCESS in 0.381 seconds
[0m19:17:38.091237 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:17:38.091616 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:17:38.092527 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:17:38.098514 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:17:38.099028 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:17:38.099346 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:38.445402 [debug] [ThreadPool]: SQL status: SUCCESS in 0.346 seconds
[0m19:17:38.447584 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:17:38.448731 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:17:38.451828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef824ad0>]}
[0m19:17:38.453834 [debug] [MainThread]: On master: COMMIT
[0m19:17:38.469048 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:17:38.470501 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m19:17:38.471546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m19:17:38.475761 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:17:38.493664 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:17:38.495945 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:17:38.566034 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:17:38.570930 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:17:38.571851 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m19:17:38.572489 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:40.353088 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 1.779 seconds
[0m19:17:40.374452 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:17:40.375003 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:17:40.449854 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.074 seconds
[0m19:17:40.453525 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:17:40.453992 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m19:17:40.517938 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.063 seconds
[0m19:17:40.526485 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:17:40.528978 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:17:40.529449 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:17:40.612168 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.082 seconds
[0m19:17:40.696954 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m19:17:40.697713 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m19:17:40.703950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef408980>]}
[0m19:17:40.705278 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 2.23s]
[0m19:17:40.709085 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:17:40.709732 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:17:40.710782 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m19:17:40.711324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:17:40.711739 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:17:40.716216 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:17:40.717513 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:17:40.721278 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:17:40.727589 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:17:40.728151 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m19:17:40.728617 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:42.736858 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 1.999 seconds
[0m19:17:42.772210 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:17:42.773183 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:17:42.870992 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.097 seconds
[0m19:17:42.875629 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:17:42.876226 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m19:17:42.963861 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.087 seconds
[0m19:17:42.967913 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:17:42.969110 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:17:42.969493 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:17:43.026519 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m19:17:43.030058 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m19:17:43.031142 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m19:17:43.041774 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef495eb0>]}
[0m19:17:43.047159 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.32s]
[0m19:17:43.048654 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:17:43.049460 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:17:43.051217 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m19:17:43.051977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m19:17:43.052372 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:17:43.061131 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:17:43.062579 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:17:43.065775 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m19:17:43.069527 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:17:43.070062 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m19:17:43.070621 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:17:45.052844 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.981 seconds
[0m19:17:45.075621 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:17:45.076353 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:17:45.167560 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.091 seconds
[0m19:17:45.174015 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:17:45.174729 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m19:17:45.282341 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.107 seconds
[0m19:17:45.286726 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:17:45.287790 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:17:45.288194 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:17:45.344683 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.056 seconds
[0m19:17:45.350568 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m19:17:45.351476 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m19:17:45.361745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '982fc632-8d24-42a2-9f4d-4758ee3aae1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5b1370>]}
[0m19:17:45.365706 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 2.30s]
[0m19:17:45.367832 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:17:45.384491 [debug] [MainThread]: On master: COMMIT
[0m19:17:45.386273 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:17:45.386968 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m19:17:45.389218 [info ] [MainThread]: 
[0m19:17:45.391134 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 10.95 seconds (10.95s).
[0m19:17:45.394485 [debug] [MainThread]: Command end result
[0m19:17:45.435205 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:17:45.445786 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:17:45.479752 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:17:45.480950 [info ] [MainThread]: 
[0m19:17:45.481894 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:17:45.482680 [info ] [MainThread]: 
[0m19:17:45.483896 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m19:17:45.493808 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.453702, "process_in_blocks": "206984", "process_kernel_time": 1.565693, "process_mem_max_rss": "288672", "process_out_blocks": "2297", "process_user_time": 3.679891}
[0m19:17:45.500359 [debug] [MainThread]: Command `cli run` succeeded at 19:17:45.499954 after 12.47 seconds
[0m19:17:45.503711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19eee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0451b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0cd7b00>]}
[0m19:17:45.504660 [debug] [MainThread]: Flushing usage events
[0m19:17:46.150446 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:17:55.701683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19eef00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c3bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c2b40>]}


============================== 19:17:55.723915 | 41e25463-68fd-4173-b043-5d0b131658a4 ==============================
[0m19:17:55.723915 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:17:55.725769 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:17:56.038759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0475eb0>]}
[0m19:17:56.126383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff098f860>]}
[0m19:17:56.127468 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:17:56.417919 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:17:56.608310 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:17:56.609354 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:17:56.707508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd50320>]}
[0m19:17:56.721600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa6510>]}
[0m19:17:56.722483 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:17:56.722994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefea0650>]}
[0m19:17:56.727169 [info ] [MainThread]: 
[0m19:17:56.728153 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:17:56.728853 [info ] [MainThread]: 
[0m19:17:56.729957 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:17:56.741651 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m19:17:56.793377 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:17:56.794078 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:17:56.794455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:17:56.794739 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:17:56.796198 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4df4d0>]}
[0m19:17:58.426760 [debug] [ThreadPool]: SQL status: SUCCESS in 1.629 seconds
[0m19:17:58.439302 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:17:58.440285 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:17:58.447891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:17:58.473342 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:17:58.474412 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:17:58.475674 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:59.198550 [debug] [ThreadPool]: SQL status: SUCCESS in 0.723 seconds
[0m19:17:59.201733 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:17:59.202335 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:17:59.203459 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:17:59.217667 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:17:59.218532 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:17:59.219950 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:17:59.850685 [debug] [ThreadPool]: SQL status: SUCCESS in 0.629 seconds
[0m19:17:59.858671 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:17:59.859582 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:17:59.869598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41e25463-68fd-4173-b043-5d0b131658a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefff0680>]}
[0m19:17:59.886450 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m19:17:59.887561 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m19:17:59.888230 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m19:17:59.894431 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m19:17:59.896413 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m19:17:59.897117 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:17:59.897896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m19:17:59.898513 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:17:59.900465 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:17:59.901251 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:17:59.901714 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:17:59.902167 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m19:17:59.902603 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m19:17:59.904382 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m19:17:59.905348 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:17:59.905799 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m19:17:59.906464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m19:17:59.906977 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m19:17:59.909035 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m19:17:59.909971 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m19:17:59.910570 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:17:59.911287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m19:17:59.911935 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:17:59.922164 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:17:59.923530 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:17:59.924481 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:17:59.924956 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:17:59.925518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:17:59.926154 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:17:59.931037 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:17:59.932116 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:17:59.933353 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:17:59.933855 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:17:59.934472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:17:59.934923 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:17:59.939014 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:17:59.939976 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:17:59.940795 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:17:59.941321 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:17:59.941901 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:17:59.942613 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:17:59.946471 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:17:59.947712 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:17:59.948618 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:17:59.949105 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:59.949704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:17:59.950247 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:59.953686 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:17:59.954437 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:59.955215 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:17:59.955765 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:17:59.956354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m19:17:59.956776 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:17:59.976521 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m19:17:59.977477 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:17:59.978220 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:17:59.978624 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:17:59.979110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m19:17:59.979491 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:17:59.984596 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m19:17:59.985514 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:17:59.986298 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:17:59.986741 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:17:59.987227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m19:17:59.987587 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:17:59.991926 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m19:17:59.992881 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:17:59.993564 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:17:59.993960 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:17:59.994461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m19:17:59.994852 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:18:00.003171 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m19:18:00.004342 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:18:00.005125 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:18:00.005527 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:18:00.006022 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m19:18:00.006382 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:18:00.010184 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:18:00.011104 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:18:00.011810 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:18:00.012325 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:18:00.013007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m19:18:00.013520 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:18:00.018609 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m19:18:00.019752 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:18:00.020722 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:18:00.021454 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:18:00.022068 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m19:18:00.022491 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:18:00.032885 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m19:18:00.034050 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:18:00.035181 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:18:00.037392 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:18:00.039127 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m19:18:00.040459 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:18:00.046592 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m19:18:00.048826 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:18:00.050994 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:18:00.051832 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:18:00.053001 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m19:18:00.054239 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:18:00.060896 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m19:18:00.062753 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:18:00.065033 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:18:00.066381 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:18:00.067440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:18:00.068288 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:18:00.073694 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:18:00.074987 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:18:00.076156 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:18:00.076794 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:18:00.077601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m19:18:00.078520 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:18:00.085132 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m19:18:00.086315 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:18:00.087300 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:18:00.087797 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:18:00.088451 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m19:18:00.089119 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:18:00.093909 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m19:18:00.095004 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:18:00.095850 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:18:00.096304 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:18:00.096766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m19:18:00.097226 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:18:00.101111 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m19:18:00.101845 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:18:00.102538 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:18:00.103024 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:18:00.103439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m19:18:00.103793 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:18:00.107098 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:18:00.107879 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:18:00.108626 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:18:00.109019 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:18:00.109592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m19:18:00.110001 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:18:00.114175 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m19:18:00.115099 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:18:00.116123 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:18:00.116695 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:18:00.117229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m19:18:00.117670 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:18:00.122041 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m19:18:00.122973 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:18:00.123713 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:18:00.124174 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:18:00.124681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m19:18:00.125085 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:18:00.129605 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m19:18:00.130695 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:18:00.131746 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:18:00.132371 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:18:00.133256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m19:18:00.133864 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:18:00.139335 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:18:00.140307 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:18:00.141163 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:18:00.141731 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:18:00.142262 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m19:18:00.142651 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:18:00.146704 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:18:00.147789 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:18:00.148584 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:18:00.148993 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:18:00.149413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:18:00.149895 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:18:00.153916 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:18:00.154829 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:18:00.155969 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:18:00.160878 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:18:00.162387 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m19:18:00.168739 [debug] [MainThread]: Command end result
[0m19:18:00.550311 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:18:00.619574 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:18:00.674397 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:18:00.708117 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m19:18:00.709364 [info ] [MainThread]: Building catalog
[0m19:18:00.730697 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m19:18:00.856783 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m19:18:00.860704 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m19:18:00.862992 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:18:28.286994 [debug] [ThreadPool]: SQL status: SUCCESS in 27.416 seconds
[0m19:18:28.350217 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m19:18:28.459506 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:18:28.524723 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:18:28.550135 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:18:28.551658 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:18:28.581380 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 33.009846, "process_in_blocks": "100696", "process_kernel_time": 2.845274, "process_mem_max_rss": "287176", "process_out_blocks": "5916", "process_user_time": 7.431703}
[0m19:18:28.586216 [debug] [MainThread]: Command `cli docs generate` succeeded at 19:18:28.585037 after 33.03 seconds
[0m19:18:28.589223 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m19:18:28.590383 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m19:18:28.596051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff07200e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82c2f0>]}
[0m19:18:28.597026 [debug] [MainThread]: Flushing usage events
[0m19:18:29.640580 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:18:45.541244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0312210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05938c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01a8a10>]}


============================== 19:18:45.564340 | 41eae521-7e75-4389-9b1d-fc2cbf74db21 ==============================
[0m19:18:45.564340 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:18:45.565763 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:18:45.787535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0073ce0>]}
[0m19:18:45.869994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01c83e0>]}
[0m19:18:45.871042 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:18:46.177069 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:18:46.314359 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:18:46.315093 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:18:46.382958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2baa0>]}
[0m19:18:46.477738 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:18:46.480230 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:18:46.494513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b560>]}
[0m19:18:46.496021 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:18:46.497268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef837f20>]}
[0m19:18:46.500715 [info ] [MainThread]: 
[0m19:18:46.501311 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:18:46.502215 [info ] [MainThread]: 
[0m19:18:46.503024 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:18:46.511100 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:18:46.541666 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:18:46.542259 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:18:46.542620 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:18:46.542940 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:18:46.544225 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef520ec0>]}
[0m19:18:47.065152 [debug] [ThreadPool]: SQL status: SUCCESS in 0.520 seconds
[0m19:18:47.070370 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:18:47.082913 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:18:47.107863 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:18:47.108632 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:18:47.109100 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:18:47.810218 [debug] [ThreadPool]: SQL status: SUCCESS in 0.699 seconds
[0m19:18:47.817090 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:18:47.817630 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:18:47.818951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:18:47.828634 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:18:47.829240 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:18:47.829589 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:18:48.128068 [debug] [ThreadPool]: SQL status: SUCCESS in 0.298 seconds
[0m19:18:48.130001 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:18:48.130444 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:18:48.131143 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:18:48.137277 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:18:48.137778 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:18:48.138108 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:18:48.375357 [debug] [ThreadPool]: SQL status: SUCCESS in 0.237 seconds
[0m19:18:48.377186 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:18:48.377590 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:18:48.380338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55db7a0>]}
[0m19:18:48.382551 [debug] [MainThread]: On master: COMMIT
[0m19:18:48.393482 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:18:48.395460 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m19:18:48.396761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m19:18:48.397259 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:18:48.407208 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:18:48.408517 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:18:48.451427 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:18:48.454103 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:18:48.454507 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m19:18:48.454844 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:56.648152 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 8.191 seconds
[0m19:18:56.683544 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:18:56.684409 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:18:56.768508 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.084 seconds
[0m19:18:56.772376 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:18:56.772903 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m19:18:56.887046 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.114 seconds
[0m19:18:56.898601 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:18:56.902106 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m19:18:56.902791 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m19:18:56.984241 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.081 seconds
[0m19:18:57.014101 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m19:18:57.014821 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m19:18:57.024042 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8099a0>]}
[0m19:18:57.025613 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 8.62s]
[0m19:18:57.028214 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:18:57.029659 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:18:57.031917 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m19:18:57.032806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:18:57.033283 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:18:57.037282 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:18:57.038329 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:18:57.041149 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:18:57.043383 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:18:57.043753 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m19:18:57.044137 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:18:58.671113 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 1.627 seconds
[0m19:18:58.675944 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:18:58.676541 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:18:58.753804 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.077 seconds
[0m19:18:58.758747 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:18:58.759273 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m19:18:58.841776 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.082 seconds
[0m19:18:58.847160 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:18:58.848430 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:18:58.848893 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m19:18:58.904163 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.054 seconds
[0m19:18:58.906029 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m19:18:58.906366 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m19:18:58.908051 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef46be60>]}
[0m19:18:58.908811 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 1.88s]
[0m19:18:58.909529 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:18:58.910148 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:18:58.911065 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m19:18:58.911785 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:18:58.912460 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:18:58.917808 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:18:58.919726 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:18:58.926270 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:18:58.931121 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:18:58.931832 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m19:18:58.932384 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:00.943120 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.010 seconds
[0m19:19:00.954920 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:19:00.955632 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:19:01.093309 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.136 seconds
[0m19:19:01.101269 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:19:01.102042 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m19:19:01.218632 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.116 seconds
[0m19:19:01.223288 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:19:01.224396 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:19:01.224836 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m19:19:01.277579 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.052 seconds
[0m19:19:01.280779 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m19:19:01.281171 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m19:19:01.287777 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8558b0>]}
[0m19:19:01.291738 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 2.37s]
[0m19:19:01.296122 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:19:01.297085 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:19:01.298177 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m19:19:01.298814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:19:01.299205 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:19:01.306147 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:19:01.307483 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:19:01.311268 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:19:01.314195 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:19:01.314724 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m19:19:01.315178 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:02.816450 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 1.501 seconds
[0m19:19:02.839850 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:19:02.841838 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:19:02.963914 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.120 seconds
[0m19:19:02.971145 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:19:02.972063 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m19:19:03.141537 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.169 seconds
[0m19:19:03.147265 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:19:03.148614 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m19:19:03.149204 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m19:19:03.254890 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.105 seconds
[0m19:19:03.257914 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m19:19:03.258494 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m19:19:03.261031 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41eae521-7e75-4389-9b1d-fc2cbf74db21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3d1f70>]}
[0m19:19:03.263109 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 1.96s]
[0m19:19:03.267301 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:19:03.274860 [debug] [MainThread]: On master: COMMIT
[0m19:19:03.276877 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:19:03.277596 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m19:19:03.281020 [info ] [MainThread]: 
[0m19:19:03.282600 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 16.78 seconds (16.78s).
[0m19:19:03.286121 [debug] [MainThread]: Command end result
[0m19:19:03.333179 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:19:03.342710 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:19:03.375211 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:19:03.375961 [info ] [MainThread]: 
[0m19:19:03.377169 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:19:03.378103 [info ] [MainThread]: 
[0m19:19:03.379127 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:19:03.383530 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.915861, "process_in_blocks": "10640", "process_kernel_time": 0.673089, "process_mem_max_rss": "289068", "process_out_blocks": "2286", "process_user_time": 3.042883}
[0m19:19:03.385118 [debug] [MainThread]: Command `cli run` succeeded at 19:19:03.384834 after 17.92 seconds
[0m19:19:03.386621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022f830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c76ea0>]}
[0m19:19:03.387404 [debug] [MainThread]: Flushing usage events
[0m19:19:04.082437 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:19:13.930013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c7d280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0276540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c7d1f0>]}


============================== 19:19:13.951598 | fd4c9e22-48ae-4557-b5e3-0af685890678 ==============================
[0m19:19:13.951598 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:19:13.952507 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:19:14.439648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc5130>]}
[0m19:19:14.583717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0630530>]}
[0m19:19:14.585269 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:19:14.987609 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:19:15.164632 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:19:15.165544 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:19:15.230300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01aa5a0>]}
[0m19:19:15.333595 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:19:15.336847 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:19:15.359822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b5c0>]}
[0m19:19:15.360986 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:19:15.361603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8368d0>]}
[0m19:19:15.365549 [info ] [MainThread]: 
[0m19:19:15.366107 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:19:15.366449 [info ] [MainThread]: 
[0m19:19:15.367292 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:19:15.375659 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:19:15.405606 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:19:15.406077 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:19:15.406420 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:15.406665 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:19:15.408093 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2fd10>]}
[0m19:19:15.862268 [debug] [ThreadPool]: SQL status: SUCCESS in 0.455 seconds
[0m19:19:15.867185 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:19:15.873358 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:19:15.892766 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:19:15.893882 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:19:15.894267 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:16.448925 [debug] [ThreadPool]: SQL status: SUCCESS in 0.554 seconds
[0m19:19:16.452448 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:19:16.453092 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:19:16.454201 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:19:16.461716 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:19:16.462195 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:19:16.462521 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:16.829414 [debug] [ThreadPool]: SQL status: SUCCESS in 0.366 seconds
[0m19:19:16.833047 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:19:16.833582 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:19:16.834802 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:19:16.847094 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:19:16.848213 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:19:16.848862 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:17.167925 [debug] [ThreadPool]: SQL status: SUCCESS in 0.319 seconds
[0m19:19:17.170118 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:19:17.170543 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:19:17.172966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffdfc80>]}
[0m19:19:17.174563 [debug] [MainThread]: On master: COMMIT
[0m19:19:17.185768 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:19:17.187288 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m19:19:17.188794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:19:17.189441 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:19:17.196988 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:19:17.198455 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:19:17.244358 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:19:17.250297 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:19:17.250783 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m19:19:17.251203 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:19.016388 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 1.763 seconds
[0m19:19:19.041303 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:19:19.042552 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:19:19.119549 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.076 seconds
[0m19:19:19.124104 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:19:19.124731 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m19:19:19.212649 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.087 seconds
[0m19:19:19.228773 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:19:19.233143 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m19:19:19.233959 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m19:19:19.297142 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.063 seconds
[0m19:19:19.324124 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m19:19:19.324713 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m19:19:19.329593 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef3e30>]}
[0m19:19:19.330981 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 2.14s]
[0m19:19:19.332254 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:19:19.333088 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:19:19.334471 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m19:19:19.335299 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m19:19:19.335742 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:19:19.340230 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:19:19.341534 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:19:19.346997 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:19:19.356569 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:19:19.357560 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m19:19:19.358532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:22.424682 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 3.062 seconds
[0m19:19:22.476928 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:19:22.479484 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:19:23.205840 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.723 seconds
[0m19:19:23.219044 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:19:23.220029 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m19:19:23.395953 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.175 seconds
[0m19:19:23.399990 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:19:23.400885 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m19:19:23.401217 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m19:19:23.445881 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.044 seconds
[0m19:19:23.449216 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m19:19:23.450390 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m19:19:23.453330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55bba40>]}
[0m19:19:23.455139 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 4.12s]
[0m19:19:23.457412 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:19:23.458264 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:19:23.460102 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m19:19:23.460783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:19:23.461351 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:19:23.470533 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:19:23.472438 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:19:23.476822 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:19:23.489164 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:19:23.490095 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m19:19:23.491102 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:25.351381 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 1.859 seconds
[0m19:19:25.367043 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:19:25.367738 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:19:25.422027 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.054 seconds
[0m19:19:25.426902 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:19:25.427264 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m19:19:25.508851 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.081 seconds
[0m19:19:25.513070 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:19:25.514311 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m19:19:25.514720 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m19:19:25.560479 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.045 seconds
[0m19:19:25.564202 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m19:19:25.564797 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m19:19:25.566859 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3d0050>]}
[0m19:19:25.568367 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 2.11s]
[0m19:19:25.569522 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:19:25.571469 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:19:25.572772 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m19:19:25.576533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m19:19:25.577514 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:19:25.587754 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:19:25.589753 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:19:25.596315 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:19:25.617195 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:19:25.618964 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m19:19:25.620208 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:27.045923 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 1.426 seconds
[0m19:19:27.049860 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:19:27.050509 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:19:27.108350 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.057 seconds
[0m19:19:27.112910 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:19:27.113331 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m19:19:27.196709 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.083 seconds
[0m19:19:27.200032 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:19:27.200862 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m19:19:27.201288 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m19:19:27.238569 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.037 seconds
[0m19:19:27.240613 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m19:19:27.241149 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m19:19:27.242453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd4c9e22-48ae-4557-b5e3-0af685890678', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3d0f80>]}
[0m19:19:27.243478 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 1.67s]
[0m19:19:27.244145 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:19:27.251312 [debug] [MainThread]: On master: COMMIT
[0m19:19:27.252580 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:19:27.252988 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m19:19:27.255029 [info ] [MainThread]: 
[0m19:19:27.256036 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 11.89 seconds (11.89s).
[0m19:19:27.258176 [debug] [MainThread]: Command end result
[0m19:19:27.287095 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:19:27.293732 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:19:27.320613 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:19:27.321045 [info ] [MainThread]: 
[0m19:19:27.321548 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:19:27.322333 [info ] [MainThread]: 
[0m19:19:27.323619 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m19:19:27.327255 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.515231, "process_in_blocks": "12872", "process_kernel_time": 1.508173, "process_mem_max_rss": "289104", "process_out_blocks": "2421", "process_user_time": 4.617581}
[0m19:19:27.329340 [debug] [MainThread]: Command `cli run` succeeded at 19:19:27.329209 after 13.52 seconds
[0m19:19:27.330865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0473e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b35cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff7942780>]}
[0m19:19:27.331230 [debug] [MainThread]: Flushing usage events
[0m19:19:28.116395 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:19:32.411199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f53a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0501100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0501610>]}


============================== 19:19:32.432076 | 64b8044b-59eb-49ce-b2f1-97ddf404fabb ==============================
[0m19:19:32.432076 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:19:32.433350 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:19:32.713299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff052d070>]}
[0m19:19:32.792340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0967860>]}
[0m19:19:32.793229 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:19:33.062561 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:19:33.195444 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:19:33.196230 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:19:33.258188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2bd40>]}
[0m19:19:33.361910 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:19:33.364119 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:19:33.374056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80f170>]}
[0m19:19:33.374982 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:19:33.375853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83bf80>]}
[0m19:19:33.377929 [info ] [MainThread]: 
[0m19:19:33.378355 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:19:33.378910 [info ] [MainThread]: 
[0m19:19:33.379721 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:19:33.386510 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m19:19:33.425388 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m19:19:33.426198 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m19:19:33.426747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:33.427302 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:19:33.429693 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85b7a0>]}
[0m19:19:33.826090 [debug] [ThreadPool]: SQL status: SUCCESS in 0.398 seconds
[0m19:19:33.829075 [debug] [ThreadPool]: On list_iceberg: Close
[0m19:19:33.833673 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m19:19:33.849961 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:19:33.850451 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:19:33.850761 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:35.654495 [debug] [ThreadPool]: SQL status: SUCCESS in 1.799 seconds
[0m19:19:35.691825 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:19:35.695875 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:19:35.700944 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:19:35.729126 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:19:35.730022 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:19:35.730667 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:39.436470 [debug] [ThreadPool]: SQL status: SUCCESS in 3.704 seconds
[0m19:19:39.443769 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:19:39.444326 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:19:39.446452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:19:39.458422 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:19:39.458995 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:19:39.459435 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:40.100215 [debug] [ThreadPool]: SQL status: SUCCESS in 0.641 seconds
[0m19:19:40.101855 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:19:40.102245 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:19:40.105496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef67f800>]}
[0m19:19:40.108472 [debug] [MainThread]: On master: COMMIT
[0m19:19:40.127946 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:19:40.130303 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m19:19:40.134062 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m19:19:40.135122 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:19:40.157756 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:19:40.161589 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:19:40.256324 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:19:40.264291 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:19:40.265299 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m19:19:40.266077 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:44.298320 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 4.031 seconds
[0m19:19:44.333728 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:19:44.334569 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:19:44.503778 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.168 seconds
[0m19:19:44.514926 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:19:44.516491 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m19:19:44.831271 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.313 seconds
[0m19:19:44.846600 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:19:44.852218 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m19:19:44.852997 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m19:19:44.958488 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.105 seconds
[0m19:19:44.995959 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m19:19:44.996595 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m19:19:45.000985 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefeefe60>]}
[0m19:19:45.002495 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 4.87s]
[0m19:19:45.003647 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:19:45.004433 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:19:45.005958 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m19:19:45.007058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:19:45.008170 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:19:45.016686 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:19:45.018321 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:19:45.027142 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:19:45.035319 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:19:45.036199 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m19:19:45.037459 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:47.359054 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.320 seconds
[0m19:19:47.379732 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:19:47.380746 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:19:47.460302 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.078 seconds
[0m19:19:47.465058 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:19:47.465721 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m19:19:47.559112 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.092 seconds
[0m19:19:47.564706 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:19:47.566259 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m19:19:47.566839 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m19:19:47.658488 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.091 seconds
[0m19:19:47.664118 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m19:19:47.664977 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m19:19:47.675177 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef464170>]}
[0m19:19:47.679406 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.67s]
[0m19:19:47.682954 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:19:47.685112 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:19:47.688659 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m19:19:47.690549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m19:19:47.692153 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:19:47.712056 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:19:47.722013 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:19:47.733396 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m19:19:47.743601 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:19:47.744749 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m19:19:47.745735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:19:49.851807 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 2.102 seconds
[0m19:19:49.894596 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:19:49.895891 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:19:49.965691 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.069 seconds
[0m19:19:49.970017 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:19:49.970650 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m19:19:50.069644 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.098 seconds
[0m19:19:50.078486 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:19:50.080552 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m19:19:50.081537 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m19:19:50.139195 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m19:19:50.146401 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m19:19:50.147078 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m19:19:50.153137 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64b8044b-59eb-49ce-b2f1-97ddf404fabb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4949e0>]}
[0m19:19:50.154935 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 2.46s]
[0m19:19:50.155897 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:19:50.162588 [debug] [MainThread]: On master: COMMIT
[0m19:19:50.164631 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:19:50.165314 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m19:19:50.167611 [info ] [MainThread]: 
[0m19:19:50.168651 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 16.79 seconds (16.79s).
[0m19:19:50.170858 [debug] [MainThread]: Command end result
[0m19:19:50.205901 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:19:50.213229 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:19:50.255651 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:19:50.256822 [info ] [MainThread]: 
[0m19:19:50.258588 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:19:50.259757 [info ] [MainThread]: 
[0m19:19:50.261662 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m19:19:50.268534 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.923187, "process_in_blocks": "15520", "process_kernel_time": 0.75844, "process_mem_max_rss": "287120", "process_out_blocks": "2297", "process_user_time": 3.715854}
[0m19:19:50.270427 [debug] [MainThread]: Command `cli run` succeeded at 19:19:50.270228 after 17.93 seconds
[0m19:19:50.271537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b39b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5fbe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c33080>]}
[0m19:19:50.271990 [debug] [MainThread]: Flushing usage events
[0m19:19:50.858794 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:19:57.838862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f57c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0278620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff027a0f0>]}


============================== 19:19:57.855858 | 931c7340-44c1-4bfe-b79a-56dcb377d020 ==============================
[0m19:19:57.855858 [info ] [MainThread]: Running with dbt=1.10.10
[0m19:19:57.857117 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m19:19:58.098985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0047bc0>]}
[0m19:19:58.177353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefded970>]}
[0m19:19:58.178325 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m19:19:58.475547 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m19:19:58.618358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:19:58.619235 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:19:58.682648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2f1d0>]}
[0m19:19:58.697796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa9fc20>]}
[0m19:19:58.698855 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m19:19:58.699554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa58200>]}
[0m19:19:58.702979 [info ] [MainThread]: 
[0m19:19:58.703409 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m19:19:58.703939 [info ] [MainThread]: 
[0m19:19:58.704799 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m19:19:58.712034 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m19:19:58.749460 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m19:19:58.750121 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m19:19:58.750474 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:58.750758 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m19:19:58.752470 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef837830>]}
[0m19:19:59.513436 [debug] [ThreadPool]: SQL status: SUCCESS in 0.762 seconds
[0m19:19:59.517305 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m19:19:59.517934 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m19:19:59.519673 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m19:19:59.528863 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m19:19:59.529534 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m19:19:59.530023 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:59.782130 [debug] [ThreadPool]: SQL status: SUCCESS in 0.252 seconds
[0m19:19:59.784330 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m19:19:59.784832 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m19:19:59.785675 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m19:19:59.794544 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m19:19:59.795242 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m19:19:59.795676 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:59.968137 [debug] [ThreadPool]: SQL status: SUCCESS in 0.172 seconds
[0m19:19:59.970391 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m19:19:59.970878 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m19:19:59.976196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '931c7340-44c1-4bfe-b79a-56dcb377d020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1994b30>]}
[0m19:19:59.984513 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m19:19:59.985523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m19:19:59.986157 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m19:19:59.989029 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m19:19:59.990223 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m19:19:59.990743 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:19:59.991419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m19:19:59.991746 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:19:59.993387 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:19:59.994015 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m19:19:59.994365 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:19:59.994849 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m19:19:59.995276 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m19:19:59.997034 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m19:19:59.997736 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m19:19:59.998090 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m19:19:59.998568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m19:19:59.998891 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m19:20:00.000616 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m19:20:00.001309 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m19:20:00.001731 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m19:20:00.002181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m19:20:00.002477 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m19:20:00.008455 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m19:20:00.010967 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m19:20:00.011851 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m19:20:00.012260 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:20:00.012918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m19:20:00.013532 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:20:00.016701 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m19:20:00.018030 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:20:00.018695 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m19:20:00.019123 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:20:00.019688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m19:20:00.020052 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m19:20:00.026598 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m19:20:00.027981 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m19:20:00.029667 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m19:20:00.030529 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m19:20:00.031904 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m19:20:00.032794 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m19:20:00.039854 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m19:20:00.041440 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m19:20:00.042452 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m19:20:00.042851 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m19:20:00.043398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m19:20:00.043726 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m19:20:00.046859 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m19:20:00.047694 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m19:20:00.048337 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m19:20:00.048731 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:20:00.049140 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m19:20:00.049555 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:20:00.064476 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m19:20:00.065522 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:20:00.066229 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m19:20:00.066584 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:20:00.067011 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m19:20:00.067356 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:20:00.070410 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m19:20:00.070951 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:20:00.071514 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m19:20:00.071861 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:20:00.072212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m19:20:00.072517 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:20:00.075304 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m19:20:00.075996 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:20:00.076566 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m19:20:00.076925 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:20:00.077405 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m19:20:00.077807 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:20:00.082733 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m19:20:00.083610 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:20:00.084196 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m19:20:00.084535 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m19:20:00.084992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m19:20:00.085405 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m19:20:00.088493 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m19:20:00.089630 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m19:20:00.090282 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m19:20:00.090934 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:20:00.091858 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m19:20:00.092336 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:20:00.095898 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m19:20:00.096546 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:20:00.097161 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m19:20:00.097517 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:20:00.097915 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m19:20:00.098217 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:20:00.101154 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m19:20:00.102098 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:20:00.102670 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m19:20:00.103111 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:20:00.103798 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m19:20:00.104780 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:20:00.109262 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m19:20:00.110068 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:20:00.110675 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m19:20:00.111018 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:20:00.111399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m19:20:00.111721 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:20:00.115235 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m19:20:00.116010 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:20:00.116606 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m19:20:00.116985 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m19:20:00.117357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m19:20:00.117663 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m19:20:00.120584 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m19:20:00.121396 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m19:20:00.121942 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m19:20:00.122269 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:20:00.122612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m19:20:00.122913 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:20:00.125781 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m19:20:00.126267 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:20:00.126759 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m19:20:00.127059 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:20:00.127374 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m19:20:00.127669 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:20:00.131736 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m19:20:00.132275 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:20:00.132799 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m19:20:00.133114 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:20:00.133438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m19:20:00.133733 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:20:00.136300 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m19:20:00.136781 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:20:00.137262 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m19:20:00.137601 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m19:20:00.137968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m19:20:00.138261 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m19:20:00.140898 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m19:20:00.141427 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m19:20:00.141923 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m19:20:00.142236 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:20:00.142713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m19:20:00.143088 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:20:00.145947 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m19:20:00.146539 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:20:00.147266 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m19:20:00.147737 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:20:00.148282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m19:20:00.148752 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:20:00.152179 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m19:20:00.153131 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:20:00.153737 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m19:20:00.154076 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:20:00.154435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m19:20:00.154733 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:20:00.157472 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m19:20:00.157995 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:20:00.158493 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m19:20:00.158814 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m19:20:00.159145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m19:20:00.159426 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m19:20:00.162323 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m19:20:00.162982 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m19:20:00.163489 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m19:20:00.163810 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m19:20:00.164154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m19:20:00.164433 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m19:20:00.168062 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m19:20:00.168896 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m19:20:00.169815 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m19:20:00.170358 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m19:20:00.170950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m19:20:00.171571 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m19:20:00.177942 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m19:20:00.178955 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m19:20:00.179752 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m19:20:00.182279 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:20:00.184420 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m19:20:00.191097 [debug] [MainThread]: Command end result
[0m19:20:00.372017 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:20:00.376789 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:20:00.393144 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m19:20:00.403010 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m19:20:00.403865 [info ] [MainThread]: Building catalog
[0m19:20:00.412103 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m19:20:00.466816 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m19:20:00.467911 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m19:20:00.468928 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:20:02.804260 [debug] [ThreadPool]: SQL status: SUCCESS in 2.333 seconds
[0m19:20:02.817889 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m19:20:02.859590 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:20:02.891204 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:20:02.895271 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:20:02.896075 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:20:02.899815 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 5.138713, "process_in_blocks": "230944", "process_kernel_time": 1.473653, "process_mem_max_rss": "290000", "process_out_blocks": "5916", "process_user_time": 3.029401}
[0m19:20:02.905587 [debug] [MainThread]: Command `cli docs generate` succeeded at 19:20:02.903679 after 5.14 seconds
[0m19:20:02.909597 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m19:20:02.910386 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m19:20:02.912959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bfe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefded970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1047da0>]}
[0m19:20:02.915276 [debug] [MainThread]: Flushing usage events
[0m19:20:03.452831 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:58:25.734556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f3170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bbc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06babd0>]}


============================== 00:58:25.753102 | 7df50ee0-9fdb-4b46-9f13-7b964c64a51b ==============================
[0m00:58:25.753102 [info ] [MainThread]: Running with dbt=1.10.10
[0m00:58:25.754318 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m00:58:26.018354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe49610>]}
[0m00:58:26.088395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefced0a0>]}
[0m00:58:26.089184 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m00:58:26.386518 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m00:58:26.523155 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:58:26.524049 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:58:26.589292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd4c920>]}
[0m00:58:26.678388 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:58:26.681368 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:58:26.692695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838e00>]}
[0m00:58:26.693612 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m00:58:26.694238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83ce30>]}
[0m00:58:26.696755 [info ] [MainThread]: 
[0m00:58:26.697280 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m00:58:26.697738 [info ] [MainThread]: 
[0m00:58:26.698509 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m00:58:26.708528 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m00:58:26.750277 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m00:58:26.750859 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m00:58:26.751222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:58:26.751596 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m00:58:26.753155 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52af00>]}
[0m00:58:27.645098 [debug] [ThreadPool]: SQL status: SUCCESS in 0.893 seconds
[0m00:58:27.648782 [debug] [ThreadPool]: On list_iceberg: Close
[0m00:58:27.654083 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m00:58:27.674124 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m00:58:27.674737 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m00:58:27.675144 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:28.864687 [debug] [ThreadPool]: SQL status: SUCCESS in 1.189 seconds
[0m00:58:28.867607 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m00:58:28.868103 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m00:58:28.869227 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m00:58:28.874718 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m00:58:28.876655 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m00:58:28.877011 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:29.472237 [debug] [ThreadPool]: SQL status: SUCCESS in 0.595 seconds
[0m00:58:29.474520 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m00:58:29.474931 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m00:58:29.475659 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m00:58:29.480001 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m00:58:29.480447 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m00:58:29.480782 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:30.124775 [debug] [ThreadPool]: SQL status: SUCCESS in 0.644 seconds
[0m00:58:30.127133 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m00:58:30.127757 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m00:58:30.130383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef68b800>]}
[0m00:58:30.132034 [debug] [MainThread]: On master: COMMIT
[0m00:58:30.142962 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m00:58:30.144103 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m00:58:30.145036 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m00:58:30.145565 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m00:58:30.159818 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m00:58:30.162351 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m00:58:30.242598 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m00:58:30.245856 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m00:58:30.246361 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m00:58:30.246743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:58:35.312939 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.063 seconds
[0m00:58:35.350346 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m00:58:35.351133 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m00:58:36.145816 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.791 seconds
[0m00:58:36.167633 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m00:58:36.170412 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m00:58:36.864908 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.692 seconds
[0m00:58:36.953542 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m00:58:36.959181 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m00:58:36.960129 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m00:58:37.302785 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.342 seconds
[0m00:58:37.381935 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m00:58:37.383903 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m00:58:37.410125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c502f0>]}
[0m00:58:37.414302 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 7.25s]
[0m00:58:37.420732 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m00:58:37.422659 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:58:37.425530 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m00:58:37.426304 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m00:58:37.427341 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:58:37.437600 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:58:37.441147 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:58:37.447666 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:58:37.451081 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:58:37.451619 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m00:58:37.452610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:58:41.218423 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.764 seconds
[0m00:58:41.248663 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:58:41.249604 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m00:58:41.400851 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.150 seconds
[0m00:58:41.405429 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:58:41.405958 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m00:58:41.537287 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.131 seconds
[0m00:58:41.541297 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m00:58:41.542241 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:58:41.542580 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m00:58:41.632260 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.089 seconds
[0m00:58:41.635784 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m00:58:41.636282 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m00:58:41.641114 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3c8260>]}
[0m00:58:41.645491 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 4.21s]
[0m00:58:41.648456 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:58:41.649599 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m00:58:41.652826 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m00:58:41.654024 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m00:58:41.654652 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m00:58:41.665078 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:58:41.668041 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m00:58:41.678815 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:58:41.684663 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:58:41.685454 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m00:58:41.686240 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:58:45.213648 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.526 seconds
[0m00:58:45.240652 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:58:45.241258 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m00:58:45.344112 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.102 seconds
[0m00:58:45.347791 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:58:45.348427 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m00:58:45.434128 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.085 seconds
[0m00:58:45.437451 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m00:58:45.438264 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:58:45.438590 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m00:58:45.480345 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.041 seconds
[0m00:58:45.483293 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m00:58:45.483757 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m00:58:45.485539 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef493050>]}
[0m00:58:45.487025 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 3.83s]
[0m00:58:45.489009 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m00:58:45.489915 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m00:58:45.491135 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m00:58:45.492441 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m00:58:45.492942 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m00:58:45.499105 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m00:58:45.500680 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m00:58:45.504221 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m00:58:45.507189 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m00:58:45.507551 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m00:58:45.507938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:58:47.620790 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.111 seconds
[0m00:58:47.635417 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m00:58:47.635941 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m00:58:47.716838 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.080 seconds
[0m00:58:47.719999 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m00:58:47.720364 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m00:58:47.788898 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.068 seconds
[0m00:58:47.792067 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m00:58:47.792847 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m00:58:47.793180 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m00:58:47.836339 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.043 seconds
[0m00:58:47.839891 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m00:58:47.840368 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m00:58:47.842262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7df50ee0-9fdb-4b46-9f13-7b964c64a51b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3c8140>]}
[0m00:58:47.846003 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.35s]
[0m00:58:47.850783 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m00:58:47.865316 [debug] [MainThread]: On master: COMMIT
[0m00:58:47.867782 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:58:47.868466 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m00:58:47.871054 [info ] [MainThread]: 
[0m00:58:47.872161 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 21.17 seconds (21.17s).
[0m00:58:47.875285 [debug] [MainThread]: Command end result
[0m00:58:47.924873 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:58:47.934724 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:58:47.961665 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m00:58:47.962162 [info ] [MainThread]: 
[0m00:58:47.963014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:58:47.963502 [info ] [MainThread]: 
[0m00:58:47.964325 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m00:58:47.967372 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 22.299362, "process_in_blocks": "40384", "process_kernel_time": 0.833526, "process_mem_max_rss": "288764", "process_out_blocks": "2286", "process_user_time": 3.265487}
[0m00:58:47.968220 [debug] [MainThread]: Command `cli run` succeeded at 00:58:47.968094 after 22.30 seconds
[0m00:58:47.969688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01cb890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19983e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff6169880>]}
[0m00:58:47.970031 [debug] [MainThread]: Flushing usage events
[0m00:58:48.732362 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:58:53.208349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0691610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff16b3da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0764ec0>]}


============================== 00:58:53.219170 | 2c661da6-f94a-40ee-af15-66ed81ae73f1 ==============================
[0m00:58:53.219170 [info ] [MainThread]: Running with dbt=1.10.10
[0m00:58:53.220184 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m00:58:53.419994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff16b40>]}
[0m00:58:53.486942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef22a0>]}
[0m00:58:53.487713 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m00:58:53.748082 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m00:58:53.896806 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:58:53.897801 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:58:53.965352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd51d30>]}
[0m00:58:54.083818 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:58:54.086134 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:58:54.096166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8131a0>]}
[0m00:58:54.097150 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m00:58:54.098302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83c230>]}
[0m00:58:54.100669 [info ] [MainThread]: 
[0m00:58:54.101262 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m00:58:54.101932 [info ] [MainThread]: 
[0m00:58:54.103130 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m00:58:54.111494 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m00:58:54.139280 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m00:58:54.139782 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m00:58:54.140088 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:58:54.140343 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m00:58:54.142089 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5288f0>]}
[0m00:58:54.556673 [debug] [ThreadPool]: SQL status: SUCCESS in 0.416 seconds
[0m00:58:54.558376 [debug] [ThreadPool]: On list_iceberg: Close
[0m00:58:54.561532 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m00:58:54.574818 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m00:58:54.575232 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m00:58:54.575513 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:55.183981 [debug] [ThreadPool]: SQL status: SUCCESS in 0.608 seconds
[0m00:58:55.186917 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m00:58:55.187356 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m00:58:55.188108 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m00:58:55.193115 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m00:58:55.193423 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m00:58:55.193719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:57.706498 [debug] [ThreadPool]: SQL status: SUCCESS in 2.512 seconds
[0m00:58:57.709694 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m00:58:57.710158 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m00:58:57.711290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m00:58:57.718366 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m00:58:57.718847 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m00:58:57.719198 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:58:58.271022 [debug] [ThreadPool]: SQL status: SUCCESS in 0.552 seconds
[0m00:58:58.273341 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m00:58:58.273844 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m00:58:58.275918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1998f20>]}
[0m00:58:58.277230 [debug] [MainThread]: On master: COMMIT
[0m00:58:58.286848 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m00:58:58.288176 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m00:58:58.289241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m00:58:58.289864 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m00:58:58.298026 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m00:58:58.300375 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m00:58:58.351292 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m00:58:58.359771 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m00:58:58.360537 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m00:58:58.361047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:01.339166 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 2.976 seconds
[0m00:59:01.363925 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m00:59:01.364493 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m00:59:01.523780 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.159 seconds
[0m00:59:01.527383 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m00:59:01.527835 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m00:59:01.629595 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.101 seconds
[0m00:59:01.637921 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m00:59:01.640190 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m00:59:01.640560 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m00:59:01.690572 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.050 seconds
[0m00:59:01.716740 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m00:59:01.717402 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m00:59:01.722007 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3f6210>]}
[0m00:59:01.723432 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 3.43s]
[0m00:59:01.728326 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m00:59:01.729138 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m00:59:01.730424 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m00:59:01.731334 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m00:59:01.731954 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m00:59:01.737441 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:01.738993 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m00:59:01.742454 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:01.749795 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:01.750404 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m00:59:01.750979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:04.165069 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 2.412 seconds
[0m00:59:04.185332 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:04.186049 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m00:59:04.316122 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.129 seconds
[0m00:59:04.321122 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:04.322299 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m00:59:04.427525 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.103 seconds
[0m00:59:04.438010 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m00:59:04.439547 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:04.440183 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m00:59:04.495808 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.055 seconds
[0m00:59:04.499283 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m00:59:04.499799 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m00:59:04.501849 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1f60680>]}
[0m00:59:04.503458 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 2.77s]
[0m00:59:04.504359 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m00:59:04.507955 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:04.508494 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m00:59:04.509036 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m00:59:04.509426 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:04.526982 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:04.528759 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:04.533303 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:04.544803 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:04.545787 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m00:59:04.546569 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:09.919867 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.372 seconds
[0m00:59:09.934273 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:09.934943 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m00:59:10.070525 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.135 seconds
[0m00:59:10.075362 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:10.075997 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m00:59:10.199859 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.123 seconds
[0m00:59:10.203981 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m00:59:10.204881 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:10.205256 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m00:59:10.267505 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.062 seconds
[0m00:59:10.271337 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m00:59:10.271876 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m00:59:10.273895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3deff0>]}
[0m00:59:10.275505 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.76s]
[0m00:59:10.276548 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:10.279074 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m00:59:10.280224 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m00:59:10.280867 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m00:59:10.281382 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m00:59:10.298486 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:10.299848 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m00:59:10.303987 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:10.320492 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:10.321346 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m00:59:10.322076 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:14.265320 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 3.939 seconds
[0m00:59:14.303708 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:14.305889 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m00:59:14.545218 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.238 seconds
[0m00:59:14.554202 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:14.555386 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m00:59:14.722747 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.166 seconds
[0m00:59:14.728114 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m00:59:14.729429 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:14.729978 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m00:59:14.791431 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.061 seconds
[0m00:59:14.794930 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m00:59:14.795439 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m00:59:14.798068 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c661da6-f94a-40ee-af15-66ed81ae73f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2d7f80>]}
[0m00:59:14.800250 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 4.52s]
[0m00:59:14.804014 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m00:59:14.832620 [debug] [MainThread]: On master: COMMIT
[0m00:59:14.835671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:59:14.836612 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m00:59:14.842162 [info ] [MainThread]: 
[0m00:59:14.844806 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 20.73 seconds (20.73s).
[0m00:59:14.854233 [debug] [MainThread]: Command end result
[0m00:59:14.933313 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:59:14.965691 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:59:15.017767 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m00:59:15.018501 [info ] [MainThread]: 
[0m00:59:15.020047 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:59:15.022616 [info ] [MainThread]: 
[0m00:59:15.025577 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m00:59:15.030692 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 21.88339, "process_in_blocks": "21120", "process_kernel_time": 1.112995, "process_mem_max_rss": "286948", "process_out_blocks": "2421", "process_user_time": 3.095551}
[0m00:59:15.032902 [debug] [MainThread]: Command `cli run` succeeded at 00:59:15.032626 after 21.89 seconds
[0m00:59:15.034762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4f800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4e8d0>]}
[0m00:59:15.036213 [debug] [MainThread]: Flushing usage events
[0m00:59:15.745715 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:59:21.840578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0218320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0218500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e7950>]}


============================== 00:59:21.874845 | 343a9b01-4d7a-4fe3-b870-ffccf23cb74e ==============================
[0m00:59:21.874845 [info ] [MainThread]: Running with dbt=1.10.10
[0m00:59:21.877126 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m00:59:22.133943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05c7bf0>]}
[0m00:59:22.201031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff009ecf0>]}
[0m00:59:22.201918 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m00:59:22.485354 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m00:59:22.608050 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:59:22.609015 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:59:22.669719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff17770>]}
[0m00:59:22.764348 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:59:22.766579 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:59:22.777182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef839160>]}
[0m00:59:22.777959 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m00:59:22.779339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82d0d0>]}
[0m00:59:22.782799 [info ] [MainThread]: 
[0m00:59:22.783549 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m00:59:22.784108 [info ] [MainThread]: 
[0m00:59:22.785089 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m00:59:22.798054 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m00:59:22.836487 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m00:59:22.836989 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m00:59:22.837320 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:22.837583 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m00:59:22.838408 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe8c560>]}
[0m00:59:23.500719 [debug] [ThreadPool]: SQL status: SUCCESS in 0.663 seconds
[0m00:59:23.503197 [debug] [ThreadPool]: On list_iceberg: Close
[0m00:59:23.508152 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m00:59:23.524672 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m00:59:23.525455 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m00:59:23.525916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:24.110854 [debug] [ThreadPool]: SQL status: SUCCESS in 0.585 seconds
[0m00:59:24.112772 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m00:59:24.113120 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m00:59:24.113766 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m00:59:24.118796 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m00:59:24.119173 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m00:59:24.119476 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:24.566719 [debug] [ThreadPool]: SQL status: SUCCESS in 0.447 seconds
[0m00:59:24.568365 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m00:59:24.568707 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m00:59:24.569318 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m00:59:24.572970 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m00:59:24.574555 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m00:59:24.574881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:24.884401 [debug] [ThreadPool]: SQL status: SUCCESS in 0.309 seconds
[0m00:59:24.887317 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m00:59:24.887867 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m00:59:24.889814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4e7b00>]}
[0m00:59:24.891088 [debug] [MainThread]: On master: COMMIT
[0m00:59:24.903472 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m00:59:24.904679 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m00:59:24.906227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m00:59:24.906772 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m00:59:24.911872 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:24.913129 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m00:59:24.960771 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:24.964217 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:24.964825 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m00:59:24.965239 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:26.917703 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 1.952 seconds
[0m00:59:26.928455 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:26.929031 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m00:59:26.986850 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.057 seconds
[0m00:59:26.989845 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:26.990191 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m00:59:27.082183 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.092 seconds
[0m00:59:27.090558 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m00:59:27.093383 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:27.094081 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m00:59:27.128347 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.034 seconds
[0m00:59:27.145825 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m00:59:27.146283 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m00:59:27.148545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef40cbc0>]}
[0m00:59:27.149194 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 2.24s]
[0m00:59:27.152587 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m00:59:27.153596 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:27.155240 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m00:59:27.155906 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m00:59:27.156297 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:27.160248 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:27.161327 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:27.163953 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:27.169533 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:27.170204 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m00:59:27.170689 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:28.517578 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 1.346 seconds
[0m00:59:28.523483 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:28.524079 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m00:59:28.587047 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.062 seconds
[0m00:59:28.590025 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:28.590385 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m00:59:28.657331 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.067 seconds
[0m00:59:28.660479 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m00:59:28.661239 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:28.661550 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m00:59:28.694019 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.032 seconds
[0m00:59:28.695954 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m00:59:28.696341 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m00:59:28.697237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4c9d3d0>]}
[0m00:59:28.697996 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 1.54s]
[0m00:59:28.698561 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:28.700345 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m00:59:28.701249 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m00:59:28.701878 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m00:59:28.702391 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m00:59:28.708625 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m00:59:28.709988 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m00:59:28.713783 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m00:59:28.718879 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m00:59:28.719375 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m00:59:28.719911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:29.646034 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 0.926 seconds
[0m00:59:29.650498 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m00:59:29.650905 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m00:59:29.693342 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.042 seconds
[0m00:59:29.697949 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m00:59:29.698553 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m00:59:29.759073 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.060 seconds
[0m00:59:29.762382 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m00:59:29.763180 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m00:59:29.763556 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m00:59:29.799902 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.036 seconds
[0m00:59:29.802244 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m00:59:29.802873 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m00:59:29.803789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '343a9b01-4d7a-4fe3-b870-ffccf23cb74e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef48b620>]}
[0m00:59:29.804578 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.10s]
[0m00:59:29.805274 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m00:59:29.809870 [debug] [MainThread]: On master: COMMIT
[0m00:59:29.811121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:59:29.811570 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m00:59:29.812829 [info ] [MainThread]: 
[0m00:59:29.813453 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 7.03 seconds (7.03s).
[0m00:59:29.815382 [debug] [MainThread]: Command end result
[0m00:59:29.843062 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:59:29.849183 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:59:29.875426 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m00:59:29.876529 [info ] [MainThread]: 
[0m00:59:29.878414 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:59:29.879169 [info ] [MainThread]: 
[0m00:59:29.881502 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:59:29.883958 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.153654, "process_in_blocks": "85456", "process_kernel_time": 1.323147, "process_mem_max_rss": "288392", "process_out_blocks": "2297", "process_user_time": 4.259972}
[0m00:59:29.885083 [debug] [MainThread]: Command `cli run` succeeded at 00:59:29.884959 after 8.16 seconds
[0m00:59:29.885907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01ca360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01a9fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01eec00>]}
[0m00:59:29.886454 [debug] [MainThread]: Flushing usage events
[0m00:59:30.452324 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:59:34.659950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0501970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b324b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12c77d0>]}


============================== 00:59:34.686933 | 1c9111b9-6316-4089-b4f4-fd7c17448ef1 ==============================
[0m00:59:34.686933 [info ] [MainThread]: Running with dbt=1.10.10
[0m00:59:34.688482 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m00:59:35.175966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff021b770>]}
[0m00:59:35.531256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef01a0>]}
[0m00:59:35.537472 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m00:59:36.341136 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m00:59:36.507244 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:59:36.508080 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:59:36.575247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff060f860>]}
[0m00:59:36.591901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa6cf0>]}
[0m00:59:36.592953 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m00:59:36.593456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa55eb0>]}
[0m00:59:36.599759 [info ] [MainThread]: 
[0m00:59:36.600271 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m00:59:36.600579 [info ] [MainThread]: 
[0m00:59:36.601793 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m00:59:36.608731 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m00:59:36.659030 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m00:59:36.659497 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m00:59:36.659837 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:36.660091 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m00:59:36.662404 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef501400>]}
[0m00:59:37.099665 [debug] [ThreadPool]: SQL status: SUCCESS in 0.439 seconds
[0m00:59:37.101815 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m00:59:37.102235 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m00:59:37.103155 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m00:59:37.107097 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m00:59:37.107413 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m00:59:37.108803 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:37.392191 [debug] [ThreadPool]: SQL status: SUCCESS in 0.283 seconds
[0m00:59:37.393912 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m00:59:37.394315 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m00:59:37.395058 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m00:59:37.400463 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m00:59:37.400848 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m00:59:37.401218 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:37.703158 [debug] [ThreadPool]: SQL status: SUCCESS in 0.302 seconds
[0m00:59:37.704921 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m00:59:37.705316 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m00:59:37.707933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c9111b9-6316-4089-b4f4-fd7c17448ef1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc5220>]}
[0m00:59:37.713722 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m00:59:37.714298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m00:59:37.714785 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m00:59:37.717496 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m00:59:37.718559 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m00:59:37.719219 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m00:59:37.719911 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m00:59:37.720334 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m00:59:37.722105 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m00:59:37.723030 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m00:59:37.723462 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m00:59:37.724002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m00:59:37.724425 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m00:59:37.726740 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m00:59:37.727703 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m00:59:37.728297 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m00:59:37.728993 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m00:59:37.729594 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m00:59:37.732126 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m00:59:37.733267 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m00:59:37.733864 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m00:59:37.734495 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m00:59:37.734957 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m00:59:37.740399 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m00:59:37.741720 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m00:59:37.742520 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m00:59:37.743081 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:59:37.743750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m00:59:37.744194 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:59:37.747430 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m00:59:37.748170 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:59:37.748938 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m00:59:37.749342 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m00:59:37.749776 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m00:59:37.750155 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m00:59:37.752988 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m00:59:37.753932 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m00:59:37.754621 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m00:59:37.755156 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m00:59:37.755913 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m00:59:37.756305 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m00:59:37.759215 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m00:59:37.759945 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m00:59:37.760746 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m00:59:37.761115 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m00:59:37.761671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m00:59:37.762117 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m00:59:37.766052 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m00:59:37.766817 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m00:59:37.767480 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m00:59:37.767920 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m00:59:37.768373 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m00:59:37.768718 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m00:59:37.779288 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m00:59:37.780103 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m00:59:37.780682 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m00:59:37.781017 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m00:59:37.781415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m00:59:37.781736 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m00:59:37.784877 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m00:59:37.785521 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m00:59:37.786116 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m00:59:37.786527 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m00:59:37.786978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m00:59:37.787338 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m00:59:37.791030 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m00:59:37.791924 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m00:59:37.792615 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m00:59:37.792982 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m00:59:37.793390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m00:59:37.793735 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m00:59:37.799924 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m00:59:37.800842 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m00:59:37.801485 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m00:59:37.801866 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m00:59:37.802335 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m00:59:37.802723 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m00:59:37.805896 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m00:59:37.806570 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m00:59:37.807179 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m00:59:37.807535 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m00:59:37.808112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m00:59:37.808437 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m00:59:37.812895 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m00:59:37.813693 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m00:59:37.814291 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m00:59:37.814648 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m00:59:37.815078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m00:59:37.815374 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m00:59:37.819235 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m00:59:37.819775 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m00:59:37.820260 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m00:59:37.820946 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m00:59:37.821271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m00:59:37.821557 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m00:59:37.824043 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m00:59:37.824520 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m00:59:37.825012 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m00:59:37.825306 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m00:59:37.825615 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m00:59:37.825897 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m00:59:37.828337 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m00:59:37.828824 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m00:59:37.829332 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m00:59:37.829633 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:37.829951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m00:59:37.830222 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:37.832555 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m00:59:37.833013 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:37.833491 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m00:59:37.833800 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m00:59:37.834109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m00:59:37.834381 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m00:59:37.836876 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m00:59:37.837351 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m00:59:37.837838 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m00:59:37.838141 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m00:59:37.838448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m00:59:37.838828 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m00:59:37.841363 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m00:59:37.841822 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m00:59:37.842304 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m00:59:37.842601 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m00:59:37.842911 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m00:59:37.843186 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m00:59:37.845622 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m00:59:37.846079 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m00:59:37.846553 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m00:59:37.846876 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m00:59:37.847174 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m00:59:37.847445 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m00:59:37.849920 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m00:59:37.850402 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m00:59:37.850902 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m00:59:37.851193 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m00:59:37.851586 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m00:59:37.851871 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m00:59:37.854687 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m00:59:37.855184 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m00:59:37.855669 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m00:59:37.855961 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m00:59:37.856259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m00:59:37.856537 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m00:59:37.859015 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m00:59:37.859654 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m00:59:37.860128 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m00:59:37.860421 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m00:59:37.860723 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m00:59:37.861000 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m00:59:37.863426 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m00:59:37.863868 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m00:59:37.864337 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m00:59:37.864631 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m00:59:37.864937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m00:59:37.865202 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m00:59:37.868528 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m00:59:37.868985 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m00:59:37.869468 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m00:59:37.869778 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m00:59:37.870093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m00:59:37.870368 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m00:59:37.872715 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m00:59:37.873209 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m00:59:37.873700 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m00:59:37.873989 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:37.874283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m00:59:37.874553 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:37.876965 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m00:59:37.877411 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:37.877893 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m00:59:37.879298 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:59:37.880076 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m00:59:37.884561 [debug] [MainThread]: Command end result
[0m00:59:37.969425 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:59:37.972857 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:59:37.981683 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m00:59:37.991015 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m00:59:37.991563 [info ] [MainThread]: Building catalog
[0m00:59:37.998862 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m00:59:38.056324 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m00:59:38.057297 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m00:59:38.058159 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:42.394629 [debug] [ThreadPool]: SQL status: SUCCESS in 4.336 seconds
[0m00:59:42.405544 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m00:59:42.441843 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m00:59:42.465516 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m00:59:42.469600 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m00:59:42.470356 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m00:59:42.472989 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 7.9678183, "process_in_blocks": "48728", "process_kernel_time": 0.998444, "process_mem_max_rss": "289800", "process_out_blocks": "5916", "process_user_time": 3.545744}
[0m00:59:42.474111 [debug] [MainThread]: Command `cli docs generate` succeeded at 00:59:42.473959 after 7.97 seconds
[0m00:59:42.474965 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m00:59:42.475254 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m00:59:42.475762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12c77d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff1c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m00:59:42.476240 [debug] [MainThread]: Flushing usage events
[0m00:59:42.923322 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:10:54.058473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1d4e270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bff80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bedb0>]}


============================== 12:10:54.103358 | 5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0 ==============================
[0m12:10:54.103358 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:10:54.104749 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:10:54.378988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdf0980>]}
[0m12:10:54.465180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bf2c0>]}
[0m12:10:54.467380 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:10:54.891081 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:10:55.049675 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:10:55.050681 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:10:55.120549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcefb60>]}
[0m12:10:55.222049 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:10:55.225034 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:10:55.244300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b1d0>]}
[0m12:10:55.245462 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:10:55.247177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8341a0>]}
[0m12:10:55.255411 [info ] [MainThread]: 
[0m12:10:55.256103 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:10:55.256477 [info ] [MainThread]: 
[0m12:10:55.257917 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:10:55.273142 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:10:55.311994 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:10:55.312615 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:10:55.312985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:10:55.313279 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:10:55.314864 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef856a50>]}
[0m12:10:56.956164 [debug] [ThreadPool]: SQL status: SUCCESS in 1.639 seconds
[0m12:10:56.964480 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:10:56.978856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m12:10:57.015508 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:10:57.016173 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:10:57.016566 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:10:59.455700 [debug] [ThreadPool]: SQL status: SUCCESS in 2.438 seconds
[0m12:10:59.475457 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:10:59.477207 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:10:59.481430 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:10:59.512760 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:10:59.517346 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:10:59.518136 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:11:00.813444 [debug] [ThreadPool]: SQL status: SUCCESS in 1.295 seconds
[0m12:11:00.818168 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:11:00.818649 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:11:00.819998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:11:00.829774 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:11:00.830179 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:11:00.830534 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:11:01.335203 [debug] [ThreadPool]: SQL status: SUCCESS in 0.504 seconds
[0m12:11:01.338127 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:11:01.338904 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:11:01.350605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2b9b0>]}
[0m12:11:01.357061 [debug] [MainThread]: On master: COMMIT
[0m12:11:01.376807 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m12:11:01.380400 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m12:11:01.381563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m12:11:01.383374 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m12:11:01.403600 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m12:11:01.408127 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m12:11:01.466760 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m12:11:01.471432 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:11:01.472115 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m12:11:01.472615 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:07.202607 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.728 seconds
[0m12:11:07.235196 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:11:07.235974 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m12:11:07.376577 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.140 seconds
[0m12:11:07.381976 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:11:07.382543 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m12:11:07.486250 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.103 seconds
[0m12:11:07.494938 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m12:11:07.497549 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:11:07.497999 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m12:11:07.570011 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.071 seconds
[0m12:11:07.600320 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m12:11:07.601036 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m12:11:07.608848 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7d10>]}
[0m12:11:07.610698 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 6.22s]
[0m12:11:07.613735 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m12:11:07.614547 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:11:07.615331 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m12:11:07.620578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m12:11:07.621578 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:11:07.630399 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:11:07.631463 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:11:07.634965 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:11:07.641980 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:11:07.643259 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m12:11:07.644699 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:10.899713 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.245 seconds
[0m12:11:10.923214 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:11:10.924313 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m12:11:11.131854 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.206 seconds
[0m12:11:11.148252 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:11:11.149015 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m12:11:11.281474 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.132 seconds
[0m12:11:11.289403 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m12:11:11.291288 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:11:11.291824 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m12:11:11.366805 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.074 seconds
[0m12:11:11.373807 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m12:11:11.374637 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m12:11:11.383037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c48b90>]}
[0m12:11:11.388567 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 3.76s]
[0m12:11:11.391866 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:11:11.392701 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m12:11:11.394228 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m12:11:11.395286 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m12:11:11.396049 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m12:11:11.407316 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:11:11.410032 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m12:11:11.417663 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:11:11.425588 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:11:11.427633 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m12:11:11.428959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:20.753544 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 9.322 seconds
[0m12:11:20.795466 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:11:20.799994 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m12:11:20.982035 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.181 seconds
[0m12:11:20.989223 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:11:20.989833 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m12:11:21.144901 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.154 seconds
[0m12:11:21.150140 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m12:11:21.151595 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:11:21.152100 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m12:11:21.244332 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.092 seconds
[0m12:11:21.247817 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m12:11:21.248413 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m12:11:21.253096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55cd4f0>]}
[0m12:11:21.254896 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 9.86s]
[0m12:11:21.259763 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m12:11:21.261183 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m12:11:21.261972 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m12:11:21.266200 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m12:11:21.267357 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m12:11:21.276414 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m12:11:21.278234 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m12:11:21.282495 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m12:11:21.287308 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:11:21.288581 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m12:11:21.289331 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:26.486318 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 5.195 seconds
[0m12:11:26.523313 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:11:26.524065 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m12:11:26.691010 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.166 seconds
[0m12:11:26.700334 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:11:26.701204 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m12:11:26.853557 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.152 seconds
[0m12:11:26.857934 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m12:11:26.859428 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:11:26.860056 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m12:11:26.926287 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.065 seconds
[0m12:11:26.931180 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m12:11:26.932098 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m12:11:26.935749 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d70a5b4-1bb1-49eb-8e8a-5a4bbfe438c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2c0200>]}
[0m12:11:26.937993 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 5.67s]
[0m12:11:26.939385 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m12:11:26.979057 [debug] [MainThread]: On master: COMMIT
[0m12:11:26.990002 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:11:26.990592 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m12:11:27.007484 [info ] [MainThread]: 
[0m12:11:27.010651 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 31.73 seconds (31.73s).
[0m12:11:27.020391 [debug] [MainThread]: Command end result
[0m12:11:27.098204 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:11:27.150396 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:11:27.371787 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m12:11:27.373318 [info ] [MainThread]: 
[0m12:11:27.376161 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:11:27.378123 [info ] [MainThread]: 
[0m12:11:27.381575 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m12:11:27.395023 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 33.45062, "process_in_blocks": "175064", "process_kernel_time": 3.253586, "process_mem_max_rss": "287772", "process_out_blocks": "2286", "process_user_time": 5.588147}
[0m12:11:27.406967 [debug] [MainThread]: Command `cli run` succeeded at 12:11:27.406352 after 33.47 seconds
[0m12:11:27.415126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4b9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4aa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0077d40>]}
[0m12:11:27.417846 [debug] [MainThread]: Flushing usage events
[0m12:11:28.663073 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:11:37.567157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06fff20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0690770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0693350>]}


============================== 12:11:37.599421 | bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2 ==============================
[0m12:11:37.599421 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:11:37.600747 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:11:37.895396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0476840>]}
[0m12:11:37.974690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff037bbf0>]}
[0m12:11:37.976082 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:11:38.322811 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:11:38.489636 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:11:38.491191 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:11:38.568008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd66240>]}
[0m12:11:38.685207 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:11:38.688251 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:11:38.699545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b3e0>]}
[0m12:11:38.700641 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:11:38.701199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff065cf50>]}
[0m12:11:38.705176 [info ] [MainThread]: 
[0m12:11:38.706018 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:11:38.706590 [info ] [MainThread]: 
[0m12:11:38.708548 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:11:38.717117 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:11:38.770574 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:11:38.771211 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:11:38.771559 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:11:38.771846 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:11:38.775146 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef525280>]}
[0m12:11:39.253997 [debug] [ThreadPool]: SQL status: SUCCESS in 0.480 seconds
[0m12:11:39.258830 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:11:39.268990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m12:11:39.291689 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:11:39.292264 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:11:39.292652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:11:39.917166 [debug] [ThreadPool]: SQL status: SUCCESS in 0.624 seconds
[0m12:11:39.921814 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:11:39.922461 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:11:39.924331 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:11:39.938520 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:11:39.939307 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:11:39.939753 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:11:40.294051 [debug] [ThreadPool]: SQL status: SUCCESS in 0.354 seconds
[0m12:11:40.296676 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:11:40.297231 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:11:40.298431 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:11:40.306197 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:11:40.307550 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:11:40.308147 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:11:40.589467 [debug] [ThreadPool]: SQL status: SUCCESS in 0.281 seconds
[0m12:11:40.593049 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:11:40.594024 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:11:40.596553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1991250>]}
[0m12:11:40.599604 [debug] [MainThread]: On master: COMMIT
[0m12:11:40.611989 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m12:11:40.613369 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m12:11:40.617610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m12:11:40.618175 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m12:11:40.623859 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m12:11:40.626456 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m12:11:40.678749 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m12:11:40.689328 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:11:40.690152 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m12:11:40.690748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:45.724859 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 4.990 seconds
[0m12:11:45.922092 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:11:45.924709 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m12:11:46.372273 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.445 seconds
[0m12:11:46.377634 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:11:46.378273 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m12:11:46.502492 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.123 seconds
[0m12:11:46.514029 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m12:11:46.517290 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:11:46.517873 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m12:11:46.605436 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.087 seconds
[0m12:11:46.644533 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m12:11:46.645199 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m12:11:46.654346 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef42d820>]}
[0m12:11:46.656729 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 6.03s]
[0m12:11:46.662100 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m12:11:46.663244 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m12:11:46.663874 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m12:11:46.665410 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m12:11:46.665957 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m12:11:46.670675 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m12:11:46.672076 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m12:11:46.677064 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m12:11:46.685004 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:11:46.685674 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m12:11:46.686217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:51.143333 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 4.455 seconds
[0m12:11:51.180343 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:11:51.182117 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m12:11:51.320516 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.136 seconds
[0m12:11:51.332626 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:11:51.334489 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m12:11:51.513964 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.177 seconds
[0m12:11:51.519557 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m12:11:51.522196 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:11:51.523377 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m12:11:51.621748 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.096 seconds
[0m12:11:51.630050 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m12:11:51.631386 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m12:11:51.636535 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3f5fd0>]}
[0m12:11:51.639680 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 4.97s]
[0m12:11:51.643274 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m12:11:51.645340 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m12:11:51.648864 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m12:11:51.651699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m12:11:51.655577 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m12:11:51.674826 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m12:11:51.679677 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m12:11:51.692308 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m12:11:51.709426 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:11:51.711046 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m12:11:51.712728 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:11:56.935241 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.216 seconds
[0m12:11:56.984259 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:11:56.985288 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m12:11:57.126570 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.140 seconds
[0m12:11:57.134247 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:11:57.135044 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m12:11:57.224739 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.089 seconds
[0m12:11:57.237536 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m12:11:57.238963 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:11:57.239435 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m12:11:57.300454 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.060 seconds
[0m12:11:57.306668 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m12:11:57.307295 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m12:11:57.311831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef463410>]}
[0m12:11:57.313471 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.66s]
[0m12:11:57.316140 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m12:11:57.316836 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m12:11:57.319681 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m12:11:57.321061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m12:11:57.321476 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m12:11:57.329286 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m12:11:57.330925 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m12:11:57.334839 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m12:11:57.352247 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:11:57.353089 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m12:11:57.353827 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:10.667298 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 13.311 seconds
[0m12:12:10.693431 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:12:10.694153 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m12:12:10.879819 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.185 seconds
[0m12:12:10.885845 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:12:10.886406 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m12:12:11.062765 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.176 seconds
[0m12:12:11.071067 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m12:12:11.072298 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:12:11.072682 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m12:12:11.106659 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.033 seconds
[0m12:12:11.109227 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m12:12:11.110276 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m12:12:11.118478 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc038aa3-e6fd-4a5c-a6bb-66b92242f2e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e3560>]}
[0m12:12:11.121772 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 13.79s]
[0m12:12:11.122648 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m12:12:11.148889 [debug] [MainThread]: On master: COMMIT
[0m12:12:11.150199 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:12:11.150602 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m12:12:11.154066 [info ] [MainThread]: 
[0m12:12:11.155261 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 32.44 seconds (32.44s).
[0m12:12:11.160228 [debug] [MainThread]: Command end result
[0m12:12:11.214263 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:12:11.252193 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:12:11.302398 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m12:12:11.303239 [info ] [MainThread]: 
[0m12:12:11.305185 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:12:11.305581 [info ] [MainThread]: 
[0m12:12:11.307123 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m12:12:11.313684 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 33.851925, "process_in_blocks": "50776", "process_kernel_time": 2.223421, "process_mem_max_rss": "288188", "process_out_blocks": "2421", "process_user_time": 5.543925}
[0m12:12:11.315833 [debug] [MainThread]: Command `cli run` succeeded at 12:12:11.315699 after 33.86 seconds
[0m12:12:11.317765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b08170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04569c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4ab40>]}
[0m12:12:11.318140 [debug] [MainThread]: Flushing usage events
[0m12:12:12.003606 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:12:30.183036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff037b8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1dad070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0172810>]}


============================== 12:12:30.222547 | 21df57e6-82e2-4d3d-a410-683252b5649e ==============================
[0m12:12:30.222547 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:12:30.226443 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:12:30.784790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefff4560>]}
[0m12:12:30.941543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12c3bf0>]}
[0m12:12:30.943287 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:12:31.739671 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:12:31.951278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:12:31.952757 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:12:32.062800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd32c00>]}
[0m12:12:32.224653 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:12:32.230209 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:12:32.250190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b260>]}
[0m12:12:32.251499 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:12:32.252743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef834d10>]}
[0m12:12:32.264855 [info ] [MainThread]: 
[0m12:12:32.265743 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:12:32.266739 [info ] [MainThread]: 
[0m12:12:32.267966 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:12:32.278366 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:12:32.327979 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:12:32.328776 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:12:32.329307 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:12:32.329703 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:12:32.333532 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef525400>]}
[0m12:12:34.312344 [debug] [ThreadPool]: SQL status: SUCCESS in 1.981 seconds
[0m12:12:34.322391 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:12:34.332105 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m12:12:34.356717 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:12:34.357645 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:12:34.358116 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:12:35.646629 [debug] [ThreadPool]: SQL status: SUCCESS in 1.288 seconds
[0m12:12:35.653191 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:12:35.653912 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:12:35.655451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:12:35.674216 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:12:35.675694 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:12:35.677193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:12:36.214692 [debug] [ThreadPool]: SQL status: SUCCESS in 0.537 seconds
[0m12:12:36.219863 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:12:36.220556 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:12:36.221855 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:12:36.234240 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:12:36.234897 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:12:36.235509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:12:36.759345 [debug] [ThreadPool]: SQL status: SUCCESS in 0.524 seconds
[0m12:12:36.762224 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:12:36.762747 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:12:36.765368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffe3fe0>]}
[0m12:12:36.769184 [debug] [MainThread]: On master: COMMIT
[0m12:12:36.789547 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m12:12:36.794248 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m12:12:36.799101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m12:12:36.800476 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m12:12:36.819176 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m12:12:36.821164 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m12:12:36.911278 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m12:12:36.917129 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m12:12:36.917903 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m12:12:36.918739 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:40.643551 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 3.723 seconds
[0m12:12:40.682579 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m12:12:40.683390 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m12:12:40.813736 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.130 seconds
[0m12:12:40.818658 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m12:12:40.819838 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m12:12:40.913239 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.092 seconds
[0m12:12:40.931730 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m12:12:40.935632 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m12:12:40.936308 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m12:12:41.023563 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.087 seconds
[0m12:12:41.066332 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m12:12:41.067980 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m12:12:41.077933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4431a0>]}
[0m12:12:41.082233 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 4.27s]
[0m12:12:41.085264 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m12:12:41.086272 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m12:12:41.087572 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m12:12:41.088232 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m12:12:41.088640 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m12:12:41.094118 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m12:12:41.096874 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m12:12:41.102852 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m12:12:41.110929 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m12:12:41.112213 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m12:12:41.112787 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:44.035571 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.914 seconds
[0m12:12:44.059955 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m12:12:44.060656 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m12:12:44.170065 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.109 seconds
[0m12:12:44.174539 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m12:12:44.175218 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m12:12:44.261216 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.085 seconds
[0m12:12:44.266096 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m12:12:44.267556 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m12:12:44.268235 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m12:12:44.325862 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m12:12:44.330642 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m12:12:44.331175 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m12:12:44.333495 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4e2e10>]}
[0m12:12:44.335369 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 3.24s]
[0m12:12:44.336616 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m12:12:44.337578 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m12:12:44.339955 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m12:12:44.341111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m12:12:44.341774 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m12:12:44.360824 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m12:12:44.363343 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m12:12:44.368547 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m12:12:44.379048 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m12:12:44.380181 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m12:12:44.382088 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:50.513421 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 6.125 seconds
[0m12:12:50.544539 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m12:12:50.545290 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m12:12:50.686396 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.141 seconds
[0m12:12:50.690445 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m12:12:50.690895 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m12:12:50.778242 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.087 seconds
[0m12:12:50.783631 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m12:12:50.785324 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m12:12:50.785736 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m12:12:50.832679 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.046 seconds
[0m12:12:50.835878 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m12:12:50.836310 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m12:12:50.840587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21df57e6-82e2-4d3d-a410-683252b5649e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef68fbc0>]}
[0m12:12:50.843902 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 6.50s]
[0m12:12:50.846863 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m12:12:50.882162 [debug] [MainThread]: On master: COMMIT
[0m12:12:50.883819 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:12:50.884343 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m12:12:50.889596 [info ] [MainThread]: 
[0m12:12:50.891656 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 18.62 seconds (18.62s).
[0m12:12:50.910172 [debug] [MainThread]: Command end result
[0m12:12:50.968939 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:12:50.989119 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:12:51.038452 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m12:12:51.039120 [info ] [MainThread]: 
[0m12:12:51.041587 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:12:51.042709 [info ] [MainThread]: 
[0m12:12:51.044602 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m12:12:51.054822 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 21.081127, "process_in_blocks": "208792", "process_kernel_time": 4.865039, "process_mem_max_rss": "288772", "process_out_blocks": "2297", "process_user_time": 6.643103}
[0m12:12:51.059324 [debug] [MainThread]: Command `cli run` succeeded at 12:12:51.058583 after 21.09 seconds
[0m12:12:51.063420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01eb7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b1c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c579b0>]}
[0m12:12:51.064808 [debug] [MainThread]: Flushing usage events
[0m12:12:51.980518 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:12:58.623146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f74770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca6fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca7590>]}


============================== 12:12:58.639110 | 2ad4b780-8e1b-4a40-9586-122a99b1991a ==============================
[0m12:12:58.639110 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:12:58.639963 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:12:58.891528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01d14f0>]}
[0m12:12:58.965628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0346d50>]}
[0m12:12:58.966464 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:12:59.264423 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:12:59.442428 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:12:59.443868 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:12:59.532847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b7a0>]}
[0m12:12:59.551142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaae900>]}
[0m12:12:59.551938 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:12:59.554385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03fe7e0>]}
[0m12:12:59.559819 [info ] [MainThread]: 
[0m12:12:59.560575 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:12:59.561538 [info ] [MainThread]: 
[0m12:12:59.563024 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:12:59.573117 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m12:12:59.633982 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:12:59.634688 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:12:59.635110 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:12:59.635419 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:12:59.637250 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4eaae0>]}
[0m12:13:01.147704 [debug] [ThreadPool]: SQL status: SUCCESS in 1.506 seconds
[0m12:13:01.171340 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:13:01.172309 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:13:01.177061 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:13:01.190945 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:13:01.191530 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:13:01.192062 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:13:01.626701 [debug] [ThreadPool]: SQL status: SUCCESS in 0.435 seconds
[0m12:13:01.628987 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:13:01.629471 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:13:01.630497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:13:01.640591 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:13:01.641093 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:13:01.641397 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:13:02.172827 [debug] [ThreadPool]: SQL status: SUCCESS in 0.531 seconds
[0m12:13:02.175910 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:13:02.176531 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:13:02.186916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ad4b780-8e1b-4a40-9586-122a99b1991a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc5700>]}
[0m12:13:02.207661 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m12:13:02.209447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m12:13:02.211043 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m12:13:02.220347 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m12:13:02.221718 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m12:13:02.222290 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m12:13:02.222940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m12:13:02.223469 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m12:13:02.225417 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m12:13:02.226274 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m12:13:02.226701 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m12:13:02.227924 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m12:13:02.228698 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m12:13:02.231628 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m12:13:02.233013 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m12:13:02.233431 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m12:13:02.233818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m12:13:02.234449 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m12:13:02.237516 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m12:13:02.238601 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m12:13:02.239248 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m12:13:02.240497 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m12:13:02.241626 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m12:13:02.269687 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m12:13:02.272625 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m12:13:02.273669 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m12:13:02.274682 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:13:02.275979 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m12:13:02.276441 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:13:02.286163 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:13:02.287547 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:13:02.288323 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:13:02.288821 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m12:13:02.289428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m12:13:02.289786 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m12:13:02.293531 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:13:02.294584 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m12:13:02.295642 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m12:13:02.296262 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m12:13:02.297048 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m12:13:02.297673 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m12:13:02.302435 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m12:13:02.305519 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m12:13:02.310452 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m12:13:02.312453 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m12:13:02.316339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m12:13:02.320145 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m12:13:02.337514 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m12:13:02.340356 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m12:13:02.346029 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m12:13:02.350563 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m12:13:02.353273 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m12:13:02.356149 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m12:13:02.435431 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m12:13:02.437005 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m12:13:02.438184 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m12:13:02.438643 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m12:13:02.439235 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m12:13:02.439583 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m12:13:02.447221 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m12:13:02.449516 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m12:13:02.450903 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m12:13:02.451305 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m12:13:02.451760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m12:13:02.452116 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m12:13:02.457740 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m12:13:02.459942 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m12:13:02.461368 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m12:13:02.463527 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m12:13:02.464352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m12:13:02.465259 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m12:13:02.484379 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m12:13:02.486891 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m12:13:02.489252 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m12:13:02.490208 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m12:13:02.490836 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m12:13:02.495137 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m12:13:02.499492 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m12:13:02.500618 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m12:13:02.501571 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m12:13:02.502122 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m12:13:02.502576 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m12:13:02.502956 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m12:13:02.511169 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m12:13:02.516557 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m12:13:02.520896 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m12:13:02.522080 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m12:13:02.524421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m12:13:02.527462 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m12:13:02.540390 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m12:13:02.541850 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m12:13:02.545613 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m12:13:02.548245 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m12:13:02.551835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m12:13:02.553997 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m12:13:02.569671 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m12:13:02.570962 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m12:13:02.574985 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m12:13:02.577078 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m12:13:02.577886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m12:13:02.578296 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m12:13:02.591922 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m12:13:02.594941 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m12:13:02.600312 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m12:13:02.603906 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m12:13:02.606256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m12:13:02.609023 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m12:13:02.621851 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m12:13:02.625204 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m12:13:02.628208 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m12:13:02.629852 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m12:13:02.632594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m12:13:02.634136 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m12:13:02.646885 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m12:13:02.650028 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m12:13:02.654541 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m12:13:02.656728 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m12:13:02.658581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m12:13:02.662173 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m12:13:02.674640 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m12:13:02.675919 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m12:13:02.678477 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m12:13:02.679588 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m12:13:02.680364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m12:13:02.680848 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m12:13:02.685809 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m12:13:02.688232 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m12:13:02.689397 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m12:13:02.689899 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m12:13:02.690393 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m12:13:02.690743 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m12:13:02.694646 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m12:13:02.695954 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m12:13:02.697120 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m12:13:02.697590 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m12:13:02.699780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m12:13:02.701728 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m12:13:02.709088 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m12:13:02.711609 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m12:13:02.712779 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m12:13:02.713437 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m12:13:02.714093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m12:13:02.714563 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m12:13:02.725289 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m12:13:02.728537 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m12:13:02.730786 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m12:13:02.732335 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m12:13:02.733763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m12:13:02.734308 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m12:13:02.748260 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m12:13:02.749488 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m12:13:02.750372 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m12:13:02.750954 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m12:13:02.751656 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m12:13:02.752061 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m12:13:02.761089 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m12:13:02.765174 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m12:13:02.770764 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m12:13:02.773819 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m12:13:02.775745 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m12:13:02.777205 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m12:13:02.796366 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m12:13:02.800194 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m12:13:02.805401 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m12:13:02.809609 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m12:13:02.813072 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m12:13:02.816762 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m12:13:02.837654 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m12:13:02.839542 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m12:13:02.845698 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m12:13:02.864141 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:13:02.865425 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m12:13:02.945684 [debug] [MainThread]: Command end result
[0m12:13:03.526923 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:13:03.565502 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:13:03.610866 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m12:13:03.856995 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m12:13:03.861665 [info ] [MainThread]: Building catalog
[0m12:13:03.894298 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m12:13:03.979187 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m12:13:03.980444 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m12:13:03.981652 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:13:29.337743 [debug] [ThreadPool]: SQL status: SUCCESS in 25.347 seconds
[0m12:13:29.391832 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m12:13:29.479769 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m12:13:29.528010 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:13:29.556040 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:13:29.557561 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m12:13:29.572208 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 31.026886, "process_in_blocks": "49872", "process_kernel_time": 1.749311, "process_mem_max_rss": "287680", "process_out_blocks": "5916", "process_user_time": 4.591422}
[0m12:13:29.577308 [debug] [MainThread]: Command `cli docs generate` succeeded at 12:13:29.575807 after 31.04 seconds
[0m12:13:29.579545 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m12:13:29.580630 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m12:13:29.582671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0aca240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0acbfe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff074eab0>]}
[0m12:13:29.584329 [debug] [MainThread]: Flushing usage events
[0m12:13:30.301256 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:58:30.982986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4caaab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06afef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06afcb0>]}


============================== 12:58:31.046728 | e27f3018-eb32-4468-9fb0-c3fb39a40e02 ==============================
[0m12:58:31.046728 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:58:31.048093 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:58:31.380240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00bbec0>]}
[0m12:58:31.467849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0bc3fe0>]}
[0m12:58:31.468920 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:58:31.842552 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:58:32.001529 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:58:32.002529 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:58:32.103800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f7a10>]}
[0m12:58:32.226566 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:58:32.230375 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:58:32.245565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef821130>]}
[0m12:58:32.246857 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:58:32.247623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef811130>]}
[0m12:58:32.251763 [info ] [MainThread]: 
[0m12:58:32.253180 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:58:32.254808 [info ] [MainThread]: 
[0m12:58:32.256809 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:58:32.268680 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:58:32.306789 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:58:32.307387 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:58:32.307747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:58:32.308066 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:58:32.309503 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff0bdd0>]}
[0m12:58:33.226244 [debug] [ThreadPool]: SQL status: SUCCESS in 0.917 seconds
[0m12:58:33.232173 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:58:33.238599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m12:58:33.259822 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:58:33.261004 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:58:33.262003 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:58:36.633973 [debug] [ThreadPool]: SQL status: SUCCESS in 3.361 seconds
[0m12:58:36.655080 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:58:36.655920 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:58:36.658690 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:58:36.677278 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:58:36.677971 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:58:36.678466 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:58:38.454961 [debug] [ThreadPool]: SQL status: SUCCESS in 1.770 seconds
[0m12:58:38.481468 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:58:38.482811 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:58:38.485718 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:58:38.506937 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:58:38.507744 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:58:38.508335 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:58:40.405590 [debug] [ThreadPool]: SQL status: SUCCESS in 1.893 seconds
[0m12:58:40.428749 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:58:40.430065 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:58:40.447659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef811d60>]}
[0m12:58:40.458410 [debug] [MainThread]: On master: COMMIT
[0m12:58:40.512421 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m12:58:40.519786 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m12:58:40.527767 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m12:58:40.532637 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m12:58:40.572601 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m12:58:40.575241 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m12:58:40.663209 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m12:58:40.669102 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:58:40.670122 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m12:58:40.670865 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:58:49.228936 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 8.553 seconds
[0m12:58:49.283324 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:58:49.284010 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m12:58:49.441110 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.157 seconds
[0m12:58:49.445180 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:58:49.445648 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m12:58:49.700262 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.254 seconds
[0m12:58:49.740743 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m12:58:49.749877 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m12:58:49.751238 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m12:58:49.899939 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.148 seconds
[0m12:58:49.933311 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m12:58:49.933971 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m12:58:49.943417 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef549580>]}
[0m12:58:49.945684 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 9.41s]
[0m12:58:49.947449 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m12:58:49.948244 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:58:49.948945 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m12:58:49.951425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m12:58:49.951902 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:58:49.956920 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:58:49.958087 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:58:49.961437 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:58:49.965421 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:58:49.965935 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m12:58:49.966382 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:58:55.881057 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 5.913 seconds
[0m12:58:55.895705 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:58:55.896222 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m12:58:55.987640 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.091 seconds
[0m12:58:55.991108 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:58:55.991486 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m12:58:56.165377 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.173 seconds
[0m12:58:56.169409 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m12:58:56.170186 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m12:58:56.170495 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m12:58:56.214047 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.043 seconds
[0m12:58:56.217106 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m12:58:56.217522 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m12:58:56.219593 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3ce600>]}
[0m12:58:56.222161 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 6.27s]
[0m12:58:56.224384 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m12:58:56.225127 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m12:58:56.226316 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m12:58:56.226884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m12:58:56.227295 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m12:58:56.235308 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:58:56.236750 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m12:58:56.245597 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:58:56.248289 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:58:56.248654 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m12:58:56.249056 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:59:01.325455 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.075 seconds
[0m12:59:01.341210 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:59:01.342043 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m12:59:01.456472 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.114 seconds
[0m12:59:01.460411 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:59:01.460811 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m12:59:01.566835 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.106 seconds
[0m12:59:01.570464 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m12:59:01.571336 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m12:59:01.571700 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m12:59:01.634256 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.062 seconds
[0m12:59:01.637280 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m12:59:01.637790 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m12:59:01.639619 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef50f3b0>]}
[0m12:59:01.641037 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 5.41s]
[0m12:59:01.643257 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m12:59:01.644594 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m12:59:01.645076 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m12:59:01.646412 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m12:59:01.647247 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m12:59:01.655938 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m12:59:01.658941 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m12:59:01.664125 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m12:59:01.670447 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:59:01.671183 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m12:59:01.671706 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:59:04.158610 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.485 seconds
[0m12:59:04.184237 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:59:04.185259 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m12:59:04.303223 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.117 seconds
[0m12:59:04.306783 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:59:04.307216 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m12:59:04.406727 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m12:59:04.412741 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m12:59:04.414814 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m12:59:04.415357 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m12:59:04.467025 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.051 seconds
[0m12:59:04.473943 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m12:59:04.474600 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m12:59:04.476931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e27f3018-eb32-4468-9fb0-c3fb39a40e02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef681a30>]}
[0m12:59:04.478510 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.83s]
[0m12:59:04.479423 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m12:59:04.505418 [debug] [MainThread]: On master: COMMIT
[0m12:59:04.507849 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:59:04.508227 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m12:59:04.540304 [info ] [MainThread]: 
[0m12:59:04.546022 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 32.25 seconds (32.25s).
[0m12:59:04.550827 [debug] [MainThread]: Command end result
[0m12:59:04.611704 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:59:04.639280 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:59:04.694377 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m12:59:04.694925 [info ] [MainThread]: 
[0m12:59:04.696657 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:59:04.697273 [info ] [MainThread]: 
[0m12:59:04.699478 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m12:59:04.708682 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 33.809437, "process_in_blocks": "266968", "process_kernel_time": 2.785524, "process_mem_max_rss": "284960", "process_out_blocks": "2286", "process_user_time": 4.008792}
[0m12:59:04.711694 [debug] [MainThread]: Command `cli run` succeeded at 12:59:04.711409 after 33.82 seconds
[0m12:59:04.714875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04dbb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff041af60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff11725a0>]}
[0m12:59:04.715463 [debug] [MainThread]: Flushing usage events
[0m12:59:06.086110 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:59:10.877297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0746fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c6e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0697440>]}


============================== 12:59:10.896847 | 10266260-0403-40ac-940e-962a7ca0fdf8 ==============================
[0m12:59:10.896847 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:59:10.898905 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:59:11.192875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0eb9a30>]}
[0m12:59:11.293019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04e2e40>]}
[0m12:59:11.294054 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:59:11.716068 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:59:11.946495 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:59:11.947849 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:59:12.033446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcee1e0>]}
[0m12:59:12.183635 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:59:12.187607 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:59:12.207725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83fa70>]}
[0m12:59:12.209746 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:59:12.212897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcce300>]}
[0m12:59:12.216373 [info ] [MainThread]: 
[0m12:59:12.217331 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:59:12.218048 [info ] [MainThread]: 
[0m12:59:12.219210 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:59:12.229029 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:59:12.276319 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:59:12.277220 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:59:12.277570 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:59:12.277871 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:59:12.280184 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef618650>]}
[0m12:59:12.944773 [debug] [ThreadPool]: SQL status: SUCCESS in 0.665 seconds
[0m12:59:12.948688 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:59:12.959482 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m12:59:12.990952 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:59:12.991621 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:59:12.992135 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:14.439316 [debug] [ThreadPool]: SQL status: SUCCESS in 1.445 seconds
[0m12:59:14.462779 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:59:14.466094 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:59:14.472754 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:59:14.494927 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:59:14.495560 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:59:14.496094 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:16.648361 [debug] [ThreadPool]: SQL status: SUCCESS in 2.151 seconds
[0m12:59:16.657225 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:59:16.657890 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:59:16.660231 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:59:16.672788 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:59:16.673423 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:59:16.673922 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:17.503958 [debug] [ThreadPool]: SQL status: SUCCESS in 0.830 seconds
[0m12:59:17.506498 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:59:17.507342 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:59:17.516459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19912b0>]}
[0m12:59:17.519504 [debug] [MainThread]: On master: COMMIT
[0m12:59:17.563323 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m12:59:17.566857 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m12:59:17.569966 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m12:59:17.570905 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m12:59:17.583082 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m12:59:17.585442 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m12:59:17.658060 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m12:59:17.676399 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:59:17.679084 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m12:59:17.681539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:59:23.390844 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.698 seconds
[0m12:59:23.456675 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:59:23.457464 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m12:59:23.593822 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.136 seconds
[0m12:59:23.597630 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:59:23.598194 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m12:59:23.755377 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.157 seconds
[0m12:59:23.772718 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m12:59:23.778401 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m12:59:23.779478 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m12:59:23.958849 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.178 seconds
[0m12:59:24.024326 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m12:59:24.025543 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m12:59:24.041227 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd54857f0>]}
[0m12:59:24.046319 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 6.46s]
[0m12:59:24.051946 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m12:59:24.053499 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m12:59:24.055608 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m12:59:24.056393 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m12:59:24.056891 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m12:59:24.064570 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m12:59:24.066660 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m12:59:24.070703 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m12:59:24.080655 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:59:24.081415 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m12:59:24.081980 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:59:28.935688 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 4.821 seconds
[0m12:59:29.006412 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:59:29.016184 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m12:59:29.254781 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.238 seconds
[0m12:59:29.258408 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:59:29.258839 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m12:59:29.582335 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.323 seconds
[0m12:59:29.588536 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m12:59:29.589832 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m12:59:29.590289 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m12:59:30.012255 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.411 seconds
[0m12:59:30.045850 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m12:59:30.048164 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m12:59:30.052837 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5b2d20>]}
[0m12:59:30.055059 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 5.99s]
[0m12:59:30.056525 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m12:59:30.057824 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m12:59:30.059754 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m12:59:30.060761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m12:59:30.061275 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m12:59:30.080877 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m12:59:30.084020 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m12:59:30.088383 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m12:59:30.099463 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:59:30.100140 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m12:59:30.102198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:59:34.796759 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.694 seconds
[0m12:59:34.823850 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:59:34.826503 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m12:59:35.040275 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.213 seconds
[0m12:59:35.045955 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:59:35.046555 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m12:59:35.198453 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.151 seconds
[0m12:59:35.203836 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m12:59:35.205125 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m12:59:35.205529 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m12:59:35.320971 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.115 seconds
[0m12:59:35.324103 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m12:59:35.324571 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m12:59:35.327033 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef49c770>]}
[0m12:59:35.328764 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.27s]
[0m12:59:35.329868 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m12:59:35.330511 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m12:59:35.331779 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m12:59:35.333200 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m12:59:35.334657 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m12:59:35.348157 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m12:59:35.351154 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m12:59:35.355380 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m12:59:35.376188 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:59:35.376969 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m12:59:35.377600 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:59:41.224863 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 5.845 seconds
[0m12:59:41.251207 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:59:41.251807 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m12:59:41.334760 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.082 seconds
[0m12:59:41.339123 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:59:41.339636 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m12:59:41.430309 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.090 seconds
[0m12:59:41.436439 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m12:59:41.439849 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m12:59:41.440674 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m12:59:41.495170 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.054 seconds
[0m12:59:41.498621 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m12:59:41.499162 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m12:59:41.501246 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10266260-0403-40ac-940e-962a7ca0fdf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3f52b0>]}
[0m12:59:41.502861 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 6.17s]
[0m12:59:41.503745 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m12:59:41.528575 [debug] [MainThread]: On master: COMMIT
[0m12:59:41.530158 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:59:41.530545 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m12:59:41.537758 [info ] [MainThread]: 
[0m12:59:41.538643 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 29.31 seconds (29.31s).
[0m12:59:41.544079 [debug] [MainThread]: Command end result
[0m12:59:41.584050 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:59:41.608254 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:59:41.658016 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m12:59:41.658446 [info ] [MainThread]: 
[0m12:59:41.659932 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:59:41.660317 [info ] [MainThread]: 
[0m12:59:41.661758 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m12:59:41.671333 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 30.916391, "process_in_blocks": "334032", "process_kernel_time": 2.032959, "process_mem_max_rss": "288432", "process_out_blocks": "2421", "process_user_time": 4.354709}
[0m12:59:41.673336 [debug] [MainThread]: Command `cli run` succeeded at 12:59:41.673173 after 30.92 seconds
[0m12:59:41.677572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b1df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b366f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82deb0>]}
[0m12:59:41.678108 [debug] [MainThread]: Flushing usage events
[0m12:59:42.780498 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:59:47.840147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f09a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03accb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b2b080>]}


============================== 12:59:47.872067 | f210cdee-2b63-489b-9e8b-0a17f3b037b9 ==============================
[0m12:59:47.872067 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:59:47.873875 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:59:48.200954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff037b2f0>]}
[0m12:59:48.305863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0fdcad0>]}
[0m12:59:48.307108 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:59:48.711695 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:59:48.898099 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:59:48.899222 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:59:48.986876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcce600>]}
[0m12:59:49.100225 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:59:49.103613 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:59:49.116126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80f590>]}
[0m12:59:49.118437 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:59:49.119731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83fe00>]}
[0m12:59:49.122821 [info ] [MainThread]: 
[0m12:59:49.123304 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:59:49.123645 [info ] [MainThread]: 
[0m12:59:49.124913 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:59:49.134185 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:59:49.164672 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:59:49.165141 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:59:49.165571 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:59:49.165864 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:59:49.167278 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52d670>]}
[0m12:59:49.557210 [debug] [ThreadPool]: SQL status: SUCCESS in 0.391 seconds
[0m12:59:49.560285 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:59:49.565583 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m12:59:49.581273 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m12:59:49.581803 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m12:59:49.582152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:50.171197 [debug] [ThreadPool]: SQL status: SUCCESS in 0.586 seconds
[0m12:59:50.178870 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m12:59:50.179526 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m12:59:50.181170 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m12:59:50.196056 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m12:59:50.197012 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m12:59:50.197575 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:50.739435 [debug] [ThreadPool]: SQL status: SUCCESS in 0.542 seconds
[0m12:59:50.744141 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m12:59:50.744754 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m12:59:50.745703 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m12:59:50.761783 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m12:59:50.762397 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m12:59:50.762765 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:59:51.067395 [debug] [ThreadPool]: SQL status: SUCCESS in 0.304 seconds
[0m12:59:51.069358 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m12:59:51.069812 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m12:59:51.072603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff189b0>]}
[0m12:59:51.074826 [debug] [MainThread]: On master: COMMIT
[0m12:59:51.085856 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m12:59:51.087216 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m12:59:51.091439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m12:59:51.092210 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m12:59:51.107712 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m12:59:51.109340 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m12:59:51.202270 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m12:59:51.207226 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m12:59:51.208033 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m12:59:51.208442 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:00:00.188914 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 8.973 seconds
[0m13:00:00.316899 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m13:00:00.318460 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m13:00:00.614111 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.294 seconds
[0m13:00:00.625377 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m13:00:00.626202 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m13:00:00.790869 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.164 seconds
[0m13:00:00.816347 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m13:00:00.821709 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m13:00:00.823048 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m13:00:00.950118 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.126 seconds
[0m13:00:00.999780 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m13:00:01.000664 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m13:00:01.021015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7d10>]}
[0m13:00:01.024668 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 9.92s]
[0m13:00:01.031415 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m13:00:01.032908 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:01.033716 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m13:00:01.034352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m13:00:01.043173 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:01.049024 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:01.052038 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:01.057967 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:01.069555 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:01.070366 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m13:00:01.071637 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:00:04.877708 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 3.805 seconds
[0m13:00:04.891373 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:04.891911 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m13:00:04.972422 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.080 seconds
[0m13:00:04.976110 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:04.976782 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m13:00:05.059321 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.082 seconds
[0m13:00:05.062921 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m13:00:05.063872 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:05.064213 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m13:00:05.104866 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.040 seconds
[0m13:00:05.107519 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m13:00:05.107922 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m13:00:05.109917 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef697620>]}
[0m13:00:05.111513 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 4.07s]
[0m13:00:05.115760 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:05.118050 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m13:00:05.121813 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m13:00:05.122663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m13:00:05.123286 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m13:00:05.132977 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m13:00:05.134742 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m13:00:05.138816 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m13:00:05.143435 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m13:00:05.144177 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m13:00:05.144761 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:00:07.287891 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 2.140 seconds
[0m13:00:07.300617 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m13:00:07.301307 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m13:00:07.569523 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.268 seconds
[0m13:00:07.573433 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m13:00:07.573961 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m13:00:07.687379 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.113 seconds
[0m13:00:07.691417 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m13:00:07.692981 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m13:00:07.693462 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m13:00:07.754360 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.060 seconds
[0m13:00:07.757351 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m13:00:07.758020 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m13:00:07.764662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f210cdee-2b63-489b-9e8b-0a17f3b037b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef697890>]}
[0m13:00:07.769905 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 2.64s]
[0m13:00:07.772815 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m13:00:07.798878 [debug] [MainThread]: On master: COMMIT
[0m13:00:07.801464 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:00:07.802527 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m13:00:07.807743 [info ] [MainThread]: 
[0m13:00:07.808742 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 18.68 seconds (18.68s).
[0m13:00:07.811968 [debug] [MainThread]: Command end result
[0m13:00:07.856229 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m13:00:07.867025 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m13:00:07.903470 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m13:00:07.905195 [info ] [MainThread]: 
[0m13:00:07.909057 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:00:07.909642 [info ] [MainThread]: 
[0m13:00:07.911202 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m13:00:07.915572 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 20.172268, "process_in_blocks": "56136", "process_kernel_time": 1.16494, "process_mem_max_rss": "286664", "process_out_blocks": "2297", "process_user_time": 4.205717}
[0m13:00:07.917081 [debug] [MainThread]: Command `cli run` succeeded at 13:00:07.916873 after 20.18 seconds
[0m13:00:07.918881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c57320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0172030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4aeed0>]}
[0m13:00:07.919362 [debug] [MainThread]: Flushing usage events
[0m13:00:08.890760 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:00:15.616721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0476c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0179790>]}


============================== 13:00:15.638758 | 703e3e1b-981a-4105-bbf9-358894db5b0e ==============================
[0m13:00:15.638758 [info ] [MainThread]: Running with dbt=1.10.10
[0m13:00:15.640453 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m13:00:16.011866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdf2e40>]}
[0m13:00:16.083221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0078500>]}
[0m13:00:16.084067 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m13:00:16.370187 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m13:00:16.511632 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:00:16.512357 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:00:16.579191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef61e0>]}
[0m13:00:16.592103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaaa750>]}
[0m13:00:16.592786 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m13:00:16.597046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcce300>]}
[0m13:00:16.602141 [info ] [MainThread]: 
[0m13:00:16.603715 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m13:00:16.604313 [info ] [MainThread]: 
[0m13:00:16.605317 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m13:00:16.616378 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m13:00:16.674744 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m13:00:16.675292 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m13:00:16.675640 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:00:16.675936 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m13:00:16.677394 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4eaf60>]}
[0m13:00:17.271396 [debug] [ThreadPool]: SQL status: SUCCESS in 0.595 seconds
[0m13:00:17.275419 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m13:00:17.276017 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m13:00:17.278228 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m13:00:17.285738 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m13:00:17.286363 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m13:00:17.286749 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:00:17.712486 [debug] [ThreadPool]: SQL status: SUCCESS in 0.426 seconds
[0m13:00:17.714693 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m13:00:17.715127 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m13:00:17.715951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m13:00:17.720463 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m13:00:17.724280 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m13:00:17.724698 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:00:17.988403 [debug] [ThreadPool]: SQL status: SUCCESS in 0.263 seconds
[0m13:00:17.991288 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m13:00:17.991666 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m13:00:17.994350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '703e3e1b-981a-4105-bbf9-358894db5b0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd14350>]}
[0m13:00:18.005772 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m13:00:18.006465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m13:00:18.006860 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m13:00:18.008987 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m13:00:18.009755 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m13:00:18.010220 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m13:00:18.010690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m13:00:18.011103 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m13:00:18.012529 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m13:00:18.013053 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m13:00:18.013390 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m13:00:18.013859 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m13:00:18.014277 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m13:00:18.015690 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m13:00:18.016182 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m13:00:18.016498 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m13:00:18.016908 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m13:00:18.017196 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m13:00:18.018434 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m13:00:18.018923 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m13:00:18.019266 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m13:00:18.019671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m13:00:18.019971 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m13:00:18.025077 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m13:00:18.026019 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m13:00:18.026540 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m13:00:18.027205 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m13:00:18.027973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m13:00:18.028655 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m13:00:18.031852 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m13:00:18.032605 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m13:00:18.033187 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m13:00:18.033533 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m13:00:18.033902 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m13:00:18.034261 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m13:00:18.036460 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m13:00:18.036940 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m13:00:18.037434 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m13:00:18.037732 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m13:00:18.038089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m13:00:18.038493 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m13:00:18.041007 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m13:00:18.041825 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m13:00:18.042368 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m13:00:18.042711 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m13:00:18.043157 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m13:00:18.043542 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m13:00:18.046371 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m13:00:18.047649 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m13:00:18.048335 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m13:00:18.048721 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m13:00:18.049152 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m13:00:18.049481 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m13:00:18.059768 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m13:00:18.061170 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m13:00:18.061771 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m13:00:18.062106 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m13:00:18.062460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m13:00:18.062752 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m13:00:18.068020 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m13:00:18.069101 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m13:00:18.070302 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m13:00:18.070888 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m13:00:18.071633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m13:00:18.071986 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m13:00:18.075383 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m13:00:18.076261 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m13:00:18.076770 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m13:00:18.077099 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m13:00:18.077432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m13:00:18.077712 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m13:00:18.082300 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m13:00:18.082800 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m13:00:18.083295 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m13:00:18.083608 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m13:00:18.083968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m13:00:18.084295 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m13:00:18.086772 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m13:00:18.087470 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m13:00:18.087974 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m13:00:18.088291 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m13:00:18.088763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m13:00:18.089090 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m13:00:18.091753 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m13:00:18.092398 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m13:00:18.092958 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m13:00:18.093267 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m13:00:18.093606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m13:00:18.093912 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m13:00:18.098228 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m13:00:18.098848 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m13:00:18.099617 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m13:00:18.100094 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m13:00:18.100486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m13:00:18.100887 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m13:00:18.103916 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m13:00:18.104419 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m13:00:18.104912 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m13:00:18.105215 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m13:00:18.105536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m13:00:18.105828 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m13:00:18.108413 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m13:00:18.108890 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m13:00:18.109382 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m13:00:18.109712 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m13:00:18.110053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m13:00:18.110351 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m13:00:18.112744 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m13:00:18.113383 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m13:00:18.113875 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m13:00:18.114231 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m13:00:18.114535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m13:00:18.114865 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m13:00:18.117485 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m13:00:18.118151 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m13:00:18.119294 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m13:00:18.120008 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m13:00:18.120782 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m13:00:18.121653 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m13:00:18.126579 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m13:00:18.127226 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m13:00:18.127728 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m13:00:18.128055 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m13:00:18.128424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m13:00:18.128718 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m13:00:18.131280 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m13:00:18.131777 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m13:00:18.132264 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m13:00:18.132602 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m13:00:18.132936 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m13:00:18.133211 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m13:00:18.135799 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m13:00:18.136820 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m13:00:18.137430 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m13:00:18.137767 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m13:00:18.138276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m13:00:18.138604 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m13:00:18.141215 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m13:00:18.141688 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m13:00:18.142205 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m13:00:18.142515 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m13:00:18.142862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m13:00:18.143147 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m13:00:18.146093 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m13:00:18.146782 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m13:00:18.147284 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m13:00:18.147588 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m13:00:18.147952 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m13:00:18.148234 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m13:00:18.150826 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m13:00:18.151278 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m13:00:18.151758 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m13:00:18.152089 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m13:00:18.152422 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m13:00:18.152698 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m13:00:18.156188 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m13:00:18.157111 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m13:00:18.157611 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m13:00:18.157917 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m13:00:18.158263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m13:00:18.158577 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m13:00:18.161333 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m13:00:18.161924 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m13:00:18.162462 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m13:00:18.162776 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:18.163109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m13:00:18.163390 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:18.165975 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m13:00:18.166447 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:18.166939 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m13:00:18.169637 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:00:18.170534 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m13:00:18.175189 [debug] [MainThread]: Command end result
[0m13:00:18.272492 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m13:00:18.275987 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m13:00:18.286305 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m13:00:18.307224 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m13:00:18.308208 [info ] [MainThread]: Building catalog
[0m13:00:18.318924 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m13:00:18.379111 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m13:00:18.380019 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m13:00:18.380902 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:00:37.295823 [debug] [ThreadPool]: SQL status: SUCCESS in 18.905 seconds
[0m13:00:37.360917 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m13:00:37.457287 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m13:00:37.518254 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m13:00:37.531945 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m13:00:37.533931 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m13:00:37.549456 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 22.065962, "process_in_blocks": "250968", "process_kernel_time": 2.65014, "process_mem_max_rss": "287732", "process_out_blocks": "5916", "process_user_time": 3.924507}
[0m13:00:37.553008 [debug] [MainThread]: Command `cli docs generate` succeeded at 13:00:37.552127 after 22.07 seconds
[0m13:00:37.559587 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m13:00:37.560605 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m13:00:37.566369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0692510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00ceab0>]}
[0m13:00:37.569423 [debug] [MainThread]: Flushing usage events
[0m13:00:38.617317 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:58:28.293581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f09850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0501a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05028a0>]}


============================== 18:58:28.319931 | 294a87ad-072c-4184-975a-7137f32b7d22 ==============================
[0m18:58:28.319931 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:58:28.321221 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:58:28.590364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7f80>]}
[0m18:58:28.662806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff16b5520>]}
[0m18:58:28.663635 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:58:29.002810 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:58:29.143819 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:58:29.144726 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:58:29.231586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd37b60>]}
[0m18:58:29.370270 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:58:29.374028 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:58:29.397975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8135c0>]}
[0m18:58:29.399388 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:58:29.402851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83be90>]}
[0m18:58:29.413169 [info ] [MainThread]: 
[0m18:58:29.414240 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m18:58:29.414844 [info ] [MainThread]: 
[0m18:58:29.415838 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:58:29.425819 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:58:29.461363 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:58:29.461835 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:58:29.462184 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:58:29.462473 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:58:29.463763 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0568440>]}
[0m18:58:30.312932 [debug] [ThreadPool]: SQL status: SUCCESS in 0.849 seconds
[0m18:58:30.317137 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:58:30.324112 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m18:58:30.345232 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:58:30.345782 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:58:30.346198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:58:31.757209 [debug] [ThreadPool]: SQL status: SUCCESS in 1.410 seconds
[0m18:58:31.761779 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:58:31.762375 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:58:31.764188 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m18:58:31.776917 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:58:31.777840 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:58:31.778347 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:58:32.873162 [debug] [ThreadPool]: SQL status: SUCCESS in 1.094 seconds
[0m18:58:32.878936 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:58:32.880268 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:58:32.884536 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m18:58:32.897840 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:58:32.898476 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:58:32.899134 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:58:34.083202 [debug] [ThreadPool]: SQL status: SUCCESS in 1.180 seconds
[0m18:58:34.100363 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:58:34.101350 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:58:34.116542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff7942600>]}
[0m18:58:34.123397 [debug] [MainThread]: On master: COMMIT
[0m18:58:34.156435 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m18:58:34.161936 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m18:58:34.168165 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m18:58:34.169213 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m18:58:34.197062 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m18:58:34.201669 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m18:58:34.345389 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m18:58:34.353075 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m18:58:34.355692 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m18:58:34.358320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:44.830039 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 10.467 seconds
[0m18:58:44.896052 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m18:58:44.896705 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m18:58:45.166489 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.269 seconds
[0m18:58:45.170515 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m18:58:45.171029 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m18:58:45.357261 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.186 seconds
[0m18:58:45.380073 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m18:58:45.382889 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m18:58:45.383357 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m18:58:45.478932 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.095 seconds
[0m18:58:45.521504 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m18:58:45.522172 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m18:58:45.537203 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7d70>]}
[0m18:58:45.539810 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 11.36s]
[0m18:58:45.543402 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m18:58:45.544416 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:58:45.549406 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m18:58:45.550519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m18:58:45.551041 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:58:45.558753 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:58:45.561745 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:58:45.566396 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:58:45.570618 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:58:45.571161 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m18:58:45.571640 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:49.148675 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.572 seconds
[0m18:58:49.181251 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:58:49.182149 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m18:58:49.437999 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.255 seconds
[0m18:58:49.450982 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:58:49.451817 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m18:58:49.608181 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.155 seconds
[0m18:58:49.611893 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m18:58:49.612732 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:58:49.613097 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m18:58:49.678688 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.065 seconds
[0m18:58:49.681545 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m18:58:49.682053 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m18:58:49.691974 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef47c6e0>]}
[0m18:58:49.695410 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 4.14s]
[0m18:58:49.699446 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:58:49.700917 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m18:58:49.704059 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m18:58:49.705082 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m18:58:49.705786 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m18:58:49.717120 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:58:49.718674 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m18:58:49.723765 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:58:49.727948 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:58:49.728625 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m18:58:49.729194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:54.193741 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.463 seconds
[0m18:58:54.211091 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:58:54.211690 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m18:58:54.356060 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.144 seconds
[0m18:58:54.360867 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:58:54.361689 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m18:58:54.460081 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.098 seconds
[0m18:58:54.464192 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m18:58:54.465097 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:58:54.465433 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m18:58:54.516709 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.051 seconds
[0m18:58:54.519689 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m18:58:54.520448 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m18:58:54.522789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3de2a0>]}
[0m18:58:54.524157 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 4.82s]
[0m18:58:54.527941 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m18:58:54.528604 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m18:58:54.529953 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m18:58:54.530881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m18:58:54.531946 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m18:58:54.543037 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m18:58:54.546093 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m18:58:54.550450 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m18:58:54.554657 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m18:58:54.555029 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m18:58:54.555452 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:58:56.724227 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.169 seconds
[0m18:58:56.730529 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m18:58:56.730988 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m18:58:56.809511 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.077 seconds
[0m18:58:56.813521 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m18:58:56.814360 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m18:58:56.912395 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.098 seconds
[0m18:58:56.921540 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m18:58:56.923358 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m18:58:56.924115 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m18:58:56.995236 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.070 seconds
[0m18:58:56.997641 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m18:58:56.998067 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m18:58:56.999152 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '294a87ad-072c-4184-975a-7137f32b7d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3de1b0>]}
[0m18:58:57.000191 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.47s]
[0m18:58:57.003438 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m18:58:57.025297 [debug] [MainThread]: On master: COMMIT
[0m18:58:57.027035 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:58:57.027624 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m18:58:57.028112 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m18:58:57.033082 [info ] [MainThread]: 
[0m18:58:57.034435 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 27.61 seconds (27.61s).
[0m18:58:57.037133 [debug] [MainThread]: Command end result
[0m18:58:57.087742 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:58:57.103222 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:58:57.146005 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m18:58:57.146599 [info ] [MainThread]: 
[0m18:58:57.149829 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:58:57.150486 [info ] [MainThread]: 
[0m18:58:57.151736 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m18:58:57.157331 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 28.967926, "process_in_blocks": "45576", "process_kernel_time": 0.829679, "process_mem_max_rss": "286900", "process_out_blocks": "2287", "process_user_time": 3.580081}
[0m18:58:57.160965 [debug] [MainThread]: Command `cli run` succeeded at 18:58:57.160193 after 28.97 seconds
[0m18:58:57.164487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0230b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe54d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m18:58:57.165234 [debug] [MainThread]: Flushing usage events
[0m18:58:58.355788 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:59:03.239730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1a180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c19c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1c29760>]}


============================== 18:59:03.252554 | bd279cfc-cba3-48ab-9d85-656562e72c3c ==============================
[0m18:59:03.252554 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:59:03.253371 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:59:03.485958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00a7080>]}
[0m18:59:03.570366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1999a30>]}
[0m18:59:03.571640 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:59:03.943754 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:59:04.134148 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:59:04.135515 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:59:04.250461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd68620>]}
[0m18:59:04.369133 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:59:04.372810 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:59:04.385514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8131a0>]}
[0m18:59:04.386523 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:59:04.388205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838170>]}
[0m18:59:04.391294 [info ] [MainThread]: 
[0m18:59:04.392177 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m18:59:04.392874 [info ] [MainThread]: 
[0m18:59:04.394583 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:59:04.407436 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:59:04.444573 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:59:04.445384 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:59:04.445893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:59:04.446239 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:59:04.448109 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5284a0>]}
[0m18:59:05.203653 [debug] [ThreadPool]: SQL status: SUCCESS in 0.754 seconds
[0m18:59:05.213230 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:59:05.274111 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m18:59:05.311733 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:59:05.313354 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:59:05.314242 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:06.295688 [debug] [ThreadPool]: SQL status: SUCCESS in 0.978 seconds
[0m18:59:06.301260 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:59:06.301899 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:59:06.303478 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m18:59:06.311491 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:59:06.311946 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:59:06.312350 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:11.007305 [debug] [ThreadPool]: SQL status: SUCCESS in 4.694 seconds
[0m18:59:11.014071 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:59:11.014582 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:59:11.016967 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m18:59:11.032362 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:59:11.033284 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:59:11.034124 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:12.290247 [debug] [ThreadPool]: SQL status: SUCCESS in 1.255 seconds
[0m18:59:12.294509 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:59:12.295314 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:59:12.306727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c7e150>]}
[0m18:59:12.309311 [debug] [MainThread]: On master: COMMIT
[0m18:59:12.328774 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:12.330286 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m18:59:12.338899 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m18:59:12.339718 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:12.347306 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:12.349021 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:12.418396 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:12.425490 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:12.426175 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m18:59:12.426710 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:17.743367 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.315 seconds
[0m18:59:17.766392 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:17.767112 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m18:59:17.975403 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.208 seconds
[0m18:59:17.979350 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:17.979889 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m18:59:18.074334 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.094 seconds
[0m18:59:18.087143 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m18:59:18.092173 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:18.092713 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m18:59:18.157138 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.063 seconds
[0m18:59:18.186653 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m18:59:18.187331 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m18:59:18.194675 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c7e150>]}
[0m18:59:18.196520 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 5.85s]
[0m18:59:18.201159 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:18.203311 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m18:59:18.207269 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m18:59:18.208517 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m18:59:18.209394 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m18:59:18.219447 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:18.221605 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m18:59:18.228350 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:18.244608 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:18.245700 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m18:59:18.246759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:23.262972 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 5.001 seconds
[0m18:59:23.383870 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:23.385454 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m18:59:23.599033 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.213 seconds
[0m18:59:23.603080 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:23.603526 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m18:59:23.787607 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.184 seconds
[0m18:59:23.792535 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m18:59:23.794537 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:23.795026 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m18:59:23.888502 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.093 seconds
[0m18:59:23.891902 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m18:59:23.892321 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m18:59:23.895555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3f61b0>]}
[0m18:59:23.897142 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 5.69s]
[0m18:59:23.900577 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m18:59:23.901202 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:23.901700 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m18:59:23.902327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m18:59:23.904137 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:23.914491 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:23.917737 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:23.923489 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:23.934401 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:23.935045 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m18:59:23.936008 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:27.371596 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.435 seconds
[0m18:59:27.380108 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:27.380686 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m18:59:27.460316 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.079 seconds
[0m18:59:27.463365 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:27.463707 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m18:59:27.524380 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.060 seconds
[0m18:59:27.530550 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m18:59:27.531335 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:27.531651 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m18:59:27.566392 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.034 seconds
[0m18:59:27.568413 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m18:59:27.568811 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m18:59:27.570039 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef486b40>]}
[0m18:59:27.571541 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 3.67s]
[0m18:59:27.572913 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:27.574094 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m18:59:27.574734 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m18:59:27.575440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m18:59:27.575787 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m18:59:27.580850 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:27.581984 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m18:59:27.584608 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:27.597408 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:27.597896 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m18:59:27.598492 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:29.380098 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 1.782 seconds
[0m18:59:29.383930 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:29.384453 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m18:59:29.473017 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.088 seconds
[0m18:59:29.477212 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:29.477690 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m18:59:29.555675 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.077 seconds
[0m18:59:29.563915 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m18:59:29.565296 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:29.565900 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m18:59:29.617979 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.052 seconds
[0m18:59:29.619861 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m18:59:29.620223 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m18:59:29.620940 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd279cfc-cba3-48ab-9d85-656562e72c3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd3ae70>]}
[0m18:59:29.621586 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.05s]
[0m18:59:29.624753 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m18:59:29.632421 [debug] [MainThread]: On master: COMMIT
[0m18:59:29.634714 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:59:29.636145 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m18:59:29.641578 [info ] [MainThread]: 
[0m18:59:29.643825 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 25.24 seconds (25.24s).
[0m18:59:29.648257 [debug] [MainThread]: Command end result
[0m18:59:29.694127 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:59:29.705359 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:59:29.729828 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m18:59:29.730613 [info ] [MainThread]: 
[0m18:59:29.731432 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:59:29.731924 [info ] [MainThread]: 
[0m18:59:29.732672 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m18:59:29.735386 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 26.556465, "process_in_blocks": "124056", "process_kernel_time": 1.131976, "process_mem_max_rss": "288608", "process_out_blocks": "2421", "process_user_time": 3.598734}
[0m18:59:29.736488 [debug] [MainThread]: Command `cli run` succeeded at 18:59:29.736358 after 26.56 seconds
[0m18:59:29.737615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff16b2780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c579e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09185c0>]}
[0m18:59:29.738124 [debug] [MainThread]: Flushing usage events
[0m18:59:30.635652 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:59:34.337537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0501af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0502090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1c21760>]}


============================== 18:59:34.353625 | 1c4c53fd-38f5-488b-bfec-9c72de2bc5b7 ==============================
[0m18:59:34.353625 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:59:34.354912 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:59:34.923325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03e32f0>]}
[0m18:59:35.114233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcf2630>]}
[0m18:59:35.115984 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:59:35.794940 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:59:35.970727 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:59:35.971741 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:59:36.087864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd6d0d0>]}
[0m18:59:36.210146 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:59:36.216900 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:59:36.241218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838e90>]}
[0m18:59:36.242708 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:59:36.243446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8459a0>]}
[0m18:59:36.248630 [info ] [MainThread]: 
[0m18:59:36.249379 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m18:59:36.249869 [info ] [MainThread]: 
[0m18:59:36.250862 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:59:36.267289 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m18:59:36.306587 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m18:59:36.307478 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m18:59:36.307890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:59:36.308181 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:59:36.309938 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef529010>]}
[0m18:59:37.703665 [debug] [ThreadPool]: SQL status: SUCCESS in 1.379 seconds
[0m18:59:37.725245 [debug] [ThreadPool]: On list_iceberg: Close
[0m18:59:37.753751 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m18:59:37.805069 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:59:37.805649 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:59:37.806057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:38.432677 [debug] [ThreadPool]: SQL status: SUCCESS in 0.627 seconds
[0m18:59:38.434256 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:59:38.434563 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:59:38.435128 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m18:59:38.440281 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:59:38.440617 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:59:38.440936 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:38.864833 [debug] [ThreadPool]: SQL status: SUCCESS in 0.424 seconds
[0m18:59:38.866343 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:59:38.866680 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:59:38.867243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m18:59:38.872498 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:59:38.872912 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:59:38.873283 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:39.627476 [debug] [ThreadPool]: SQL status: SUCCESS in 0.754 seconds
[0m18:59:39.628980 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:59:39.629302 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:59:39.631019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4f8e00>]}
[0m18:59:39.632294 [debug] [MainThread]: On master: COMMIT
[0m18:59:39.641950 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m18:59:39.642814 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m18:59:39.643340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m18:59:39.643836 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m18:59:39.649631 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:39.651156 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m18:59:39.700588 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:39.703543 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:39.704043 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m18:59:39.704506 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:42.094458 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 2.388 seconds
[0m18:59:42.125084 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:42.125695 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m18:59:42.287203 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.161 seconds
[0m18:59:42.290992 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:42.291456 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m18:59:42.366090 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.074 seconds
[0m18:59:42.374654 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m18:59:42.376828 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:42.377225 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m18:59:42.430412 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.053 seconds
[0m18:59:42.452041 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m18:59:42.452547 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m18:59:42.456703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4054c0>]}
[0m18:59:42.458009 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 2.81s]
[0m18:59:42.460998 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m18:59:42.463045 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:42.464899 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m18:59:42.469733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m18:59:42.470503 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:42.476567 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:42.477758 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:42.482488 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:42.488451 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:42.488974 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m18:59:42.489444 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:43.960938 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 1.470 seconds
[0m18:59:43.969888 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:43.970520 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m18:59:44.025519 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.054 seconds
[0m18:59:44.029048 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:44.029501 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m18:59:44.094025 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.064 seconds
[0m18:59:44.098780 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m18:59:44.099734 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:44.100170 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m18:59:44.138312 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.038 seconds
[0m18:59:44.140908 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m18:59:44.141380 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m18:59:44.142937 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef468140>]}
[0m18:59:44.144367 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 1.67s]
[0m18:59:44.146775 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:44.147327 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m18:59:44.147995 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m18:59:44.148480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m18:59:44.148889 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m18:59:44.154127 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m18:59:44.155341 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m18:59:44.158353 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m18:59:44.162268 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m18:59:44.162783 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m18:59:44.163185 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:45.322786 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.159 seconds
[0m18:59:45.327546 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m18:59:45.328049 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m18:59:45.394519 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.066 seconds
[0m18:59:45.397732 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m18:59:45.398142 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m18:59:45.451323 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.053 seconds
[0m18:59:45.459206 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m18:59:45.460930 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m18:59:45.461388 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m18:59:45.501117 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.039 seconds
[0m18:59:45.504531 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m18:59:45.505398 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m18:59:45.510019 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c4c53fd-38f5-488b-bfec-9c72de2bc5b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef498b60>]}
[0m18:59:45.511408 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.36s]
[0m18:59:45.512495 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m18:59:45.524241 [debug] [MainThread]: On master: COMMIT
[0m18:59:45.528235 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:59:45.529465 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m18:59:45.534708 [info ] [MainThread]: 
[0m18:59:45.536580 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 9.28 seconds (9.28s).
[0m18:59:45.539739 [debug] [MainThread]: Command end result
[0m18:59:45.588081 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:59:45.595737 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:59:45.618197 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m18:59:45.618814 [info ] [MainThread]: 
[0m18:59:45.619438 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:59:45.619999 [info ] [MainThread]: 
[0m18:59:45.621072 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m18:59:45.623364 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.386664, "process_in_blocks": "92480", "process_kernel_time": 1.063966, "process_mem_max_rss": "286684", "process_out_blocks": "2297", "process_user_time": 3.575626}
[0m18:59:45.624291 [debug] [MainThread]: Command `cli run` succeeded at 18:59:45.624155 after 11.39 seconds
[0m18:59:45.625686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0346d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c7e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05ca1b0>]}
[0m18:59:45.626559 [debug] [MainThread]: Flushing usage events
[0m18:59:46.620642 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:59:54.339168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff080f5c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff080cef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e6d50>]}


============================== 18:59:54.355704 | ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2 ==============================
[0m18:59:54.355704 [info ] [MainThread]: Running with dbt=1.10.10
[0m18:59:54.357340 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m18:59:54.600112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0073ce0>]}
[0m18:59:54.666396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00460f0>]}
[0m18:59:54.667193 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m18:59:54.899190 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m18:59:55.017369 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:59:55.018132 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:59:55.080442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd23620>]}
[0m18:59:55.095152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa9a7b0>]}
[0m18:59:55.095844 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m18:59:55.096544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef9feab0>]}
[0m18:59:55.099451 [info ] [MainThread]: 
[0m18:59:55.100000 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m18:59:55.100421 [info ] [MainThread]: 
[0m18:59:55.101272 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m18:59:55.109083 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m18:59:55.145879 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m18:59:55.146454 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m18:59:55.146841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:59:55.147435 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m18:59:55.148789 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f70b0>]}
[0m18:59:55.902435 [debug] [ThreadPool]: SQL status: SUCCESS in 0.755 seconds
[0m18:59:55.904927 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m18:59:55.905364 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m18:59:55.906217 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m18:59:55.911572 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m18:59:55.912330 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m18:59:55.912704 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:56.235823 [debug] [ThreadPool]: SQL status: SUCCESS in 0.323 seconds
[0m18:59:56.238031 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m18:59:56.238399 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m18:59:56.239160 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m18:59:56.244865 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m18:59:56.245218 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m18:59:56.245529 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:56.525604 [debug] [ThreadPool]: SQL status: SUCCESS in 0.280 seconds
[0m18:59:56.529215 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m18:59:56.529549 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m18:59:56.533690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac9f93d4-4049-4f79-9f8c-d77e86b7a3f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1988590>]}
[0m18:59:56.538807 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m18:59:56.539339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m18:59:56.539737 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m18:59:56.542084 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m18:59:56.542965 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m18:59:56.543544 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:59:56.544053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m18:59:56.544522 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:59:56.546192 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:59:56.546852 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m18:59:56.547218 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m18:59:56.547622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m18:59:56.547975 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m18:59:56.549576 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m18:59:56.550147 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m18:59:56.550545 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m18:59:56.551003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m18:59:56.551373 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m18:59:56.552733 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m18:59:56.553275 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m18:59:56.553618 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m18:59:56.553978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m18:59:56.554290 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m18:59:56.557621 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m18:59:56.558405 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m18:59:56.558939 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m18:59:56.559311 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:59:56.559686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m18:59:56.560096 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:59:56.563694 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m18:59:56.564325 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:59:56.564851 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m18:59:56.565184 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m18:59:56.565598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m18:59:56.565909 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m18:59:56.568189 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m18:59:56.568737 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m18:59:56.569251 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m18:59:56.569561 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m18:59:56.569984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m18:59:56.570274 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m18:59:56.572496 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m18:59:56.573211 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m18:59:56.573700 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m18:59:56.574027 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:56.574409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m18:59:56.574714 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:56.576993 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m18:59:56.577512 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:56.578021 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m18:59:56.578349 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m18:59:56.578688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m18:59:56.578984 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m18:59:56.588225 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m18:59:56.589085 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m18:59:56.589660 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m18:59:56.589999 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m18:59:56.590387 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m18:59:56.590685 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m18:59:56.593650 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m18:59:56.594198 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m18:59:56.594706 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m18:59:56.595025 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m18:59:56.595356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m18:59:56.595637 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m18:59:56.598351 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m18:59:56.599087 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m18:59:56.599588 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m18:59:56.599910 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m18:59:56.600250 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m18:59:56.600530 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m18:59:56.605071 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m18:59:56.605693 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m18:59:56.606225 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m18:59:56.606543 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m18:59:56.606886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m18:59:56.607169 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m18:59:56.609885 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m18:59:56.610641 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m18:59:56.611244 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m18:59:56.611566 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m18:59:56.611980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m18:59:56.612302 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m18:59:56.615169 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m18:59:56.615713 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m18:59:56.616225 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m18:59:56.616533 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m18:59:56.616876 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m18:59:56.617159 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m18:59:56.620640 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m18:59:56.621368 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m18:59:56.621948 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m18:59:56.622322 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m18:59:56.622673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m18:59:56.622984 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m18:59:56.626973 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m18:59:56.627554 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m18:59:56.628078 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m18:59:56.628399 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m18:59:56.628736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m18:59:56.629045 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m18:59:56.631690 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m18:59:56.632202 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m18:59:56.632704 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m18:59:56.633027 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:56.633421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m18:59:56.633711 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:56.636172 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m18:59:56.636797 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:56.637353 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m18:59:56.637678 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m18:59:56.638025 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m18:59:56.638478 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m18:59:56.641265 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m18:59:56.641811 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m18:59:56.642308 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m18:59:56.642623 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m18:59:56.642963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m18:59:56.643280 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m18:59:56.646089 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m18:59:56.646697 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m18:59:56.647306 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m18:59:56.647669 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m18:59:56.648098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m18:59:56.648418 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m18:59:56.651169 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m18:59:56.651677 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m18:59:56.652175 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m18:59:56.652485 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m18:59:56.652840 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m18:59:56.653157 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m18:59:56.655808 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m18:59:56.656345 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m18:59:56.656853 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m18:59:56.657167 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m18:59:56.657587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m18:59:56.657906 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m18:59:56.660689 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m18:59:56.661212 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m18:59:56.661721 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m18:59:56.662044 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m18:59:56.662386 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m18:59:56.662671 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m18:59:56.665500 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m18:59:56.666327 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m18:59:56.666865 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m18:59:56.667187 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m18:59:56.667531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m18:59:56.667831 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m18:59:56.670626 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m18:59:56.671213 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m18:59:56.671714 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m18:59:56.672035 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m18:59:56.672382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m18:59:56.672671 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m18:59:56.675332 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m18:59:56.675937 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m18:59:56.676447 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m18:59:56.676762 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m18:59:56.677104 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m18:59:56.677383 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m18:59:56.681199 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m18:59:56.681799 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m18:59:56.682590 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m18:59:56.682998 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:56.683429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m18:59:56.683803 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:56.686744 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m18:59:56.687331 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:56.687862 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m18:59:56.689101 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:59:56.690218 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m18:59:56.694698 [debug] [MainThread]: Command end result
[0m18:59:56.787061 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m18:59:56.790114 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m18:59:56.800650 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m18:59:56.811923 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m18:59:56.812411 [info ] [MainThread]: Building catalog
[0m18:59:56.816729 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m18:59:56.868247 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m18:59:56.869212 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m18:59:56.870023 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:00:00.331783 [debug] [ThreadPool]: SQL status: SUCCESS in 3.458 seconds
[0m19:00:00.360747 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m19:00:00.409652 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:00:00.438268 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m19:00:00.442517 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m19:00:00.442937 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m19:00:00.446623 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 6.199274, "process_in_blocks": "320536", "process_kernel_time": 3.123647, "process_mem_max_rss": "289420", "process_out_blocks": "5916", "process_user_time": 4.268083}
[0m19:00:00.450500 [debug] [MainThread]: Command `cli docs generate` succeeded at 19:00:00.449647 after 6.20 seconds
[0m19:00:00.452578 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m19:00:00.453277 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m19:00:00.455322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0372d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff020cb00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m19:00:00.456863 [debug] [MainThread]: Flushing usage events
[0m19:00:01.150722 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:13:07.219340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff074c560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff074e330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff045a540>]}


============================== 14:13:07.250457 | 1de00f92-fb7c-42cd-9dbf-876c807bb805 ==============================
[0m14:13:07.250457 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:13:07.253284 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:13:07.664348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffffdd0>]}
[0m14:13:07.742453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefffd9d0>]}
[0m14:13:07.743498 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:13:08.125473 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:13:08.281665 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:13:08.282504 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:13:08.360665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcf2c90>]}
[0m14:13:08.463940 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:13:08.467184 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:13:08.484669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83cfb0>]}
[0m14:13:08.486202 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:13:08.486912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef848fe0>]}
[0m14:13:08.493791 [info ] [MainThread]: 
[0m14:13:08.494556 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:13:08.495703 [info ] [MainThread]: 
[0m14:13:08.497226 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:13:08.515286 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:13:08.559564 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:13:08.560145 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:13:08.560517 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:13:08.560820 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:13:08.561840 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef530a70>]}
[0m14:13:10.166926 [debug] [ThreadPool]: SQL status: SUCCESS in 1.604 seconds
[0m14:13:10.185243 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:13:10.196909 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m14:13:10.231633 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:13:10.232300 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:13:10.232711 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:13:14.311747 [debug] [ThreadPool]: SQL status: SUCCESS in 4.077 seconds
[0m14:13:14.326127 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:13:14.327196 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:13:14.331303 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:13:14.357076 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:13:14.359611 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:13:14.361245 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:13:17.458516 [debug] [ThreadPool]: SQL status: SUCCESS in 3.095 seconds
[0m14:13:17.467244 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:13:17.468037 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:13:17.470557 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:13:17.488227 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:13:17.489149 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:13:17.489707 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:13:19.582157 [debug] [ThreadPool]: SQL status: SUCCESS in 2.091 seconds
[0m14:13:19.597792 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:13:19.598536 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:13:19.608412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1999dc0>]}
[0m14:13:19.614362 [debug] [MainThread]: On master: COMMIT
[0m14:13:19.670160 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m14:13:19.673390 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m14:13:19.679702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m14:13:19.681177 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m14:13:19.706618 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m14:13:19.709869 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m14:13:19.789754 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m14:13:19.794796 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:13:19.795428 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m14:13:19.796038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:13:30.415623 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 10.594 seconds
[0m14:13:30.567833 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:13:30.569096 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m14:13:31.020917 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.451 seconds
[0m14:13:31.025734 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:13:31.026323 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m14:13:31.533761 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.507 seconds
[0m14:13:31.557995 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m14:13:31.562931 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:13:31.563612 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m14:13:31.666595 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.102 seconds
[0m14:13:31.729300 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m14:13:31.730223 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m14:13:31.741935 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c5d520>]}
[0m14:13:31.747154 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 12.06s]
[0m14:13:31.750900 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m14:13:31.752203 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:13:31.754986 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m14:13:31.756173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m14:13:31.757205 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:13:31.763589 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:13:31.765438 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:13:31.769327 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:13:31.774466 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:13:31.775661 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m14:13:31.776632 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:13:42.205899 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 10.415 seconds
[0m14:13:42.303023 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:13:42.304364 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m14:13:43.332266 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 1.024 seconds
[0m14:13:43.383714 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:13:43.386866 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m14:13:45.433737 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 2.041 seconds
[0m14:13:45.499066 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m14:13:45.513341 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:13:45.516744 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m14:13:46.984057 [debug] [Thread-1 (]: SQL status: DROP TABLE in 1.460 seconds
[0m14:13:47.061732 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m14:13:47.065658 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m14:13:47.105390 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3d8470>]}
[0m14:13:47.116231 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 15.32s]
[0m14:13:47.119856 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:13:47.122264 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:13:47.128447 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m14:13:47.129877 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m14:13:47.131290 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m14:13:47.197209 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:13:47.203156 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m14:13:47.223702 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:13:47.232349 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:13:47.236140 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m14:13:47.238932 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:14:00.257116 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 13.000 seconds
[0m14:14:00.479750 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:14:00.480886 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m14:14:01.324357 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.842 seconds
[0m14:14:01.337458 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:14:01.339525 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m14:14:01.518341 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.178 seconds
[0m14:14:01.526005 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m14:14:01.528440 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:14:01.529102 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m14:14:01.634873 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.105 seconds
[0m14:14:01.643332 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m14:14:01.643966 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m14:14:01.652728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef49fce0>]}
[0m14:14:01.658414 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 14.52s]
[0m14:14:01.661428 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:14:01.662503 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m14:14:01.664459 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m14:14:01.665099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m14:14:01.665619 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m14:14:01.682045 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m14:14:01.685439 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m14:14:01.690179 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m14:14:01.694989 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:14:01.695406 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m14:14:01.696529 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:14:11.120880 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 9.423 seconds
[0m14:14:11.148122 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:14:11.148777 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m14:14:11.696155 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.547 seconds
[0m14:14:11.701337 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:14:11.701843 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m14:14:11.879408 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.177 seconds
[0m14:14:11.884434 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m14:14:11.885558 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:14:11.886125 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m14:14:11.972501 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.086 seconds
[0m14:14:11.976728 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m14:14:11.977233 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m14:14:11.981629 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1de00f92-fb7c-42cd-9dbf-876c807bb805', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef813f80>]}
[0m14:14:11.983762 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 10.31s]
[0m14:14:11.984708 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m14:14:12.029966 [debug] [MainThread]: On master: COMMIT
[0m14:14:12.032054 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:14:12.032532 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m14:14:12.042589 [info ] [MainThread]: 
[0m14:14:12.046595 [info ] [MainThread]: Finished running 4 table models in 0 hours 1 minutes and 3.54 seconds (63.54s).
[0m14:14:12.055889 [debug] [MainThread]: Command end result
[0m14:14:12.133149 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:14:12.177882 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:14:12.258972 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:14:12.259843 [info ] [MainThread]: 
[0m14:14:12.262247 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:14:12.263518 [info ] [MainThread]: 
[0m14:14:12.264951 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m14:14:12.276507 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 65.176796, "process_in_blocks": "224040", "process_kernel_time": 3.919288, "process_mem_max_rss": "286584", "process_out_blocks": "2286", "process_user_time": 7.354768}
[0m14:14:12.284433 [debug] [MainThread]: Command `cli run` succeeded at 14:14:12.283941 after 65.19 seconds
[0m14:14:12.289714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55e3e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe2e1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0236a20>]}
[0m14:14:12.290549 [debug] [MainThread]: Flushing usage events
[0m14:14:13.720238 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:14:33.480375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a208c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017a330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017a660>]}


============================== 14:14:33.528754 | 43a6f825-6387-4c7d-8337-bc2ae69f51cf ==============================
[0m14:14:33.528754 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:14:33.529609 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:14:33.981716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff18560>]}
[0m14:14:34.079707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01d6d80>]}
[0m14:14:34.081238 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:14:34.982305 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:14:35.210344 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:14:35.212388 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:14:35.403539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff007ff20>]}
[0m14:14:35.613025 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:14:35.620598 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:14:35.664605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83cec0>]}
[0m14:14:35.666215 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:14:35.668647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00ceb10>]}
[0m14:14:35.676412 [info ] [MainThread]: 
[0m14:14:35.679415 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:14:35.680235 [info ] [MainThread]: 
[0m14:14:35.681492 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:14:35.712589 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:14:35.789284 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:14:35.790159 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:14:35.790554 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:14:35.790868 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:14:35.793620 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5302f0>]}
[0m14:14:40.402800 [debug] [ThreadPool]: SQL status: SUCCESS in 4.608 seconds
[0m14:14:40.416626 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:14:40.428065 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m14:14:40.472631 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:14:40.473342 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:14:40.473823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:14:42.279949 [debug] [ThreadPool]: SQL status: SUCCESS in 1.806 seconds
[0m14:14:42.282364 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:14:42.282889 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:14:42.283744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:14:42.289778 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:14:42.290290 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:14:42.290594 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:14:42.967154 [debug] [ThreadPool]: SQL status: SUCCESS in 0.672 seconds
[0m14:14:42.978879 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:14:42.981320 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:14:42.986495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:14:43.004501 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:14:43.005361 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:14:43.005885 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:14:44.011683 [debug] [ThreadPool]: SQL status: SUCCESS in 1.006 seconds
[0m14:14:44.014700 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:14:44.015451 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:14:44.019827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca66f0>]}
[0m14:14:44.022575 [debug] [MainThread]: On master: COMMIT
[0m14:14:44.061500 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m14:14:44.063946 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m14:14:44.066510 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m14:14:44.067786 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m14:14:44.078899 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m14:14:44.081594 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m14:14:44.152618 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m14:14:44.158758 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:14:44.159403 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m14:14:44.159822 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:14:57.524674 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 13.361 seconds
[0m14:14:57.638683 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:14:57.639826 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m14:14:57.987694 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.347 seconds
[0m14:14:58.018164 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:14:58.018758 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m14:14:58.326110 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.307 seconds
[0m14:14:58.360728 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m14:14:58.368668 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:14:58.370400 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m14:14:58.611811 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.240 seconds
[0m14:14:58.717989 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m14:14:58.719845 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m14:14:58.771367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c55610>]}
[0m14:14:58.787128 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 14.67s]
[0m14:14:58.799169 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m14:14:58.802498 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m14:14:58.827209 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m14:14:58.849735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m14:14:58.854100 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m14:14:58.902927 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m14:14:58.924654 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m14:14:58.936202 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m14:14:59.027923 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:14:59.028764 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m14:14:59.030832 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:15:09.360811 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 10.319 seconds
[0m14:15:09.440877 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:15:09.443994 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m14:15:09.871877 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.426 seconds
[0m14:15:09.883550 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:15:09.884097 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m14:15:10.157684 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.273 seconds
[0m14:15:10.170539 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m14:15:10.172429 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:15:10.172910 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m14:15:10.254619 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.081 seconds
[0m14:15:10.262501 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m14:15:10.263564 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m14:15:10.269712 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e3fe0>]}
[0m14:15:10.277449 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 11.42s]
[0m14:15:10.281639 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m14:15:10.283025 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m14:15:10.284008 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m14:15:10.288169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m14:15:10.289329 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m14:15:10.308955 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m14:15:10.310763 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m14:15:10.318559 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m14:15:10.333068 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:15:10.334814 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m14:15:10.336862 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:15:15.557148 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.212 seconds
[0m14:15:15.578774 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:15:15.579397 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m14:15:15.860245 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.280 seconds
[0m14:15:15.865291 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:15:15.865729 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m14:15:16.055654 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.189 seconds
[0m14:15:16.060196 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m14:15:16.061166 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:15:16.061570 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m14:15:16.150680 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.087 seconds
[0m14:15:16.160474 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m14:15:16.162441 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m14:15:16.165787 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55f0320>]}
[0m14:15:16.167768 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.88s]
[0m14:15:16.170115 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m14:15:16.187294 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m14:15:16.188721 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m14:15:16.191287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m14:15:16.191902 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m14:15:16.200625 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m14:15:16.204573 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m14:15:16.215453 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m14:15:16.233067 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:15:16.233871 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m14:15:16.234581 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:15:21.559217 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 5.322 seconds
[0m14:15:21.603196 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:15:21.603830 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m14:15:21.786508 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.182 seconds
[0m14:15:21.790835 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:15:21.791399 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m14:15:21.934096 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.142 seconds
[0m14:15:21.938509 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m14:15:21.939580 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:15:21.940046 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m14:15:22.013130 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.073 seconds
[0m14:15:22.016137 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m14:15:22.016572 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m14:15:22.018660 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43a6f825-6387-4c7d-8337-bc2ae69f51cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2d5040>]}
[0m14:15:22.020473 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 5.83s]
[0m14:15:22.025068 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m14:15:22.047008 [debug] [MainThread]: On master: COMMIT
[0m14:15:22.048642 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:15:22.049022 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m14:15:22.054071 [info ] [MainThread]: 
[0m14:15:22.055524 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 46.37 seconds (46.37s).
[0m14:15:22.060589 [debug] [MainThread]: Command end result
[0m14:15:22.110544 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:15:22.146664 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:15:22.213192 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:15:22.213924 [info ] [MainThread]: 
[0m14:15:22.215705 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:15:22.216406 [info ] [MainThread]: 
[0m14:15:22.217745 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m14:15:22.226501 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 48.86439, "process_in_blocks": "345392", "process_kernel_time": 7.90545, "process_mem_max_rss": "286724", "process_out_blocks": "2421", "process_user_time": 8.9383}
[0m14:15:22.230139 [debug] [MainThread]: Command `cli run` succeeded at 14:15:22.229936 after 48.87 seconds
[0m14:15:22.233140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c57320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0237950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0237c50>]}
[0m14:15:22.233748 [debug] [MainThread]: Flushing usage events
[0m14:15:23.451882 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:15:30.373524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a1cfb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017b950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017a4e0>]}


============================== 14:15:30.402185 | e4cb3057-a785-493f-a069-504bded68ac1 ==============================
[0m14:15:30.402185 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:15:30.404148 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:15:30.746411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0053ce0>]}
[0m14:15:30.830307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefff5a60>]}
[0m14:15:30.831437 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:15:31.244007 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:15:31.456271 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:15:31.457296 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:15:31.534286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b2690>]}
[0m14:15:31.650556 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:15:31.653806 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:15:31.669641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83cfe0>]}
[0m14:15:31.671130 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:15:31.672835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0bef6e0>]}
[0m14:15:31.676423 [info ] [MainThread]: 
[0m14:15:31.677271 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:15:31.678331 [info ] [MainThread]: 
[0m14:15:31.679488 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:15:31.690389 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:15:31.733217 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:15:31.734017 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:15:31.734555 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:15:31.734919 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:15:31.737064 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef532e70>]}
[0m14:15:35.522087 [debug] [ThreadPool]: SQL status: SUCCESS in 3.784 seconds
[0m14:15:35.530709 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:15:35.553836 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m14:15:35.581066 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:15:35.581963 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:15:35.582496 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:15:41.585264 [debug] [ThreadPool]: SQL status: SUCCESS in 6.001 seconds
[0m14:15:41.598379 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:15:41.599113 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:15:41.603086 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:15:41.624721 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:15:41.625626 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:15:41.626079 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:15:42.571446 [debug] [ThreadPool]: SQL status: SUCCESS in 0.945 seconds
[0m14:15:42.574651 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:15:42.575338 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:15:42.576591 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:15:42.589448 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:15:42.590910 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:15:42.592082 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:15:43.562623 [debug] [ThreadPool]: SQL status: SUCCESS in 0.964 seconds
[0m14:15:43.587132 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:15:43.588322 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:15:43.600223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef859730>]}
[0m14:15:43.610476 [debug] [MainThread]: On master: COMMIT
[0m14:15:43.646957 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m14:15:43.650873 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m14:15:43.656227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m14:15:43.657394 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m14:15:43.702667 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m14:15:43.736638 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m14:15:43.922891 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m14:15:43.934684 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:15:43.935550 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m14:15:43.936330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:15:54.575341 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 10.632 seconds
[0m14:15:54.685675 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:15:54.686502 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m14:15:54.837251 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.150 seconds
[0m14:15:54.841363 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:15:54.841845 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m14:15:54.943792 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.101 seconds
[0m14:15:54.991534 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m14:15:54.996497 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:15:54.997145 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m14:15:55.059475 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.062 seconds
[0m14:15:55.100536 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m14:15:55.101729 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m14:15:55.116020 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7fb0>]}
[0m14:15:55.119089 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 11.45s]
[0m14:15:55.124285 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m14:15:55.126536 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m14:15:55.128138 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m14:15:55.131154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m14:15:55.132265 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m14:15:55.140319 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m14:15:55.143044 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m14:15:55.149449 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m14:15:55.162210 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:15:55.163130 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m14:15:55.164326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:15:57.969922 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.804 seconds
[0m14:15:57.989110 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:15:57.989792 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m14:15:58.080166 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.090 seconds
[0m14:15:58.084141 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:15:58.084638 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m14:15:58.159218 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.074 seconds
[0m14:15:58.162651 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m14:15:58.163476 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:15:58.163797 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m14:15:58.205875 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.042 seconds
[0m14:15:58.209823 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m14:15:58.210579 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m14:15:58.213176 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3eae70>]}
[0m14:15:58.214670 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 3.08s]
[0m14:15:58.217039 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m14:15:58.218141 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m14:15:58.219285 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m14:15:58.219923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m14:15:58.220331 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m14:15:58.228259 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m14:15:58.229545 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m14:15:58.234309 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m14:15:58.237939 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:15:58.238334 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m14:15:58.238747 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:16:01.668416 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 3.427 seconds
[0m14:16:01.685545 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:16:01.686192 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m14:16:01.783946 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.097 seconds
[0m14:16:01.787835 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:16:01.788268 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m14:16:01.863292 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.074 seconds
[0m14:16:01.868267 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m14:16:01.869344 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:16:01.869818 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m14:16:01.933940 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.063 seconds
[0m14:16:01.937407 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m14:16:01.937940 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m14:16:01.940130 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4cb3057-a785-493f-a069-504bded68ac1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3bcef0>]}
[0m14:16:01.941968 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 3.72s]
[0m14:16:01.942881 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m14:16:01.971871 [debug] [MainThread]: On master: COMMIT
[0m14:16:01.974421 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:01.975082 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m14:16:01.975633 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m14:16:01.980380 [info ] [MainThread]: 
[0m14:16:01.983864 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 30.30 seconds (30.30s).
[0m14:16:01.988084 [debug] [MainThread]: Command end result
[0m14:16:02.037222 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:16:02.057790 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:16:02.090707 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:16:02.091352 [info ] [MainThread]: 
[0m14:16:02.092537 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:16:02.093480 [info ] [MainThread]: 
[0m14:16:02.095307 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m14:16:02.104728 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 31.819124, "process_in_blocks": "237856", "process_kernel_time": 1.958289, "process_mem_max_rss": "286628", "process_out_blocks": "2297", "process_user_time": 4.307614}
[0m14:16:02.107491 [debug] [MainThread]: Command `cli run` succeeded at 14:16:02.107245 after 31.83 seconds
[0m14:16:02.110764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01d7b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b2a80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef410fb0>]}
[0m14:16:02.111346 [debug] [MainThread]: Flushing usage events
[0m14:16:03.480615 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:16:10.275859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017a7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01784a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0178320>]}


============================== 14:16:10.306314 | 242432c9-bb77-440c-9313-5b35f97f7ca0 ==============================
[0m14:16:10.306314 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:16:10.309402 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:16:10.698700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe2e9f0>]}
[0m14:16:10.792269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08d4f80>]}
[0m14:16:10.793409 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:16:11.255076 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:16:11.489907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:16:11.491068 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:16:11.574667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff20080>]}
[0m14:16:11.595308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaae510>]}
[0m14:16:11.596503 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:16:11.597688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa171d0>]}
[0m14:16:11.602421 [info ] [MainThread]: 
[0m14:16:11.603357 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:16:11.603987 [info ] [MainThread]: 
[0m14:16:11.605151 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:16:11.614510 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m14:16:11.688730 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:16:11.689528 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:16:11.689942 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:11.690236 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:16:11.691489 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa165d0>]}
[0m14:16:14.034235 [debug] [ThreadPool]: SQL status: SUCCESS in 2.342 seconds
[0m14:16:14.049231 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:16:14.049940 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:16:14.055607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:16:14.076983 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:16:14.077881 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:16:14.079447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:14.926495 [debug] [ThreadPool]: SQL status: SUCCESS in 0.848 seconds
[0m14:16:14.935499 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:16:14.936488 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:16:14.937723 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:16:14.948598 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:16:14.949441 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:16:14.949998 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:15.495316 [debug] [ThreadPool]: SQL status: SUCCESS in 0.544 seconds
[0m14:16:15.501442 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:16:15.502503 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:16:15.514722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '242432c9-bb77-440c-9313-5b35f97f7ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff1cbc0>]}
[0m14:16:15.534070 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m14:16:15.535072 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m14:16:15.535587 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m14:16:15.540925 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m14:16:15.543435 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m14:16:15.544188 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:16:15.545062 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m14:16:15.545816 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:16:15.548261 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:16:15.549362 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:16:15.550036 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m14:16:15.550748 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m14:16:15.551312 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m14:16:15.553292 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m14:16:15.554070 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m14:16:15.554485 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m14:16:15.555177 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m14:16:15.555666 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m14:16:15.557691 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m14:16:15.558484 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m14:16:15.559030 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m14:16:15.559696 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m14:16:15.560219 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m14:16:15.573564 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m14:16:15.575336 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m14:16:15.576556 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m14:16:15.577221 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:16:15.578592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m14:16:15.579346 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:16:15.585716 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:16:15.586755 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:16:15.587606 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:16:15.587985 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:16:15.588536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m14:16:15.588925 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m14:16:15.592566 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:16:15.593908 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m14:16:15.595168 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:16:15.595697 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m14:16:15.596490 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m14:16:15.596809 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m14:16:15.599664 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m14:16:15.600273 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m14:16:15.600805 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m14:16:15.601161 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m14:16:15.601598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m14:16:15.601903 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m14:16:15.604563 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m14:16:15.605180 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m14:16:15.605729 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m14:16:15.606095 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:16:15.606467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m14:16:15.606757 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:16:15.626323 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m14:16:15.627394 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:16:15.628063 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:16:15.628463 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:16:15.628943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m14:16:15.629356 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:16:15.633137 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m14:16:15.634173 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:16:15.635434 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:16:15.635989 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:16:15.636609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m14:16:15.637140 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:16:15.641238 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m14:16:15.642560 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:16:15.643486 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:16:15.644004 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:16:15.644601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m14:16:15.645101 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:16:15.652721 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m14:16:15.654055 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:16:15.655004 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:16:15.655648 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m14:16:15.656479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m14:16:15.657175 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m14:16:15.663740 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m14:16:15.665016 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m14:16:15.666484 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m14:16:15.667482 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:16:15.669210 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m14:16:15.670184 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:16:15.677748 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m14:16:15.679221 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:16:15.680311 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:16:15.680762 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:16:15.681332 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m14:16:15.681851 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:16:15.686828 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m14:16:15.688055 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:16:15.688915 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:16:15.689596 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:16:15.690149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m14:16:15.690514 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:16:15.696085 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m14:16:15.696877 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:16:15.697551 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:16:15.697878 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:16:15.698275 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m14:16:15.698632 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:16:15.702931 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m14:16:15.704247 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:16:15.705533 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:16:15.705970 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m14:16:15.706557 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m14:16:15.706882 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m14:16:15.710226 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m14:16:15.710991 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m14:16:15.711594 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m14:16:15.711940 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:16:15.712366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m14:16:15.712835 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:16:15.716243 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m14:16:15.717763 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:16:15.718446 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:16:15.718795 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:16:15.719191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m14:16:15.719515 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:16:15.723889 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m14:16:15.724912 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:16:15.725504 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:16:15.726140 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:16:15.726628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m14:16:15.727319 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:16:15.731006 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m14:16:15.731700 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:16:15.732367 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:16:15.732730 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m14:16:15.733131 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m14:16:15.733437 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m14:16:15.736394 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m14:16:15.737113 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m14:16:15.737692 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m14:16:15.738073 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:16:15.738616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m14:16:15.738984 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:16:15.742095 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m14:16:15.742743 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:16:15.743300 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:16:15.743624 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:16:15.744016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m14:16:15.744341 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:16:15.747273 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m14:16:15.748142 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:16:15.748764 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:16:15.749105 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:16:15.749543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m14:16:15.749848 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:16:15.755529 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m14:16:15.756749 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:16:15.757405 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:16:15.757780 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m14:16:15.758398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m14:16:15.759032 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m14:16:15.765641 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m14:16:15.766672 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m14:16:15.767486 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m14:16:15.767865 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m14:16:15.768336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m14:16:15.768670 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m14:16:15.773581 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m14:16:15.774353 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m14:16:15.774924 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m14:16:15.775257 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m14:16:15.775629 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m14:16:15.775922 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m14:16:15.778743 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m14:16:15.779315 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m14:16:15.779844 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m14:16:15.789603 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:15.800201 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m14:16:15.806681 [debug] [MainThread]: Command end result
[0m14:16:15.944073 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:16:15.949271 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:16:15.967947 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:16:15.988218 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m14:16:15.991758 [info ] [MainThread]: Building catalog
[0m14:16:16.004994 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m14:16:16.076543 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m14:16:16.077632 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m14:16:16.078705 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:02.253374 [debug] [ThreadPool]: SQL status: SUCCESS in 46.161 seconds
[0m14:17:02.353534 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m14:17:02.554099 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m14:17:02.615610 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:17:02.646902 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:17:02.649129 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m14:17:02.674943 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 52.524017, "process_in_blocks": "282480", "process_kernel_time": 2.073573, "process_mem_max_rss": "287992", "process_out_blocks": "5916", "process_user_time": 4.762383}
[0m14:17:02.684955 [debug] [MainThread]: Command `cli docs generate` succeeded at 14:17:02.684189 after 52.54 seconds
[0m14:17:02.693002 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m14:17:02.694170 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m14:17:02.697254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01761b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09d85c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0571df0>]}
[0m14:17:02.702184 [debug] [MainThread]: Flushing usage events
[0m14:17:04.622756 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:17:33.711912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c15a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c16e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a20e60>]}


============================== 14:17:33.769399 | fd8c002d-9f36-41ca-866e-353d7fb35b97 ==============================
[0m14:17:33.769399 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:17:33.772686 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:17:34.137202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff047de20>]}
[0m14:17:34.228542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0966d80>]}
[0m14:17:34.229683 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:17:34.673275 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:17:35.542156 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:17:35.547307 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:17:35.771281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefffd850>]}
[0m14:17:35.944618 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:17:35.960493 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:17:36.050057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef817170>]}
[0m14:17:36.055396 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:17:36.060087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83ff50>]}
[0m14:17:36.068351 [info ] [MainThread]: 
[0m14:17:36.074037 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:17:36.076498 [info ] [MainThread]: 
[0m14:17:36.081272 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:17:36.118586 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:17:36.192859 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:17:36.193456 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:17:36.193877 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:36.194278 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:17:36.196191 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef530ec0>]}
[0m14:17:38.815099 [debug] [ThreadPool]: SQL status: SUCCESS in 2.618 seconds
[0m14:17:38.826786 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:17:38.845267 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m14:17:38.874306 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:17:38.875015 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:17:38.875459 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:41.857647 [debug] [ThreadPool]: SQL status: SUCCESS in 2.980 seconds
[0m14:17:41.874058 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:17:41.875736 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:17:41.878653 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:17:41.897301 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:17:41.898133 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:17:41.898837 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:46.988118 [debug] [ThreadPool]: SQL status: SUCCESS in 5.087 seconds
[0m14:17:46.997844 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:17:46.998541 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:17:47.002304 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:17:47.027716 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:17:47.028374 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:17:47.028988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:57.219938 [debug] [ThreadPool]: SQL status: SUCCESS in 10.179 seconds
[0m14:17:57.246540 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:17:57.247243 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:17:57.263303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca43b0>]}
[0m14:17:57.272585 [debug] [MainThread]: On master: COMMIT
[0m14:17:57.357107 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m14:17:57.361238 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m14:17:57.365347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m14:17:57.365912 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m14:17:57.390898 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m14:17:57.400542 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m14:17:57.502002 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m14:17:57.505863 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:17:57.506310 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m14:17:57.506766 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:08.211298 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 10.617 seconds
[0m14:18:08.669822 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:18:08.677230 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m14:18:09.087966 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.407 seconds
[0m14:18:09.092515 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:18:09.093359 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m14:18:09.224937 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.131 seconds
[0m14:18:09.239245 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m14:18:09.242871 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m14:18:09.243279 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m14:18:09.292017 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.048 seconds
[0m14:18:09.341177 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m14:18:09.341773 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m14:18:09.355597 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3bd100>]}
[0m14:18:09.358661 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 11.98s]
[0m14:18:09.365040 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m14:18:09.366717 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:18:09.371175 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m14:18:09.371950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m14:18:09.372383 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:18:09.379132 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:18:09.380409 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:18:09.385335 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:18:09.389529 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:18:09.390345 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m14:18:09.391181 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:12.518418 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.125 seconds
[0m14:18:12.538572 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:18:12.539321 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m14:18:12.741596 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.202 seconds
[0m14:18:12.746416 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:18:12.747016 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m14:18:13.007012 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.259 seconds
[0m14:18:13.015416 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m14:18:13.016484 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:18:13.016840 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m14:18:13.064827 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.047 seconds
[0m14:18:13.067807 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m14:18:13.068344 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m14:18:13.070305 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4850d0>]}
[0m14:18:13.071798 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 3.70s]
[0m14:18:13.072662 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:18:13.076486 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:18:13.077704 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m14:18:13.078298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m14:18:13.078777 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m14:18:13.087059 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:18:13.089052 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m14:18:13.093668 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:18:13.098093 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:18:13.098914 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m14:18:13.100540 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:18.899833 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.798 seconds
[0m14:18:18.927328 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:18:18.927985 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m14:18:19.023336 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.095 seconds
[0m14:18:19.028250 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:18:19.028853 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m14:18:19.151647 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.122 seconds
[0m14:18:19.157492 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m14:18:19.158552 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:18:19.158960 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m14:18:19.198371 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.039 seconds
[0m14:18:19.204002 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m14:18:19.205686 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m14:18:19.215702 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3ea6c0>]}
[0m14:18:19.220299 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 6.13s]
[0m14:18:19.226549 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:18:19.227649 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m14:18:19.233803 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m14:18:19.235101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m14:18:19.235648 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m14:18:19.247185 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m14:18:19.249001 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m14:18:19.256375 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m14:18:19.263457 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:18:19.264643 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m14:18:19.265744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:25.429248 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 6.155 seconds
[0m14:18:25.455313 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:18:25.455946 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m14:18:25.601826 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.145 seconds
[0m14:18:25.607939 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:18:25.608818 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m14:18:25.777207 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.168 seconds
[0m14:18:25.791018 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m14:18:25.794569 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m14:18:25.795233 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m14:18:25.859187 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.063 seconds
[0m14:18:25.866050 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m14:18:25.868405 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m14:18:25.874470 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd8c002d-9f36-41ca-866e-353d7fb35b97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2c71a0>]}
[0m14:18:25.878228 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 6.64s]
[0m14:18:25.880734 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m14:18:25.906675 [debug] [MainThread]: On master: COMMIT
[0m14:18:25.908962 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:18:25.909920 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m14:18:25.916907 [info ] [MainThread]: 
[0m14:18:25.919357 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 49.83 seconds (49.83s).
[0m14:18:25.924869 [debug] [MainThread]: Command end result
[0m14:18:26.043766 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:18:26.065859 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:18:26.140258 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:18:26.141300 [info ] [MainThread]: 
[0m14:18:26.161764 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:18:26.163666 [info ] [MainThread]: 
[0m14:18:26.166724 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m14:18:26.180472 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 52.58388, "process_in_blocks": "54528", "process_kernel_time": 2.171961, "process_mem_max_rss": "287120", "process_out_blocks": "2286", "process_user_time": 6.588209}
[0m14:18:26.186102 [debug] [MainThread]: Command `cli run` succeeded at 14:18:26.185621 after 52.60 seconds
[0m14:18:26.190561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff16be030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd5484470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a20e60>]}
[0m14:18:26.193169 [debug] [MainThread]: Flushing usage events
[0m14:18:27.629079 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:18:35.536110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19eb200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01a91c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01aa030>]}


============================== 14:18:35.571339 | 2b230354-1216-4c61-a2f1-daa5a76de9a1 ==============================
[0m14:18:35.571339 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:18:35.573248 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:18:35.859339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0049e80>]}
[0m14:18:35.959301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffebef0>]}
[0m14:18:35.960400 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:18:36.398218 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:18:36.726893 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:18:36.728291 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:18:36.877947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd57500>]}
[0m14:18:37.030377 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:18:37.036569 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:18:37.066179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef828da0>]}
[0m14:18:37.072209 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:18:37.081203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef814dd0>]}
[0m14:18:37.101560 [info ] [MainThread]: 
[0m14:18:37.102967 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:18:37.103802 [info ] [MainThread]: 
[0m14:18:37.105298 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:18:37.138253 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:18:37.250658 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:18:37.251891 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:18:37.252522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:18:37.252972 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:18:37.254842 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef843860>]}
[0m14:18:40.821274 [debug] [ThreadPool]: SQL status: SUCCESS in 3.565 seconds
[0m14:18:40.833674 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:18:40.844628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m14:18:40.890794 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:18:40.891506 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:18:40.891962 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:43.466730 [debug] [ThreadPool]: SQL status: SUCCESS in 2.573 seconds
[0m14:18:43.482552 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:18:43.483366 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:18:43.487814 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:18:43.520247 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:18:43.521469 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:18:43.521881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:44.361297 [debug] [ThreadPool]: SQL status: SUCCESS in 0.839 seconds
[0m14:18:44.363532 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:18:44.364003 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:18:44.364865 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:18:44.374164 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:18:44.374676 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:18:44.375029 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:45.029823 [debug] [ThreadPool]: SQL status: SUCCESS in 0.653 seconds
[0m14:18:45.035032 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:18:45.035588 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:18:45.046405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4e7f50>]}
[0m14:18:45.052823 [debug] [MainThread]: On master: COMMIT
[0m14:18:45.083763 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m14:18:45.087022 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m14:18:45.090088 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m14:18:45.091339 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m14:18:45.106267 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m14:18:45.109540 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m14:18:45.184880 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m14:18:45.194323 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:18:45.194881 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m14:18:45.195325 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:51.112486 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.915 seconds
[0m14:18:51.148825 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:18:51.149738 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m14:18:51.318659 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.168 seconds
[0m14:18:51.326909 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:18:51.328005 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m14:18:55.906314 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 4.576 seconds
[0m14:18:55.930655 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m14:18:55.936850 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m14:18:55.937498 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m14:18:56.361206 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.423 seconds
[0m14:18:56.387993 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m14:18:56.388634 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m14:18:56.395961 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e5d90>]}
[0m14:18:56.397430 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 11.30s]
[0m14:18:56.403349 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m14:18:56.404126 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m14:18:56.408190 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m14:18:56.408868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m14:18:56.409416 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m14:18:56.413440 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m14:18:56.415219 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m14:18:56.418253 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m14:18:56.426712 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:18:56.430358 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m14:18:56.430900 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:10.895159 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 14.458 seconds
[0m14:19:10.945007 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:19:10.945674 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m14:19:11.269187 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.323 seconds
[0m14:19:11.275915 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:19:11.276866 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m14:19:11.415232 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.138 seconds
[0m14:19:11.420373 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m14:19:11.421629 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m14:19:11.422788 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m14:19:11.572218 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.149 seconds
[0m14:19:11.579068 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m14:19:11.579667 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m14:19:11.586569 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e6240>]}
[0m14:19:11.589866 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 15.17s]
[0m14:19:11.594748 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m14:19:11.595777 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m14:19:11.598259 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m14:19:11.599267 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m14:19:11.599810 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m14:19:11.613935 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m14:19:11.615860 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m14:19:11.620992 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m14:19:11.633657 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:19:11.634531 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m14:19:11.635625 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:16.985598 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.348 seconds
[0m14:19:17.010017 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:19:17.010584 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m14:19:17.092899 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.082 seconds
[0m14:19:17.096884 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:19:17.097444 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m14:19:17.176552 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.079 seconds
[0m14:19:17.179987 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m14:19:17.180786 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m14:19:17.181127 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m14:19:17.215216 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.034 seconds
[0m14:19:17.220845 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m14:19:17.221253 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m14:19:17.223044 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2c4c20>]}
[0m14:19:17.224589 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.62s]
[0m14:19:17.226761 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m14:19:17.227644 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m14:19:17.228575 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m14:19:17.229115 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m14:19:17.229532 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m14:19:17.243797 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m14:19:17.246329 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m14:19:17.250584 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m14:19:17.264871 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:19:17.265673 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m14:19:17.266426 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:20.558153 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 3.290 seconds
[0m14:19:20.588880 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:19:20.590362 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m14:19:20.716857 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.125 seconds
[0m14:19:20.724180 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:19:20.725338 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m14:19:20.848801 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.122 seconds
[0m14:19:20.857137 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m14:19:20.858735 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m14:19:20.859264 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m14:19:20.919364 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.059 seconds
[0m14:19:20.922867 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m14:19:20.923378 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m14:19:20.925858 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b230354-1216-4c61-a2f1-daa5a76de9a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e5370>]}
[0m14:19:20.928232 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 3.70s]
[0m14:19:20.929694 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m14:19:20.965339 [debug] [MainThread]: On master: COMMIT
[0m14:19:20.968647 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:19:20.969934 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m14:19:20.977700 [info ] [MainThread]: 
[0m14:19:20.980698 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 43.87 seconds (43.87s).
[0m14:19:20.988187 [debug] [MainThread]: Command end result
[0m14:19:21.061721 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:19:21.104854 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:19:21.146721 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:19:21.147661 [info ] [MainThread]: 
[0m14:19:21.150038 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:19:21.151629 [info ] [MainThread]: 
[0m14:19:21.154532 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m14:19:21.165477 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 45.741325, "process_in_blocks": "301640", "process_kernel_time": 2.681455, "process_mem_max_rss": "286620", "process_out_blocks": "2421", "process_user_time": 4.955347}
[0m14:19:21.171549 [debug] [MainThread]: Command `cli run` succeeded at 14:19:21.171252 after 45.75 seconds
[0m14:19:21.174356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55f3950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff026cb60>]}
[0m14:19:21.174926 [debug] [MainThread]: Flushing usage events
[0m14:19:22.588245 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:19:32.821797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05717c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0573a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cba40>]}


============================== 14:19:32.851823 | 2fb34bfb-a293-466e-8f1e-7da7ec263468 ==============================
[0m14:19:32.851823 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:19:32.855336 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:19:33.184218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00aabd0>]}
[0m14:19:33.273512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1996420>]}
[0m14:19:33.274832 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:19:33.652836 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:19:33.822546 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:19:33.824140 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:19:33.911113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd6e240>]}
[0m14:19:34.032913 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:19:34.037116 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:19:34.054559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef813620>]}
[0m14:19:34.055969 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:19:34.057128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83fef0>]}
[0m14:19:34.060468 [info ] [MainThread]: 
[0m14:19:34.061411 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:19:34.061966 [info ] [MainThread]: 
[0m14:19:34.063022 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:19:34.074733 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:19:34.120520 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:19:34.121080 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:19:34.121416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:19:34.121689 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:19:34.123319 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52c200>]}
[0m14:19:34.850104 [debug] [ThreadPool]: SQL status: SUCCESS in 0.727 seconds
[0m14:19:34.857511 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:19:34.867152 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m14:19:34.897649 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:19:34.898618 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:19:34.899285 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:19:42.380516 [debug] [ThreadPool]: SQL status: SUCCESS in 7.475 seconds
[0m14:19:42.423293 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:19:42.424745 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:19:42.430388 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:19:42.476556 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:19:42.477608 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:19:42.479036 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:19:47.159073 [debug] [ThreadPool]: SQL status: SUCCESS in 4.669 seconds
[0m14:19:47.220533 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:19:47.222164 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:19:47.230918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:19:47.258421 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:19:47.259165 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:19:47.259793 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:19:48.408799 [debug] [ThreadPool]: SQL status: SUCCESS in 1.147 seconds
[0m14:19:48.426182 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:19:48.427523 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:19:48.438008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd3eab0>]}
[0m14:19:48.444211 [debug] [MainThread]: On master: COMMIT
[0m14:19:48.498297 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m14:19:48.503499 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m14:19:48.526417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m14:19:48.527691 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m14:19:48.555177 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m14:19:48.559043 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m14:19:48.673097 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m14:19:48.679966 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:19:48.680776 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m14:19:48.681407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:54.569641 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 5.886 seconds
[0m14:19:54.595313 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:19:54.595988 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m14:19:54.670834 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.074 seconds
[0m14:19:54.674147 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:19:54.674519 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m14:19:54.763856 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.089 seconds
[0m14:19:54.774354 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m14:19:54.777177 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m14:19:54.777648 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m14:19:54.825866 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.048 seconds
[0m14:19:54.860367 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m14:19:54.861090 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m14:19:54.868881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff1cc20>]}
[0m14:19:54.871117 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 6.36s]
[0m14:19:54.874542 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m14:19:54.875514 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m14:19:54.876682 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m14:19:54.877393 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m14:19:54.877864 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m14:19:54.883985 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m14:19:54.885346 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m14:19:54.889117 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m14:19:54.897150 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:19:54.897842 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m14:19:54.898398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:57.140387 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.240 seconds
[0m14:19:57.152225 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:19:57.152662 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m14:19:57.330681 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.177 seconds
[0m14:19:57.338006 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:19:57.339073 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m14:19:57.440728 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.101 seconds
[0m14:19:57.452367 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m14:19:57.454416 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m14:19:57.455011 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m14:19:57.504817 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.049 seconds
[0m14:19:57.507427 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m14:19:57.507828 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m14:19:57.510400 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef464e30>]}
[0m14:19:57.511844 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.63s]
[0m14:19:57.518154 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m14:19:57.520250 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m14:19:57.524682 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m14:19:57.526291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m14:19:57.527896 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m14:19:57.535377 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m14:19:57.537345 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m14:19:57.540345 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m14:19:57.546128 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:19:57.546844 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m14:19:57.548082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:59.634744 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 2.082 seconds
[0m14:19:59.652531 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:19:59.653028 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m14:19:59.738915 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.085 seconds
[0m14:19:59.743290 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:19:59.743833 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m14:19:59.823246 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.079 seconds
[0m14:19:59.827195 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m14:19:59.828354 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m14:19:59.828751 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m14:19:59.874634 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.045 seconds
[0m14:19:59.877497 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m14:19:59.878032 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m14:19:59.879911 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fb34bfb-a293-466e-8f1e-7da7ec263468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4f8f50>]}
[0m14:19:59.881282 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 2.35s]
[0m14:19:59.883961 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m14:19:59.910083 [debug] [MainThread]: On master: COMMIT
[0m14:19:59.911577 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:19:59.912106 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m14:19:59.915487 [info ] [MainThread]: 
[0m14:19:59.916784 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 25.85 seconds (25.85s).
[0m14:19:59.922324 [debug] [MainThread]: Command end result
[0m14:19:59.980034 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:19:59.997230 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:20:00.041203 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:20:00.042175 [info ] [MainThread]: 
[0m14:20:00.043221 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:20:00.043802 [info ] [MainThread]: 
[0m14:20:00.045469 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m14:20:00.050498 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.309896, "process_in_blocks": "257568", "process_kernel_time": 2.9905, "process_mem_max_rss": "288844", "process_out_blocks": "2297", "process_user_time": 4.915111}
[0m14:20:00.052068 [debug] [MainThread]: Command `cli run` succeeded at 14:20:00.051624 after 27.31 seconds
[0m14:20:00.058903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff045bfe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08f1460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017b9e0>]}
[0m14:20:00.059592 [debug] [MainThread]: Flushing usage events
[0m14:20:01.358956 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:20:07.909269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0760a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0760500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e71a0>]}


============================== 14:20:07.935987 | 477c616e-bf65-488d-9ff8-01f7433a674e ==============================
[0m14:20:07.935987 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:20:07.938631 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:20:08.693177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05f8fb0>]}
[0m14:20:08.881106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0bfe690>]}
[0m14:20:08.882774 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:20:09.571923 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:20:09.843630 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:20:09.844838 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:20:09.965857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ff080>]}
[0m14:20:09.994163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa9e510>]}
[0m14:20:09.995713 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:20:09.996501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00beff0>]}
[0m14:20:10.013046 [info ] [MainThread]: 
[0m14:20:10.013933 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:20:10.014403 [info ] [MainThread]: 
[0m14:20:10.015434 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:20:10.050939 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m14:20:10.145883 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:20:10.147427 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:20:10.148666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:10.149532 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:20:10.153259 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcd5970>]}
[0m14:20:12.513041 [debug] [ThreadPool]: SQL status: SUCCESS in 2.362 seconds
[0m14:20:12.520280 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:20:12.520720 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:20:12.522904 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:20:12.532944 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:20:12.533366 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:20:12.533719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:13.043699 [debug] [ThreadPool]: SQL status: SUCCESS in 0.510 seconds
[0m14:20:13.045414 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:20:13.045766 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:20:13.046709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:20:13.050661 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:20:13.051086 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:20:13.054360 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:13.287456 [debug] [ThreadPool]: SQL status: SUCCESS in 0.233 seconds
[0m14:20:13.288879 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:20:13.289226 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:20:13.295041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '477c616e-bf65-488d-9ff8-01f7433a674e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdb92b0>]}
[0m14:20:13.308484 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m14:20:13.309145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m14:20:13.309535 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m14:20:13.312586 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m14:20:13.313542 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m14:20:13.314099 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:20:13.314762 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m14:20:13.315144 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:20:13.318901 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:20:13.319561 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m14:20:13.319916 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m14:20:13.320438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m14:20:13.320846 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m14:20:13.322298 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m14:20:13.322900 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m14:20:13.323398 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m14:20:13.323831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m14:20:13.324154 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m14:20:13.325444 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m14:20:13.325970 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m14:20:13.326394 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m14:20:13.326864 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m14:20:13.327170 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m14:20:13.333210 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m14:20:13.334470 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m14:20:13.335156 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m14:20:13.335672 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:20:13.336147 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m14:20:13.336655 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:20:13.339549 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m14:20:13.340224 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:20:13.340855 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m14:20:13.341225 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:20:13.341688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m14:20:13.342034 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m14:20:13.344853 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m14:20:13.345486 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m14:20:13.346202 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m14:20:13.346623 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m14:20:13.347173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m14:20:13.347549 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m14:20:13.350198 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m14:20:13.351321 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m14:20:13.351898 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m14:20:13.352331 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m14:20:13.352857 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m14:20:13.353292 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m14:20:13.356349 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m14:20:13.357284 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m14:20:13.357886 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m14:20:13.358287 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:20:13.358738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m14:20:13.359069 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:20:13.372606 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m14:20:13.373793 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:20:13.374379 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m14:20:13.374719 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:20:13.375093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m14:20:13.375391 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:20:13.378434 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m14:20:13.378980 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:20:13.379512 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m14:20:13.379855 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:20:13.380205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m14:20:13.380498 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:20:13.383304 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m14:20:13.383923 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:20:13.384433 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m14:20:13.384770 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:20:13.385149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m14:20:13.385477 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:20:13.391266 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m14:20:13.391847 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:20:13.392381 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m14:20:13.392703 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m14:20:13.393064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m14:20:13.393360 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m14:20:13.395847 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m14:20:13.396490 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m14:20:13.397003 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m14:20:13.397322 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:20:13.397797 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m14:20:13.398119 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:20:13.400803 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m14:20:13.401282 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:20:13.401775 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m14:20:13.402115 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:20:13.402475 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m14:20:13.402769 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:20:13.405405 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m14:20:13.405900 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:20:13.406393 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m14:20:13.406846 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:20:13.407193 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m14:20:13.407507 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:20:13.410082 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m14:20:13.410617 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:20:13.411131 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m14:20:13.411446 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:20:13.411781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m14:20:13.412078 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:20:13.414685 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m14:20:13.415164 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:20:13.415702 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m14:20:13.416026 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m14:20:13.416427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m14:20:13.416707 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m14:20:13.419261 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m14:20:13.419914 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m14:20:13.420455 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m14:20:13.420777 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:20:13.421392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m14:20:13.421875 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:20:13.425141 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m14:20:13.425880 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:20:13.426423 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m14:20:13.426734 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:20:13.427080 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m14:20:13.427372 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:20:13.430072 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m14:20:13.430603 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:20:13.431108 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m14:20:13.431413 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:20:13.431754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m14:20:13.432051 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:20:13.434537 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m14:20:13.435009 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:20:13.435492 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m14:20:13.435801 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m14:20:13.436196 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m14:20:13.436538 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m14:20:13.440046 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m14:20:13.440842 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m14:20:13.441423 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m14:20:13.441763 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:20:13.442252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m14:20:13.442562 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:20:13.446586 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m14:20:13.447175 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:20:13.447697 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m14:20:13.448037 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:20:13.448386 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m14:20:13.448675 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:20:13.451344 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m14:20:13.451948 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:20:13.452461 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m14:20:13.452778 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:20:13.453107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m14:20:13.453682 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:20:13.456250 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m14:20:13.456727 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:20:13.457224 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m14:20:13.457611 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m14:20:13.457948 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m14:20:13.458246 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m14:20:13.460656 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m14:20:13.461125 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m14:20:13.461616 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m14:20:13.461922 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m14:20:13.462271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m14:20:13.462565 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m14:20:13.465096 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m14:20:13.465873 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m14:20:13.466383 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m14:20:13.466756 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m14:20:13.467167 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m14:20:13.467489 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m14:20:13.470139 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m14:20:13.470632 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m14:20:13.471138 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m14:20:13.473684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:20:13.474495 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m14:20:13.479429 [debug] [MainThread]: Command end result
[0m14:20:13.581934 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:20:13.588500 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:20:13.600596 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m14:20:13.637611 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m14:20:13.639360 [info ] [MainThread]: Building catalog
[0m14:20:13.648010 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m14:20:13.700984 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m14:20:13.702052 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m14:20:13.704797 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:17.379016 [debug] [ThreadPool]: SQL status: SUCCESS in 3.672 seconds
[0m14:20:17.394747 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m14:20:17.440809 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m14:20:17.466832 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:20:17.472254 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:20:17.473570 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m14:20:17.481785 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.706, "process_in_blocks": "182352", "process_kernel_time": 2.255879, "process_mem_max_rss": "289080", "process_out_blocks": "5916", "process_user_time": 4.333}
[0m14:20:17.483403 [debug] [MainThread]: Command `cli docs generate` succeeded at 14:20:17.483128 after 9.71 seconds
[0m14:20:17.484401 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m14:20:17.484857 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m14:20:17.485663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff058fa40>]}
[0m14:20:17.486555 [debug] [MainThread]: Flushing usage events
[0m14:20:19.010759 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:42:07.856069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05738c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0777bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a24fb0>]}


============================== 11:42:07.876555 | ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978 ==============================
[0m11:42:07.876555 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:42:07.878387 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:42:08.152484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09903b0>]}
[0m11:42:08.224967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12eeff0>]}
[0m11:42:08.225937 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:42:08.587482 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:42:08.736813 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:08.737739 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:08.813122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd5c7d0>]}
[0m11:42:08.912149 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:42:08.915307 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:42:08.928140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8451c0>]}
[0m11:42:08.929051 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:42:08.929730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8311c0>]}
[0m11:42:08.933083 [info ] [MainThread]: 
[0m11:42:08.933681 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:42:08.934171 [info ] [MainThread]: 
[0m11:42:08.934976 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:42:08.945658 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m11:42:08.982799 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m11:42:08.983575 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m11:42:08.983971 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:08.984260 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:42:08.986256 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef830740>]}
[0m11:42:10.625460 [debug] [ThreadPool]: SQL status: SUCCESS in 1.639 seconds
[0m11:42:10.630183 [debug] [ThreadPool]: On list_iceberg: Close
[0m11:42:10.644715 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m11:42:10.669873 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m11:42:10.670681 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m11:42:10.671090 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:42:13.421894 [debug] [ThreadPool]: SQL status: SUCCESS in 2.749 seconds
[0m11:42:13.439340 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m11:42:13.443309 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m11:42:13.450296 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m11:42:13.468328 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m11:42:13.469143 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m11:42:13.469737 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:42:15.259550 [debug] [ThreadPool]: SQL status: SUCCESS in 1.787 seconds
[0m11:42:15.271677 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m11:42:15.273347 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m11:42:15.277836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m11:42:15.301030 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m11:42:15.301801 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m11:42:15.302982 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:42:15.854945 [debug] [ThreadPool]: SQL status: SUCCESS in 0.552 seconds
[0m11:42:15.857181 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m11:42:15.857741 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m11:42:15.862193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0fb2ff0>]}
[0m11:42:15.864351 [debug] [MainThread]: On master: COMMIT
[0m11:42:15.891997 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m11:42:15.893395 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m11:42:15.897168 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m11:42:15.898239 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m11:42:15.908056 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m11:42:15.910604 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m11:42:15.970762 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m11:42:15.974138 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m11:42:15.974757 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m11:42:15.975133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:42:23.165738 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 7.189 seconds
[0m11:42:23.203654 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m11:42:23.204417 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m11:42:23.610924 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.406 seconds
[0m11:42:23.615726 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m11:42:23.616371 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m11:42:23.760702 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.144 seconds
[0m11:42:23.774655 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m11:42:23.778740 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m11:42:23.779492 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m11:42:23.844507 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.064 seconds
[0m11:42:23.883981 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m11:42:23.885240 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m11:42:23.897140 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c45d90>]}
[0m11:42:23.900568 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 7.99s]
[0m11:42:23.902132 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m11:42:23.903055 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:42:23.904025 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m11:42:23.904818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m11:42:23.905445 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:42:23.909912 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:42:23.913566 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:42:23.921222 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:42:23.925766 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:42:23.926353 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m11:42:23.926950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:42:27.049210 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.117 seconds
[0m11:42:27.075539 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:42:27.076286 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m11:42:27.176128 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m11:42:27.183877 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:42:27.184836 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m11:42:27.316935 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.131 seconds
[0m11:42:27.322040 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m11:42:27.323627 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:42:27.324126 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m11:42:27.373692 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.049 seconds
[0m11:42:27.376786 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m11:42:27.377262 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m11:42:27.379467 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55d0d10>]}
[0m11:42:27.380935 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 3.47s]
[0m11:42:27.381879 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:42:27.384953 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m11:42:27.385839 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m11:42:27.386753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m11:42:27.391106 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m11:42:27.404206 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:42:27.405845 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m11:42:27.412509 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:42:27.416843 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:42:27.417598 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m11:42:27.418106 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:42:31.729313 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.309 seconds
[0m11:42:31.761385 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:42:31.762124 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m11:42:31.897158 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.134 seconds
[0m11:42:31.910170 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:42:31.912387 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m11:42:32.068260 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.154 seconds
[0m11:42:32.073946 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m11:42:32.075769 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:42:32.077111 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m11:42:32.161922 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.084 seconds
[0m11:42:32.165348 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m11:42:32.165915 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m11:42:32.168343 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef49fb30>]}
[0m11:42:32.175158 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 4.78s]
[0m11:42:32.177719 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m11:42:32.179543 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m11:42:32.181600 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m11:42:32.183045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m11:42:32.183928 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m11:42:32.195292 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m11:42:32.198583 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m11:42:32.204900 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m11:42:32.213612 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m11:42:32.215004 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m11:42:32.215923 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:42:47.806483 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 15.579 seconds
[0m11:42:47.848698 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m11:42:47.850018 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m11:42:48.125940 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.275 seconds
[0m11:42:48.130264 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m11:42:48.130806 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m11:42:48.231693 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.100 seconds
[0m11:42:48.237106 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m11:42:48.238938 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m11:42:48.239579 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m11:42:48.302701 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.062 seconds
[0m11:42:48.307364 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m11:42:48.308247 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m11:42:48.313273 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ecba5e1a-c8d0-44d9-ac1a-84bcd66ce978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef48f1a0>]}
[0m11:42:48.315457 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 16.13s]
[0m11:42:48.318373 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m11:42:48.346156 [debug] [MainThread]: On master: COMMIT
[0m11:42:48.347576 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:48.347902 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m11:42:48.352411 [info ] [MainThread]: 
[0m11:42:48.353475 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 39.41 seconds (39.41s).
[0m11:42:48.357133 [debug] [MainThread]: Command end result
[0m11:42:48.405645 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:42:48.424283 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:42:48.460948 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m11:42:48.461406 [info ] [MainThread]: 
[0m11:42:48.462562 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:42:48.463130 [info ] [MainThread]: 
[0m11:42:48.464021 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m11:42:48.474712 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 40.686676, "process_in_blocks": "107216", "process_kernel_time": 1.524673, "process_mem_max_rss": "287404", "process_out_blocks": "2286", "process_user_time": 4.100356}
[0m11:42:48.478391 [debug] [MainThread]: Command `cli run` succeeded at 11:42:48.477395 after 40.70 seconds
[0m11:42:48.481716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff059e6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a24fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c22d20>]}
[0m11:42:48.482330 [debug] [MainThread]: Flushing usage events
[0m11:42:49.659492 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:42:55.061997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff070b8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f7d760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06caed0>]}


============================== 11:42:55.079861 | a9d50172-b362-4133-a490-f98700d5fd5f ==============================
[0m11:42:55.079861 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:42:55.080611 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:42:55.351823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b0cda0>]}
[0m11:42:55.420074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff074d700>]}
[0m11:42:55.421067 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:42:55.694583 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:42:55.821040 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:55.821890 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:55.883140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd5d850>]}
[0m11:42:55.975203 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:42:55.977398 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:42:55.987493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83d3a0>]}
[0m11:42:55.988363 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:42:55.989237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8313a0>]}
[0m11:42:55.991359 [info ] [MainThread]: 
[0m11:42:55.991961 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:42:55.992389 [info ] [MainThread]: 
[0m11:42:55.993189 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:42:55.999784 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m11:42:56.027384 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m11:42:56.027848 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m11:42:56.028159 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:56.028434 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:42:56.030896 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef530980>]}
[0m11:42:57.026912 [debug] [ThreadPool]: SQL status: SUCCESS in 0.990 seconds
[0m11:42:57.042733 [debug] [ThreadPool]: On list_iceberg: Close
[0m11:42:57.067514 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m11:42:57.107515 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m11:42:57.108211 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m11:42:57.108600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:42:59.341477 [debug] [ThreadPool]: SQL status: SUCCESS in 2.231 seconds
[0m11:42:59.349692 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m11:42:59.350251 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m11:42:59.353041 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m11:42:59.364746 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m11:42:59.365314 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m11:42:59.365751 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:42:59.738001 [debug] [ThreadPool]: SQL status: SUCCESS in 0.372 seconds
[0m11:42:59.740159 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m11:42:59.740645 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m11:42:59.741622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m11:42:59.748062 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m11:42:59.748545 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m11:42:59.748854 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:43:00.191673 [debug] [ThreadPool]: SQL status: SUCCESS in 0.443 seconds
[0m11:43:00.193417 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m11:43:00.193806 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m11:43:00.197162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefff87a0>]}
[0m11:43:00.199495 [debug] [MainThread]: On master: COMMIT
[0m11:43:00.216068 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m11:43:00.217775 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m11:43:00.221367 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m11:43:00.222430 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m11:43:00.232096 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m11:43:00.234810 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m11:43:00.300616 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m11:43:00.320847 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m11:43:00.321849 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m11:43:00.322682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:43:05.052387 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 4.726 seconds
[0m11:43:05.084450 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m11:43:05.085140 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m11:43:05.155187 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.069 seconds
[0m11:43:05.163056 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m11:43:05.163593 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m11:43:05.226786 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.063 seconds
[0m11:43:05.238187 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m11:43:05.241414 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m11:43:05.241939 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m11:43:05.299405 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m11:43:05.380669 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m11:43:05.381391 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m11:43:05.395191 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff1c920>]}
[0m11:43:05.397642 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 5.17s]
[0m11:43:05.399941 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m11:43:05.400888 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m11:43:05.402303 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m11:43:05.402967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m11:43:05.403409 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m11:43:05.407763 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m11:43:05.409132 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m11:43:05.412413 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m11:43:05.420138 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m11:43:05.420863 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m11:43:05.421433 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:43:08.445511 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 3.021 seconds
[0m11:43:08.465571 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m11:43:08.466549 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m11:43:08.550311 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.083 seconds
[0m11:43:08.553550 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m11:43:08.553917 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m11:43:08.613208 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.059 seconds
[0m11:43:08.616524 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m11:43:08.617325 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m11:43:08.617644 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m11:43:08.664096 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.046 seconds
[0m11:43:08.666826 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m11:43:08.667285 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m11:43:08.669167 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55db380>]}
[0m11:43:08.670453 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 3.27s]
[0m11:43:08.673636 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m11:43:08.674632 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m11:43:08.675778 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m11:43:08.676408 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m11:43:08.676830 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m11:43:08.682877 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m11:43:08.684047 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m11:43:08.688442 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m11:43:08.696569 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m11:43:08.697072 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m11:43:08.697638 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:43:12.599458 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.899 seconds
[0m11:43:12.634764 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m11:43:12.636321 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m11:43:12.815145 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.178 seconds
[0m11:43:12.824711 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m11:43:12.825676 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m11:43:13.521824 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.694 seconds
[0m11:43:13.544189 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m11:43:13.548874 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m11:43:13.549816 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m11:43:14.081350 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.526 seconds
[0m11:43:14.137456 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m11:43:14.141548 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m11:43:14.207135 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55ce750>]}
[0m11:43:14.211312 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 5.48s]
[0m11:43:14.212754 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m11:43:14.224428 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m11:43:14.231864 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m11:43:14.235442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m11:43:14.239468 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m11:43:14.409372 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m11:43:14.415176 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m11:43:14.427119 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m11:43:14.497895 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m11:43:14.500301 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m11:43:14.501303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:43:35.913366 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 21.396 seconds
[0m11:43:36.046348 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m11:43:36.047765 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m11:43:36.475190 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.427 seconds
[0m11:43:36.480319 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m11:43:36.480857 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m11:43:36.726401 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.245 seconds
[0m11:43:36.733238 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m11:43:36.735525 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m11:43:36.735896 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m11:43:36.796557 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.060 seconds
[0m11:43:36.803588 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m11:43:36.804218 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m11:43:36.811503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9d50172-b362-4133-a490-f98700d5fd5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3dcd40>]}
[0m11:43:36.823488 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 22.57s]
[0m11:43:36.827065 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m11:43:36.863743 [debug] [MainThread]: On master: COMMIT
[0m11:43:36.866509 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:36.866935 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m11:43:36.873472 [info ] [MainThread]: 
[0m11:43:36.876592 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 40.87 seconds (40.87s).
[0m11:43:36.880993 [debug] [MainThread]: Command end result
[0m11:43:36.953743 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:43:36.984425 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:43:37.087556 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m11:43:37.088205 [info ] [MainThread]: 
[0m11:43:37.090339 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:43:37.091887 [info ] [MainThread]: 
[0m11:43:37.093918 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m11:43:37.106020 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 42.12577, "process_in_blocks": "141432", "process_kernel_time": 1.621375, "process_mem_max_rss": "287060", "process_out_blocks": "2421", "process_user_time": 4.656014}
[0m11:43:37.111177 [debug] [MainThread]: Command `cli run` succeeded at 11:43:37.110486 after 42.13 seconds
[0m11:43:37.115476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02ea150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b2a210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b2bb00>]}
[0m11:43:37.116766 [debug] [MainThread]: Flushing usage events
[0m11:43:38.272566 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:43:53.806194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0224b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0227bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0224ad0>]}


============================== 11:43:53.907177 | 646097a1-e93a-4346-8af6-f18e14b77441 ==============================
[0m11:43:53.907177 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:43:53.910190 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:43:54.684422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b3fb0>]}
[0m11:43:54.912515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff043b980>]}
[0m11:43:54.921506 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:43:55.855574 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:43:56.291701 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:56.294119 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:56.504498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef9f04a0>]}
[0m11:43:56.674760 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:43:56.680020 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:43:56.708265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef831040>]}
[0m11:43:56.710952 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:43:56.716510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef821040>]}
[0m11:43:56.731091 [info ] [MainThread]: 
[0m11:43:56.732751 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:43:56.734213 [info ] [MainThread]: 
[0m11:43:56.737810 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:43:56.798736 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m11:43:56.928213 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m11:43:56.929242 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m11:43:56.929766 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:56.930271 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:43:56.933471 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef524920>]}
[0m11:44:06.883617 [debug] [ThreadPool]: SQL status: SUCCESS in 9.940 seconds
[0m11:44:06.928051 [debug] [ThreadPool]: On list_iceberg: Close
[0m11:44:06.957870 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m11:44:07.018570 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m11:44:07.019334 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m11:44:07.019833 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:44:08.940682 [debug] [ThreadPool]: SQL status: SUCCESS in 1.921 seconds
[0m11:44:08.943797 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m11:44:08.944256 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m11:44:08.945173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m11:44:08.952357 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m11:44:08.952779 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m11:44:08.953108 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:44:09.645334 [debug] [ThreadPool]: SQL status: SUCCESS in 0.691 seconds
[0m11:44:09.653983 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m11:44:09.654665 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m11:44:09.656015 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m11:44:09.664820 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m11:44:09.668234 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m11:44:09.672581 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:44:10.417579 [debug] [ThreadPool]: SQL status: SUCCESS in 0.745 seconds
[0m11:44:10.419114 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m11:44:10.419444 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m11:44:10.433667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd54f2960>]}
[0m11:44:10.443063 [debug] [MainThread]: On master: COMMIT
[0m11:44:10.485283 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m11:44:10.486694 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m11:44:10.497300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m11:44:10.498163 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m11:44:10.509019 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m11:44:10.512881 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m11:44:10.575322 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m11:44:10.579541 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m11:44:10.580127 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m11:44:10.580487 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:44:19.075581 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 8.493 seconds
[0m11:44:19.104555 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m11:44:19.105378 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m11:44:19.252798 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.147 seconds
[0m11:44:19.258207 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m11:44:19.258735 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m11:44:19.348525 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.089 seconds
[0m11:44:19.364562 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m11:44:19.367567 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m11:44:19.368035 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m11:44:19.425769 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m11:44:19.470389 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m11:44:19.471218 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m11:44:19.484943 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff102c0>]}
[0m11:44:19.487124 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 8.99s]
[0m11:44:19.491707 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m11:44:19.492840 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m11:44:19.493553 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m11:44:19.495706 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m11:44:19.496243 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m11:44:19.502084 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m11:44:19.503907 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m11:44:19.507772 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m11:44:19.517954 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m11:44:19.518869 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m11:44:19.519662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:44:22.929542 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 3.407 seconds
[0m11:44:22.964748 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m11:44:22.965434 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m11:44:23.084602 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.119 seconds
[0m11:44:23.089138 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m11:44:23.089652 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m11:44:23.189155 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m11:44:23.196849 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m11:44:23.198062 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m11:44:23.198438 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m11:44:23.303838 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.105 seconds
[0m11:44:23.310731 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m11:44:23.311297 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m11:44:23.313656 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef42bef0>]}
[0m11:44:23.315289 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 3.82s]
[0m11:44:23.317562 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m11:44:23.318565 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m11:44:23.320173 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m11:44:23.320982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m11:44:23.321520 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m11:44:23.331826 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m11:44:23.337641 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m11:44:23.346083 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m11:44:23.359812 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m11:44:23.360677 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m11:44:23.361357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:44:25.911373 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 2.545 seconds
[0m11:44:25.948566 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m11:44:25.949486 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m11:44:26.066959 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.117 seconds
[0m11:44:26.072386 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m11:44:26.072921 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m11:44:26.231814 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.158 seconds
[0m11:44:26.236588 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m11:44:26.238964 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m11:44:26.239973 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m11:44:26.300251 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.059 seconds
[0m11:44:26.304223 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m11:44:26.304911 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m11:44:26.309124 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '646097a1-e93a-4346-8af6-f18e14b77441', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca5220>]}
[0m11:44:26.316351 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 2.99s]
[0m11:44:26.318963 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m11:44:26.405515 [debug] [MainThread]: On master: COMMIT
[0m11:44:26.407878 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:26.408381 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m11:44:26.418602 [info ] [MainThread]: 
[0m11:44:26.420493 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 29.67 seconds (29.67s).
[0m11:44:26.425679 [debug] [MainThread]: Command end result
[0m11:44:26.489550 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:44:26.509295 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:44:26.565485 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m11:44:26.566065 [info ] [MainThread]: 
[0m11:44:26.568361 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:44:26.570016 [info ] [MainThread]: 
[0m11:44:26.572195 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m11:44:26.578834 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 33.09977, "process_in_blocks": "337664", "process_kernel_time": 7.399261, "process_mem_max_rss": "284680", "process_out_blocks": "2297", "process_user_time": 7.738479}
[0m11:44:26.583342 [debug] [MainThread]: Command `cli run` succeeded at 11:44:26.582925 after 33.11 seconds
[0m11:44:26.589357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1172960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016e9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016eba0>]}
[0m11:44:26.590981 [debug] [MainThread]: Flushing usage events
[0m11:44:28.073854 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:44:48.912275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a303b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a31dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19eb170>]}


============================== 11:44:48.956175 | 12696dc0-1854-46af-95bd-5f51603acfc1 ==============================
[0m11:44:48.956175 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:44:48.958914 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:44:49.350313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01a63c0>]}
[0m11:44:49.453111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffd36b0>]}
[0m11:44:49.454267 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:44:49.927572 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:44:50.110100 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:50.111833 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:50.195533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcd2c90>]}
[0m11:44:50.219621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa8fb60>]}
[0m11:44:50.221203 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:44:50.226352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0207b60>]}
[0m11:44:50.235457 [info ] [MainThread]: 
[0m11:44:50.236473 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:44:50.236921 [info ] [MainThread]: 
[0m11:44:50.238429 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:44:50.256161 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m11:44:50.314385 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m11:44:50.316499 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m11:44:50.317086 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:50.317480 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:44:50.319077 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5cbfe0>]}
[0m11:45:04.703409 [debug] [ThreadPool]: SQL status: SUCCESS in 14.377 seconds
[0m11:45:04.725405 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m11:45:04.726567 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m11:45:04.732503 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m11:45:04.765660 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m11:45:04.766510 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m11:45:04.767770 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.263092 [debug] [ThreadPool]: SQL status: SUCCESS in 1.492 seconds
[0m11:45:06.282962 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m11:45:06.283927 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m11:45:06.287247 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m11:45:06.312482 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m11:45:06.313178 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m11:45:06.313787 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:07.057064 [debug] [ThreadPool]: SQL status: SUCCESS in 0.743 seconds
[0m11:45:07.059526 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m11:45:07.059957 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m11:45:07.075992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12696dc0-1854-46af-95bd-5f51603acfc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa44980>]}
[0m11:45:07.152942 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m11:45:07.154092 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m11:45:07.155762 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m11:45:07.171877 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m11:45:07.179409 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m11:45:07.182243 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m11:45:07.186122 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m11:45:07.192422 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m11:45:07.194717 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m11:45:07.195513 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m11:45:07.195953 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m11:45:07.196397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m11:45:07.196794 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m11:45:07.199269 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m11:45:07.199946 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m11:45:07.200412 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m11:45:07.201050 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m11:45:07.201469 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m11:45:07.203311 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m11:45:07.203994 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m11:45:07.204419 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m11:45:07.204901 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m11:45:07.205459 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m11:45:07.217678 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m11:45:07.220106 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m11:45:07.220921 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m11:45:07.221310 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:45:07.221774 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m11:45:07.222626 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:45:07.225499 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m11:45:07.226871 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:45:07.227461 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m11:45:07.227810 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m11:45:07.228209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m11:45:07.228588 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m11:45:07.232239 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m11:45:07.233156 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m11:45:07.233937 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m11:45:07.234727 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m11:45:07.235760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m11:45:07.237220 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m11:45:07.241665 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m11:45:07.242936 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m11:45:07.243739 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m11:45:07.244154 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m11:45:07.244663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m11:45:07.245143 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m11:45:07.251830 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m11:45:07.256069 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m11:45:07.256888 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m11:45:07.257867 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m11:45:07.258348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m11:45:07.258664 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m11:45:07.333401 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m11:45:07.340816 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m11:45:07.343712 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m11:45:07.344277 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m11:45:07.344811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m11:45:07.345299 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m11:45:07.349645 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m11:45:07.355543 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m11:45:07.356718 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m11:45:07.357274 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m11:45:07.357948 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m11:45:07.358427 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m11:45:07.364252 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m11:45:07.367701 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m11:45:07.369068 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m11:45:07.369705 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m11:45:07.370232 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m11:45:07.370785 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m11:45:07.378116 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m11:45:07.379233 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m11:45:07.380215 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m11:45:07.380708 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m11:45:07.381162 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m11:45:07.381572 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m11:45:07.385113 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m11:45:07.386286 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m11:45:07.386950 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m11:45:07.387320 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m11:45:07.387769 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m11:45:07.388663 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m11:45:07.393125 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m11:45:07.394058 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m11:45:07.394689 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m11:45:07.395632 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m11:45:07.396050 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m11:45:07.396364 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m11:45:07.400644 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m11:45:07.401507 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m11:45:07.402124 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m11:45:07.402628 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m11:45:07.403046 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m11:45:07.403381 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m11:45:07.407576 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m11:45:07.409336 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m11:45:07.410926 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m11:45:07.411545 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m11:45:07.412213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m11:45:07.412588 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m11:45:07.418451 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m11:45:07.419782 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m11:45:07.420850 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m11:45:07.421509 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m11:45:07.422111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m11:45:07.422606 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m11:45:07.428081 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m11:45:07.430851 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m11:45:07.431780 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m11:45:07.432416 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m11:45:07.433283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m11:45:07.433900 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m11:45:07.439089 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m11:45:07.441537 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m11:45:07.442549 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m11:45:07.442963 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m11:45:07.443435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m11:45:07.443800 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m11:45:07.448442 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m11:45:07.449564 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m11:45:07.450601 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m11:45:07.451245 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m11:45:07.451934 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m11:45:07.452436 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m11:45:07.456611 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m11:45:07.457911 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m11:45:07.458612 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m11:45:07.458979 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m11:45:07.459386 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m11:45:07.459691 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m11:45:07.466495 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m11:45:07.468663 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m11:45:07.469427 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m11:45:07.469794 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m11:45:07.470525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m11:45:07.471102 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m11:45:07.475656 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m11:45:07.476995 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m11:45:07.477699 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m11:45:07.478089 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m11:45:07.478508 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m11:45:07.478850 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m11:45:07.482301 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m11:45:07.483315 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m11:45:07.483869 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m11:45:07.484199 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m11:45:07.484556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m11:45:07.484847 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m11:45:07.487712 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m11:45:07.488218 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m11:45:07.488724 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m11:45:07.489057 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m11:45:07.489390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m11:45:07.489691 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m11:45:07.492674 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m11:45:07.493398 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m11:45:07.493961 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m11:45:07.494287 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m11:45:07.494622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m11:45:07.494911 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m11:45:07.497534 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m11:45:07.498116 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m11:45:07.498721 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m11:45:07.499064 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m11:45:07.499425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m11:45:07.499734 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m11:45:07.502937 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m11:45:07.503689 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m11:45:07.504246 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m11:45:07.520594 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:07.522009 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m11:45:07.530154 [debug] [MainThread]: Command end result
[0m11:45:07.704739 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:45:07.722870 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:45:07.749062 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m11:45:07.763672 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m11:45:07.764218 [info ] [MainThread]: Building catalog
[0m11:45:07.780690 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m11:45:07.847029 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m11:45:07.848227 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m11:45:07.849439 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:38.725870 [debug] [ThreadPool]: SQL status: SUCCESS in 30.862 seconds
[0m11:45:38.810345 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m11:45:38.986268 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m11:45:39.062604 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:45:39.078331 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:45:39.079023 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m11:45:39.097141 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 50.319702, "process_in_blocks": "300344", "process_kernel_time": 7.218069, "process_mem_max_rss": "286908", "process_out_blocks": "5916", "process_user_time": 11.497788}
[0m11:45:39.104534 [debug] [MainThread]: Command `cli docs generate` succeeded at 11:45:39.103719 after 50.34 seconds
[0m11:45:39.107467 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m11:45:39.107964 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m11:45:39.111179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffebef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03a4980>]}
[0m11:45:39.112249 [debug] [MainThread]: Flushing usage events
[0m11:45:40.104823 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:47:14.881152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a253a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cf7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfd70>]}


============================== 11:47:14.983999 | 41ca6421-1c27-40fc-913f-1381c3118766 ==============================
[0m11:47:14.983999 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:47:14.987633 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:47:15.364396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41ca6421-1c27-40fc-913f-1381c3118766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe5cf20>]}
[0m11:47:15.440178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41ca6421-1c27-40fc-913f-1381c3118766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd6c470>]}
[0m11:47:15.442551 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:47:16.185222 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:47:16.360715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:47:16.362175 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:47:16.448098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41ca6421-1c27-40fc-913f-1381c3118766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefbd1700>]}
[0m11:47:16.562599 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:47:16.569111 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:47:16.596726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41ca6421-1c27-40fc-913f-1381c3118766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef886210>]}
[0m11:47:16.598468 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:47:16.598873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41ca6421-1c27-40fc-913f-1381c3118766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef89ec00>]}
[0m11:47:16.609895 [info ] [MainThread]: 
[0m11:47:16.610962 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:47:16.612152 [info ] [MainThread]: 
[0m11:47:16.613144 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:47:16.629075 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m11:47:16.685216 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m11:47:16.686141 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m11:47:16.686522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:47:16.686816 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:47:16.688428 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '41ca6421-1c27-40fc-913f-1381c3118766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3c1ac0>]}
[0m11:52:17.562137 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_122014_00428_aexdp
[0m11:52:17.598025 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_122014_00428_aexdp)
[0m11:52:17.621468 [debug] [ThreadPool]: On list_iceberg: Close
[0m11:52:17.682495 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:52:17.685088 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m11:52:17.695158 [info ] [MainThread]: 
[0m11:52:17.708110 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 1.07 seconds (301.07s).
[0m11:52:17.723449 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_122014_00428_aexdp)
[0m11:52:17.738236 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 303.1488, "process_in_blocks": "327392", "process_kernel_time": 4.745451, "process_mem_max_rss": "276788", "process_out_blocks": "1159", "process_user_time": 7.505325}
[0m11:52:17.743976 [debug] [MainThread]: Command `cli seed` failed at 11:52:17.742501 after 303.16 seconds
[0m11:52:17.750710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff037f260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8a6ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1f62600>]}
[0m11:52:17.755202 [debug] [MainThread]: Flushing usage events
[0m11:52:19.218603 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:52:27.146303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b5c6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c9c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c73200>]}


============================== 11:52:27.187080 | e8082ff7-7f45-490c-a3da-fe1ba916bec6 ==============================
[0m11:52:27.187080 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:52:27.188558 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:52:27.566480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8082ff7-7f45-490c-a3da-fe1ba916bec6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff074d700>]}
[0m11:52:27.691823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8082ff7-7f45-490c-a3da-fe1ba916bec6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1cce0>]}
[0m11:52:27.693282 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:52:28.112101 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:52:28.338168 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:52:28.339238 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:52:28.427907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8082ff7-7f45-490c-a3da-fe1ba916bec6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff13a1c40>]}
[0m11:52:28.559939 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:52:28.564466 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:52:28.580345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8082ff7-7f45-490c-a3da-fe1ba916bec6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef844f50>]}
[0m11:52:28.581360 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:52:28.582500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8082ff7-7f45-490c-a3da-fe1ba916bec6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdbf9b0>]}
[0m11:52:28.585407 [info ] [MainThread]: 
[0m11:52:28.585890 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:52:28.586551 [info ] [MainThread]: 
[0m11:52:28.587526 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:52:28.600869 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m11:52:28.665226 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m11:52:28.665915 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m11:52:28.666508 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:52:28.666908 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:52:28.669789 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e8082ff7-7f45-490c-a3da-fe1ba916bec6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef534320>]}
[0m11:57:29.698208 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_122526_00429_aexdp
[0m11:57:29.702487 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_122526_00429_aexdp)
[0m11:57:29.704945 [debug] [ThreadPool]: On list_iceberg: Close
[0m11:57:29.711399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:29.712191 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m11:57:29.715344 [info ] [MainThread]: 
[0m11:57:29.716683 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 1.13 seconds (301.13s).
[0m11:57:29.721876 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_122526_00429_aexdp)
[0m11:57:29.726917 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 302.68842, "process_in_blocks": "92424", "process_kernel_time": 2.485945, "process_mem_max_rss": "285724", "process_out_blocks": "1159", "process_user_time": 6.825602}
[0m11:57:29.728536 [debug] [MainThread]: Command `cli run` failed at 11:57:29.728236 after 302.69 seconds
[0m11:57:29.730256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff047d2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef851820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00ceb10>]}
[0m11:57:29.731739 [debug] [MainThread]: Flushing usage events
[0m11:57:30.658806 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:57:49.859108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a0ec00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfe60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cda90>]}


============================== 11:57:49.875327 | 010000c2-6efa-4d20-9cda-4982227434fd ==============================
[0m11:57:49.875327 [info ] [MainThread]: Running with dbt=1.10.10
[0m11:57:49.876747 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m11:57:50.158865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '010000c2-6efa-4d20-9cda-4982227434fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017fdd0>]}
[0m11:57:50.276766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '010000c2-6efa-4d20-9cda-4982227434fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b03170>]}
[0m11:57:50.278812 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m11:57:50.751231 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m11:57:50.943653 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:50.944814 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:51.025176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '010000c2-6efa-4d20-9cda-4982227434fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd3ef60>]}
[0m11:57:51.141624 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m11:57:51.150171 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m11:57:51.165247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '010000c2-6efa-4d20-9cda-4982227434fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8450d0>]}
[0m11:57:51.166377 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m11:57:51.168044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '010000c2-6efa-4d20-9cda-4982227434fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023f3e0>]}
[0m11:57:51.171993 [info ] [MainThread]: 
[0m11:57:51.172711 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m11:57:51.173575 [info ] [MainThread]: 
[0m11:57:51.174721 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m11:57:51.183689 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m11:57:51.244754 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m11:57:51.245401 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m11:57:51.245887 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:51.246159 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m11:57:51.247949 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '010000c2-6efa-4d20-9cda-4982227434fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef534920>]}
[0m12:02:51.606586 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_123049_00430_aexdp
[0m12:02:51.611709 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_123049_00430_aexdp)
[0m12:02:51.614858 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:02:51.622216 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:02:51.623015 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m12:02:51.625853 [info ] [MainThread]: 
[0m12:02:51.630027 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.45 seconds (300.45s).
[0m12:02:51.632344 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_123049_00430_aexdp)
[0m12:02:51.636284 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.87735, "process_in_blocks": "61320", "process_kernel_time": 1.120357, "process_mem_max_rss": "285784", "process_out_blocks": "1159", "process_user_time": 4.454852}
[0m12:02:51.637962 [debug] [MainThread]: Command `cli run` failed at 12:02:51.637646 after 301.88 seconds
[0m12:02:51.639730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff103e9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81b920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef851820>]}
[0m12:02:51.640981 [debug] [MainThread]: Flushing usage events
[0m12:02:52.712216 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:03:10.567495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff050dac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff050e360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a12c90>]}


============================== 12:03:10.583645 | 83aa656f-c483-4579-8153-440a3760ba1c ==============================
[0m12:03:10.583645 [info ] [MainThread]: Running with dbt=1.10.10
[0m12:03:10.585244 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m12:03:10.846313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83aa656f-c483-4579-8153-440a3760ba1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff1ce90>]}
[0m12:03:10.917375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83aa656f-c483-4579-8153-440a3760ba1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00ceea0>]}
[0m12:03:10.918173 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m12:03:11.170864 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m12:03:11.308466 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:03:11.309474 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:03:11.377870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83aa656f-c483-4579-8153-440a3760ba1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcd6960>]}
[0m12:03:11.498583 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m12:03:11.501320 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m12:03:11.511409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83aa656f-c483-4579-8153-440a3760ba1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83cda0>]}
[0m12:03:11.512391 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m12:03:11.514055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83aa656f-c483-4579-8153-440a3760ba1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef84d820>]}
[0m12:03:11.516431 [info ] [MainThread]: 
[0m12:03:11.516824 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m12:03:11.517391 [info ] [MainThread]: 
[0m12:03:11.518175 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m12:03:11.525348 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m12:03:11.552203 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m12:03:11.552673 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m12:03:11.552954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:03:11.553198 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m12:03:11.554427 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '83aa656f-c483-4579-8153-440a3760ba1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef531460>]}
[0m12:08:11.649856 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_123609_00431_aexdp
[0m12:08:11.655126 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_123609_00431_aexdp)
[0m12:08:11.657819 [debug] [ThreadPool]: On list_iceberg: Close
[0m12:08:11.666698 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:08:11.668111 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m12:08:11.670779 [info ] [MainThread]: 
[0m12:08:11.674265 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.15 seconds (300.15s).
[0m12:08:11.676659 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_123609_00431_aexdp)
[0m12:08:11.680741 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.1963, "process_in_blocks": "62152", "process_kernel_time": 0.719034, "process_mem_max_rss": "285692", "process_out_blocks": "1159", "process_user_time": 3.914964}
[0m12:08:11.682335 [debug] [MainThread]: Command `cli run` failed at 12:08:11.682064 after 301.20 seconds
[0m12:08:11.683914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef84d6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd3e840>]}
[0m12:08:11.685003 [debug] [MainThread]: Flushing usage events
[0m12:08:12.654508 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:11:24.901391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a0bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0018b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff001aa50>]}


============================== 10:11:24.938969 | fbb4d5b4-ab43-4539-b01f-fc44076495d6 ==============================
[0m10:11:24.938969 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:11:24.940150 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:11:25.289301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbb4d5b4-ab43-4539-b01f-fc44076495d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0779af0>]}
[0m10:11:25.364674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fbb4d5b4-ab43-4539-b01f-fc44076495d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00a4980>]}
[0m10:11:25.365648 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:11:25.755276 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:11:25.893811 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:11:25.894937 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:11:25.955940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fbb4d5b4-ab43-4539-b01f-fc44076495d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefbd6630>]}
[0m10:11:26.060842 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:11:26.064587 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:11:26.078676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fbb4d5b4-ab43-4539-b01f-fc44076495d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef886390>]}
[0m10:11:26.080121 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:11:26.081518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbb4d5b4-ab43-4539-b01f-fc44076495d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef89ad50>]}
[0m10:11:26.085313 [info ] [MainThread]: 
[0m10:11:26.085898 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:11:26.086239 [info ] [MainThread]: 
[0m10:11:26.087108 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:11:26.096132 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:11:26.135050 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:11:26.135514 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:11:26.135813 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:11:26.136065 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:11:26.137371 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'fbb4d5b4-ab43-4539-b01f-fc44076495d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefbd5fa0>]}
[0m10:16:26.352790 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_173155_00433_aexdp
[0m10:16:26.356330 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_173155_00433_aexdp)
[0m10:16:26.358310 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:16:26.366224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:16:26.367379 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:16:26.370591 [info ] [MainThread]: 
[0m10:16:26.373926 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.28 seconds (300.28s).
[0m10:16:26.375801 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_173155_00433_aexdp)
[0m10:16:26.380000 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 301.81396, "process_in_blocks": "71160", "process_kernel_time": 3.022027, "process_mem_max_rss": "285268", "process_out_blocks": "1159", "process_user_time": 8.524105}
[0m10:16:26.381443 [debug] [MainThread]: Command `cli seed` failed at 10:16:26.381183 after 301.82 seconds
[0m10:16:26.382671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c0a570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef89afc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8a3ce0>]}
[0m10:16:26.383595 [debug] [MainThread]: Flushing usage events
[0m10:16:26.940135 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:16:30.398772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a2c0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cffe0>]}


============================== 10:16:30.410649 | ca4673ca-2841-471e-8302-26cbf2460dab ==============================
[0m10:16:30.410649 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:16:30.411414 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:16:30.633002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca4673ca-2841-471e-8302-26cbf2460dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff077a660>]}
[0m10:16:30.697734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca4673ca-2841-471e-8302-26cbf2460dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00cecc0>]}
[0m10:16:30.698489 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:16:30.936610 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:16:31.062318 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:16:31.063092 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:16:31.124604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca4673ca-2841-471e-8302-26cbf2460dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcf30b0>]}
[0m10:16:31.212681 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:16:31.215230 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:16:31.224145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca4673ca-2841-471e-8302-26cbf2460dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef844e00>]}
[0m10:16:31.224966 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:16:31.225573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca4673ca-2841-471e-8302-26cbf2460dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef850f80>]}
[0m10:16:31.227556 [info ] [MainThread]: 
[0m10:16:31.228092 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:16:31.228505 [info ] [MainThread]: 
[0m10:16:31.229273 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:16:31.235662 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:16:31.259650 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:16:31.260070 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:16:31.260355 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:16:31.260592 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:16:31.261697 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'ca4673ca-2841-471e-8302-26cbf2460dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5342c0>]}
[0m10:21:31.398605 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_173700_00434_aexdp
[0m10:21:31.401242 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_173700_00434_aexdp)
[0m10:21:31.402924 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:21:31.407218 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:21:31.407710 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:21:31.409392 [info ] [MainThread]: 
[0m10:21:31.412195 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.18 seconds (300.18s).
[0m10:21:31.413696 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_173700_00434_aexdp)
[0m10:21:31.415991 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.0765, "process_in_blocks": "62152", "process_kernel_time": 0.787342, "process_mem_max_rss": "285560", "process_out_blocks": "1159", "process_user_time": 3.775127}
[0m10:21:31.417149 [debug] [MainThread]: Command `cli run` failed at 10:21:31.416914 after 301.08 seconds
[0m10:21:31.418182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017f800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00ceea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef851910>]}
[0m10:21:31.418966 [debug] [MainThread]: Flushing usage events
[0m10:21:31.900564 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:21:49.586226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff069b710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0699490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0699460>]}


============================== 10:21:49.596302 | 162f3d38-9014-4a4e-998f-24b0fbb1517a ==============================
[0m10:21:49.596302 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:21:49.597266 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:21:49.777282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '162f3d38-9014-4a4e-998f-24b0fbb1517a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc3770>]}
[0m10:21:49.841249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '162f3d38-9014-4a4e-998f-24b0fbb1517a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcfed80>]}
[0m10:21:49.841925 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:21:50.070384 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:21:50.185314 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:21:50.186051 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:21:50.280385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '162f3d38-9014-4a4e-998f-24b0fbb1517a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd729c0>]}
[0m10:21:50.402237 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:21:50.404611 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:21:50.413260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '162f3d38-9014-4a4e-998f-24b0fbb1517a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8172f0>]}
[0m10:21:50.414017 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:21:50.414618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '162f3d38-9014-4a4e-998f-24b0fbb1517a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023faa0>]}
[0m10:21:50.416783 [info ] [MainThread]: 
[0m10:21:50.417148 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:21:50.417447 [info ] [MainThread]: 
[0m10:21:50.418288 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:21:50.424641 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:21:50.449936 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:21:50.450495 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:21:50.450833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:21:50.451115 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:21:50.452263 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '162f3d38-9014-4a4e-998f-24b0fbb1517a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef865550>]}
[0m10:26:50.658519 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_174220_00435_aexdp
[0m10:26:50.661885 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_174220_00435_aexdp)
[0m10:26:50.663718 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:26:50.668900 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:26:50.669486 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:26:50.671232 [info ] [MainThread]: 
[0m10:26:50.674784 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.25 seconds (300.25s).
[0m10:26:50.676285 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_174220_00435_aexdp)
[0m10:26:50.679343 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.15656, "process_in_blocks": "61608", "process_kernel_time": 0.491183, "process_mem_max_rss": "285584", "process_out_blocks": "1159", "process_user_time": 3.305426}
[0m10:26:50.680383 [debug] [MainThread]: Command `cli run` failed at 10:26:50.680166 after 301.16 seconds
[0m10:26:50.681552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017f2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef865e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef815cd0>]}
[0m10:26:50.682368 [debug] [MainThread]: Flushing usage events
[0m10:26:51.153443 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:27:09.511670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017e990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017c3e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017c470>]}


============================== 10:27:09.522418 | d8cedfd2-6adc-4335-b9d3-d6395a59700f ==============================
[0m10:27:09.522418 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:27:09.523554 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:27:09.723498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8cedfd2-6adc-4335-b9d3-d6395a59700f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0001a90>]}
[0m10:27:09.789975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8cedfd2-6adc-4335-b9d3-d6395a59700f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c64650>]}
[0m10:27:09.790746 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:27:10.036851 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:27:10.159575 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:27:10.160350 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:27:10.221078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8cedfd2-6adc-4335-b9d3-d6395a59700f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd3f980>]}
[0m10:27:10.316966 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:27:10.319691 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:27:10.330962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8cedfd2-6adc-4335-b9d3-d6395a59700f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef845520>]}
[0m10:27:10.331931 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:27:10.332587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8cedfd2-6adc-4335-b9d3-d6395a59700f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0699b80>]}
[0m10:27:10.335290 [info ] [MainThread]: 
[0m10:27:10.336003 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:27:10.336453 [info ] [MainThread]: 
[0m10:27:10.337219 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:27:10.344915 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:27:10.372709 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:27:10.373249 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:27:10.373568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:27:10.373825 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:27:10.375172 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'd8cedfd2-6adc-4335-b9d3-d6395a59700f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef534500>]}
[0m10:32:10.563359 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_174740_00436_aexdp
[0m10:32:10.566214 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_174740_00436_aexdp)
[0m10:32:10.567922 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:32:10.572131 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:32:10.573648 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:32:10.575145 [info ] [MainThread]: 
[0m10:32:10.578980 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.24 seconds (300.24s).
[0m10:32:10.580536 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_174740_00436_aexdp)
[0m10:32:10.583487 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.1327, "process_in_blocks": "61640", "process_kernel_time": 0.631082, "process_mem_max_rss": "285404", "process_out_blocks": "1159", "process_user_time": 3.975213}
[0m10:32:10.584744 [debug] [MainThread]: Command `cli run` failed at 10:32:10.584513 after 301.13 seconds
[0m10:32:10.585895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01c2a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcd4350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe2d160>]}
[0m10:32:10.586716 [debug] [MainThread]: Flushing usage events
[0m10:32:11.055868 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:37:26.232050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1de85f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022ab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022bbf0>]}


============================== 10:37:26.257535 | ed613826-674a-45db-9d11-b2dd481624a4 ==============================
[0m10:37:26.257535 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:37:26.259482 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'None', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:37:26.462504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ed613826-674a-45db-9d11-b2dd481624a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0209bb0>]}
[0m10:37:26.528496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ed613826-674a-45db-9d11-b2dd481624a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c12bd0>]}
[0m10:37:26.529343 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:37:26.861048 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:37:26.987351 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:37:26.988325 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:37:27.047489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ed613826-674a-45db-9d11-b2dd481624a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdb2000>]}
[0m10:37:27.134594 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:37:27.144501 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:37:27.162058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ed613826-674a-45db-9d11-b2dd481624a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8a27e0>]}
[0m10:37:27.163215 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:37:27.163558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ed613826-674a-45db-9d11-b2dd481624a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef88b290>]}
[0m10:37:27.167396 [info ] [MainThread]: 
[0m10:37:27.168072 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:37:27.168571 [info ] [MainThread]: 
[0m10:37:27.169356 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:37:27.177798 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:37:27.207559 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:37:27.207990 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:37:27.208280 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:37:27.208520 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:37:27.209766 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'ed613826-674a-45db-9d11-b2dd481624a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefab2a20>]}
[0m10:42:27.343646 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_175756_00438_aexdp
[0m10:42:27.350532 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_175756_00438_aexdp)
[0m10:42:27.352689 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:42:27.357634 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:42:27.358644 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:42:27.360668 [info ] [MainThread]: 
[0m10:42:27.361579 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.19 seconds (300.19s).
[0m10:42:27.371486 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_175756_00438_aexdp)
[0m10:42:27.376318 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 301.2309, "process_in_blocks": "144168", "process_kernel_time": 1.68919, "process_mem_max_rss": "285364", "process_out_blocks": "1159", "process_user_time": 7.024345}
[0m10:42:27.377554 [debug] [MainThread]: Command `cli seed` failed at 10:42:27.377337 after 301.23 seconds
[0m10:42:27.378633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0309e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca8050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef88b590>]}
[0m10:42:27.379486 [debug] [MainThread]: Flushing usage events
[0m10:42:27.870501 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:42:30.777446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f1f440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09a6db0>]}


============================== 10:42:30.787041 | cd7e0064-ac27-4368-bac7-432f767b89a5 ==============================
[0m10:42:30.787041 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:42:30.788065 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:42:31.006347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd7e0064-ac27-4368-bac7-432f767b89a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff20740>]}
[0m10:42:31.081284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd7e0064-ac27-4368-bac7-432f767b89a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff072ce30>]}
[0m10:42:31.082104 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:42:31.321979 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:42:31.447048 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:42:31.447903 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:42:31.511366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd7e0064-ac27-4368-bac7-432f767b89a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd745c0>]}
[0m10:42:31.598037 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:42:31.600410 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:42:31.609620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd7e0064-ac27-4368-bac7-432f767b89a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8172f0>]}
[0m10:42:31.610527 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:42:31.611524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd7e0064-ac27-4368-bac7-432f767b89a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef842a80>]}
[0m10:42:31.613563 [info ] [MainThread]: 
[0m10:42:31.614082 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:42:31.614495 [info ] [MainThread]: 
[0m10:42:31.615239 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:42:31.621713 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:42:31.646634 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:42:31.647077 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:42:31.647380 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:31.647634 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:42:31.648883 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'cd7e0064-ac27-4368-bac7-432f767b89a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef86b800>]}
[0m10:47:31.796191 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_180301_00439_aexdp
[0m10:47:31.798874 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_180301_00439_aexdp)
[0m10:47:31.800567 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:47:31.804966 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:47:31.805543 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:47:31.807034 [info ] [MainThread]: 
[0m10:47:31.808062 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.19 seconds (300.19s).
[0m10:47:31.809895 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_180301_00439_aexdp)
[0m10:47:31.812119 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.0931, "process_in_blocks": "61320", "process_kernel_time": 0.590008, "process_mem_max_rss": "285632", "process_out_blocks": "1159", "process_user_time": 3.43753}
[0m10:47:31.813122 [debug] [MainThread]: Command `cli run` failed at 10:47:31.812900 after 301.09 seconds
[0m10:47:31.814077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b6cad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef843c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef69a720>]}
[0m10:47:31.814811 [debug] [MainThread]: Flushing usage events
[0m10:47:32.292397 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:47:49.098863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f1b290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff050dd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b70bc0>]}


============================== 10:47:49.109924 | 00772405-1323-4abb-b8f7-6faef89c3766 ==============================
[0m10:47:49.109924 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:47:49.110818 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:47:49.312438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '00772405-1323-4abb-b8f7-6faef89c3766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff017ffe0>]}
[0m10:47:49.376070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '00772405-1323-4abb-b8f7-6faef89c3766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a7a900>]}
[0m10:47:49.376690 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:47:49.593819 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:47:49.710949 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:47:49.711596 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:47:49.770496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '00772405-1323-4abb-b8f7-6faef89c3766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd721b0>]}
[0m10:47:49.855152 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:47:49.858513 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:47:49.881271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '00772405-1323-4abb-b8f7-6faef89c3766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8450a0>]}
[0m10:47:49.882916 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:47:49.884175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00772405-1323-4abb-b8f7-6faef89c3766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef851070>]}
[0m10:47:49.887398 [info ] [MainThread]: 
[0m10:47:49.888319 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:47:49.888993 [info ] [MainThread]: 
[0m10:47:49.890130 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:47:49.899144 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:47:49.932136 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:47:49.932578 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:47:49.932871 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:47:49.933138 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:47:49.934306 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '00772405-1323-4abb-b8f7-6faef89c3766', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcf3110>]}
[0m10:52:50.049242 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_180819_00440_aexdp
[0m10:52:50.056615 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_180819_00440_aexdp)
[0m10:52:50.061420 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:52:50.071219 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:52:50.071924 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:52:50.073663 [info ] [MainThread]: 
[0m10:52:50.074752 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.18 seconds (300.18s).
[0m10:52:50.078080 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_180819_00440_aexdp)
[0m10:52:50.080658 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 301.03842, "process_in_blocks": "65488", "process_kernel_time": 0.562682, "process_mem_max_rss": "285548", "process_out_blocks": "1159", "process_user_time": 3.205368}
[0m10:52:50.081823 [debug] [MainThread]: Command `cli run` failed at 10:52:50.081578 after 301.04 seconds
[0m10:52:50.084287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff050dd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef851a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef6a0230>]}
[0m10:52:50.086648 [debug] [MainThread]: Flushing usage events
[0m10:52:50.576006 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:53:07.946657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfa40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cd8e0>]}


============================== 10:53:07.956163 | b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a ==============================
[0m10:53:07.956163 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:53:07.957272 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'fail_fast': 'False', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:53:08.137883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c8bef0>]}
[0m10:53:08.201499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05f9310>]}
[0m10:53:08.202126 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:53:08.422573 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:53:08.535572 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:53:08.536267 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:53:08.600591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe2ff20>]}
[0m10:53:08.685683 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:53:08.687758 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:53:08.697986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef845070>]}
[0m10:53:08.698744 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:53:08.699609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef851070>]}
[0m10:53:08.701508 [info ] [MainThread]: 
[0m10:53:08.702017 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:53:08.702450 [info ] [MainThread]: 
[0m10:53:08.703165 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:53:08.709369 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:53:08.732359 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:53:08.732748 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:53:08.733024 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:53:08.733254 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:53:08.734267 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'b83e4b47-3b7a-4efe-b98c-6e1cb6a1863a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef535580>]}
[0m10:58:08.856046 [debug] [ThreadPool]: Trino adapter: Trino query id: 20250923_181338_00441_aexdp
[0m10:58:08.859017 [debug] [ThreadPool]: Trino adapter: Trino error: TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_181338_00441_aexdp)
[0m10:58:08.860997 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:58:08.866358 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:58:08.866955 [debug] [MainThread]: Connection 'list_iceberg' was properly closed.
[0m10:58:08.868680 [info ] [MainThread]: 
[0m10:58:08.869794 [info ] [MainThread]: Finished running  in 0 hours 5 minutes and 0.16 seconds (300.16s).
[0m10:58:08.872439 [error] [MainThread]: Encountered an error:
Database Error
  TrinoQueryError(type=INSUFFICIENT_RESOURCES, name=GENERIC_INSUFFICIENT_RESOURCES, message="Insufficient active worker nodes. Waited 5.00m for at least 1 workers, but only 0 workers are active", query_id=20250923_181338_00441_aexdp)
[0m10:58:08.875295 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 300.99155, "process_in_blocks": "62664", "process_kernel_time": 0.489732, "process_mem_max_rss": "285716", "process_out_blocks": "1159", "process_user_time": 3.250131}
[0m10:58:08.876575 [debug] [MainThread]: Command `cli run` failed at 10:58:08.876342 after 300.99 seconds
[0m10:58:08.877755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06cfaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0fc1c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8519d0>]}
[0m10:58:08.878621 [debug] [MainThread]: Flushing usage events
[0m10:58:09.344617 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:57:54.533025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0471ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03372f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c30e0>]}


============================== 14:57:54.556285 | 7a8ad78c-0f6d-4ec2-9e10-452826523950 ==============================
[0m14:57:54.556285 [info ] [MainThread]: Running with dbt=1.10.10
[0m14:57:54.558187 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m14:57:54.985990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff21e50>]}
[0m14:57:55.086123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0300ec0>]}
[0m14:57:55.087478 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m14:57:55.659114 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m14:57:55.931764 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:57:55.935976 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:57:56.048240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefbeb7a0>]}
[0m14:57:56.415894 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m14:57:56.422609 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m14:57:56.474283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8a2000>]}
[0m14:57:56.480505 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m14:57:56.482980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef6be840>]}
[0m14:57:56.492130 [info ] [MainThread]: 
[0m14:57:56.494651 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m14:57:56.497834 [info ] [MainThread]: 
[0m14:57:56.502061 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:57:56.521785 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m14:57:56.595797 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m14:57:56.597694 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m14:57:56.601447 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:57:56.602219 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m14:57:56.605467 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefbe9310>]}
[0m14:58:03.515465 [debug] [ThreadPool]: SQL status: SUCCESS in 6.910 seconds
[0m14:58:03.535587 [debug] [ThreadPool]: On list_iceberg: Close
[0m14:58:03.546456 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_bronze)
[0m14:58:03.549524 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "bronze"
"
[0m14:58:03.571461 [debug] [ThreadPool]: Using trino connection "create_iceberg_bronze"
[0m14:58:03.572852 [debug] [ThreadPool]: On create_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_bronze"} */
create schema if not exists "iceberg"."bronze"
[0m14:58:03.574787 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:05.103919 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 1.528 seconds
[0m14:58:05.110514 [debug] [ThreadPool]: On create_iceberg_bronze: COMMIT
[0m14:58:05.111922 [debug] [ThreadPool]: On create_iceberg_bronze: Close
[0m14:58:05.121712 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_bronze, now list_iceberg_gold)
[0m14:58:05.166209 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m14:58:05.167590 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m14:58:05.168153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:11.241248 [debug] [ThreadPool]: SQL status: SUCCESS in 6.071 seconds
[0m14:58:11.261226 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m14:58:11.262332 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m14:58:11.274985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m14:58:11.288222 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m14:58:11.289722 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m14:58:11.290575 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:13.052150 [debug] [ThreadPool]: SQL status: SUCCESS in 1.760 seconds
[0m14:58:13.058229 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m14:58:13.059468 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m14:58:13.062238 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m14:58:13.076120 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m14:58:13.076726 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m14:58:13.077108 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:13.886007 [debug] [ThreadPool]: SQL status: SUCCESS in 0.809 seconds
[0m14:58:13.889857 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m14:58:13.891343 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m14:58:13.898101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef6beed0>]}
[0m14:58:13.906888 [debug] [MainThread]: On master: COMMIT
[0m14:58:13.982788 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m14:58:13.984033 [info ] [Thread-1 (]: 1 of 4 START seed file bronze.raw_customer_events .............................. [RUN]
[0m14:58:13.986764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m14:58:13.987360 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m14:58:13.990349 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m14:58:15.197692 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:58:15.199172 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_customer_events"} */

    create table "iceberg"."bronze"."raw_customer_events" ("event_id" VARCHAR,"customer_id" VARCHAR,"session_id" VARCHAR,"event_type" VARCHAR,"event_timestamp" TIMESTAMP,"page_url" VARCHAR,"product_id" VARCHAR,"category_id" VARCHAR,"referrer_source" VARCHAR,"device_type" VARCHAR,"user_agent" VARCHAR,"ip_address" VARCHAR)
[0m14:58:15.199622 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:58:17.682859 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 2.482 seconds
[0m14:58:20.017620 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:58:20.019370 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:58:40.310139 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 20.288 seconds
[0m14:58:43.570837 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:58:43.583931 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:58:53.596137 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 10.009 seconds
[0m14:58:54.729426 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:58:54.730059 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:59:03.367675 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 8.635 seconds
[0m14:59:04.985129 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:59:04.986040 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:59:11.365913 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.378 seconds
[0m14:59:12.714473 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:59:12.715375 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:59:28.306585 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 15.588 seconds
[0m14:59:29.867166 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:59:29.869727 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:59:36.338871 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.467 seconds
[0m14:59:37.754548 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:59:37.755955 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:59:44.877089 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.119 seconds
[0m14:59:46.842331 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m14:59:46.843524 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m14:59:56.575587 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 9.730 seconds
[0m15:00:00.213199 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m15:00:00.364978 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m15:00:10.424937 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 10.056 seconds
[0m15:00:11.582729 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m15:00:11.583835 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m15:00:19.417914 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.832 seconds
[0m15:00:20.820516 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m15:00:20.821257 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m15:00:28.565231 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.739 seconds
[0m15:00:30.281620 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_customer_events"
[0m15:00:30.282566 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: insert into "iceberg"."bronze"."raw_customer_events" ("event_id", "customer_id", "session_id", "event_type", "event_timestamp", "page_url", "product_id", "category_id", "referrer_source", "device_type", "user_agent", "ip_address") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?...
[0m15:00:39.697062 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 9.411 seconds
[0m15:00:39.724082 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_customer_events"
[0m15:00:39.827046 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: COMMIT
[0m15:00:39.847876 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_customer_events: Close
[0m15:00:39.867751 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd901a0>]}
[0m15:00:39.871796 [info ] [Thread-1 (]: 1 of 4 OK loaded seed file bronze.raw_customer_events .......................... [[32mCREATE 12000[0m in 145.86s]
[0m15:00:39.879500 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m15:00:39.883076 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:00:39.884565 [info ] [Thread-1 (]: 2 of 4 START seed file bronze.raw_inventory_snapshots .......................... [RUN]
[0m15:00:39.886525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m15:00:39.889026 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:00:39.890658 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:00:41.381686 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:00:41.384697 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_inventory_snapshots"} */

    create table "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id" VARCHAR,"product_id" VARCHAR,"warehouse_id" VARCHAR,"snapshot_date" DATE,"quantity_on_hand" INTEGER,"quantity_reserved" INTEGER,"quantity_available" INTEGER,"reorder_point" INTEGER,"reorder_quantity" INTEGER,"supplier_id" VARCHAR,"last_received_date" DATE,"unit_cost" DOUBLE)
[0m15:00:41.385950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:42.510726 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 1.123 seconds
[0m15:00:46.279003 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:00:46.282951 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:00:58.851281 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 12.553 seconds
[0m15:01:01.184683 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:01.191618 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:06.457976 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.263 seconds
[0m15:01:08.468650 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:08.469532 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:11.751266 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.280 seconds
[0m15:01:13.012303 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:13.013368 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:17.699888 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.684 seconds
[0m15:01:19.895723 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:19.897680 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:24.863654 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.964 seconds
[0m15:01:26.379617 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:26.380613 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:34.990649 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 8.605 seconds
[0m15:01:37.473699 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:37.475458 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:43.746744 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.259 seconds
[0m15:01:44.954175 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:44.955039 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:49.451863 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.495 seconds
[0m15:01:50.779426 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:01:50.780316 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:01:58.047303 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.259 seconds
[0m15:02:01.495164 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:02:01.501288 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: insert into "iceberg"."bronze"."raw_inventory_snapshots" ("snapshot_id", "product_id", "warehouse_id", "snapshot_date", "quantity_on_hand", "quantity_reserved", "quantity_available", "reorder_point", "reorder_quantity", "supplier_id", "last_received_date", "unit_cost") values
          (?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,...
[0m15:02:06.155861 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.649 seconds
[0m15:02:06.173481 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_inventory_snapshots"
[0m15:02:06.196052 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: COMMIT
[0m15:02:06.201277 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_inventory_snapshots: Close
[0m15:02:06.209932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeefd95e0>]}
[0m15:02:06.216451 [info ] [Thread-1 (]: 2 of 4 OK loaded seed file bronze.raw_inventory_snapshots ...................... [[32mCREATE 10000[0m in 86.32s]
[0m15:02:06.219791 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:02:06.221766 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:02:06.226481 [info ] [Thread-1 (]: 3 of 4 START seed file bronze.raw_payment_transactions ......................... [RUN]
[0m15:02:06.227816 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m15:02:06.229266 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m15:02:06.230699 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m15:02:08.079194 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:08.081319 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_payment_transactions"} */

    create table "iceberg"."bronze"."raw_payment_transactions" ("transaction_id" VARCHAR,"order_id" VARCHAR,"customer_id" VARCHAR,"payment_method" VARCHAR,"payment_status" VARCHAR,"amount" DOUBLE,"currency" VARCHAR,"transaction_timestamp" TIMESTAMP,"processor_response_code" INTEGER,"gateway_fee" DOUBLE,"merchant_id" VARCHAR,"billing_country" VARCHAR,"risk_score" INTEGER)
[0m15:02:08.081904 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:08.802808 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.721 seconds
[0m15:02:10.355139 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:10.357482 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:02:14.922729 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.563 seconds
[0m15:02:16.591339 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:16.593678 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:02:21.567644 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.972 seconds
[0m15:02:23.313525 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:23.314893 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:02:43.129906 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 19.784 seconds
[0m15:02:44.550985 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:44.551819 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:02:51.620150 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.063 seconds
[0m15:02:53.031752 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:53.033151 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:02:57.025350 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.990 seconds
[0m15:02:58.098698 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:02:58.099374 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:06.455199 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 8.353 seconds
[0m15:03:09.043900 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:09.044909 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:18.900613 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 9.846 seconds
[0m15:03:21.269395 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:21.275255 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:26.849919 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.569 seconds
[0m15:03:27.968044 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:27.969713 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:32.527281 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.555 seconds
[0m15:03:33.771167 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:33.772020 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:38.163832 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.389 seconds
[0m15:03:41.319292 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:41.320566 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:44.407091 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.084 seconds
[0m15:03:45.558573 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:45.559200 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:03:49.276370 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.715 seconds
[0m15:03:50.418833 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:03:50.419968 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:04:15.477961 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 25.001 seconds
[0m15:04:16.912393 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:04:16.914051 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:04:23.429708 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.511 seconds
[0m15:04:30.955210 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:04:30.958019 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: insert into "iceberg"."bronze"."raw_payment_transactions" ("transaction_id", "order_id", "customer_id", "payment_method", "payment_status", "amount", "currency", "transaction_timestamp", "processor_response_code", "gateway_fee", "merchant_id", "billing_country", "risk_score") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?...
[0m15:04:45.474681 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 14.499 seconds
[0m15:04:45.537918 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_payment_transactions"
[0m15:04:45.594043 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: COMMIT
[0m15:04:45.600414 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_payment_transactions: Close
[0m15:04:45.619662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4114bf0>]}
[0m15:04:45.632799 [info ] [Thread-1 (]: 3 of 4 OK loaded seed file bronze.raw_payment_transactions ..................... [[32mCREATE 15000[0m in 159.39s]
[0m15:04:45.640917 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:04:45.646744 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m15:04:45.652902 [info ] [Thread-1 (]: 4 of 4 START seed file bronze.raw_support_tickets .............................. [RUN]
[0m15:04:45.655246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m15:04:45.655911 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m15:04:45.656498 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m15:04:46.508204 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:04:46.510027 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "seed.ecommerce_dbt.raw_support_tickets"} */

    create table "iceberg"."bronze"."raw_support_tickets" ("ticket_id" VARCHAR,"customer_id" VARCHAR,"order_id" VARCHAR,"ticket_type" VARCHAR,"priority" VARCHAR,"status" VARCHAR,"created_timestamp" TIMESTAMP,"first_response_timestamp" TIMESTAMP,"resolution_timestamp" TIMESTAMP,"agent_id" VARCHAR,"satisfaction_score" INTEGER,"subject" VARCHAR,"channel" VARCHAR)
[0m15:04:46.510826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:04:47.133809 [debug] [Thread-1 (]: SQL status: CREATE TABLE in 0.622 seconds
[0m15:04:48.693714 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:04:48.694702 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:04:52.196717 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.500 seconds
[0m15:04:53.302343 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:04:53.303292 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:04:56.946257 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 3.641 seconds
[0m15:04:58.675089 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:04:58.676754 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:05:03.935038 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 5.256 seconds
[0m15:05:05.124301 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:05:05.125664 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:05:15.134538 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 9.996 seconds
[0m15:05:17.727018 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:05:17.739850 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:05:25.385002 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 7.633 seconds
[0m15:05:26.545180 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:05:26.545972 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:05:31.497102 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 4.949 seconds
[0m15:05:33.933071 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:05:33.935824 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:05:40.028460 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 6.090 seconds
[0m15:05:41.814527 [debug] [Thread-1 (]: Using trino connection "seed.ecommerce_dbt.raw_support_tickets"
[0m15:05:41.821590 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: insert into "iceberg"."bronze"."raw_support_tickets" ("ticket_id", "customer_id", "order_id", "ticket_type", "priority", "status", "created_timestamp", "first_response_timestamp", "resolution_timestamp", "agent_id", "satisfaction_score", "subject", "channel") values
          (?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,?,?,?,?,?,?,?,?),(?,?,?,?,?,...
[0m15:05:49.923217 [debug] [Thread-1 (]: SQL status: INSERT (1_000 rows) in 8.095 seconds
[0m15:05:49.940683 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.ecommerce_dbt.raw_support_tickets"
[0m15:05:49.956827 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: COMMIT
[0m15:05:49.962247 [debug] [Thread-1 (]: On seed.ecommerce_dbt.raw_support_tickets: Close
[0m15:05:49.969001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a8ad78c-0f6d-4ec2-9e10-452826523950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffc6f59640>]}
[0m15:05:49.974678 [info ] [Thread-1 (]: 4 of 4 OK loaded seed file bronze.raw_support_tickets .......................... [[32mCREATE 8000[0m in 64.31s]
[0m15:05:49.979615 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m15:05:50.024618 [debug] [MainThread]: On master: COMMIT
[0m15:05:50.026363 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:05:50.026851 [debug] [MainThread]: Connection 'seed.ecommerce_dbt.raw_support_tickets' was properly closed.
[0m15:05:50.038233 [info ] [MainThread]: 
[0m15:05:50.040507 [info ] [MainThread]: Finished running 4 seeds in 0 hours 7 minutes and 53.53 seconds (473.53s).
[0m15:05:50.057041 [debug] [MainThread]: Command end result
[0m15:05:50.100309 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:05:50.129371 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:05:50.192122 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:05:50.192628 [info ] [MainThread]: 
[0m15:05:50.194616 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:05:50.195141 [info ] [MainThread]: 
[0m15:05:50.196892 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:05:50.206732 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 475.7684, "process_in_blocks": "1581952", "process_kernel_time": 7.87306, "process_mem_max_rss": "348272", "process_out_blocks": "6496", "process_user_time": 98.69167}
[0m15:05:50.208252 [debug] [MainThread]: Command `cli seed` succeeded at 15:05:50.208111 after 475.78 seconds
[0m15:05:50.209419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08b8d40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0456e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06991f0>]}
[0m15:05:50.210044 [debug] [MainThread]: Flushing usage events
[0m15:05:50.974952 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:06:00.232085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09322a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff10a6810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e0230>]}


============================== 15:06:00.394382 | cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6 ==============================
[0m15:06:00.394382 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:06:00.398189 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'empty': 'False', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'no_print': 'None', 'partial_parse': 'True'}
[0m15:06:00.881650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff067ef60>]}
[0m15:06:01.008515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00adca0>]}
[0m15:06:01.010793 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:06:01.493035 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:06:01.672062 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:06:01.673251 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:06:01.752235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd135f0>]}
[0m15:06:01.858946 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:06:01.863116 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:06:01.884123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ef5c0>]}
[0m15:06:01.885187 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:06:01.885904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00adca0>]}
[0m15:06:01.890442 [info ] [MainThread]: 
[0m15:06:01.891090 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:06:01.891661 [info ] [MainThread]: 
[0m15:06:01.892917 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:06:01.910751 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:06:01.960686 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:06:01.961301 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:06:01.961623 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:01.961901 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:06:01.963253 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef803fe0>]}
[0m15:06:04.822792 [debug] [ThreadPool]: SQL status: SUCCESS in 2.858 seconds
[0m15:06:04.830073 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:06:04.849545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:06:04.878430 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:06:04.879132 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:06:04.879545 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:07.306627 [debug] [ThreadPool]: SQL status: SUCCESS in 2.422 seconds
[0m15:06:07.316088 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:06:07.317012 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:06:07.319462 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:06:07.337790 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:06:07.338578 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:06:07.339070 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:08.816861 [debug] [ThreadPool]: SQL status: SUCCESS in 1.478 seconds
[0m15:06:08.819313 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:06:08.819787 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:06:08.820894 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:06:08.827599 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:06:08.828138 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:06:08.828464 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:09.249884 [debug] [ThreadPool]: SQL status: SUCCESS in 0.421 seconds
[0m15:06:09.253603 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:06:09.254128 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:06:09.256836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd13140>]}
[0m15:06:09.259223 [debug] [MainThread]: On master: COMMIT
[0m15:06:09.270936 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:06:09.272685 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m15:06:09.276501 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m15:06:09.277283 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:06:09.286041 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:06:09.287678 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:06:09.336914 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:06:09.340142 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:06:09.341051 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m15:06:09.341533 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:06:32.582703 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 23.207 seconds
[0m15:06:32.829205 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m15:06:32.836003 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m15:06:32.881261 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1d640>]}
[0m15:06:32.895254 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 23.57s]
[0m15:06:32.905108 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:06:32.912155 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:06:32.918624 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m15:06:32.921064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:06:32.922233 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:06:32.952986 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:06:32.957084 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:06:32.968249 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:06:32.985746 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:06:32.987971 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m15:06:32.993360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:06:40.308092 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 7.315 seconds
[0m15:06:40.319901 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m15:06:40.320660 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m15:06:40.326833 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5e7470>]}
[0m15:06:40.328791 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 7.40s]
[0m15:06:40.332192 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:06:40.333364 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:06:40.334435 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m15:06:40.335125 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:06:40.335738 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:06:40.346043 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:06:40.347399 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:06:40.351310 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:06:40.355178 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:06:40.355737 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m15:06:40.356141 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:06:42.919215 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.557 seconds
[0m15:06:42.940461 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m15:06:42.943400 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m15:06:42.948418 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4d80e0>]}
[0m15:06:42.950512 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 2.61s]
[0m15:06:42.955712 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:06:42.957981 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:06:42.960576 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m15:06:42.964103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:06:42.964830 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:06:42.983594 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:06:42.985444 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:06:42.992306 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:06:43.001592 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:06:43.002621 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m15:06:43.003557 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:06:45.562234 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.557 seconds
[0m15:06:45.572128 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m15:06:45.572805 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m15:06:45.575433 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdaeb204-e851-4aa0-a05b-cb83bb1ab8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4470e0>]}
[0m15:06:45.577395 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.61s]
[0m15:06:45.579526 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:06:45.598130 [debug] [MainThread]: On master: COMMIT
[0m15:06:45.600021 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:06:45.600341 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m15:06:45.606920 [info ] [MainThread]: 
[0m15:06:45.609659 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 43.71 seconds (43.71s).
[0m15:06:45.615481 [debug] [MainThread]: Command end result
[0m15:06:45.651937 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:06:45.662226 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:06:45.706309 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:06:45.706820 [info ] [MainThread]: 
[0m15:06:45.707731 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:06:45.708297 [info ] [MainThread]: 
[0m15:06:45.710749 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:06:45.718015 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 45.57466, "process_in_blocks": "365816", "process_kernel_time": 2.630474, "process_mem_max_rss": "290044", "process_out_blocks": "2272", "process_user_time": 4.944705}
[0m15:06:45.720889 [debug] [MainThread]: Command `cli run` succeeded at 15:06:45.720550 after 45.58 seconds
[0m15:06:45.723271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0329340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1f350>]}
[0m15:06:45.724106 [debug] [MainThread]: Flushing usage events
[0m15:06:46.460048 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:06:56.999294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1affbc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0217d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f52b0>]}


============================== 15:06:57.023252 | 0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129 ==============================
[0m15:06:57.023252 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:06:57.025652 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:06:57.354427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe41ee0>]}
[0m15:06:57.466154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0039100>]}
[0m15:06:57.467196 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:06:57.806268 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:06:57.969419 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:06:57.970580 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:06:58.038909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2a690>]}
[0m15:06:58.155604 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:06:58.158357 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:06:58.170669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7ff1d0>]}
[0m15:06:58.171905 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:06:58.172705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82bf80>]}
[0m15:06:58.177473 [info ] [MainThread]: 
[0m15:06:58.178311 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:06:58.178963 [info ] [MainThread]: 
[0m15:06:58.180325 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:06:58.195329 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:06:58.237538 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:06:58.238382 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:06:58.238816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:58.239206 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:06:58.240295 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef853770>]}
[0m15:06:58.723314 [debug] [ThreadPool]: SQL status: SUCCESS in 0.484 seconds
[0m15:06:58.726510 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:06:58.728384 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_silver)
[0m15:06:58.729347 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "silver"
"
[0m15:06:58.740682 [debug] [ThreadPool]: Using trino connection "create_iceberg_silver"
[0m15:06:58.741645 [debug] [ThreadPool]: On create_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_silver"} */
create schema if not exists "iceberg"."silver"
[0m15:06:58.742254 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:58.823293 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.081 seconds
[0m15:06:58.825361 [debug] [ThreadPool]: On create_iceberg_silver: COMMIT
[0m15:06:58.826169 [debug] [ThreadPool]: On create_iceberg_silver: Close
[0m15:06:58.831290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_silver, now list_iceberg_gold)
[0m15:06:58.851373 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:06:58.851903 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:06:58.852210 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:59.564638 [debug] [ThreadPool]: SQL status: SUCCESS in 0.712 seconds
[0m15:06:59.568353 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:06:59.569551 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:06:59.571513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:06:59.577891 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:06:59.578431 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:06:59.578807 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:59.972591 [debug] [ThreadPool]: SQL status: SUCCESS in 0.394 seconds
[0m15:06:59.974398 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:06:59.974800 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:06:59.975510 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:06:59.981657 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:06:59.982097 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:06:59.982413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:07:00.649368 [debug] [ThreadPool]: SQL status: SUCCESS in 0.666 seconds
[0m15:07:00.654370 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:07:00.655134 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:07:00.658033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff07f80>]}
[0m15:07:00.666676 [debug] [MainThread]: On master: COMMIT
[0m15:07:00.689235 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:07:00.691519 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m15:07:00.692657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:07:00.693093 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:07:00.708502 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:07:00.711536 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:07:00.778555 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:07:00.786324 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:07:00.787362 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m15:07:00.787977 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:06.083392 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.285 seconds
[0m15:07:06.193718 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m15:07:06.195865 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m15:07:06.215389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef402240>]}
[0m15:07:06.217629 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 5.51s]
[0m15:07:06.222852 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:07:06.225091 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:07:06.225841 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m15:07:06.227075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m15:07:06.227567 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:07:06.234234 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:07:06.238196 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:07:06.245798 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:07:06.257045 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:07:06.257819 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m15:07:06.258426 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:11.468215 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 5.205 seconds
[0m15:07:11.500412 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m15:07:11.501672 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m15:07:11.510658 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef67adb0>]}
[0m15:07:11.515551 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 5.28s]
[0m15:07:11.519425 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:07:11.521201 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:07:11.522972 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m15:07:11.523947 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:07:11.524587 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:07:11.541848 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:07:11.543728 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:07:11.548000 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:07:11.566702 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:07:11.567542 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m15:07:11.568251 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:17.957114 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 6.387 seconds
[0m15:07:17.968131 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m15:07:17.968790 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m15:07:17.973063 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4444a0>]}
[0m15:07:17.975439 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 6.45s]
[0m15:07:17.978239 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:07:17.979620 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:07:17.981116 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m15:07:17.982321 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m15:07:17.983015 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:07:17.994280 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:07:17.995880 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:07:18.000205 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:07:18.020141 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:07:18.021071 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m15:07:18.022011 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:26.517281 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 8.485 seconds
[0m15:07:26.559737 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m15:07:26.562292 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m15:07:26.568998 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d2a1a3c-bbcb-4b8f-8752-ad3717fb4129', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef49e9f0>]}
[0m15:07:26.573588 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 8.58s]
[0m15:07:26.581606 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:07:26.623564 [debug] [MainThread]: On master: COMMIT
[0m15:07:26.626292 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:07:26.626820 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m15:07:26.638661 [info ] [MainThread]: 
[0m15:07:26.639638 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 28.45 seconds (28.45s).
[0m15:07:26.648526 [debug] [MainThread]: Command end result
[0m15:07:26.722452 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:07:26.752389 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:07:26.814059 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:07:26.814841 [info ] [MainThread]: 
[0m15:07:26.816068 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:07:26.817068 [info ] [MainThread]: 
[0m15:07:26.819047 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:07:26.829302 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 29.915113, "process_in_blocks": "254280", "process_kernel_time": 2.776783, "process_mem_max_rss": "288408", "process_out_blocks": "2409", "process_user_time": 4.687452}
[0m15:07:26.832313 [debug] [MainThread]: Command `cli run` succeeded at 15:07:26.831737 after 29.92 seconds
[0m15:07:26.834323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1affbc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b0d70>]}
[0m15:07:26.834901 [debug] [MainThread]: Flushing usage events
[0m15:07:27.698062 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:07:33.417899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff084be00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0e0a6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0255760>]}


============================== 15:07:33.434738 | c111efab-ffbc-49b9-8711-a5693ef4b5bd ==============================
[0m15:07:33.434738 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:07:33.435816 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'empty': 'False', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'no_print': 'None', 'partial_parse': 'True'}
[0m15:07:34.178760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a5d190>]}
[0m15:07:34.446799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0916240>]}
[0m15:07:34.449885 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:07:35.112147 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:07:35.495908 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:07:35.499472 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:07:35.664083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd13050>]}
[0m15:07:35.933785 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:07:35.951482 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:07:35.998807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f3620>]}
[0m15:07:36.000407 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:07:36.004638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1df0f80>]}
[0m15:07:36.009786 [info ] [MainThread]: 
[0m15:07:36.010934 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:07:36.011718 [info ] [MainThread]: 
[0m15:07:36.014081 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:07:36.028263 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:07:36.106991 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:07:36.108009 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:07:36.109112 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:07:36.109651 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:07:36.112515 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef514b30>]}
[0m15:07:38.466744 [debug] [ThreadPool]: SQL status: SUCCESS in 2.355 seconds
[0m15:07:38.473151 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:07:38.476935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now create_iceberg_gold)
[0m15:07:38.479567 [debug] [ThreadPool]: Creating schema "database: "iceberg"
schema: "gold"
"
[0m15:07:38.498059 [debug] [ThreadPool]: Using trino connection "create_iceberg_gold"
[0m15:07:38.498617 [debug] [ThreadPool]: On create_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "create_iceberg_gold"} */
create schema if not exists "iceberg"."gold"
[0m15:07:38.498953 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:07:38.667956 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.169 seconds
[0m15:07:38.669610 [debug] [ThreadPool]: On create_iceberg_gold: COMMIT
[0m15:07:38.669961 [debug] [ThreadPool]: On create_iceberg_gold: Close
[0m15:07:38.675363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_iceberg_gold, now list_iceberg_gold)
[0m15:07:38.693590 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:07:38.694142 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:07:38.694532 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:07:39.595535 [debug] [ThreadPool]: SQL status: SUCCESS in 0.901 seconds
[0m15:07:39.597566 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:07:39.598065 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:07:39.598864 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:07:39.604060 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:07:39.604762 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:07:39.605125 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:07:40.095897 [debug] [ThreadPool]: SQL status: SUCCESS in 0.490 seconds
[0m15:07:40.097995 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:07:40.098355 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:07:40.099508 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:07:40.107453 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:07:40.107883 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:07:40.108188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:07:40.535002 [debug] [ThreadPool]: SQL status: SUCCESS in 0.426 seconds
[0m15:07:40.539336 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:07:40.539956 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:07:40.547712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a9faa0>]}
[0m15:07:40.553476 [debug] [MainThread]: On master: COMMIT
[0m15:07:40.571114 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:07:40.573090 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m15:07:40.574054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m15:07:40.582820 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:07:40.591761 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:07:40.593434 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:07:40.649811 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:07:40.653557 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:07:40.654018 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m15:07:40.654424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:44.460839 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 3.805 seconds
[0m15:07:44.500407 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m15:07:44.501127 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m15:07:44.506252 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1e300>]}
[0m15:07:44.507970 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 3.93s]
[0m15:07:44.511574 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:07:44.514247 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:07:44.515287 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m15:07:44.519637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:07:44.520430 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:07:44.529442 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:07:44.531208 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:07:44.537019 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:07:44.546260 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:07:44.547230 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m15:07:44.547969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:48.558560 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 4.005 seconds
[0m15:07:48.585517 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m15:07:48.586848 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m15:07:48.594296 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4ce930>]}
[0m15:07:48.599392 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 4.07s]
[0m15:07:48.605238 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:07:48.608231 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:07:48.611446 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m15:07:48.621344 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m15:07:48.622238 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:07:48.656502 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:07:48.661337 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:07:48.672829 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m15:07:48.724443 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:07:48.727370 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m15:07:48.731276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:54.318424 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 5.586 seconds
[0m15:07:54.334800 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m15:07:54.336024 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m15:07:54.347150 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c111efab-ffbc-49b9-8711-a5693ef4b5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd56c2c90>]}
[0m15:07:54.350371 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 5.72s]
[0m15:07:54.353840 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:07:54.379665 [debug] [MainThread]: On master: COMMIT
[0m15:07:54.382328 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:07:54.382855 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m15:07:54.387261 [info ] [MainThread]: 
[0m15:07:54.389723 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 18.37 seconds (18.37s).
[0m15:07:54.394067 [debug] [MainThread]: Command end result
[0m15:07:54.446728 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:07:54.465731 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:07:54.516508 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:07:54.517028 [info ] [MainThread]: 
[0m15:07:54.518041 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:07:54.518566 [info ] [MainThread]: 
[0m15:07:54.520049 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m15:07:54.525241 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 21.188408, "process_in_blocks": "129528", "process_kernel_time": 1.984965, "process_mem_max_rss": "289196", "process_out_blocks": "2289", "process_user_time": 4.766451}
[0m15:07:54.526824 [debug] [MainThread]: Command `cli run` succeeded at 15:07:54.526689 after 21.19 seconds
[0m15:07:54.528686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022bec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd130b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff008bbf0>]}
[0m15:07:54.529096 [debug] [MainThread]: Flushing usage events
[0m15:07:55.252982 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:08:07.759723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04736e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0cddaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c3110>]}


============================== 15:08:07.775418 | d30146da-0563-45d5-868e-45bd60896351 ==============================
[0m15:08:07.775418 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:08:07.776909 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:08:07.999725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff18f13d0>]}
[0m15:08:08.079251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0cddaf0>]}
[0m15:08:08.080356 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:08:08.335303 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:08:08.463417 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:08.464206 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:08.530203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2fe60>]}
[0m15:08:08.543553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa2630>]}
[0m15:08:08.544493 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:08:08.545147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa49670>]}
[0m15:08:08.549109 [info ] [MainThread]: 
[0m15:08:08.549606 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:08:08.549913 [info ] [MainThread]: 
[0m15:08:08.551065 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:08:08.557494 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:08:08.593063 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:08:08.593602 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:08:08.593979 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:08.594230 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:08:08.595470 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4f4860>]}
[0m15:08:09.361563 [debug] [ThreadPool]: SQL status: SUCCESS in 0.767 seconds
[0m15:08:09.364425 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:08:09.364917 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:08:09.366027 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:08:09.373053 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:08:09.373714 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:08:09.374060 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:09.820110 [debug] [ThreadPool]: SQL status: SUCCESS in 0.446 seconds
[0m15:08:09.823012 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:08:09.823647 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:08:09.824872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:08:09.831004 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:08:09.831527 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:08:09.831850 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:10.331416 [debug] [ThreadPool]: SQL status: SUCCESS in 0.499 seconds
[0m15:08:10.334128 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:08:10.334562 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:08:10.337760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd30146da-0563-45d5-868e-45bd60896351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff052c7a0>]}
[0m15:08:10.345592 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m15:08:10.346838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m15:08:10.347594 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m15:08:10.350209 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m15:08:10.351347 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m15:08:10.351888 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:08:10.352484 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m15:08:10.353019 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:08:10.355076 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:08:10.355974 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:08:10.356444 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:08:10.357090 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m15:08:10.357545 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m15:08:10.359254 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m15:08:10.361315 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:08:10.362414 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m15:08:10.364646 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m15:08:10.365475 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m15:08:10.367891 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m15:08:10.369226 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m15:08:10.370696 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:08:10.371885 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m15:08:10.372470 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:08:10.378199 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:10.380301 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:08:10.381569 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:08:10.382081 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:10.382689 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:08:10.383355 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:10.389579 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:10.393269 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:10.394600 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:10.395339 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:10.396104 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:08:10.396859 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:10.400986 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:10.402502 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:10.403675 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:10.404411 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:10.405326 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:08:10.405946 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:10.412431 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:08:10.414136 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:10.415318 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:10.416082 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:08:10.416989 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:08:10.417592 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:08:10.422264 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:08:10.423966 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:08:10.425070 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:08:10.425663 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:08:10.426279 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m15:08:10.426684 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:08:10.439677 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m15:08:10.441036 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:08:10.441750 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:08:10.442174 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:08:10.442644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m15:08:10.443030 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:08:10.447549 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m15:08:10.448491 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:08:10.449743 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:08:10.450430 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:08:10.451182 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m15:08:10.451630 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:08:10.456082 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m15:08:10.457689 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:08:10.458594 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:08:10.459091 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:08:10.459631 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m15:08:10.459990 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:08:10.466412 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m15:08:10.467992 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:08:10.469154 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:08:10.469685 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:08:10.470183 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m15:08:10.470750 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:08:10.475362 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:08:10.476769 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:08:10.477655 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:08:10.478431 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:08:10.480080 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m15:08:10.481770 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:08:10.489752 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m15:08:10.491007 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:08:10.492167 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:08:10.492858 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:08:10.493549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m15:08:10.494498 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:08:10.501895 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m15:08:10.502994 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:08:10.503981 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:08:10.505660 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:08:10.506606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m15:08:10.507322 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:08:10.511633 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m15:08:10.512504 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:08:10.513126 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:08:10.513489 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:08:10.513888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m15:08:10.514207 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:08:10.517327 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m15:08:10.517917 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:08:10.518441 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:08:10.518760 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:08:10.520180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:08:10.520501 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:08:10.523363 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:08:10.524269 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:08:10.524809 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:08:10.525138 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:08:10.525680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m15:08:10.526035 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:08:10.529128 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m15:08:10.529731 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:08:10.530256 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:08:10.530587 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:08:10.530964 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m15:08:10.531271 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:08:10.533925 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m15:08:10.534606 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:08:10.535136 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:08:10.535471 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:08:10.535777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m15:08:10.536104 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:08:10.538947 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m15:08:10.539572 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:08:10.540082 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:08:10.540406 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:08:10.540794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m15:08:10.541149 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:08:10.544034 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:08:10.544679 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:08:10.545271 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:08:10.545604 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:08:10.546109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m15:08:10.546605 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:08:10.549865 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m15:08:10.550712 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:08:10.551313 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:08:10.551669 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:08:10.552045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m15:08:10.552360 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:08:10.555267 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m15:08:10.556021 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:08:10.556565 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:08:10.556885 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:08:10.557297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m15:08:10.557624 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:08:10.560356 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m15:08:10.561003 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:08:10.561520 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:08:10.561852 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:08:10.562205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m15:08:10.562495 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:08:10.564887 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:08:10.565426 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:08:10.565922 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:08:10.566239 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:08:10.566566 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m15:08:10.566846 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:08:10.570417 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:08:10.571175 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:08:10.571743 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:08:10.572047 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:08:10.572402 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:08:10.572685 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:08:10.575497 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:08:10.576084 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:08:10.576637 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:08:10.578343 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:10.579427 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m15:08:10.584590 [debug] [MainThread]: Command end result
[0m15:08:10.675671 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:08:10.679794 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:08:10.695822 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:08:10.702823 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m15:08:10.703521 [info ] [MainThread]: Building catalog
[0m15:08:10.713351 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m15:08:10.765707 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m15:08:10.766700 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m15:08:10.767561 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:17.712015 [debug] [ThreadPool]: SQL status: SUCCESS in 6.943 seconds
[0m15:08:17.732275 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m15:08:17.785376 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:08:17.816769 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:08:17.823879 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:08:17.824376 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:08:17.827716 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 10.151279, "process_in_blocks": "74568", "process_kernel_time": 1.004839, "process_mem_max_rss": "289828", "process_out_blocks": "5916", "process_user_time": 3.530736}
[0m15:08:17.829466 [debug] [MainThread]: Command `cli docs generate` succeeded at 15:08:17.829240 after 10.15 seconds
[0m15:08:17.830211 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:08:17.830498 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m15:08:17.831694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08e9ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3dd4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3dc350>]}
[0m15:08:17.833768 [debug] [MainThread]: Flushing usage events
[0m15:08:18.442902 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:08:42.298198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19eaae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023b320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023b560>]}


============================== 15:08:42.315726 | a89a701e-37c8-46ef-843d-86faa767c3fe ==============================
[0m15:08:42.315726 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:08:42.316969 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:08:42.626798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe1d430>]}
[0m15:08:42.723038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff003f830>]}
[0m15:08:42.724320 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:08:43.179001 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:08:43.368934 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:43.370865 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:43.455029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd60590>]}
[0m15:08:43.560747 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:08:43.564291 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:08:43.576858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b170>]}
[0m15:08:43.577861 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:08:43.579860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef833f20>]}
[0m15:08:43.582958 [info ] [MainThread]: 
[0m15:08:43.583392 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:08:43.583691 [info ] [MainThread]: 
[0m15:08:43.584665 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:08:43.592597 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:08:43.628292 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:08:43.628828 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:08:43.629201 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:43.629530 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:08:43.631127 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85aa80>]}
[0m15:08:44.303736 [debug] [ThreadPool]: SQL status: SUCCESS in 0.673 seconds
[0m15:08:44.309978 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:08:44.315852 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:08:44.346798 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:08:44.347970 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:08:44.348478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:45.216403 [debug] [ThreadPool]: SQL status: SUCCESS in 0.867 seconds
[0m15:08:45.220691 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:08:45.221314 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:08:45.222695 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:08:45.232630 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:08:45.233394 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:08:45.233824 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:45.786144 [debug] [ThreadPool]: SQL status: SUCCESS in 0.552 seconds
[0m15:08:45.789435 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:08:45.790210 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:08:45.791496 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:08:45.799894 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:08:45.800492 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:08:45.800823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:46.248034 [debug] [ThreadPool]: SQL status: SUCCESS in 0.447 seconds
[0m15:08:46.251634 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:08:46.252212 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:08:46.254954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1998140>]}
[0m15:08:46.257069 [debug] [MainThread]: On master: COMMIT
[0m15:08:46.277148 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:08:46.279584 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m15:08:46.284662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m15:08:46.285906 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:08:46.305941 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:46.307815 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:08:46.395014 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:46.399430 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:46.399993 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m15:08:46.400402 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:08:49.550678 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 3.136 seconds
[0m15:08:49.630648 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:49.631781 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:08:50.398432 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.766 seconds
[0m15:08:50.410372 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:50.411440 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m15:08:50.749983 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.336 seconds
[0m15:08:50.793353 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:08:50.797612 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:08:50.798173 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:08:50.948330 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.150 seconds
[0m15:08:50.985931 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m15:08:50.986640 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m15:08:50.995532 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3fb500>]}
[0m15:08:50.997724 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 4.70s]
[0m15:08:51.002038 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:08:51.007054 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:51.011427 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m15:08:51.012205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:08:51.012672 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:51.018304 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:51.021867 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:51.027066 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:51.031245 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:51.031860 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m15:08:51.032348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:08:54.664023 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.630 seconds
[0m15:08:54.680851 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:54.681567 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:08:54.854230 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.172 seconds
[0m15:08:54.857973 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:54.858355 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m15:08:55.039908 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.181 seconds
[0m15:08:55.048221 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:08:55.050367 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:08:55.051025 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:08:55.171074 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.119 seconds
[0m15:08:55.175565 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m15:08:55.176222 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m15:08:55.179089 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef457f20>]}
[0m15:08:55.185319 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 4.17s]
[0m15:08:55.189931 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:08:55.190807 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:55.191894 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m15:08:55.196932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:08:55.197646 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:55.207778 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:55.209239 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:55.213508 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:55.217273 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:55.217976 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m15:08:55.230278 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:08:57.501794 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.269 seconds
[0m15:08:57.526519 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:57.527365 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:08:57.668616 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.140 seconds
[0m15:08:57.673763 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:57.674459 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m15:08:58.064618 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.389 seconds
[0m15:08:58.072480 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:08:58.074123 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:08:58.074604 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:08:58.142927 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.068 seconds
[0m15:08:58.151421 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m15:08:58.152470 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m15:08:58.159973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04f59a0>]}
[0m15:08:58.162783 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 2.96s]
[0m15:08:58.164012 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:08:58.165697 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:58.169626 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m15:08:58.171731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:08:58.173243 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:58.184271 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:08:58.186872 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:08:58.192223 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:08:58.196129 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:08:58.196734 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m15:08:58.197177 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:09:08.407290 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 10.195 seconds
[0m15:09:08.470117 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:09:08.471852 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:09:09.028176 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.554 seconds
[0m15:09:09.044592 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:09:09.046938 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m15:09:09.389386 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.340 seconds
[0m15:09:09.407438 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:09:09.409738 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:09:09.410514 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:09:09.528542 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.116 seconds
[0m15:09:09.538819 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m15:09:09.539765 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m15:09:09.546868 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89a701e-37c8-46ef-843d-86faa767c3fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef49bd70>]}
[0m15:09:09.550146 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 11.37s]
[0m15:09:09.553556 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:09:09.589009 [debug] [MainThread]: On master: COMMIT
[0m15:09:09.592122 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:09.593374 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m15:09:09.598371 [info ] [MainThread]: 
[0m15:09:09.600087 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 26.01 seconds (26.01s).
[0m15:09:09.609298 [debug] [MainThread]: Command end result
[0m15:09:09.675689 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:09:09.705983 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:09:09.766712 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:09:09.767484 [info ] [MainThread]: 
[0m15:09:09.768645 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:09:09.769611 [info ] [MainThread]: 
[0m15:09:09.771677 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:09:09.784612 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.564512, "process_in_blocks": "29552", "process_kernel_time": 0.999652, "process_mem_max_rss": "287508", "process_out_blocks": "2286", "process_user_time": 4.310811}
[0m15:09:09.788247 [debug] [MainThread]: Command `cli run` succeeded at 15:09:09.787490 after 27.57 seconds
[0m15:09:09.790970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0271c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0941ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff023b320>]}
[0m15:09:09.792010 [debug] [MainThread]: Flushing usage events
[0m15:09:10.684432 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:09:16.155571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bf860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bfda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bd850>]}


============================== 15:09:16.169714 | f3e5ecc4-0241-434e-b6b2-b4edd0978490 ==============================
[0m15:09:16.169714 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:09:16.171370 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:09:16.411144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0769fa0>]}
[0m15:09:16.483021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bf2c0>]}
[0m15:09:16.483872 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:09:16.809122 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:09:16.980365 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:09:16.981357 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:09:17.072415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd604a0>]}
[0m15:09:17.181945 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:09:17.184895 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:09:17.198558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b140>]}
[0m15:09:17.199550 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:09:17.200773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef837f20>]}
[0m15:09:17.203602 [info ] [MainThread]: 
[0m15:09:17.204456 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:09:17.204915 [info ] [MainThread]: 
[0m15:09:17.205806 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:09:17.214553 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:09:17.245565 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:09:17.246047 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:09:17.246359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:17.246667 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:09:17.248174 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52cfb0>]}
[0m15:09:18.080032 [debug] [ThreadPool]: SQL status: SUCCESS in 0.833 seconds
[0m15:09:18.082720 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:09:18.088898 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:09:18.112911 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:09:18.113646 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:09:18.114015 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:09:18.972852 [debug] [ThreadPool]: SQL status: SUCCESS in 0.858 seconds
[0m15:09:18.977228 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:09:18.977734 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:09:18.979004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:09:18.987796 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:09:18.988383 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:09:18.988746 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:09:19.496684 [debug] [ThreadPool]: SQL status: SUCCESS in 0.507 seconds
[0m15:09:19.518113 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:09:19.522770 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:09:19.524753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:09:19.604232 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:09:19.606842 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:09:19.610082 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:09:21.342317 [debug] [ThreadPool]: SQL status: SUCCESS in 1.731 seconds
[0m15:09:21.359838 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:09:21.360885 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:09:21.379890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe47e60>]}
[0m15:09:21.385443 [debug] [MainThread]: On master: COMMIT
[0m15:09:21.404789 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:09:21.408411 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m15:09:21.411115 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:09:21.412005 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:09:21.437365 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:09:21.439616 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:09:21.536145 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:09:21.546604 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:09:21.547409 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m15:09:21.548100 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:09:27.455687 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.904 seconds
[0m15:09:27.488132 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:09:27.488870 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:09:27.624247 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.135 seconds
[0m15:09:27.631646 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:09:27.632703 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m15:09:28.049546 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.416 seconds
[0m15:09:28.060751 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:09:28.063545 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:09:28.064002 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:09:28.145616 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.081 seconds
[0m15:09:28.197402 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m15:09:28.197999 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m15:09:28.222052 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00e3830>]}
[0m15:09:28.224364 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 6.79s]
[0m15:09:28.226215 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:09:28.227287 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:09:28.228556 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m15:09:28.229315 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m15:09:28.229820 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:09:28.234188 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:09:28.236196 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:09:28.240573 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:09:28.251726 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:09:28.252800 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m15:09:28.253516 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:09:30.749717 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 2.494 seconds
[0m15:09:30.780748 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:09:30.781799 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:09:30.872071 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.089 seconds
[0m15:09:30.876616 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:09:30.877297 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m15:09:30.970508 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.092 seconds
[0m15:09:30.974241 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:09:30.975426 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:09:30.975794 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:09:31.026060 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.050 seconds
[0m15:09:31.030091 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m15:09:31.030559 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m15:09:31.032630 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef478c50>]}
[0m15:09:31.034397 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 2.80s]
[0m15:09:31.035616 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:09:31.036318 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:09:31.037526 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m15:09:31.038377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:09:31.038851 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:09:31.046797 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:09:31.048526 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:09:31.052372 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:09:31.061118 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:09:31.062847 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m15:09:31.063687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:09:34.801509 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.736 seconds
[0m15:09:34.858677 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:09:34.861650 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:09:35.469073 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.603 seconds
[0m15:09:35.492781 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:09:35.493523 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m15:09:35.823341 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.329 seconds
[0m15:09:35.829054 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:09:35.830307 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:09:35.830918 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:09:35.952397 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.121 seconds
[0m15:09:35.960676 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m15:09:35.961612 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m15:09:35.965944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff796cd40>]}
[0m15:09:35.967952 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 4.93s]
[0m15:09:35.970041 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:09:35.973945 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:09:35.976704 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m15:09:35.977948 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m15:09:35.978808 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:09:35.998467 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:09:36.000264 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:09:36.015560 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:09:36.030525 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:09:36.031597 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m15:09:36.032386 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:09:39.902568 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 3.868 seconds
[0m15:09:39.926231 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:09:39.926816 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:09:40.022749 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.095 seconds
[0m15:09:40.026742 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:09:40.027229 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m15:09:40.113253 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.085 seconds
[0m15:09:40.117635 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:09:40.118671 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:09:40.119136 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:09:40.352325 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.233 seconds
[0m15:09:40.356527 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m15:09:40.357111 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m15:09:40.359662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3e5ecc4-0241-434e-b6b2-b4edd0978490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3dae10>]}
[0m15:09:40.361216 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 4.38s]
[0m15:09:40.363587 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:09:40.377256 [debug] [MainThread]: On master: COMMIT
[0m15:09:40.379267 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:40.379803 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m15:09:40.385968 [info ] [MainThread]: 
[0m15:09:40.387774 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 23.18 seconds (23.18s).
[0m15:09:40.391734 [debug] [MainThread]: Command end result
[0m15:09:40.441367 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:09:40.450722 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:09:40.482470 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:09:40.483054 [info ] [MainThread]: 
[0m15:09:40.483666 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:09:40.484145 [info ] [MainThread]: 
[0m15:09:40.485658 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:09:40.488526 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 24.405, "process_in_blocks": "207504", "process_kernel_time": 1.364459, "process_mem_max_rss": "288104", "process_out_blocks": "2421", "process_user_time": 3.869332}
[0m15:09:40.490055 [debug] [MainThread]: Command `cli run` succeeded at 15:09:40.489930 after 24.41 seconds
[0m15:09:40.491706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff079e240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09403e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m15:09:40.492122 [debug] [MainThread]: Flushing usage events
[0m15:09:41.154933 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:09:57.308888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e7170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02366c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0237980>]}


============================== 15:09:57.334744 | 9b1856c3-f8ed-4b57-a09b-195820d2e7d5 ==============================
[0m15:09:57.334744 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:09:57.335818 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:09:57.627606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdf77a0>]}
[0m15:09:57.723786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19987a0>]}
[0m15:09:57.724718 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:09:58.124318 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:09:58.316693 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:09:58.317955 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:09:58.399493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2eb40>]}
[0m15:09:58.527473 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:09:58.530965 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:09:58.563187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b620>]}
[0m15:09:58.565015 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:09:58.565810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef836f60>]}
[0m15:09:58.572533 [info ] [MainThread]: 
[0m15:09:58.573673 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:09:58.574564 [info ] [MainThread]: 
[0m15:09:58.576089 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:09:58.592476 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:09:58.645232 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:09:58.645815 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:09:58.646232 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:58.646515 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:09:58.648071 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcea1b0>]}
[0m15:09:59.936972 [debug] [ThreadPool]: SQL status: SUCCESS in 1.288 seconds
[0m15:09:59.945373 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:09:59.955943 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:09:59.985393 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:09:59.986350 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:09:59.987367 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:10:00.840712 [debug] [ThreadPool]: SQL status: SUCCESS in 0.853 seconds
[0m15:10:00.845810 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:10:00.846503 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:10:00.848111 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:10:00.860482 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:10:00.861327 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:10:00.861945 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:10:01.624139 [debug] [ThreadPool]: SQL status: SUCCESS in 0.760 seconds
[0m15:10:01.629356 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:10:01.630020 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:10:01.631993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:10:01.646547 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:10:01.647164 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:10:01.647615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:10:02.296964 [debug] [ThreadPool]: SQL status: SUCCESS in 0.649 seconds
[0m15:10:02.304757 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:10:02.306101 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:10:02.311453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc80b0>]}
[0m15:10:02.315320 [debug] [MainThread]: On master: COMMIT
[0m15:10:02.346304 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:10:02.348513 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m15:10:02.358730 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m15:10:02.360449 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:10:02.379174 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:02.381704 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:10:02.456914 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:02.461543 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:02.462254 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m15:10:02.462767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:10:07.236399 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 4.767 seconds
[0m15:10:07.298815 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:07.299968 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:10:07.459757 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.159 seconds
[0m15:10:07.464404 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:07.464973 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m15:10:07.581821 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.116 seconds
[0m15:10:07.594709 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:10:07.598309 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:07.598927 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:10:07.663545 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.064 seconds
[0m15:10:07.706633 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m15:10:07.707344 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m15:10:07.719739 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00e3e00>]}
[0m15:10:07.721445 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 5.36s]
[0m15:10:07.724611 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:10:07.725311 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:07.727691 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m15:10:07.728370 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:10:07.728792 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:07.733229 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:07.734689 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:07.739430 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:07.749373 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:07.750058 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m15:10:07.750571 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:10:10.419360 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.667 seconds
[0m15:10:10.433983 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:10.434766 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:10:10.535121 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m15:10:10.538496 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:10.538860 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m15:10:10.676405 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.137 seconds
[0m15:10:10.683100 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:10:10.684679 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:10.685328 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:10:10.740056 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.054 seconds
[0m15:10:10.743333 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m15:10:10.743840 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m15:10:10.746825 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef45cc50>]}
[0m15:10:10.750798 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 3.02s]
[0m15:10:10.755219 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:10.756739 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:10:10.758263 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m15:10:10.758861 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m15:10:10.759291 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:10:10.778339 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:10:10.780445 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:10:10.787222 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m15:10:10.792150 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:10:10.792778 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m15:10:10.793243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:10:14.230834 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 3.436 seconds
[0m15:10:14.254756 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:10:14.255555 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:10:14.373943 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.118 seconds
[0m15:10:14.379459 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:10:14.380081 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m15:10:14.536892 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.156 seconds
[0m15:10:14.541520 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:10:14.542711 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:10:14.543120 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:10:14.604304 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.061 seconds
[0m15:10:14.607653 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m15:10:14.608344 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m15:10:14.612034 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b1856c3-f8ed-4b57-a09b-195820d2e7d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5acda0>]}
[0m15:10:14.613999 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 3.85s]
[0m15:10:14.617476 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:10:14.635177 [debug] [MainThread]: On master: COMMIT
[0m15:10:14.639294 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:10:14.640471 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m15:10:14.645169 [info ] [MainThread]: 
[0m15:10:14.647580 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 16.07 seconds (16.07s).
[0m15:10:14.654771 [debug] [MainThread]: Command end result
[0m15:10:14.702804 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:10:14.717592 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:10:14.751936 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:10:14.752852 [info ] [MainThread]: 
[0m15:10:14.754993 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:10:14.755871 [info ] [MainThread]: 
[0m15:10:14.758343 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m15:10:14.770268 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.586807, "process_in_blocks": "227352", "process_kernel_time": 2.497149, "process_mem_max_rss": "286840", "process_out_blocks": "2297", "process_user_time": 4.168636}
[0m15:10:14.773553 [debug] [MainThread]: Command `cli run` succeeded at 15:10:14.772897 after 17.60 seconds
[0m15:10:14.777784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e7170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016ea20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4a120>]}
[0m15:10:14.779350 [debug] [MainThread]: Flushing usage events
[0m15:10:15.538472 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:10:30.399355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0e48a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4fe60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4fd40>]}


============================== 15:10:30.411739 | d1c9a117-d229-4f01-b6b7-234ebb9704dd ==============================
[0m15:10:30.411739 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:10:30.413149 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:10:30.659884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff18f30e0>]}
[0m15:10:30.745473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefeedee0>]}
[0m15:10:30.746630 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:10:31.064234 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:10:31.210960 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:10:31.211893 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:10:31.282887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016ebd0>]}
[0m15:10:31.294317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaae180>]}
[0m15:10:31.295023 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:10:31.295504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefff19d0>]}
[0m15:10:31.299369 [info ] [MainThread]: 
[0m15:10:31.300173 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:10:31.300616 [info ] [MainThread]: 
[0m15:10:31.301448 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:10:31.313814 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:10:31.350310 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:10:31.350795 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:10:31.351143 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:10:31.351435 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:10:31.352708 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef836c90>]}
[0m15:10:32.678491 [debug] [ThreadPool]: SQL status: SUCCESS in 1.325 seconds
[0m15:10:32.684524 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:10:32.685213 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:10:32.686964 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:10:32.699022 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:10:32.699713 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:10:32.700131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:10:33.629918 [debug] [ThreadPool]: SQL status: SUCCESS in 0.929 seconds
[0m15:10:33.639746 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:10:33.640840 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:10:33.643101 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:10:33.652027 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:10:33.652866 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:10:33.653394 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:10:34.178528 [debug] [ThreadPool]: SQL status: SUCCESS in 0.521 seconds
[0m15:10:34.186716 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:10:34.187386 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:10:34.193353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1c9a117-d229-4f01-b6b7-234ebb9704dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef835e50>]}
[0m15:10:34.209815 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m15:10:34.210955 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m15:10:34.211532 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m15:10:34.217728 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m15:10:34.219126 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m15:10:34.219724 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:10:34.220441 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m15:10:34.221020 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:10:34.222923 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:10:34.223768 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:10:34.224263 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:10:34.224846 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m15:10:34.225191 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m15:10:34.226715 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m15:10:34.227249 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:10:34.227564 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m15:10:34.228035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m15:10:34.228391 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m15:10:34.229790 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m15:10:34.230344 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m15:10:34.230723 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:10:34.231175 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m15:10:34.231467 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:10:34.236370 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:10:34.240179 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:10:34.241283 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:10:34.241689 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:10:34.242399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:10:34.243957 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:10:34.248321 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:10:34.249912 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:10:34.250850 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:10:34.251272 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:10:34.251713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:10:34.252115 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:10:34.254950 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:10:34.255687 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:10:34.256273 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:10:34.256607 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:10:34.257008 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:10:34.257458 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:10:34.260094 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:10:34.260745 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:10:34.261326 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:10:34.261673 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:10:34.262086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:10:34.262489 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:10:34.265260 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:10:34.266376 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:10:34.267097 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:10:34.267499 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:10:34.267869 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m15:10:34.268172 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:10:34.280487 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m15:10:34.281516 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:10:34.282115 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:10:34.282474 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:10:34.282821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m15:10:34.283222 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:10:34.286421 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m15:10:34.287133 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:10:34.287647 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:10:34.287987 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:10:34.288426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m15:10:34.288837 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:10:34.293031 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m15:10:34.293932 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:10:34.294517 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:10:34.294861 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:10:34.295233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m15:10:34.295524 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:10:34.300464 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m15:10:34.301190 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:10:34.301752 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:10:34.302083 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:10:34.302454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m15:10:34.302735 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:10:34.305382 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:10:34.305936 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:10:34.306475 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:10:34.306802 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:10:34.307323 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m15:10:34.307672 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:10:34.311819 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m15:10:34.312739 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:10:34.313415 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:10:34.314251 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:10:34.315102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m15:10:34.315990 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:10:34.321049 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m15:10:34.322072 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:10:34.322752 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:10:34.323924 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:10:34.324440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m15:10:34.324782 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:10:34.329952 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m15:10:34.330714 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:10:34.331355 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:10:34.331678 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:10:34.332048 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m15:10:34.332360 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:10:34.336529 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m15:10:34.337872 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:10:34.338754 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:10:34.339149 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:10:34.339571 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:10:34.339879 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:10:34.342917 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:10:34.343660 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:10:34.344231 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:10:34.344579 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:10:34.345148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m15:10:34.345459 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:10:34.348578 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m15:10:34.349331 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:10:34.349937 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:10:34.350294 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:10:34.350670 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m15:10:34.350977 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:10:34.354459 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m15:10:34.355608 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:10:34.356211 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:10:34.356592 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:10:34.356973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m15:10:34.357281 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:10:34.360670 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m15:10:34.361407 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:10:34.361956 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:10:34.362289 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:10:34.362632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m15:10:34.362922 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:10:34.367123 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:10:34.367796 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:10:34.368344 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:10:34.368661 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:10:34.369183 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m15:10:34.369567 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:10:34.373522 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m15:10:34.374364 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:10:34.375326 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:10:34.375742 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:10:34.376186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m15:10:34.376644 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:10:34.380100 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m15:10:34.381277 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:10:34.381888 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:10:34.382257 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:10:34.382749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m15:10:34.383070 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:10:34.387507 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m15:10:34.388376 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:10:34.389064 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:10:34.389580 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:10:34.390138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m15:10:34.390616 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:10:34.395050 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:10:34.397200 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:10:34.398734 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:10:34.399464 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:10:34.400137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m15:10:34.400568 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:10:34.404954 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:10:34.405961 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:10:34.406780 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:10:34.407190 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:34.407570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:10:34.407946 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:34.411106 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:10:34.411805 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:34.412380 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:10:34.415317 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:10:34.417999 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m15:10:34.425118 [debug] [MainThread]: Command end result
[0m15:10:34.530107 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:10:34.541741 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:10:34.556802 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:10:34.571042 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m15:10:34.574613 [info ] [MainThread]: Building catalog
[0m15:10:34.584254 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m15:10:34.639605 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m15:10:34.640698 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m15:10:34.641728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:10:47.126094 [debug] [ThreadPool]: SQL status: SUCCESS in 12.467 seconds
[0m15:10:47.239708 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m15:10:47.362865 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:10:47.414799 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:10:47.426038 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:10:47.426875 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:10:47.440833 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 17.120047, "process_in_blocks": "178912", "process_kernel_time": 1.746063, "process_mem_max_rss": "288316", "process_out_blocks": "5916", "process_user_time": 4.51022}
[0m15:10:47.446090 [debug] [MainThread]: Command `cli docs generate` succeeded at 15:10:47.443829 after 17.13 seconds
[0m15:10:47.449413 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:10:47.450109 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m15:10:47.451825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0656b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a16240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0696180>]}
[0m15:10:47.454909 [debug] [MainThread]: Flushing usage events
[0m15:10:48.163915 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:11:17.502570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff144f3e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05c30e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f3110>]}


============================== 15:11:17.534139 | bbbf113a-5d96-4796-ac64-a896f81c099c ==============================
[0m15:11:17.534139 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:11:17.535689 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:11:17.844374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe1dfa0>]}
[0m15:11:17.944419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f162d0>]}
[0m15:11:17.945450 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:11:18.310656 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:11:18.459062 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:11:18.459929 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:11:18.528517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefce65d0>]}
[0m15:11:18.618276 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:11:18.620611 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:11:18.634885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8350a0>]}
[0m15:11:18.636669 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:11:18.637995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8299a0>]}
[0m15:11:18.641605 [info ] [MainThread]: 
[0m15:11:18.642537 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:11:18.643137 [info ] [MainThread]: 
[0m15:11:18.644057 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:11:18.653637 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:11:18.687566 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:11:18.688018 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:11:18.688310 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:18.688569 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:11:18.689921 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85b410>]}
[0m15:11:19.642726 [debug] [ThreadPool]: SQL status: SUCCESS in 0.946 seconds
[0m15:11:19.648434 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:11:19.656233 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:11:19.678187 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:11:19.678829 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:11:19.679434 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:11:20.618701 [debug] [ThreadPool]: SQL status: SUCCESS in 0.938 seconds
[0m15:11:20.624707 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:11:20.625565 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:11:20.629549 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:11:20.646310 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:11:20.646936 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:11:20.647288 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:11:21.241057 [debug] [ThreadPool]: SQL status: SUCCESS in 0.592 seconds
[0m15:11:21.248919 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:11:21.249693 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:11:21.253437 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:11:21.265410 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:11:21.266285 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:11:21.266757 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:11:21.895440 [debug] [ThreadPool]: SQL status: SUCCESS in 0.628 seconds
[0m15:11:21.898797 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:11:21.899296 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:11:21.902425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef836480>]}
[0m15:11:21.904586 [debug] [MainThread]: On master: COMMIT
[0m15:11:21.926507 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:11:21.927870 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m15:11:21.928892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m15:11:21.932534 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:11:21.946064 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:11:21.950027 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:11:22.027263 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:11:22.030871 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:11:22.031394 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m15:11:22.031883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:11:26.551378 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 4.518 seconds
[0m15:11:26.585263 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:11:26.586016 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:11:26.751625 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.165 seconds
[0m15:11:26.755320 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:11:26.755761 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m15:11:26.831211 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.075 seconds
[0m15:11:26.840558 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:11:26.843286 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:11:26.843688 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:11:26.892902 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.049 seconds
[0m15:11:26.913593 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m15:11:26.914088 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m15:11:26.925262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefeeff80>]}
[0m15:11:26.926665 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 4.99s]
[0m15:11:26.929939 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:11:26.930872 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:11:26.931925 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m15:11:26.932523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:11:26.932898 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:11:26.938637 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:11:26.939795 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:11:26.942934 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:11:26.945611 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:11:26.946027 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m15:11:26.946437 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:11:28.466023 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 1.515 seconds
[0m15:11:28.487954 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:11:28.488655 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:11:28.588859 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.100 seconds
[0m15:11:28.594105 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:11:28.594664 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m15:11:28.676687 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.081 seconds
[0m15:11:28.680727 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:11:28.681609 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:11:28.682068 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:11:28.737170 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.054 seconds
[0m15:11:28.739812 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m15:11:28.740418 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m15:11:28.742546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4364b0>]}
[0m15:11:28.744661 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 1.81s]
[0m15:11:28.749014 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:11:28.749611 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:11:28.750096 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m15:11:28.750600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:11:28.750961 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:11:28.763267 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:11:28.764919 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:11:28.769003 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:11:28.772136 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:11:28.772742 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m15:11:28.773315 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:11:31.825937 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.049 seconds
[0m15:11:31.850798 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:11:31.851554 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:11:31.973208 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.121 seconds
[0m15:11:31.984388 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:11:31.986098 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m15:11:32.568898 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.582 seconds
[0m15:11:32.598496 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:11:32.603487 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:11:32.605144 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:11:32.805762 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.199 seconds
[0m15:11:32.818347 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m15:11:32.818976 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m15:11:32.840561 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef496270>]}
[0m15:11:32.848744 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 4.08s]
[0m15:11:32.853140 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:11:32.858846 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:11:32.859843 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m15:11:32.861817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:11:32.865519 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:11:32.896236 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:11:32.907519 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:11:32.914704 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:11:32.928602 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:11:32.929724 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m15:11:32.933635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:11:47.020709 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 14.078 seconds
[0m15:11:47.151181 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:11:47.152872 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:11:47.551687 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.397 seconds
[0m15:11:47.563784 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:11:47.567257 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m15:11:47.960795 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.391 seconds
[0m15:11:47.975420 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:11:47.977904 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:11:47.978530 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:11:48.130626 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.151 seconds
[0m15:11:48.147796 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m15:11:48.149501 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m15:11:48.171556 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbbf113a-5d96-4796-ac64-a896f81c099c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef49c680>]}
[0m15:11:48.190032 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 15.29s]
[0m15:11:48.192887 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:11:48.234194 [debug] [MainThread]: On master: COMMIT
[0m15:11:48.236907 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:11:48.237456 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m15:11:48.244510 [info ] [MainThread]: 
[0m15:11:48.245905 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 29.59 seconds (29.59s).
[0m15:11:48.251362 [debug] [MainThread]: Command end result
[0m15:11:48.347551 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:11:48.372504 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:11:48.465144 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:11:48.466831 [info ] [MainThread]: 
[0m15:11:48.469912 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:11:48.472861 [info ] [MainThread]: 
[0m15:11:48.474880 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:11:48.484911 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 31.088799, "process_in_blocks": "272624", "process_kernel_time": 2.543951, "process_mem_max_rss": "287816", "process_out_blocks": "2286", "process_user_time": 5.027383}
[0m15:11:48.487586 [debug] [MainThread]: Command `cli run` succeeded at 15:11:48.487132 after 31.09 seconds
[0m15:11:48.491796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b35ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4a390>]}
[0m15:11:48.493601 [debug] [MainThread]: Flushing usage events
[0m15:11:49.741210 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:11:57.433814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19f3230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016e360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016e1e0>]}


============================== 15:11:57.456935 | a4fc5ebb-a993-4119-9690-4bf51242f240 ==============================
[0m15:11:57.456935 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:11:57.457797 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:11:58.030381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02e9f70>]}
[0m15:11:58.130401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03a85c0>]}
[0m15:11:58.131805 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:11:58.802300 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:11:59.267940 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:11:59.268951 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:11:59.359516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd604a0>]}
[0m15:11:59.476548 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:11:59.479586 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:11:59.492444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838d70>]}
[0m15:11:59.493379 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:11:59.494058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef834d40>]}
[0m15:11:59.496819 [info ] [MainThread]: 
[0m15:11:59.497490 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:11:59.497951 [info ] [MainThread]: 
[0m15:11:59.498733 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:11:59.522960 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:11:59.583842 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:11:59.584330 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:11:59.584600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:59.584845 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:11:59.586189 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52c800>]}
[0m15:12:02.758170 [debug] [ThreadPool]: SQL status: SUCCESS in 3.171 seconds
[0m15:12:02.768583 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:12:02.779119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:12:02.802926 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:12:02.803532 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:12:02.803909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:04.520862 [debug] [ThreadPool]: SQL status: SUCCESS in 1.717 seconds
[0m15:12:04.522954 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:12:04.523331 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:12:04.524116 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:12:04.529451 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:12:04.529876 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:12:04.530198 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:04.842956 [debug] [ThreadPool]: SQL status: SUCCESS in 0.313 seconds
[0m15:12:04.845249 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:12:04.845826 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:12:04.846657 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:12:04.852582 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:12:04.853186 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:12:04.853521 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:05.169448 [debug] [ThreadPool]: SQL status: SUCCESS in 0.316 seconds
[0m15:12:05.171222 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:12:05.171555 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:12:05.173363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4d3aab0>]}
[0m15:12:05.174685 [debug] [MainThread]: On master: COMMIT
[0m15:12:05.182747 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:05.183639 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m15:12:05.184505 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:12:05.185106 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:05.189144 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:05.190090 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:05.230256 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:05.273409 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:05.275955 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m15:12:05.277066 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:07.461847 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 2.183 seconds
[0m15:12:07.495110 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:07.495765 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:12:07.588431 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.092 seconds
[0m15:12:07.594280 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:07.594715 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m15:12:07.665273 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.070 seconds
[0m15:12:07.681009 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:12:07.686169 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:07.686742 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:12:07.741595 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.054 seconds
[0m15:12:07.767279 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m15:12:07.767931 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m15:12:07.796298 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef41ecf0>]}
[0m15:12:07.797738 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 2.58s]
[0m15:12:07.801420 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:07.802071 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:12:07.803007 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m15:12:07.803528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m15:12:07.803889 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:12:07.807406 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:07.808375 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:12:07.811000 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:07.816815 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:07.817223 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m15:12:07.817641 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:11.390077 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 3.567 seconds
[0m15:12:11.413767 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:11.414399 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:12:11.528428 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.113 seconds
[0m15:12:11.535096 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:11.535890 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m15:12:11.668108 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.132 seconds
[0m15:12:11.671630 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:12:11.672453 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:11.672779 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:12:11.722451 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.049 seconds
[0m15:12:11.725434 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m15:12:11.725902 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m15:12:11.727790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4ca7e30>]}
[0m15:12:11.729261 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 3.92s]
[0m15:12:11.730091 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:12:11.732128 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:11.733497 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m15:12:11.734302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:12:11.734823 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:11.741268 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:11.742705 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:11.753658 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:11.766254 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:11.767264 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m15:12:11.768230 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:16.332987 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.563 seconds
[0m15:12:16.351317 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:16.352175 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:12:16.437354 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.084 seconds
[0m15:12:16.442274 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:16.442699 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m15:12:16.566332 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.123 seconds
[0m15:12:16.570416 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:12:16.571434 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:16.571826 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:12:16.631118 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.059 seconds
[0m15:12:16.634601 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m15:12:16.635144 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m15:12:16.639585 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa2360>]}
[0m15:12:16.641478 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 4.90s]
[0m15:12:16.643174 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:16.654214 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:12:16.655165 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m15:12:16.655964 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m15:12:16.656785 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:12:16.666098 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:16.669279 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:12:16.676762 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:16.698087 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:16.699087 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m15:12:16.700013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:19.530052 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.825 seconds
[0m15:12:19.565190 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:19.566057 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:12:19.692377 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.126 seconds
[0m15:12:19.696693 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:19.697243 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m15:12:19.823121 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.125 seconds
[0m15:12:19.827703 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:12:19.829126 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:19.829712 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:12:19.911008 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.081 seconds
[0m15:12:19.915087 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m15:12:19.915714 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m15:12:19.918491 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4fc5ebb-a993-4119-9690-4bf51242f240', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2ccd40>]}
[0m15:12:19.920357 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 3.26s]
[0m15:12:19.924548 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:12:19.950516 [debug] [MainThread]: On master: COMMIT
[0m15:12:19.952925 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:19.953835 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m15:12:19.956247 [info ] [MainThread]: 
[0m15:12:19.957857 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 20.46 seconds (20.46s).
[0m15:12:19.964615 [debug] [MainThread]: Command end result
[0m15:12:20.068649 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:12:20.087590 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:12:20.132896 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:12:20.133547 [info ] [MainThread]: 
[0m15:12:20.134120 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:12:20.134714 [info ] [MainThread]: 
[0m15:12:20.135609 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:12:20.145082 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 22.787554, "process_in_blocks": "233592", "process_kernel_time": 1.719778, "process_mem_max_rss": "288028", "process_out_blocks": "2421", "process_user_time": 4.248796}
[0m15:12:20.148675 [debug] [MainThread]: Command `cli run` succeeded at 15:12:20.147999 after 22.80 seconds
[0m15:12:20.153390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0232510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01cef30>]}
[0m15:12:20.154309 [debug] [MainThread]: Flushing usage events
[0m15:12:21.270274 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:12:28.005886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1182b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02346e0>]}


============================== 15:12:28.021600 | 4025b02a-29d7-4f09-9911-8a226fa91095 ==============================
[0m15:12:28.021600 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:12:28.022745 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:12:28.266778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff18f3440>]}
[0m15:12:28.339129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef1c10>]}
[0m15:12:28.339933 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:12:28.712224 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:12:28.869945 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:12:28.871031 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:12:28.940035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00cdac0>]}
[0m15:12:29.043085 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:12:29.045833 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:12:29.061620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83d160>]}
[0m15:12:29.062823 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:12:29.063743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef815190>]}
[0m15:12:29.066913 [info ] [MainThread]: 
[0m15:12:29.067470 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:12:29.067857 [info ] [MainThread]: 
[0m15:12:29.068956 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:12:29.079583 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:12:29.126234 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:12:29.126786 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:12:29.127115 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:12:29.127393 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:12:29.128494 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85fa70>]}
[0m15:12:29.797478 [debug] [ThreadPool]: SQL status: SUCCESS in 0.669 seconds
[0m15:12:29.801562 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:12:29.811596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:12:29.833440 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:12:29.834465 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:12:29.835279 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:30.278018 [debug] [ThreadPool]: SQL status: SUCCESS in 0.442 seconds
[0m15:12:30.280846 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:12:30.281407 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:12:30.282353 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:12:30.290525 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:12:30.291318 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:12:30.291732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:30.647274 [debug] [ThreadPool]: SQL status: SUCCESS in 0.355 seconds
[0m15:12:30.650061 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:12:30.650577 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:12:30.651657 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:12:30.657078 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:12:30.657758 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:12:30.662573 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:31.127509 [debug] [ThreadPool]: SQL status: SUCCESS in 0.465 seconds
[0m15:12:31.129787 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:12:31.130260 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:12:31.132803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe20aa0>]}
[0m15:12:31.134619 [debug] [MainThread]: On master: COMMIT
[0m15:12:31.145781 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:12:31.147057 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m15:12:31.148960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m15:12:31.150113 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:12:31.158387 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:31.160440 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:12:31.228001 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:31.232841 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:31.233715 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m15:12:31.234247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:32.815348 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 1.579 seconds
[0m15:12:32.844132 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:32.844826 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:12:32.944480 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m15:12:32.951085 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:32.951580 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m15:12:33.039728 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.087 seconds
[0m15:12:33.054515 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:12:33.057533 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:33.058168 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:12:33.117031 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.058 seconds
[0m15:12:33.139330 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m15:12:33.139943 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m15:12:33.152046 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef3d40>]}
[0m15:12:33.153726 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 2.00s]
[0m15:12:33.156452 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:12:33.157260 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:33.158663 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m15:12:33.159878 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:12:33.160488 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:33.164466 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:33.165537 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:33.168443 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:33.176809 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:33.177554 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m15:12:33.178105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:34.949078 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 1.769 seconds
[0m15:12:34.965525 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:34.966097 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:12:35.054189 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.087 seconds
[0m15:12:35.059280 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:35.059906 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m15:12:35.120316 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.060 seconds
[0m15:12:35.123750 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:12:35.124628 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:35.124956 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:12:35.170843 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.045 seconds
[0m15:12:35.177636 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m15:12:35.178333 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m15:12:35.182579 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef696810>]}
[0m15:12:35.184435 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.02s]
[0m15:12:35.186860 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:35.187715 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:12:35.190188 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m15:12:35.190862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m15:12:35.191253 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:12:35.197142 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:12:35.198294 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:12:35.204923 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m15:12:35.208786 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:12:35.209252 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m15:12:35.209693 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:36.920371 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.709 seconds
[0m15:12:36.936466 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:12:36.937694 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:12:37.029387 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.091 seconds
[0m15:12:37.033483 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:12:37.034020 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m15:12:37.127904 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.093 seconds
[0m15:12:37.137291 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:12:37.138751 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:12:37.139344 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:12:37.184764 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.045 seconds
[0m15:12:37.187472 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m15:12:37.187926 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m15:12:37.189776 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4025b02a-29d7-4f09-9911-8a226fa91095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3c0140>]}
[0m15:12:37.191399 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 2.00s]
[0m15:12:37.196048 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:12:37.205133 [debug] [MainThread]: On master: COMMIT
[0m15:12:37.207266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:37.207930 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m15:12:37.210461 [info ] [MainThread]: 
[0m15:12:37.211483 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 8.14 seconds (8.14s).
[0m15:12:37.213635 [debug] [MainThread]: Command end result
[0m15:12:37.262306 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:12:37.270043 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:12:37.294551 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:12:37.295188 [info ] [MainThread]: 
[0m15:12:37.295803 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:12:37.296598 [info ] [MainThread]: 
[0m15:12:37.297701 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m15:12:37.301366 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.384726, "process_in_blocks": "261672", "process_kernel_time": 1.038329, "process_mem_max_rss": "289280", "process_out_blocks": "2297", "process_user_time": 2.993127}
[0m15:12:37.303587 [debug] [MainThread]: Command `cli run` succeeded at 15:12:37.303373 after 9.39 seconds
[0m15:12:37.304760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff079b860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff11829c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe23bc0>]}
[0m15:12:37.305305 [debug] [MainThread]: Flushing usage events
[0m15:12:37.963756 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:12:42.848071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03f3c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016e2a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016e600>]}


============================== 15:12:42.877066 | 1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb ==============================
[0m15:12:42.877066 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:12:42.878155 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:12:43.122285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff052cdd0>]}
[0m15:12:43.204747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff644deb0>]}
[0m15:12:43.205811 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:12:43.532122 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:12:43.672680 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:12:43.673528 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:12:43.750601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80fc20>]}
[0m15:12:43.763279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa4ec30>]}
[0m15:12:43.763995 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:12:43.764520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe1c140>]}
[0m15:12:43.767791 [info ] [MainThread]: 
[0m15:12:43.768398 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:12:43.768821 [info ] [MainThread]: 
[0m15:12:43.769673 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:12:43.775816 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:12:43.818839 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:12:43.819522 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:12:43.819882 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:12:43.820200 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:12:43.822151 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83b9e0>]}
[0m15:12:44.353770 [debug] [ThreadPool]: SQL status: SUCCESS in 0.533 seconds
[0m15:12:44.357111 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:12:44.357595 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:12:44.358775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:12:44.366104 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:12:44.366924 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:12:44.367617 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:44.726058 [debug] [ThreadPool]: SQL status: SUCCESS in 0.358 seconds
[0m15:12:44.731874 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:12:44.732617 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:12:44.734211 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:12:44.748021 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:12:44.748633 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:12:44.748992 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:45.012418 [debug] [ThreadPool]: SQL status: SUCCESS in 0.263 seconds
[0m15:12:45.016983 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:12:45.017982 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:12:45.023254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1344b51d-7f41-4d4e-a2d0-fbe57dc8a5cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff14d40>]}
[0m15:12:45.034985 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m15:12:45.035702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m15:12:45.036155 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m15:12:45.039856 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m15:12:45.041634 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m15:12:45.042782 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:12:45.043888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m15:12:45.044951 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:12:45.047051 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:12:45.047665 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:12:45.048037 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:12:45.048444 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m15:12:45.048840 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m15:12:45.050359 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m15:12:45.050890 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:12:45.051233 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m15:12:45.051564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m15:12:45.051913 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m15:12:45.053392 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m15:12:45.053896 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m15:12:45.054261 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:12:45.054677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m15:12:45.055123 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:12:45.059805 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:12:45.060675 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:12:45.061250 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:12:45.061604 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:12:45.062066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:12:45.062552 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:12:45.065103 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:12:45.065686 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:12:45.066233 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:12:45.066624 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:12:45.067052 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:12:45.067479 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:12:45.071189 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:12:45.071751 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:12:45.072349 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:12:45.072696 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:12:45.073119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:12:45.073612 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:12:45.077374 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:12:45.078077 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:12:45.078641 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:12:45.079047 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:45.079453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:12:45.079956 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:45.082749 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:12:45.083283 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:45.083814 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:12:45.084169 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:12:45.084545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m15:12:45.084847 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:12:45.098901 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m15:12:45.100062 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:12:45.100871 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:12:45.101279 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:12:45.101684 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m15:12:45.102017 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:12:45.105243 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m15:12:45.105865 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:12:45.106479 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:12:45.106831 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:12:45.107572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m15:12:45.108348 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:12:45.112190 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m15:12:45.112910 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:12:45.113600 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:12:45.113943 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:12:45.114332 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m15:12:45.114667 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:12:45.120037 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m15:12:45.120835 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:12:45.121465 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:12:45.121853 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:12:45.122304 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m15:12:45.122640 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:12:45.125688 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:12:45.126406 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:12:45.126986 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:12:45.127334 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:12:45.127839 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m15:12:45.128230 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:12:45.131339 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m15:12:45.131877 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:12:45.132462 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:12:45.132801 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:12:45.133202 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m15:12:45.133513 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:12:45.136312 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m15:12:45.136851 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:12:45.137382 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:12:45.137814 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:12:45.138175 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m15:12:45.138522 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:12:45.143053 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m15:12:45.144070 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:12:45.144918 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:12:45.145496 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:12:45.146102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m15:12:45.146542 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:12:45.152862 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m15:12:45.153987 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:12:45.154931 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:12:45.155349 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:45.156067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:12:45.156424 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:45.160178 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:12:45.161951 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:45.163336 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:12:45.163952 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:12:45.164440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m15:12:45.164764 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:12:45.168689 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m15:12:45.169406 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:12:45.170234 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:12:45.170580 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:12:45.170931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m15:12:45.171257 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:12:45.174262 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m15:12:45.174806 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:12:45.175530 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:12:45.175874 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:12:45.176301 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m15:12:45.176637 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:12:45.179708 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m15:12:45.180431 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:12:45.181007 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:12:45.181400 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:12:45.181784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m15:12:45.182099 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:12:45.185217 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:12:45.186281 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:12:45.187728 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:12:45.188584 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:12:45.189288 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m15:12:45.189623 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:12:45.192881 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m15:12:45.193470 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:12:45.194038 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:12:45.194368 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:12:45.194712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m15:12:45.195008 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:12:45.198603 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m15:12:45.199176 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:12:45.199741 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:12:45.200070 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:12:45.200413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m15:12:45.200891 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:12:45.205236 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m15:12:45.205883 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:12:45.206445 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:12:45.206785 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:12:45.207169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m15:12:45.207486 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:12:45.210127 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:12:45.210652 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:12:45.211172 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:12:45.211505 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:12:45.211860 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m15:12:45.212144 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:12:45.214875 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:12:45.215389 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:12:45.215919 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:12:45.216259 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:45.216573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:12:45.216968 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:45.220986 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:12:45.221696 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:45.222233 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:12:45.224240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:45.225239 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m15:12:45.230566 [debug] [MainThread]: Command end result
[0m15:12:45.332957 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:12:45.341401 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:12:45.355615 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:12:45.364382 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m15:12:45.364980 [info ] [MainThread]: Building catalog
[0m15:12:45.374251 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m15:12:45.433146 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m15:12:45.434278 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m15:12:45.439049 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:05.902508 [debug] [ThreadPool]: SQL status: SUCCESS in 20.453 seconds
[0m15:13:05.946871 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m15:13:06.026184 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:13:06.083714 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:13:06.096675 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:13:06.097410 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:13:06.117073 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 23.353966, "process_in_blocks": "76288", "process_kernel_time": 0.923128, "process_mem_max_rss": "287980", "process_out_blocks": "5916", "process_user_time": 3.315008}
[0m15:13:06.119818 [debug] [MainThread]: Command `cli docs generate` succeeded at 15:13:06.119211 after 23.37 seconds
[0m15:13:06.121797 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:13:06.122323 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m15:13:06.124976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04e10d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03f3c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03f2ae0>]}
[0m15:13:06.127704 [debug] [MainThread]: Flushing usage events
[0m15:13:06.673765 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:13:18.629587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff025d820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0e8e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0851ee0>]}


============================== 15:13:18.645030 | c2c62855-9b37-430c-9c13-c65e03334082 ==============================
[0m15:13:18.645030 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:13:18.647263 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'empty': 'False', 'invocation_command': 'dbt celery worker', 'use_colors': 'True', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'no_print': 'None', 'partial_parse': 'True'}
[0m15:13:18.889946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01a6780>]}
[0m15:13:18.962986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff001d070>]}
[0m15:13:18.964091 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:13:19.295888 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:13:19.429720 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:13:19.430512 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:13:19.492613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefccda00>]}
[0m15:13:19.579275 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:13:19.581903 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:13:19.593182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f7650>]}
[0m15:13:19.594266 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:13:19.595326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81fec0>]}
[0m15:13:19.597825 [info ] [MainThread]: 
[0m15:13:19.598579 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:13:19.599633 [info ] [MainThread]: 
[0m15:13:19.601113 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:13:19.615008 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:13:19.649245 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:13:19.649870 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:13:19.650241 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:19.650565 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:13:19.652233 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5198b0>]}
[0m15:13:20.218456 [debug] [ThreadPool]: SQL status: SUCCESS in 0.567 seconds
[0m15:13:20.220685 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:13:20.224534 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:13:20.242673 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:13:20.243355 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:13:20.243928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:20.915858 [debug] [ThreadPool]: SQL status: SUCCESS in 0.671 seconds
[0m15:13:20.919837 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:13:20.920254 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:13:20.921555 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:13:20.930706 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:13:20.931154 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:13:20.931721 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:21.192134 [debug] [ThreadPool]: SQL status: SUCCESS in 0.260 seconds
[0m15:13:21.194937 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:13:21.195511 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:13:21.196645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:13:21.202148 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:13:21.205546 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:13:21.205939 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:21.468191 [debug] [ThreadPool]: SQL status: SUCCESS in 0.262 seconds
[0m15:13:21.470970 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:13:21.471552 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:13:21.475711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef51a570>]}
[0m15:13:21.479556 [debug] [MainThread]: On master: COMMIT
[0m15:13:21.492127 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:13:21.495669 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m15:13:21.497004 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m15:13:21.501135 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:13:21.525958 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:13:21.529954 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:13:21.619956 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:13:21.622839 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:13:21.623343 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m15:13:21.623681 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:13:24.856974 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 3.231 seconds
[0m15:13:24.893761 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:13:24.894506 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:13:25.000113 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.105 seconds
[0m15:13:25.003387 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:13:25.003741 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m15:13:25.090570 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.086 seconds
[0m15:13:25.099219 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:13:25.102246 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m15:13:25.102837 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m15:13:25.183550 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.080 seconds
[0m15:13:25.214429 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m15:13:25.215065 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m15:13:25.221696 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff7a2a060>]}
[0m15:13:25.223144 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 3.72s]
[0m15:13:25.224611 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:13:25.225396 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:13:25.226610 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m15:13:25.228033 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:13:25.229292 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:13:25.239275 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:13:25.240844 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:13:25.245670 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:13:25.249299 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:13:25.249915 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m15:13:25.250406 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:13:26.781810 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 1.530 seconds
[0m15:13:26.814393 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:13:26.815030 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:13:26.926403 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.111 seconds
[0m15:13:26.932276 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:13:26.932676 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m15:13:27.019716 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.086 seconds
[0m15:13:27.027147 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:13:27.028744 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:13:27.029224 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m15:13:27.115585 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.086 seconds
[0m15:13:27.118530 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m15:13:27.119065 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m15:13:27.121300 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef44c1d0>]}
[0m15:13:27.123341 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 1.89s]
[0m15:13:27.125922 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:13:27.130890 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:13:27.133402 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m15:13:27.134722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:13:27.136467 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:13:27.153152 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:13:27.158017 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:13:27.168518 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:13:27.174939 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:13:27.175820 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m15:13:27.176441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:13:29.053634 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 1.874 seconds
[0m15:13:29.121434 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:13:29.123088 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:13:29.284078 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.160 seconds
[0m15:13:29.288145 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:13:29.288927 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m15:13:29.403001 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.113 seconds
[0m15:13:29.406727 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:13:29.407720 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:13:29.408179 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m15:13:29.441861 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.033 seconds
[0m15:13:29.448897 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m15:13:29.449438 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m15:13:29.456170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5221b0>]}
[0m15:13:29.458223 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 2.32s]
[0m15:13:29.459236 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:13:29.460050 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:13:29.461257 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m15:13:29.461967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:13:29.462531 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:13:29.470367 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:13:29.471587 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:13:29.474753 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:13:29.477854 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:13:29.478312 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m15:13:29.478714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:13:43.219191 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 13.735 seconds
[0m15:13:43.303946 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:13:43.304983 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:13:43.477898 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.172 seconds
[0m15:13:43.485688 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:13:43.486271 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m15:13:43.575194 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.088 seconds
[0m15:13:43.581837 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:13:43.584385 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m15:13:43.585128 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m15:13:43.640561 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.055 seconds
[0m15:13:43.643583 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m15:13:43.644074 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m15:13:43.648288 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2c62855-9b37-430c-9c13-c65e03334082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3ca990>]}
[0m15:13:43.653562 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 14.18s]
[0m15:13:43.654989 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:13:43.675603 [debug] [MainThread]: On master: COMMIT
[0m15:13:43.678465 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:13:43.679056 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m15:13:43.682164 [info ] [MainThread]: 
[0m15:13:43.684095 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 24.08 seconds (24.08s).
[0m15:13:43.688738 [debug] [MainThread]: Command end result
[0m15:13:43.737858 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:13:43.756348 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:13:43.803937 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:13:43.804582 [info ] [MainThread]: 
[0m15:13:43.806462 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:13:43.807610 [info ] [MainThread]: 
[0m15:13:43.809325 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:13:43.821687 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.35047, "process_in_blocks": "204416", "process_kernel_time": 1.333918, "process_mem_max_rss": "287732", "process_out_blocks": "2286", "process_user_time": 3.429055}
[0m15:13:43.823939 [debug] [MainThread]: Command `cli run` succeeded at 15:13:43.823709 after 25.36 seconds
[0m15:13:43.826055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b03aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81c1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01a5970>]}
[0m15:13:43.826621 [debug] [MainThread]: Flushing usage events
[0m15:13:44.524791 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:13:49.110736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0ddfb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0ddf860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c21310>]}


============================== 15:13:49.127950 | 10a5856b-3d54-4afc-bc01-2d019ca838c8 ==============================
[0m15:13:49.127950 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:13:49.128786 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:13:49.404094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff1c3e0>]}
[0m15:13:49.479784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f09bb0>]}
[0m15:13:49.480777 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:13:49.813763 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:13:49.985140 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:13:49.986388 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:13:50.100353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefce3c50>]}
[0m15:13:50.211599 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:13:50.214250 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:13:50.225248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838f20>]}
[0m15:13:50.226019 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:13:50.226539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef848f50>]}
[0m15:13:50.229256 [info ] [MainThread]: 
[0m15:13:50.229818 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:13:50.230268 [info ] [MainThread]: 
[0m15:13:50.231037 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:13:50.239079 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:13:50.337087 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:13:50.337846 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:13:50.338188 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:50.338499 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:13:50.340324 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef528950>]}
[0m15:13:50.845527 [debug] [ThreadPool]: SQL status: SUCCESS in 0.506 seconds
[0m15:13:50.847918 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:13:50.852483 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:13:50.874144 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:13:50.874856 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:13:50.875204 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:51.814144 [debug] [ThreadPool]: SQL status: SUCCESS in 0.938 seconds
[0m15:13:51.816891 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:13:51.817310 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:13:51.818191 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:13:51.823842 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:13:51.824227 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:13:51.824552 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:52.088855 [debug] [ThreadPool]: SQL status: SUCCESS in 0.264 seconds
[0m15:13:52.091489 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:13:52.091917 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:13:52.092775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:13:52.101312 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:13:52.101933 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:13:52.102597 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:13:52.318054 [debug] [ThreadPool]: SQL status: SUCCESS in 0.215 seconds
[0m15:13:52.321849 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:13:52.322700 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:13:52.327866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff05524b0>]}
[0m15:13:52.332414 [debug] [MainThread]: On master: COMMIT
[0m15:13:52.345524 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:13:52.346621 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m15:13:52.347545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:13:52.348004 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:13:52.359820 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:13:52.364058 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:13:52.425285 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:13:52.431005 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:13:52.431417 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m15:13:52.431821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:13:55.452376 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 3.015 seconds
[0m15:13:55.484648 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:13:55.486447 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:13:55.579965 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.093 seconds
[0m15:13:55.583480 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:13:55.583830 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m15:13:55.681046 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.096 seconds
[0m15:13:55.692875 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:13:55.695548 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m15:13:55.696052 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m15:13:55.749328 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.053 seconds
[0m15:13:55.782135 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m15:13:55.783052 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m15:13:55.787934 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3bcbf0>]}
[0m15:13:55.790413 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 3.44s]
[0m15:13:55.795919 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:13:55.800884 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:13:55.802512 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m15:13:55.803435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m15:13:55.803875 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:13:55.810568 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:13:55.812101 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:13:55.816438 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:13:55.827545 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:13:55.828251 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m15:13:55.828750 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:13:58.683666 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 2.853 seconds
[0m15:13:58.698144 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:13:58.698810 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:13:58.992373 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.293 seconds
[0m15:13:58.997329 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:13:58.998030 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m15:13:59.142092 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.143 seconds
[0m15:13:59.147190 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:13:59.148217 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m15:13:59.148569 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m15:13:59.240696 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.092 seconds
[0m15:13:59.256652 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m15:13:59.258653 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m15:13:59.265226 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef475460>]}
[0m15:13:59.269942 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 3.46s]
[0m15:13:59.275255 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:13:59.276350 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:13:59.280002 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m15:13:59.281763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:13:59.284839 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:13:59.303519 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:13:59.305350 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:13:59.311825 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:13:59.329488 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:13:59.330609 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m15:13:59.331578 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:14:01.963155 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.630 seconds
[0m15:14:01.974878 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:14:01.975396 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:14:02.025664 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.050 seconds
[0m15:14:02.029720 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:14:02.030321 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m15:14:02.091732 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.061 seconds
[0m15:14:02.094961 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:14:02.095819 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m15:14:02.096172 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m15:14:02.129553 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.033 seconds
[0m15:14:02.132219 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m15:14:02.132609 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m15:14:02.134317 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3edf10>]}
[0m15:14:02.136976 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 2.85s]
[0m15:14:02.139932 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:14:02.141557 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:14:02.144796 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m15:14:02.145712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m15:14:02.146295 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:14:02.153003 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:02.155308 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:14:02.172100 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:02.204791 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:02.206399 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m15:14:02.207854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:14:04.052113 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 1.843 seconds
[0m15:14:04.069891 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:04.070878 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:14:04.143740 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.072 seconds
[0m15:14:04.152358 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:04.153139 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m15:14:04.264404 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.110 seconds
[0m15:14:04.276143 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:14:04.277651 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:04.278092 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m15:14:04.329891 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.051 seconds
[0m15:14:04.332522 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m15:14:04.332950 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m15:14:04.334846 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10a5856b-3d54-4afc-bc01-2d019ca838c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2d0770>]}
[0m15:14:04.336141 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.19s]
[0m15:14:04.336948 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:14:04.344737 [debug] [MainThread]: On master: COMMIT
[0m15:14:04.346560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:04.347173 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m15:14:04.349488 [info ] [MainThread]: 
[0m15:14:04.350438 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 14.12 seconds (14.12s).
[0m15:14:04.353057 [debug] [MainThread]: Command end result
[0m15:14:04.395215 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:14:04.400044 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:14:04.420997 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:14:04.421498 [info ] [MainThread]: 
[0m15:14:04.422044 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:14:04.422874 [info ] [MainThread]: 
[0m15:14:04.423722 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m15:14:04.428452 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.433148, "process_in_blocks": "82288", "process_kernel_time": 1.28311, "process_mem_max_rss": "289608", "process_out_blocks": "2421", "process_user_time": 3.805087}
[0m15:14:04.429785 [debug] [MainThread]: Command `cli run` succeeded at 15:14:04.429608 after 15.44 seconds
[0m15:14:04.430919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0215df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe1f530>]}
[0m15:14:04.431470 [debug] [MainThread]: Flushing usage events
[0m15:14:04.975091 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:14:09.033852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff093be00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff10a69f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06a53a0>]}


============================== 15:14:09.049624 | 3ee72658-46c6-40f8-a65e-6470d564a939 ==============================
[0m15:14:09.049624 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:14:09.050721 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:14:09.258947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff01100>]}
[0m15:14:09.337556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff195a8d0>]}
[0m15:14:09.338566 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:14:09.646878 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:14:09.778258 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:14:09.779102 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:14:09.841546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd4e780>]}
[0m15:14:10.048544 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:14:10.053144 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:14:10.073384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f7620>]}
[0m15:14:10.074896 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:14:10.075711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81ffe0>]}
[0m15:14:10.081548 [info ] [MainThread]: 
[0m15:14:10.082568 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:14:10.083150 [info ] [MainThread]: 
[0m15:14:10.084394 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:14:10.093899 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m15:14:10.129563 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m15:14:10.130129 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m15:14:10.130470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:10.130737 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:14:10.132228 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef81e8d0>]}
[0m15:14:10.612942 [debug] [ThreadPool]: SQL status: SUCCESS in 0.482 seconds
[0m15:14:10.616080 [debug] [ThreadPool]: On list_iceberg: Close
[0m15:14:10.621644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m15:14:10.648753 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:14:10.649512 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:14:10.649934 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:11.130867 [debug] [ThreadPool]: SQL status: SUCCESS in 0.480 seconds
[0m15:14:11.134417 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:14:11.134940 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:14:11.136068 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:14:11.147922 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:14:11.149021 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:14:11.149519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:11.485108 [debug] [ThreadPool]: SQL status: SUCCESS in 0.335 seconds
[0m15:14:11.487710 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:14:11.488246 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:14:11.489119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:14:11.495866 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:14:11.496424 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:14:11.496777 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:11.942889 [debug] [ThreadPool]: SQL status: SUCCESS in 0.445 seconds
[0m15:14:11.951882 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:14:11.952717 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:14:11.970920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff195ab70>]}
[0m15:14:11.974101 [debug] [MainThread]: On master: COMMIT
[0m15:14:12.017727 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:14:12.023248 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m15:14:12.030476 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m15:14:12.035841 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:14:12.081282 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:12.083022 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:14:12.171466 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:12.181646 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:12.182500 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m15:14:12.183142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:14:14.358277 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 2.173 seconds
[0m15:14:14.391267 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:14.392126 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:14:14.555476 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.163 seconds
[0m15:14:14.563615 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:14.564445 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m15:14:14.667552 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.102 seconds
[0m15:14:14.682264 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:14:14.685483 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:14.686097 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m15:14:14.746300 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.060 seconds
[0m15:14:14.774106 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m15:14:14.774918 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m15:14:14.779632 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef41e810>]}
[0m15:14:14.781200 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 2.75s]
[0m15:14:14.786326 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:14:14.787073 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:14.788485 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m15:14:14.789223 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:14:14.789717 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:14.803418 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:14.805023 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:14.810584 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:14.820723 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:14.822073 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m15:14:14.823150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:14:17.122470 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.297 seconds
[0m15:14:17.142771 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:17.143507 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:14:17.227039 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.083 seconds
[0m15:14:17.230380 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:17.230793 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m15:14:17.281555 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.050 seconds
[0m15:14:17.285380 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:14:17.286247 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:17.286610 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m15:14:17.332019 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.045 seconds
[0m15:14:17.338285 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m15:14:17.338828 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m15:14:17.342485 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef41e7b0>]}
[0m15:14:17.343839 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.55s]
[0m15:14:17.346008 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:17.346795 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:14:17.348067 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m15:14:17.348839 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m15:14:17.349399 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:14:17.357385 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:14:17.359081 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:14:17.363309 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m15:14:17.367107 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:14:17.367582 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m15:14:17.367994 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:14:18.867600 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.498 seconds
[0m15:14:18.886801 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:14:18.889151 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:14:18.973284 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.084 seconds
[0m15:14:18.976848 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:14:18.977390 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m15:14:19.013117 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.035 seconds
[0m15:14:19.016301 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:14:19.017072 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m15:14:19.017403 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m15:14:19.049753 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.032 seconds
[0m15:14:19.052249 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m15:14:19.052632 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m15:14:19.054130 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ee72658-46c6-40f8-a65e-6470d564a939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5ae510>]}
[0m15:14:19.055145 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.70s]
[0m15:14:19.055898 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:14:19.060772 [debug] [MainThread]: On master: COMMIT
[0m15:14:19.061768 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:19.062101 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m15:14:19.063517 [info ] [MainThread]: 
[0m15:14:19.064068 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 8.98 seconds (8.98s).
[0m15:14:19.066229 [debug] [MainThread]: Command end result
[0m15:14:19.090761 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:14:19.095502 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:14:19.116873 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:14:19.117516 [info ] [MainThread]: 
[0m15:14:19.118074 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:14:19.119092 [info ] [MainThread]: 
[0m15:14:19.120154 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m15:14:19.122399 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.151264, "process_in_blocks": "41112", "process_kernel_time": 0.851291, "process_mem_max_rss": "288400", "process_out_blocks": "2297", "process_user_time": 3.23031}
[0m15:14:19.123172 [debug] [MainThread]: Command `cli run` succeeded at 15:14:19.123050 after 10.15 seconds
[0m15:14:19.123885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff10a69f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0687e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0bf4d70>]}
[0m15:14:19.124254 [debug] [MainThread]: Flushing usage events
[0m15:14:19.684824 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:14:23.608944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12e3ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0233980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0691fa0>]}


============================== 15:14:23.624619 | d5af3359-f7ff-4e9d-a60a-01928b3bab24 ==============================
[0m15:14:23.624619 [info ] [MainThread]: Running with dbt=1.10.10
[0m15:14:23.626381 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m15:14:23.841896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c20e90>]}
[0m15:14:23.910576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1995280>]}
[0m15:14:23.911437 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m15:14:24.184858 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m15:14:24.307101 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:14:24.307948 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:14:24.377008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b4d0>]}
[0m15:14:24.388741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaa5fa0>]}
[0m15:14:24.389501 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:14:24.390073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe8d760>]}
[0m15:14:24.393182 [info ] [MainThread]: 
[0m15:14:24.393643 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m15:14:24.393980 [info ] [MainThread]: 
[0m15:14:24.395155 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:14:24.401817 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:14:24.439800 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:14:24.440578 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:14:24.440912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:24.441187 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:14:24.442809 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4e2f00>]}
[0m15:14:24.837002 [debug] [ThreadPool]: SQL status: SUCCESS in 0.395 seconds
[0m15:14:24.840034 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:14:24.840685 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:14:24.842821 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m15:14:24.853417 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:14:24.854002 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:14:24.854332 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:25.311418 [debug] [ThreadPool]: SQL status: SUCCESS in 0.457 seconds
[0m15:14:25.315377 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:14:25.315944 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:14:25.317204 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m15:14:25.329091 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:14:25.329909 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:14:25.330419 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:25.669337 [debug] [ThreadPool]: SQL status: SUCCESS in 0.339 seconds
[0m15:14:25.671708 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:14:25.672111 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:14:25.675744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5af3359-f7ff-4e9d-a60a-01928b3bab24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc12e0>]}
[0m15:14:25.695142 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m15:14:25.695888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m15:14:25.696314 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m15:14:25.699287 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m15:14:25.700221 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m15:14:25.700708 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:14:25.701364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m15:14:25.701871 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:14:25.703464 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:14:25.704024 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:14:25.704400 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:14:25.704850 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m15:14:25.705179 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m15:14:25.707795 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m15:14:25.708377 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:14:25.708699 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m15:14:25.709128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m15:14:25.709446 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m15:14:25.710815 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m15:14:25.711363 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m15:14:25.711739 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:14:25.712230 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m15:14:25.712527 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:14:25.717272 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:14:25.718254 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:14:25.718805 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:14:25.719128 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:14:25.719533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:14:25.720004 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:14:25.722465 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:14:25.723057 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:14:25.723575 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:14:25.723908 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:14:25.724276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:14:25.724636 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:14:25.726857 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:14:25.727345 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:14:25.727827 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:14:25.728124 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:14:25.728483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:14:25.728907 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:14:25.731072 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:14:25.731566 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:14:25.732041 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:14:25.732368 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:14:25.732781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:14:25.733094 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:14:25.735355 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:14:25.735820 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:14:25.736338 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:14:25.736696 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:14:25.737023 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m15:14:25.737312 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:14:25.747825 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m15:14:25.748477 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:14:25.748988 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:14:25.749313 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:14:25.749645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m15:14:25.749927 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:14:25.752659 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m15:14:25.753178 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:14:25.753665 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:14:25.753969 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:14:25.754298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m15:14:25.754577 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:14:25.757094 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m15:14:25.757576 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:14:25.758124 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:14:25.758481 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:14:25.758814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m15:14:25.759090 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:14:25.764061 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m15:14:25.764683 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:14:25.765221 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:14:25.765563 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:14:25.765940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m15:14:25.766264 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:14:25.769808 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:14:25.770338 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:14:25.770845 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:14:25.771184 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:14:25.771641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m15:14:25.771938 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:14:25.774582 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m15:14:25.775063 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:14:25.775552 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:14:25.775865 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:14:25.776226 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m15:14:25.776523 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:14:25.779011 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m15:14:25.779666 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:14:25.780182 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:14:25.780635 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:14:25.780964 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m15:14:25.781265 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:14:25.783867 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m15:14:25.784351 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:14:25.784844 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:14:25.785155 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:14:25.785479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m15:14:25.785753 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:14:25.788208 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m15:14:25.788657 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:14:25.789125 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:14:25.789438 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:14:25.789749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:14:25.790059 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:14:25.792733 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:14:25.793459 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:14:25.793991 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:14:25.794324 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:14:25.794688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m15:14:25.794965 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:14:25.797668 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m15:14:25.798177 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:14:25.798677 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:14:25.798979 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:14:25.799301 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m15:14:25.799649 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:14:25.802128 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m15:14:25.802599 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:14:25.803089 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:14:25.803399 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:14:25.803715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m15:14:25.803989 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:14:25.806576 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m15:14:25.807057 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:14:25.807588 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:14:25.807938 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:14:25.808277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m15:14:25.808562 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:14:25.811205 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:14:25.811697 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:14:25.812220 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:14:25.812531 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:14:25.812954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m15:14:25.813275 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:14:25.816083 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m15:14:25.816684 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:14:25.817167 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:14:25.817466 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:14:25.817794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m15:14:25.818072 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:14:25.821587 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m15:14:25.822053 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:14:25.822534 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:14:25.822831 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:14:25.823142 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m15:14:25.823438 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:14:25.827456 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m15:14:25.828133 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:14:25.828945 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:14:25.829376 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:14:25.829727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m15:14:25.830014 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:14:25.833510 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:14:25.834322 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:14:25.834971 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:14:25.835341 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:14:25.835735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m15:14:25.836059 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:14:25.839018 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:14:25.839666 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:14:25.840225 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:14:25.840556 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:25.840902 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:14:25.841216 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:25.844270 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:14:25.844870 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:25.845414 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:14:25.847345 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:25.848106 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m15:14:25.852766 [debug] [MainThread]: Command end result
[0m15:14:25.957567 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:14:25.968936 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:14:25.981610 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m15:14:25.988948 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m15:14:25.989602 [info ] [MainThread]: Building catalog
[0m15:14:25.995760 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m15:14:26.050961 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m15:14:26.052317 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m15:14:26.055323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:37.685294 [debug] [ThreadPool]: SQL status: SUCCESS in 11.629 seconds
[0m15:14:37.705130 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m15:14:37.753248 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:14:37.784781 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m15:14:37.791279 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m15:14:37.791900 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m15:14:37.795317 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 14.263272, "process_in_blocks": "34784", "process_kernel_time": 0.754776, "process_mem_max_rss": "290512", "process_out_blocks": "5916", "process_user_time": 2.613688}
[0m15:14:37.796635 [debug] [MainThread]: Command `cli docs generate` succeeded at 15:14:37.796436 after 14.27 seconds
[0m15:14:37.797378 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:14:37.797667 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m15:14:37.798318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0342900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08a5700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55c8230>]}
[0m15:14:37.798991 [debug] [MainThread]: Flushing usage events
[0m15:14:38.260555 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:32:38.981778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04fcb00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04fda60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e7c80>]}


============================== 16:32:39.005878 | e1c47d3c-913d-4a7a-9917-ee903322b41a ==============================
[0m16:32:39.005878 [info ] [MainThread]: Running with dbt=1.10.10
[0m16:32:39.008569 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m16:32:39.706850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0230860>]}
[0m16:32:39.773731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff071d520>]}
[0m16:32:39.774548 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m16:32:40.550125 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m16:32:40.804874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:32:40.805772 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:32:40.882138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe21a00>]}
[0m16:32:40.988458 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:32:40.996759 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:32:41.026568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80f5f0>]}
[0m16:32:41.028661 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m16:32:41.031116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83bf50>]}
[0m16:32:41.041647 [info ] [MainThread]: 
[0m16:32:41.042582 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m16:32:41.043088 [info ] [MainThread]: 
[0m16:32:41.044295 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:32:41.081951 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m16:32:41.166744 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m16:32:41.167234 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m16:32:41.167551 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:32:41.167817 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m16:32:41.169881 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80a780>]}
[0m16:32:47.475009 [debug] [ThreadPool]: SQL status: SUCCESS in 6.299 seconds
[0m16:32:47.482411 [debug] [ThreadPool]: On list_iceberg: Close
[0m16:32:47.491729 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m16:32:47.520240 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m16:32:47.520814 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m16:32:47.521309 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:32:49.428533 [debug] [ThreadPool]: SQL status: SUCCESS in 1.907 seconds
[0m16:32:49.430880 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m16:32:49.431257 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m16:32:49.432115 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m16:32:49.439119 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m16:32:49.439479 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m16:32:49.439790 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:32:49.857049 [debug] [ThreadPool]: SQL status: SUCCESS in 0.417 seconds
[0m16:32:49.861090 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m16:32:49.861602 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m16:32:49.862837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m16:32:49.871960 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m16:32:49.872379 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m16:32:49.872724 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:32:50.412454 [debug] [ThreadPool]: SQL status: SUCCESS in 0.540 seconds
[0m16:32:50.415611 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m16:32:50.416460 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m16:32:50.419859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe21a30>]}
[0m16:32:50.424423 [debug] [MainThread]: On master: COMMIT
[0m16:32:50.438763 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m16:32:50.442686 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m16:32:50.443782 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m16:32:50.447354 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m16:32:50.454994 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m16:32:50.457414 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m16:32:50.516418 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m16:32:50.520059 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m16:32:50.520660 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m16:32:50.521032 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:32:56.235643 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 5.713 seconds
[0m16:32:56.275056 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m16:32:56.275653 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m16:32:56.372679 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.097 seconds
[0m16:32:56.376211 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m16:32:56.376616 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m16:32:56.446526 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.069 seconds
[0m16:32:56.454068 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m16:32:56.456254 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m16:32:56.456612 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m16:32:56.485955 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.029 seconds
[0m16:32:56.510289 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m16:32:56.510803 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m16:32:56.517277 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef3e90>]}
[0m16:32:56.518443 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 6.07s]
[0m16:32:56.520670 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m16:32:56.521613 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:32:56.526261 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m16:32:56.527437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m16:32:56.527936 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:32:56.533240 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:32:56.534480 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:32:56.539421 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:32:56.541976 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:32:56.542421 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m16:32:56.542860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:32:58.267123 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 1.718 seconds
[0m16:32:58.282331 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:32:58.282904 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m16:32:58.352089 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.068 seconds
[0m16:32:58.355235 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:32:58.355603 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m16:32:58.403699 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.048 seconds
[0m16:32:58.406972 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m16:32:58.407893 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:32:58.408246 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m16:32:58.434032 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.025 seconds
[0m16:32:58.436497 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m16:32:58.436929 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m16:32:58.438645 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef44a720>]}
[0m16:32:58.439833 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 1.91s]
[0m16:32:58.442649 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:32:58.443388 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m16:32:58.446051 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m16:32:58.447245 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m16:32:58.448225 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m16:32:58.459383 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:32:58.460696 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m16:32:58.464190 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:32:58.466670 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:32:58.467057 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m16:32:58.467471 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:01.702122 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.232 seconds
[0m16:33:01.723143 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:33:01.723783 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m16:33:01.813833 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.089 seconds
[0m16:33:01.817980 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:33:01.818505 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m16:33:01.930061 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.111 seconds
[0m16:33:01.934237 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m16:33:01.935333 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:33:01.935730 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m16:33:01.991347 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.055 seconds
[0m16:33:01.996880 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m16:33:01.997686 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m16:33:01.999866 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4414c0>]}
[0m16:33:02.001883 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 3.55s]
[0m16:33:02.003413 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m16:33:02.004386 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:02.009274 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m16:33:02.010219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m16:33:02.010686 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:02.021322 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:02.022981 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:02.029213 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:02.034322 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:02.034888 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m16:33:02.035721 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:03.664348 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 1.627 seconds
[0m16:33:03.684118 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:03.684938 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m16:33:03.809980 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.124 seconds
[0m16:33:03.815208 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:03.816238 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m16:33:03.915630 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m16:33:03.919432 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m16:33:03.920405 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:03.920752 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m16:33:03.955221 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.034 seconds
[0m16:33:03.962474 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m16:33:03.963711 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m16:33:03.968106 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1c47d3c-913d-4a7a-9917-ee903322b41a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef42e270>]}
[0m16:33:03.969842 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 1.96s]
[0m16:33:03.970694 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:03.985274 [debug] [MainThread]: On master: COMMIT
[0m16:33:03.986951 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:33:03.987400 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m16:33:03.991692 [info ] [MainThread]: 
[0m16:33:03.993547 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 22.94 seconds (22.94s).
[0m16:33:03.998812 [debug] [MainThread]: Command end result
[0m16:33:04.040921 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:04.065824 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:04.091596 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m16:33:04.092213 [info ] [MainThread]: 
[0m16:33:04.093109 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:33:04.093681 [info ] [MainThread]: 
[0m16:33:04.099166 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m16:33:04.103587 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.237165, "process_in_blocks": "46008", "process_kernel_time": 1.396441, "process_mem_max_rss": "287104", "process_out_blocks": "2286", "process_user_time": 3.889292}
[0m16:33:04.106431 [debug] [MainThread]: Command `cli run` succeeded at 16:33:04.106104 after 25.24 seconds
[0m16:33:04.111194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b32690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefff4980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0214920>]}
[0m16:33:04.111984 [debug] [MainThread]: Flushing usage events
[0m16:33:04.917758 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:33:10.318419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06912e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0691dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c739b0>]}


============================== 16:33:10.337858 | 003c13eb-22e9-4b08-bf03-b366dc02cb79 ==============================
[0m16:33:10.337858 [info ] [MainThread]: Running with dbt=1.10.10
[0m16:33:10.338708 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m16:33:10.569138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff009cc20>]}
[0m16:33:10.644670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0d6a900>]}
[0m16:33:10.645537 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m16:33:10.910231 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m16:33:11.049243 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:33:11.050151 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:33:11.114480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcea090>]}
[0m16:33:11.214420 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:11.217132 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:11.228178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b350>]}
[0m16:33:11.229005 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m16:33:11.229584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff14599d0>]}
[0m16:33:11.232102 [info ] [MainThread]: 
[0m16:33:11.232548 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m16:33:11.232836 [info ] [MainThread]: 
[0m16:33:11.233776 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:33:11.241620 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m16:33:11.271278 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m16:33:11.271817 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m16:33:11.272138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:33:11.272425 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m16:33:11.274015 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef857650>]}
[0m16:33:11.571727 [debug] [ThreadPool]: SQL status: SUCCESS in 0.298 seconds
[0m16:33:11.574775 [debug] [ThreadPool]: On list_iceberg: Close
[0m16:33:11.579529 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m16:33:11.595107 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m16:33:11.595690 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m16:33:11.596078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:11.947125 [debug] [ThreadPool]: SQL status: SUCCESS in 0.351 seconds
[0m16:33:11.949333 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m16:33:11.949708 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m16:33:11.950474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m16:33:11.956001 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m16:33:11.956461 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m16:33:11.956782 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:12.160195 [debug] [ThreadPool]: SQL status: SUCCESS in 0.203 seconds
[0m16:33:12.162245 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m16:33:12.162645 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m16:33:12.163424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m16:33:12.167475 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m16:33:12.169197 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m16:33:12.169525 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:12.383670 [debug] [ThreadPool]: SQL status: SUCCESS in 0.214 seconds
[0m16:33:12.385427 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m16:33:12.385738 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m16:33:12.387535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0169880>]}
[0m16:33:12.388651 [debug] [MainThread]: On master: COMMIT
[0m16:33:12.395858 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:12.396758 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m16:33:12.397317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m16:33:12.397714 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:12.403492 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:12.404657 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:12.447949 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:12.453758 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:12.454231 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m16:33:12.454631 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:13.858992 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 1.403 seconds
[0m16:33:13.873424 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:13.874150 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m16:33:13.935621 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.061 seconds
[0m16:33:13.939726 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:13.940151 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m16:33:13.992554 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.052 seconds
[0m16:33:14.000845 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m16:33:14.003267 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:14.003804 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m16:33:14.041769 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.037 seconds
[0m16:33:14.062412 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m16:33:14.062905 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m16:33:14.066177 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef3e60>]}
[0m16:33:14.066938 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 1.67s]
[0m16:33:14.069052 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:14.069800 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m16:33:14.071205 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m16:33:14.072842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m16:33:14.073603 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m16:33:14.084419 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:14.086016 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m16:33:14.091108 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:14.108364 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:14.109371 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m16:33:14.110029 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:16.187958 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 2.076 seconds
[0m16:33:16.203585 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:16.204206 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m16:33:16.286678 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.082 seconds
[0m16:33:16.290432 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:16.290893 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m16:33:16.352853 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.061 seconds
[0m16:33:16.357489 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m16:33:16.359770 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:16.360687 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m16:33:16.400092 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.039 seconds
[0m16:33:16.402583 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m16:33:16.402990 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m16:33:16.404763 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa4ce00>]}
[0m16:33:16.406057 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 2.33s]
[0m16:33:16.407057 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m16:33:16.407777 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:16.408842 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m16:33:16.409494 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m16:33:16.409884 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:16.422392 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:16.423638 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:16.426731 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:16.435062 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:16.435667 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m16:33:16.436231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:19.055517 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.602 seconds
[0m16:33:19.090156 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:19.090750 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m16:33:19.310694 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.219 seconds
[0m16:33:19.317570 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:19.318940 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m16:33:19.468038 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.148 seconds
[0m16:33:19.483456 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m16:33:19.485455 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:19.486015 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m16:33:19.696566 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.210 seconds
[0m16:33:19.704134 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m16:33:19.706949 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m16:33:19.709601 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5ae840>]}
[0m16:33:19.713623 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 3.30s]
[0m16:33:19.714997 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:19.719424 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m16:33:19.723409 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m16:33:19.726181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m16:33:19.727926 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m16:33:19.746322 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:19.751801 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m16:33:19.765501 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:19.788355 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:19.789544 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m16:33:19.790742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:22.727485 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.935 seconds
[0m16:33:22.748504 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:22.749155 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m16:33:22.806664 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.057 seconds
[0m16:33:22.810086 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:22.810487 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m16:33:22.879824 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.069 seconds
[0m16:33:22.885474 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m16:33:22.886686 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:22.887094 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m16:33:22.965381 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.078 seconds
[0m16:33:22.968641 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m16:33:22.969197 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m16:33:22.971314 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003c13eb-22e9-4b08-bf03-b366dc02cb79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4539e0>]}
[0m16:33:22.972898 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 3.25s]
[0m16:33:22.974010 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m16:33:22.992279 [debug] [MainThread]: On master: COMMIT
[0m16:33:22.995190 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:33:22.996091 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m16:33:22.999636 [info ] [MainThread]: 
[0m16:33:23.000941 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 11.76 seconds (11.76s).
[0m16:33:23.003577 [debug] [MainThread]: Command end result
[0m16:33:23.051987 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:23.059755 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:23.097912 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m16:33:23.098438 [info ] [MainThread]: 
[0m16:33:23.098952 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:33:23.099494 [info ] [MainThread]: 
[0m16:33:23.100471 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m16:33:23.103782 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.8550625, "process_in_blocks": "89640", "process_kernel_time": 1.258657, "process_mem_max_rss": "289588", "process_out_blocks": "2421", "process_user_time": 3.188733}
[0m16:33:23.105711 [debug] [MainThread]: Command `cli run` succeeded at 16:33:23.105494 after 12.86 seconds
[0m16:33:23.107222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff07403b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4fe90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4eed0>]}
[0m16:33:23.107741 [debug] [MainThread]: Flushing usage events
[0m16:33:23.694418 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:33:29.630176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19ebcb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016eea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff016fec0>]}


============================== 16:33:29.657800 | 6c3ed965-1307-4655-be43-0fcca0535957 ==============================
[0m16:33:29.657800 [info ] [MainThread]: Running with dbt=1.10.10
[0m16:33:29.660192 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m16:33:29.976227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00461e0>]}
[0m16:33:30.062590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff03f8380>]}
[0m16:33:30.063676 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m16:33:30.363401 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m16:33:30.505259 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:33:30.506116 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:33:30.574377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef7f7800>]}
[0m16:33:30.690824 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:30.693481 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:30.705733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838f80>]}
[0m16:33:30.706624 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m16:33:30.707555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b79e0>]}
[0m16:33:30.710038 [info ] [MainThread]: 
[0m16:33:30.710669 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m16:33:30.711161 [info ] [MainThread]: 
[0m16:33:30.712004 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:33:30.720433 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m16:33:30.751992 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m16:33:30.752515 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m16:33:30.752812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:33:30.753096 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m16:33:30.754569 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef5287a0>]}
[0m16:33:31.113422 [debug] [ThreadPool]: SQL status: SUCCESS in 0.360 seconds
[0m16:33:31.116258 [debug] [ThreadPool]: On list_iceberg: Close
[0m16:33:31.120734 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m16:33:31.138099 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m16:33:31.138593 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m16:33:31.138939 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:31.580177 [debug] [ThreadPool]: SQL status: SUCCESS in 0.441 seconds
[0m16:33:31.583030 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m16:33:31.583484 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m16:33:31.584374 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m16:33:31.590512 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m16:33:31.591059 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m16:33:31.591414 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:31.845242 [debug] [ThreadPool]: SQL status: SUCCESS in 0.254 seconds
[0m16:33:31.847131 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m16:33:31.847544 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m16:33:31.848533 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m16:33:31.856763 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m16:33:31.857428 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m16:33:31.857820 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:32.074951 [debug] [ThreadPool]: SQL status: SUCCESS in 0.217 seconds
[0m16:33:32.076775 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m16:33:32.077136 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m16:33:32.079043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19994f0>]}
[0m16:33:32.080257 [debug] [MainThread]: On master: COMMIT
[0m16:33:32.088421 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m16:33:32.089450 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m16:33:32.090285 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m16:33:32.090671 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m16:33:32.100382 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:32.102118 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m16:33:32.158507 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:32.163612 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:32.164542 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m16:33:32.165145 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:35.650639 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 3.484 seconds
[0m16:33:35.683739 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:35.684569 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m16:33:35.756131 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.071 seconds
[0m16:33:35.760750 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:35.761327 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m16:33:35.815995 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.054 seconds
[0m16:33:35.831638 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m16:33:35.834129 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:35.834638 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m16:33:35.870008 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.035 seconds
[0m16:33:35.927261 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m16:33:35.930123 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m16:33:35.950411 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef458bc0>]}
[0m16:33:35.958025 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 3.85s]
[0m16:33:35.966478 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m16:33:35.969659 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:35.973507 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m16:33:35.976842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m16:33:35.979732 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:36.009170 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:36.013624 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:36.017995 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:36.024287 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:36.024996 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m16:33:36.025512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:38.319131 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.292 seconds
[0m16:33:38.333211 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:38.333799 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m16:33:38.421282 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.087 seconds
[0m16:33:38.425895 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:38.426364 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m16:33:38.506561 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.080 seconds
[0m16:33:38.511193 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m16:33:38.512317 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:38.512800 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m16:33:38.595453 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.082 seconds
[0m16:33:38.598608 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m16:33:38.599090 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m16:33:38.601441 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2b380>]}
[0m16:33:38.603407 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.62s]
[0m16:33:38.608506 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:38.609332 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m16:33:38.609876 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m16:33:38.613635 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m16:33:38.614226 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m16:33:38.630248 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m16:33:38.632015 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m16:33:38.636892 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m16:33:38.643814 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m16:33:38.644421 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m16:33:38.644972 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:33:40.174391 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.528 seconds
[0m16:33:40.188267 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m16:33:40.189110 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m16:33:40.266017 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.076 seconds
[0m16:33:40.269722 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m16:33:40.270226 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m16:33:40.323365 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.053 seconds
[0m16:33:40.327417 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m16:33:40.328362 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m16:33:40.328731 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m16:33:40.352808 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.024 seconds
[0m16:33:40.359288 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m16:33:40.359901 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m16:33:40.365516 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c3ed965-1307-4655-be43-0fcca0535957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc4380>]}
[0m16:33:40.367392 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.75s]
[0m16:33:40.370516 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m16:33:40.377951 [debug] [MainThread]: On master: COMMIT
[0m16:33:40.379446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:33:40.380215 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m16:33:40.385575 [info ] [MainThread]: 
[0m16:33:40.388116 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 9.67 seconds (9.67s).
[0m16:33:40.392356 [debug] [MainThread]: Command end result
[0m16:33:40.419322 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:40.437916 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:40.461316 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m16:33:40.461806 [info ] [MainThread]: 
[0m16:33:40.462669 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:33:40.463206 [info ] [MainThread]: 
[0m16:33:40.464493 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m16:33:40.467424 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.959401, "process_in_blocks": "115904", "process_kernel_time": 1.268559, "process_mem_max_rss": "289416", "process_out_blocks": "2297", "process_user_time": 3.452741}
[0m16:33:40.469114 [debug] [MainThread]: Command `cli run` succeeded at 16:33:40.468959 after 10.96 seconds
[0m16:33:40.470710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff147da90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff09f38f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c4bf20>]}
[0m16:33:40.471205 [debug] [MainThread]: Flushing usage events
[0m16:33:41.105818 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:33:45.223641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f0d640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04fd610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff04fd520>]}


============================== 16:33:45.233765 | dbd1fc43-71b4-4aad-a89d-088244437e99 ==============================
[0m16:33:45.233765 [info ] [MainThread]: Running with dbt=1.10.10
[0m16:33:45.234893 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m16:33:45.449601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bfa40>]}
[0m16:33:45.526557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06fea20>]}
[0m16:33:45.527620 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m16:33:45.781902 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m16:33:45.927706 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:33:45.928670 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:33:46.017671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd683b0>]}
[0m16:33:46.031444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefaae450>]}
[0m16:33:46.032011 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m16:33:46.032409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa57f80>]}
[0m16:33:46.035788 [info ] [MainThread]: 
[0m16:33:46.036325 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m16:33:46.036767 [info ] [MainThread]: 
[0m16:33:46.037943 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:33:46.047832 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m16:33:46.081006 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m16:33:46.081560 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m16:33:46.081929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:33:46.082255 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m16:33:46.083627 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef836d50>]}
[0m16:33:46.528583 [debug] [ThreadPool]: SQL status: SUCCESS in 0.446 seconds
[0m16:33:46.530862 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m16:33:46.531239 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m16:33:46.532216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m16:33:46.538578 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m16:33:46.539005 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m16:33:46.539334 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:46.792266 [debug] [ThreadPool]: SQL status: SUCCESS in 0.253 seconds
[0m16:33:46.796104 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m16:33:46.796970 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m16:33:46.797868 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m16:33:46.804373 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m16:33:46.804823 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m16:33:46.805132 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:33:47.008772 [debug] [ThreadPool]: SQL status: SUCCESS in 0.203 seconds
[0m16:33:47.010950 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m16:33:47.011365 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m16:33:47.016555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbd1fc43-71b4-4aad-a89d-088244437e99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff18e00>]}
[0m16:33:47.024656 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m16:33:47.025483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m16:33:47.026012 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m16:33:47.028826 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m16:33:47.030137 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m16:33:47.031450 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m16:33:47.032834 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m16:33:47.033821 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m16:33:47.036566 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m16:33:47.037560 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m16:33:47.038132 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m16:33:47.038894 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m16:33:47.039891 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m16:33:47.042345 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m16:33:47.043456 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m16:33:47.044192 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m16:33:47.044970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m16:33:47.045667 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m16:33:47.047955 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m16:33:47.048895 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m16:33:47.049442 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m16:33:47.050053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m16:33:47.050642 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m16:33:47.056667 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m16:33:47.058168 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m16:33:47.059288 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m16:33:47.059817 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:33:47.060518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m16:33:47.061095 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:33:47.064615 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m16:33:47.065636 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:33:47.066627 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m16:33:47.067123 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m16:33:47.067703 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m16:33:47.068323 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m16:33:47.071651 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m16:33:47.072546 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m16:33:47.073306 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m16:33:47.073694 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:47.074356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m16:33:47.074741 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:47.078067 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m16:33:47.078990 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:47.079682 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m16:33:47.080213 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:47.080865 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m16:33:47.081230 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:47.085459 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m16:33:47.089231 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:47.091048 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m16:33:47.091582 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m16:33:47.092084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m16:33:47.092479 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m16:33:47.104392 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m16:33:47.105804 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m16:33:47.106838 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m16:33:47.107415 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m16:33:47.108116 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m16:33:47.108766 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m16:33:47.113675 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m16:33:47.114858 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m16:33:47.115805 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m16:33:47.116243 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m16:33:47.116827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m16:33:47.117553 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m16:33:47.122736 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m16:33:47.124036 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m16:33:47.124902 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m16:33:47.125407 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m16:33:47.125979 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m16:33:47.126422 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m16:33:47.132441 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m16:33:47.133559 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m16:33:47.136174 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m16:33:47.138073 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m16:33:47.139316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m16:33:47.140053 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m16:33:47.146677 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m16:33:47.148597 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m16:33:47.150487 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m16:33:47.151484 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m16:33:47.152872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m16:33:47.153875 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m16:33:47.160138 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m16:33:47.161280 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m16:33:47.162147 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m16:33:47.162735 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m16:33:47.163185 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m16:33:47.163541 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m16:33:47.170857 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m16:33:47.172597 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m16:33:47.174430 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m16:33:47.175364 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m16:33:47.176443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m16:33:47.177464 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m16:33:47.183937 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m16:33:47.184777 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m16:33:47.185433 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m16:33:47.185797 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m16:33:47.186264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m16:33:47.186577 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m16:33:47.189505 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m16:33:47.190048 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m16:33:47.190567 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m16:33:47.190916 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:47.191271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m16:33:47.191588 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:47.194290 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m16:33:47.194824 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:47.195427 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m16:33:47.195839 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m16:33:47.196277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m16:33:47.196611 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m16:33:47.201572 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m16:33:47.202230 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m16:33:47.202836 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m16:33:47.203262 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m16:33:47.203691 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m16:33:47.204012 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m16:33:47.207756 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m16:33:47.208504 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m16:33:47.209230 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m16:33:47.209700 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m16:33:47.210331 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m16:33:47.210978 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m16:33:47.218615 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m16:33:47.219845 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m16:33:47.220607 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m16:33:47.221162 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m16:33:47.221673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m16:33:47.221987 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m16:33:47.224798 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m16:33:47.225410 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m16:33:47.225931 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m16:33:47.226258 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m16:33:47.226725 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m16:33:47.227076 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m16:33:47.229809 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m16:33:47.230402 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m16:33:47.230911 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m16:33:47.231267 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m16:33:47.231636 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m16:33:47.231926 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m16:33:47.234558 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m16:33:47.235190 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m16:33:47.235677 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m16:33:47.235979 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m16:33:47.236325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m16:33:47.236611 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m16:33:47.239117 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m16:33:47.239735 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m16:33:47.240219 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m16:33:47.240541 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m16:33:47.240873 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m16:33:47.241172 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m16:33:47.243592 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m16:33:47.244099 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m16:33:47.244607 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m16:33:47.244917 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m16:33:47.245257 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m16:33:47.245550 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m16:33:47.248056 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m16:33:47.248554 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m16:33:47.249044 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m16:33:47.249379 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:47.249713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m16:33:47.250001 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:47.252639 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m16:33:47.253091 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:47.253589 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m16:33:47.255480 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:33:47.256491 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m16:33:47.261369 [debug] [MainThread]: Command end result
[0m16:33:47.398849 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:47.410009 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:47.434341 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m16:33:47.467527 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m16:33:47.468216 [info ] [MainThread]: Building catalog
[0m16:33:47.475590 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m16:33:47.563051 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m16:33:47.564219 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m16:33:47.565255 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:33:51.505920 [debug] [ThreadPool]: SQL status: SUCCESS in 3.937 seconds
[0m16:33:51.520790 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m16:33:51.560562 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m16:33:51.592581 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m16:33:51.597744 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m16:33:51.598205 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m16:33:51.609916 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 6.449771, "process_in_blocks": "61744", "process_kernel_time": 0.872933, "process_mem_max_rss": "289996", "process_out_blocks": "5916", "process_user_time": 2.738575}
[0m16:33:51.611875 [debug] [MainThread]: Command `cli docs generate` succeeded at 16:33:51.611578 after 6.46 seconds
[0m16:33:51.612831 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m16:33:51.613310 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m16:33:51.614265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c14c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c154f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c50fe0>]}
[0m16:33:51.615329 [debug] [MainThread]: Flushing usage events
[0m16:33:52.071569 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:32:48.798567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff19e7c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01bb4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01b9940>]}


============================== 22:32:48.826309 | 87832efa-f174-423e-b3c9-e59a9c0064ba ==============================
[0m22:32:48.826309 [info ] [MainThread]: Running with dbt=1.10.10
[0m22:32:48.827213 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m22:32:49.182284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff004b8c0>]}
[0m22:32:49.256320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b609b0>]}
[0m22:32:49.257344 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m22:32:49.712307 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m22:32:49.892182 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:32:49.893104 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:32:49.962700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefe1c1a0>]}
[0m22:32:50.067475 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:32:50.071014 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:32:50.088359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80f380>]}
[0m22:32:50.089459 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m22:32:50.092241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83bf50>]}
[0m22:32:50.097417 [info ] [MainThread]: 
[0m22:32:50.098255 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m22:32:50.098785 [info ] [MainThread]: 
[0m22:32:50.099837 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m22:32:50.113987 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m22:32:50.184979 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m22:32:50.185678 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m22:32:50.186051 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:50.186365 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m22:32:50.188367 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef529010>]}
[0m22:32:51.695542 [debug] [ThreadPool]: SQL status: SUCCESS in 1.505 seconds
[0m22:32:51.702592 [debug] [ThreadPool]: On list_iceberg: Close
[0m22:32:51.715776 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m22:32:51.744664 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m22:32:51.745470 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m22:32:51.745949 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:32:53.997019 [debug] [ThreadPool]: SQL status: SUCCESS in 2.250 seconds
[0m22:32:54.003987 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m22:32:54.004737 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m22:32:54.006453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m22:32:54.016315 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m22:32:54.016833 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m22:32:54.017441 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:32:55.578016 [debug] [ThreadPool]: SQL status: SUCCESS in 1.560 seconds
[0m22:32:55.583803 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m22:32:55.585907 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m22:32:55.589274 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m22:32:55.602891 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m22:32:55.603677 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m22:32:55.604183 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:32:57.531474 [debug] [ThreadPool]: SQL status: SUCCESS in 1.926 seconds
[0m22:32:57.551992 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m22:32:57.552922 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m22:32:57.560415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4caa4e0>]}
[0m22:32:57.563602 [debug] [MainThread]: On master: COMMIT
[0m22:32:57.586795 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m22:32:57.588712 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m22:32:57.593432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m22:32:57.595638 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m22:32:57.621248 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m22:32:57.623797 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m22:32:57.707623 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m22:32:57.711582 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m22:32:57.712968 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m22:32:57.713524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:10.445397 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 12.721 seconds
[0m22:33:10.559776 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m22:33:10.561088 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m22:33:10.879942 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.318 seconds
[0m22:33:10.895676 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m22:33:10.896328 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m22:33:11.203855 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.307 seconds
[0m22:33:11.223164 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m22:33:11.227510 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m22:33:11.228583 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m22:33:11.362630 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.133 seconds
[0m22:33:11.423414 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m22:33:11.424313 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m22:33:11.433278 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefefbc20>]}
[0m22:33:11.435325 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 13.84s]
[0m22:33:11.439606 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m22:33:11.441298 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:33:11.446664 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m22:33:11.447549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m22:33:11.447999 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:33:11.453945 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:33:11.459816 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:33:11.467841 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:33:11.472153 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:33:11.472874 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m22:33:11.473608 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:16.962113 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 5.477 seconds
[0m22:33:16.992794 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:33:16.993912 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m22:33:17.246136 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.252 seconds
[0m22:33:17.250471 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:33:17.251029 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m22:33:17.453594 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.202 seconds
[0m22:33:17.461482 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m22:33:17.462926 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:33:17.463366 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m22:33:17.604787 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.141 seconds
[0m22:33:17.610759 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m22:33:17.611588 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m22:33:17.615078 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef473e30>]}
[0m22:33:17.619356 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 6.17s]
[0m22:33:17.628081 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:33:17.634110 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m22:33:17.637269 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m22:33:17.640175 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m22:33:17.650330 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m22:33:17.665571 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:33:17.668415 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m22:33:17.676542 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:33:17.685773 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:33:17.686744 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m22:33:17.687251 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:21.485275 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 3.788 seconds
[0m22:33:21.518874 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:33:21.523326 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m22:33:21.780457 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.255 seconds
[0m22:33:21.785816 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:33:21.786367 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m22:33:21.916710 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.130 seconds
[0m22:33:21.921946 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m22:33:21.923548 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:33:21.924314 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m22:33:22.036725 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.112 seconds
[0m22:33:22.039547 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m22:33:22.039976 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m22:33:22.043330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef408230>]}
[0m22:33:22.046616 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 4.40s]
[0m22:33:22.047763 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m22:33:22.050054 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m22:33:22.053260 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m22:33:22.054322 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m22:33:22.054883 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m22:33:22.065449 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m22:33:22.067766 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m22:33:22.072917 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m22:33:22.078081 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m22:33:22.079074 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m22:33:22.079860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:30.928555 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 8.841 seconds
[0m22:33:30.953065 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m22:33:30.953841 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m22:33:31.323606 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.369 seconds
[0m22:33:31.327494 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m22:33:31.327890 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m22:33:31.508354 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.180 seconds
[0m22:33:31.513783 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m22:33:31.515040 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m22:33:31.515619 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m22:33:31.683269 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.166 seconds
[0m22:33:31.687996 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m22:33:31.688753 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m22:33:31.694561 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87832efa-f174-423e-b3c9-e59a9c0064ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e5f70>]}
[0m22:33:31.697512 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 9.64s]
[0m22:33:31.703513 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m22:33:31.733902 [debug] [MainThread]: On master: COMMIT
[0m22:33:31.735534 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:33:31.735875 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m22:33:31.747568 [info ] [MainThread]: 
[0m22:33:31.749636 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 41.64 seconds (41.64s).
[0m22:33:31.761584 [debug] [MainThread]: Command end result
[0m22:33:31.804812 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:33:31.835740 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:33:31.925530 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m22:33:31.926923 [info ] [MainThread]: 
[0m22:33:31.927834 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:33:31.928947 [info ] [MainThread]: 
[0m22:33:31.930063 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m22:33:31.936540 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 43.233513, "process_in_blocks": "17368", "process_kernel_time": 1.398185, "process_mem_max_rss": "289448", "process_out_blocks": "2286", "process_user_time": 6.149735}
[0m22:33:31.939934 [debug] [MainThread]: Command `cli run` succeeded at 22:33:31.939384 after 43.24 seconds
[0m22:33:31.944824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06bd970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55d7a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m22:33:31.946302 [debug] [MainThread]: Flushing usage events
[0m22:33:32.860712 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:33:42.828375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0233a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0230980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0230a10>]}


============================== 22:33:42.863235 | ab17be57-530b-4303-892b-d9b850eaf59d ==============================
[0m22:33:42.863235 [info ] [MainThread]: Running with dbt=1.10.10
[0m22:33:42.866891 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m22:33:43.829231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefdc3410>]}
[0m22:33:43.956373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff009eed0>]}
[0m22:33:43.958750 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m22:33:44.652075 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m22:33:44.877416 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:33:44.878703 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:33:44.957106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd5ac90>]}
[0m22:33:45.102063 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:33:45.106631 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:33:45.124844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef839190>]}
[0m22:33:45.126053 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m22:33:45.126753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0455cd0>]}
[0m22:33:45.133737 [info ] [MainThread]: 
[0m22:33:45.134553 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m22:33:45.134954 [info ] [MainThread]: 
[0m22:33:45.136609 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m22:33:45.152360 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m22:33:45.199553 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m22:33:45.200232 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m22:33:45.200689 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:33:45.201067 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m22:33:45.203222 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52cbc0>]}
[0m22:33:48.203230 [debug] [ThreadPool]: SQL status: SUCCESS in 2.990 seconds
[0m22:33:48.211631 [debug] [ThreadPool]: On list_iceberg: Close
[0m22:33:48.223272 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m22:33:48.259335 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m22:33:48.260027 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m22:33:48.261023 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:33:50.927669 [debug] [ThreadPool]: SQL status: SUCCESS in 2.665 seconds
[0m22:33:50.953441 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m22:33:50.956383 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m22:33:50.967651 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m22:33:51.042162 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m22:33:51.044239 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m22:33:51.045510 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:33:52.793133 [debug] [ThreadPool]: SQL status: SUCCESS in 1.745 seconds
[0m22:33:52.813494 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m22:33:52.814936 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m22:33:52.818079 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m22:33:52.848846 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m22:33:52.851142 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m22:33:52.853688 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:33:54.575549 [debug] [ThreadPool]: SQL status: SUCCESS in 1.721 seconds
[0m22:33:54.594114 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m22:33:54.594939 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m22:33:54.611071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff198e900>]}
[0m22:33:54.617709 [debug] [MainThread]: On master: COMMIT
[0m22:33:54.666819 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m22:33:54.676741 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m22:33:54.681626 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m22:33:54.682501 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m22:33:54.705601 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m22:33:54.711965 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m22:33:54.816309 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m22:33:54.826417 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m22:33:54.827197 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m22:33:54.827735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:34:01.719682 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 6.885 seconds
[0m22:34:01.841957 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m22:34:01.842966 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m22:34:02.351871 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.508 seconds
[0m22:34:02.359688 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m22:34:02.360439 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m22:34:02.553821 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.192 seconds
[0m22:34:02.586872 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m22:34:02.598333 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m22:34:02.599343 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m22:34:02.742111 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.141 seconds
[0m22:34:02.789075 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m22:34:02.789874 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m22:34:02.803281 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7e30>]}
[0m22:34:02.806819 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 8.11s]
[0m22:34:02.814349 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m22:34:02.817716 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m22:34:02.818614 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m22:34:02.823101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m22:34:02.824323 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m22:34:02.834239 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m22:34:02.835907 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m22:34:02.844734 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m22:34:02.853217 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m22:34:02.853887 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m22:34:02.854436 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:34:07.054294 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 4.198 seconds
[0m22:34:07.076511 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m22:34:07.077644 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m22:34:07.203320 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.123 seconds
[0m22:34:07.210855 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m22:34:07.211648 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m22:34:07.327037 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.115 seconds
[0m22:34:07.330790 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m22:34:07.331801 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m22:34:07.332146 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m22:34:07.422604 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.090 seconds
[0m22:34:07.425938 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m22:34:07.426562 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m22:34:07.428834 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef45d2b0>]}
[0m22:34:07.430724 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 4.61s]
[0m22:34:07.434362 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m22:34:07.435942 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m22:34:07.437016 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m22:34:07.438752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m22:34:07.439446 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m22:34:07.453760 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m22:34:07.455934 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m22:34:07.463068 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m22:34:07.483151 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m22:34:07.484023 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m22:34:07.487402 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:34:13.191013 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.703 seconds
[0m22:34:13.210666 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m22:34:13.211260 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m22:34:13.393237 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.181 seconds
[0m22:34:13.397064 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m22:34:13.397543 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m22:34:13.499201 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.101 seconds
[0m22:34:13.503932 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m22:34:13.505292 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m22:34:13.505816 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m22:34:13.568943 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.063 seconds
[0m22:34:13.571780 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m22:34:13.572268 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m22:34:13.574508 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e7b90>]}
[0m22:34:13.575982 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 6.13s]
[0m22:34:13.576764 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m22:34:13.578625 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m22:34:13.579830 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m22:34:13.580478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m22:34:13.581248 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m22:34:13.598887 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m22:34:13.603069 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m22:34:13.607593 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m22:34:13.623664 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m22:34:13.624458 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m22:34:13.625268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:34:22.923139 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 9.292 seconds
[0m22:34:23.087957 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m22:34:23.092337 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m22:34:23.978689 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.882 seconds
[0m22:34:24.006575 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m22:34:24.007632 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m22:34:24.790987 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.782 seconds
[0m22:34:24.815654 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m22:34:24.826122 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m22:34:24.830657 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m22:34:25.304392 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.470 seconds
[0m22:34:25.317561 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m22:34:25.319434 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m22:34:25.323983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab17be57-530b-4303-892b-d9b850eaf59d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2c0110>]}
[0m22:34:25.328699 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 11.74s]
[0m22:34:25.332836 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m22:34:25.370174 [debug] [MainThread]: On master: COMMIT
[0m22:34:25.374277 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:34:25.377706 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m22:34:25.390915 [info ] [MainThread]: 
[0m22:34:25.392869 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 40.24 seconds (40.24s).
[0m22:34:25.407040 [debug] [MainThread]: Command end result
[0m22:34:25.513127 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:34:25.540750 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:34:25.694566 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m22:34:25.696877 [info ] [MainThread]: 
[0m22:34:25.703959 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:34:25.708534 [info ] [MainThread]: 
[0m22:34:25.713208 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m22:34:25.730970 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 43.142773, "process_in_blocks": "43160", "process_kernel_time": 2.805952, "process_mem_max_rss": "289212", "process_out_blocks": "2421", "process_user_time": 9.47376}
[0m22:34:25.741325 [debug] [MainThread]: Command `cli run` succeeded at 22:34:25.740334 after 43.16 seconds
[0m22:34:25.747786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01bab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c6d220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08667b0>]}
[0m22:34:25.750415 [debug] [MainThread]: Flushing usage events
[0m22:34:26.679507 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:34:38.922376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c7c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1c120f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01721b0>]}


============================== 22:34:38.953414 | 0072047a-4416-4392-9990-034c5172c036 ==============================
[0m22:34:38.953414 [info ] [MainThread]: Running with dbt=1.10.10
[0m22:34:38.955682 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m22:34:39.832006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06fc4a0>]}
[0m22:34:39.962293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff198e4b0>]}
[0m22:34:39.964138 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m22:34:40.616355 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m22:34:40.840813 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:34:40.841863 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:34:40.951697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd2ee10>]}
[0m22:34:41.166415 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:34:41.172796 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:34:41.198700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8391f0>]}
[0m22:34:41.202010 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m22:34:41.202754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01c07d0>]}
[0m22:34:41.208435 [info ] [MainThread]: 
[0m22:34:41.209278 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m22:34:41.210151 [info ] [MainThread]: 
[0m22:34:41.211409 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m22:34:41.222713 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m22:34:41.282120 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m22:34:41.294584 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m22:34:41.295522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:34:41.297628 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m22:34:41.300547 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52ee70>]}
[0m22:34:42.809845 [debug] [ThreadPool]: SQL status: SUCCESS in 1.511 seconds
[0m22:34:42.862358 [debug] [ThreadPool]: On list_iceberg: Close
[0m22:34:42.890621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m22:34:42.932536 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m22:34:42.933304 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m22:34:42.933761 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:34:44.116974 [debug] [ThreadPool]: SQL status: SUCCESS in 1.182 seconds
[0m22:34:44.123395 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m22:34:44.124872 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m22:34:44.128367 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m22:34:44.141201 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m22:34:44.142058 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m22:34:44.142600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:34:44.890805 [debug] [ThreadPool]: SQL status: SUCCESS in 0.748 seconds
[0m22:34:44.893688 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m22:34:44.894392 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m22:34:44.895620 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m22:34:44.900674 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m22:34:44.902824 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m22:34:44.903810 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:34:45.554326 [debug] [ThreadPool]: SQL status: SUCCESS in 0.649 seconds
[0m22:34:45.564007 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m22:34:45.565248 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m22:34:45.571398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff11af9e0>]}
[0m22:34:45.574857 [debug] [MainThread]: On master: COMMIT
[0m22:34:45.610300 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m22:34:45.619057 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m22:34:45.623974 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m22:34:45.625329 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m22:34:45.648849 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m22:34:45.653996 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m22:34:45.919869 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m22:34:45.928383 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m22:34:45.931310 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m22:34:45.934150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:34:53.193612 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 7.256 seconds
[0m22:34:53.300397 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m22:34:53.301216 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m22:34:53.519825 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.218 seconds
[0m22:34:53.525702 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m22:34:53.526455 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m22:34:53.626893 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.100 seconds
[0m22:34:53.640730 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m22:34:53.644877 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m22:34:53.645603 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m22:34:53.723023 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.077 seconds
[0m22:34:53.779347 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m22:34:53.780120 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m22:34:53.799820 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7bc0>]}
[0m22:34:53.803126 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 8.16s]
[0m22:34:53.808687 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m22:34:53.810361 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m22:34:53.814815 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m22:34:53.815749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m22:34:53.816256 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m22:34:53.824198 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m22:34:53.827063 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m22:34:53.833742 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m22:34:53.845722 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m22:34:53.846463 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m22:34:53.847751 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:35:01.301657 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 7.446 seconds
[0m22:35:01.373574 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m22:35:01.375147 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m22:35:01.837597 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.460 seconds
[0m22:35:01.849883 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m22:35:01.850897 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m22:35:02.060962 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.208 seconds
[0m22:35:02.086302 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m22:35:02.087723 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m22:35:02.088340 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m22:35:02.230451 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.140 seconds
[0m22:35:02.244108 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m22:35:02.245748 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m22:35:02.257508 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef488830>]}
[0m22:35:02.260757 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 8.44s]
[0m22:35:02.266671 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m22:35:02.271318 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m22:35:02.277416 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m22:35:02.285358 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m22:35:02.287196 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m22:35:02.313567 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m22:35:02.319828 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m22:35:02.326730 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m22:35:02.336368 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m22:35:02.337933 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m22:35:02.338624 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:35:08.689378 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 6.337 seconds
[0m22:35:08.781928 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m22:35:08.782827 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m22:35:08.956423 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.173 seconds
[0m22:35:08.960888 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m22:35:08.961520 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m22:35:09.116210 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.154 seconds
[0m22:35:09.124113 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m22:35:09.128368 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m22:35:09.129119 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m22:35:09.210627 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.081 seconds
[0m22:35:09.223705 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m22:35:09.224868 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m22:35:09.229964 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0072047a-4416-4392-9990-034c5172c036', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4fc950>]}
[0m22:35:09.232236 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 6.94s]
[0m22:35:09.235930 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m22:35:09.279467 [debug] [MainThread]: On master: COMMIT
[0m22:35:09.280917 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:35:09.281355 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m22:35:09.285881 [info ] [MainThread]: 
[0m22:35:09.288023 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 28.07 seconds (28.07s).
[0m22:35:09.298465 [debug] [MainThread]: Command end result
[0m22:35:09.360307 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:35:09.380661 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:35:09.447207 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m22:35:09.447955 [info ] [MainThread]: 
[0m22:35:09.449010 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:35:09.450133 [info ] [MainThread]: 
[0m22:35:09.453977 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m22:35:09.464250 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 30.694784, "process_in_blocks": "83176", "process_kernel_time": 3.608224, "process_mem_max_rss": "289088", "process_out_blocks": "2297", "process_user_time": 9.101243}
[0m22:35:09.468038 [debug] [MainThread]: Command `cli run` succeeded at 22:35:09.467556 after 30.70 seconds
[0m22:35:09.471268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01c1160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7bc0>]}
[0m22:35:09.471931 [debug] [MainThread]: Flushing usage events
[0m22:35:10.430103 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:35:22.520291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f02900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02763c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0274b60>]}


============================== 22:35:22.562301 | 877e1999-adfd-4257-a2c1-886561fa630c ==============================
[0m22:35:22.562301 [info ] [MainThread]: Running with dbt=1.10.10
[0m22:35:22.564434 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m22:35:22.923541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a9eab0>]}
[0m22:35:23.018912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a9eab0>]}
[0m22:35:23.020814 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m22:35:23.789710 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m22:35:24.067722 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:35:24.069041 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:35:24.195522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80bc50>]}
[0m22:35:24.217638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa5b8f0>]}
[0m22:35:24.219052 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m22:35:24.220985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcce390>]}
[0m22:35:24.227532 [info ] [MainThread]: 
[0m22:35:24.228587 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m22:35:24.229695 [info ] [MainThread]: 
[0m22:35:24.234751 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m22:35:24.252281 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m22:35:24.340185 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m22:35:24.341438 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m22:35:24.342010 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:35:24.343320 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m22:35:24.346970 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef506ed0>]}
[0m22:35:25.875674 [debug] [ThreadPool]: SQL status: SUCCESS in 1.531 seconds
[0m22:35:25.891389 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m22:35:25.892547 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m22:35:25.899822 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m22:35:25.934026 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m22:35:25.934713 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m22:35:25.935167 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:35:26.711371 [debug] [ThreadPool]: SQL status: SUCCESS in 0.776 seconds
[0m22:35:26.713703 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m22:35:26.714519 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m22:35:26.716201 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m22:35:26.725899 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m22:35:26.727047 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m22:35:26.727763 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:35:28.265089 [debug] [ThreadPool]: SQL status: SUCCESS in 1.534 seconds
[0m22:35:28.299986 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m22:35:28.304651 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m22:35:28.327497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '877e1999-adfd-4257-a2c1-886561fa630c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef75f0>]}
[0m22:35:28.398367 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m22:35:28.404055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m22:35:28.407299 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m22:35:28.431858 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m22:35:28.440977 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m22:35:28.448297 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m22:35:28.451645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m22:35:28.454928 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m22:35:28.469144 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m22:35:28.475414 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m22:35:28.478127 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m22:35:28.480680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m22:35:28.484708 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m22:35:28.496064 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m22:35:28.502097 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m22:35:28.506393 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m22:35:28.510098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m22:35:28.512616 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m22:35:28.524553 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m22:35:28.526613 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m22:35:28.527746 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m22:35:28.528828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m22:35:28.529289 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m22:35:28.544510 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m22:35:28.548289 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m22:35:28.549830 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m22:35:28.551050 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:35:28.553928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m22:35:28.555059 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:35:28.564407 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m22:35:28.565628 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:35:28.566468 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m22:35:28.566907 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m22:35:28.567633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m22:35:28.568050 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m22:35:28.571816 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m22:35:28.573896 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m22:35:28.575265 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m22:35:28.575717 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m22:35:28.576503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m22:35:28.577065 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m22:35:28.580986 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m22:35:28.582196 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m22:35:28.582968 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m22:35:28.583410 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m22:35:28.584111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m22:35:28.584831 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m22:35:28.591195 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m22:35:28.593681 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m22:35:28.595280 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m22:35:28.596099 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m22:35:28.596671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m22:35:28.597071 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m22:35:28.640561 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m22:35:28.658082 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m22:35:28.661545 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m22:35:28.665176 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m22:35:28.666783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m22:35:28.667349 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m22:35:28.674879 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m22:35:28.677209 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m22:35:28.680913 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m22:35:28.704399 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m22:35:28.706302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m22:35:28.707333 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m22:35:28.725306 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m22:35:28.732822 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m22:35:28.743310 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m22:35:28.744881 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m22:35:28.745692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m22:35:28.747644 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m22:35:28.766320 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m22:35:28.767729 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m22:35:28.768701 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m22:35:28.769261 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m22:35:28.769790 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m22:35:28.770133 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m22:35:28.781628 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m22:35:28.783250 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m22:35:28.784495 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m22:35:28.785234 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m22:35:28.786217 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m22:35:28.786634 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m22:35:28.796327 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m22:35:28.799119 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m22:35:28.801987 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m22:35:28.804444 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m22:35:28.807488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m22:35:28.808321 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m22:35:28.818798 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m22:35:28.820671 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m22:35:28.821944 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m22:35:28.824392 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m22:35:28.825333 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m22:35:28.826277 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m22:35:28.837155 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m22:35:28.840046 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m22:35:28.841369 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m22:35:28.841950 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m22:35:28.842686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m22:35:28.843408 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m22:35:28.850426 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m22:35:28.851661 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m22:35:28.852758 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m22:35:28.853351 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m22:35:28.854055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m22:35:28.854714 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m22:35:28.861930 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m22:35:28.863288 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m22:35:28.864258 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m22:35:28.864789 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m22:35:28.865295 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m22:35:28.865626 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m22:35:28.872102 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m22:35:28.873854 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m22:35:28.875320 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m22:35:28.875899 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m22:35:28.876617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m22:35:28.877341 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m22:35:28.884047 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m22:35:28.885505 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m22:35:28.886401 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m22:35:28.886913 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m22:35:28.887364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m22:35:28.887872 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m22:35:28.893485 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m22:35:28.894565 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m22:35:28.895606 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m22:35:28.896227 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m22:35:28.897302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m22:35:28.898028 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m22:35:28.903618 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m22:35:28.905366 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m22:35:28.906364 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m22:35:28.906850 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m22:35:28.907557 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m22:35:28.907948 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m22:35:28.912655 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m22:35:28.914624 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m22:35:28.915710 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m22:35:28.916135 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m22:35:28.916823 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m22:35:28.917252 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m22:35:28.921041 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m22:35:28.922258 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m22:35:28.923377 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m22:35:28.924076 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m22:35:28.924724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m22:35:28.925290 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m22:35:28.932782 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m22:35:28.934231 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m22:35:28.935220 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m22:35:28.935898 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m22:35:28.936469 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m22:35:28.936877 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m22:35:28.940872 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m22:35:28.942022 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m22:35:28.942751 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m22:35:28.943182 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m22:35:28.943707 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m22:35:28.944287 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m22:35:28.950592 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m22:35:28.952094 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m22:35:28.952833 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m22:35:28.957630 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m22:35:28.959085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m22:35:28.959443 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m22:35:28.963463 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m22:35:28.964438 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m22:35:28.965144 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m22:35:28.971753 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:35:28.973323 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m22:35:28.979958 [debug] [MainThread]: Command end result
[0m22:35:29.184666 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:35:29.198911 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:35:29.227918 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m22:35:29.237826 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m22:35:29.239912 [info ] [MainThread]: Building catalog
[0m22:35:29.253396 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m22:35:29.359362 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m22:35:29.361223 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m22:35:29.362532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:35:45.929252 [debug] [ThreadPool]: SQL status: SUCCESS in 16.540 seconds
[0m22:35:46.060705 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m22:35:46.303781 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m22:35:46.448890 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m22:35:46.510443 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m22:35:46.514316 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m22:35:46.558482 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 24.194025, "process_in_blocks": "182176", "process_kernel_time": 3.885202, "process_mem_max_rss": "289372", "process_out_blocks": "5916", "process_user_time": 6.891519}
[0m22:35:46.578910 [debug] [MainThread]: Command `cli docs generate` succeeded at 22:35:46.575200 after 24.23 seconds
[0m22:35:46.609819 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m22:35:46.612128 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m22:35:46.623475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff138a6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa9a8d0>]}
[0m22:35:46.628669 [debug] [MainThread]: Flushing usage events
[0m22:35:48.461744 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:32:46.225390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a1d2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c7cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c7d10>]}


============================== 04:32:46.267345 | 1954e5a8-6079-446e-9cd9-bb81bc7a4705 ==============================
[0m04:32:46.267345 [info ] [MainThread]: Running with dbt=1.10.10
[0m04:32:46.268640 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m04:32:46.563020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0afddc0>]}
[0m04:32:46.665976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff12bbda0>]}
[0m04:32:46.667501 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m04:32:47.141093 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m04:32:47.289464 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:32:47.290304 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:32:47.368402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcffdd0>]}
[0m04:32:47.482568 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:32:47.486621 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:32:47.502254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b620>]}
[0m04:32:47.503292 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m04:32:47.504034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef837f50>]}
[0m04:32:47.507596 [info ] [MainThread]: 
[0m04:32:47.508272 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m04:32:47.508735 [info ] [MainThread]: 
[0m04:32:47.509678 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m04:32:47.521441 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m04:32:47.560619 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m04:32:47.561104 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m04:32:47.561433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:32:47.561732 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m04:32:47.563165 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef603e60>]}
[0m04:32:49.213565 [debug] [ThreadPool]: SQL status: SUCCESS in 1.650 seconds
[0m04:32:49.223921 [debug] [ThreadPool]: On list_iceberg: Close
[0m04:32:49.231061 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m04:32:49.251394 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m04:32:49.252076 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m04:32:49.252470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:32:51.832343 [debug] [ThreadPool]: SQL status: SUCCESS in 2.577 seconds
[0m04:32:51.853995 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m04:32:51.854888 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m04:32:51.858736 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m04:32:51.883433 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m04:32:51.884305 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m04:32:51.884783 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:32:53.382387 [debug] [ThreadPool]: SQL status: SUCCESS in 1.497 seconds
[0m04:32:53.387785 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m04:32:53.388406 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m04:32:53.390037 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m04:32:53.415196 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m04:32:53.416487 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m04:32:53.416993 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:32:55.725941 [debug] [ThreadPool]: SQL status: SUCCESS in 2.307 seconds
[0m04:32:55.739688 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m04:32:55.741698 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m04:32:55.749152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefcfebd0>]}
[0m04:32:55.759252 [debug] [MainThread]: On master: COMMIT
[0m04:32:55.815785 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m04:32:55.823371 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m04:32:55.846169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m04:32:55.847900 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m04:32:55.860904 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m04:32:55.862616 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m04:32:55.998634 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m04:32:56.005144 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m04:32:56.006181 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m04:32:56.006657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:04.762415 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 8.740 seconds
[0m04:33:04.886028 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m04:33:04.887424 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m04:33:05.370608 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.481 seconds
[0m04:33:05.403353 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m04:33:05.403844 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m04:33:05.672539 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.268 seconds
[0m04:33:05.690983 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m04:33:05.694992 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m04:33:05.695832 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m04:33:05.828445 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.132 seconds
[0m04:33:05.872471 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m04:33:05.873135 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m04:33:05.887228 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3ba1b0>]}
[0m04:33:05.889240 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 10.05s]
[0m04:33:05.892025 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m04:33:05.892811 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:33:05.893975 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m04:33:05.902995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m04:33:05.905471 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:33:05.913825 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:33:05.916424 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:33:05.922561 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:33:05.928933 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:33:05.929508 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m04:33:05.930053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:09.905911 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.973 seconds
[0m04:33:09.936381 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:33:09.937713 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m04:33:10.137525 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.198 seconds
[0m04:33:10.145334 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:33:10.146518 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m04:33:10.333636 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.186 seconds
[0m04:33:10.337589 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m04:33:10.338556 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:33:10.338888 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m04:33:10.429434 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.090 seconds
[0m04:33:10.432032 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m04:33:10.432613 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m04:33:10.434883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55cc4d0>]}
[0m04:33:10.436663 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 4.53s]
[0m04:33:10.439346 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:33:10.440635 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m04:33:10.442271 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m04:33:10.442968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m04:33:10.443446 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m04:33:10.450741 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:33:10.452099 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m04:33:10.455546 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:33:10.460171 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:33:10.460922 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m04:33:10.461819 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:16.260559 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 5.788 seconds
[0m04:33:16.322279 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:33:16.323727 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m04:33:16.530128 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.205 seconds
[0m04:33:16.533945 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:33:16.534424 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m04:33:16.649529 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.115 seconds
[0m04:33:16.653701 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m04:33:16.654590 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:33:16.654947 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m04:33:16.745324 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.090 seconds
[0m04:33:16.750224 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m04:33:16.750940 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m04:33:16.753821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef438110>]}
[0m04:33:16.757778 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 6.31s]
[0m04:33:16.759550 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m04:33:16.760348 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m04:33:16.760841 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m04:33:16.761454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m04:33:16.763206 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m04:33:16.771076 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m04:33:16.772773 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m04:33:16.778274 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m04:33:16.786084 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m04:33:16.786922 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m04:33:16.787488 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:19.287523 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.498 seconds
[0m04:33:19.305383 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m04:33:19.305956 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m04:33:19.420632 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.114 seconds
[0m04:33:19.426398 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m04:33:19.427454 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m04:33:19.658217 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.230 seconds
[0m04:33:19.669352 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m04:33:19.671089 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m04:33:19.671671 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m04:33:19.730825 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.059 seconds
[0m04:33:19.738547 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m04:33:19.739816 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m04:33:19.744114 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1954e5a8-6079-446e-9cd9-bb81bc7a4705', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3dea80>]}
[0m04:33:19.745925 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.98s]
[0m04:33:19.746755 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m04:33:19.766715 [debug] [MainThread]: On master: COMMIT
[0m04:33:19.767948 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:33:19.768270 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m04:33:19.771982 [info ] [MainThread]: 
[0m04:33:19.773816 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 32.26 seconds (32.26s).
[0m04:33:19.777861 [debug] [MainThread]: Command end result
[0m04:33:19.819935 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:33:19.834136 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:33:19.899286 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m04:33:19.899953 [info ] [MainThread]: 
[0m04:33:19.901296 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:33:19.902263 [info ] [MainThread]: 
[0m04:33:19.903589 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m04:33:19.914336 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 33.779564, "process_in_blocks": "15024", "process_kernel_time": 1.190038, "process_mem_max_rss": "289388", "process_out_blocks": "2286", "process_user_time": 4.315579}
[0m04:33:19.918414 [debug] [MainThread]: Command `cli run` succeeded at 04:33:19.917965 after 33.79 seconds
[0m04:33:19.920903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0bf2de0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c6c3e0>]}
[0m04:33:19.922087 [debug] [MainThread]: Flushing usage events
[0m04:33:20.785637 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:33:25.740351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff022c5c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a1d370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c6d80>]}


============================== 04:33:25.754516 | 7725c4fa-ca76-469e-a75d-f556bd664957 ==============================
[0m04:33:25.754516 [info ] [MainThread]: Running with dbt=1.10.10
[0m04:33:25.755750 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m04:33:25.971282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff08ef530>]}
[0m04:33:26.039825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff076ff20>]}
[0m04:33:26.040656 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m04:33:26.297267 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m04:33:26.434604 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:33:26.435468 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:33:26.501481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd36ba0>]}
[0m04:33:26.600984 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:33:26.603199 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:33:26.614276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef80b650>]}
[0m04:33:26.615725 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m04:33:26.616588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83bf80>]}
[0m04:33:26.619620 [info ] [MainThread]: 
[0m04:33:26.620838 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m04:33:26.621485 [info ] [MainThread]: 
[0m04:33:26.622676 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m04:33:26.630637 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m04:33:26.663181 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m04:33:26.663729 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m04:33:26.664049 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:33:26.664340 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m04:33:26.665976 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef838d10>]}
[0m04:33:27.076543 [debug] [ThreadPool]: SQL status: SUCCESS in 0.412 seconds
[0m04:33:27.078969 [debug] [ThreadPool]: On list_iceberg: Close
[0m04:33:27.084843 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m04:33:27.100113 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m04:33:27.100616 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m04:33:27.100965 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:33:28.025030 [debug] [ThreadPool]: SQL status: SUCCESS in 0.923 seconds
[0m04:33:28.031409 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m04:33:28.032088 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m04:33:28.033636 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m04:33:28.039930 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m04:33:28.040328 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m04:33:28.040670 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:33:28.399654 [debug] [ThreadPool]: SQL status: SUCCESS in 0.359 seconds
[0m04:33:28.401511 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m04:33:28.401893 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m04:33:28.402561 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m04:33:28.408060 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m04:33:28.408561 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m04:33:28.408870 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:33:28.831615 [debug] [ThreadPool]: SQL status: SUCCESS in 0.422 seconds
[0m04:33:28.834057 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m04:33:28.834536 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m04:33:28.837031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4f85c0>]}
[0m04:33:28.838470 [debug] [MainThread]: On master: COMMIT
[0m04:33:28.847369 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m04:33:28.848381 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m04:33:28.848946 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m04:33:28.849327 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m04:33:28.855395 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m04:33:28.856705 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m04:33:28.915037 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m04:33:28.922616 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m04:33:28.923271 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m04:33:28.923714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:31.344668 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 2.416 seconds
[0m04:33:31.419592 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m04:33:31.420805 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m04:33:31.678848 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.257 seconds
[0m04:33:31.686171 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m04:33:31.686983 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m04:33:31.831046 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.143 seconds
[0m04:33:31.852918 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m04:33:31.859750 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m04:33:31.860672 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m04:33:31.981883 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.120 seconds
[0m04:33:32.053927 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m04:33:32.055185 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m04:33:32.063789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4eaba0>]}
[0m04:33:32.066452 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 3.21s]
[0m04:33:32.071182 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m04:33:32.073617 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m04:33:32.078055 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m04:33:32.080184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m04:33:32.082220 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m04:33:32.089881 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m04:33:32.091251 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m04:33:32.094986 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m04:33:32.109432 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m04:33:32.110563 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m04:33:32.111229 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:40.161863 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 8.045 seconds
[0m04:33:40.213371 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m04:33:40.214140 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m04:33:40.467600 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.252 seconds
[0m04:33:40.476214 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m04:33:40.476854 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m04:33:40.668185 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.191 seconds
[0m04:33:40.675498 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m04:33:40.677001 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m04:33:40.677441 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m04:33:40.834091 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.156 seconds
[0m04:33:40.845645 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m04:33:40.847644 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m04:33:40.853576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa50590>]}
[0m04:33:40.859235 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 8.77s]
[0m04:33:40.861988 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m04:33:40.863025 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m04:33:40.863733 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m04:33:40.864555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m04:33:40.866651 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m04:33:40.895443 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m04:33:40.896910 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m04:33:40.901373 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m04:33:40.915905 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m04:33:40.916797 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m04:33:40.917454 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:45.193833 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.275 seconds
[0m04:33:45.210969 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m04:33:45.211505 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m04:33:45.313352 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.101 seconds
[0m04:33:45.317048 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m04:33:45.317553 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m04:33:45.394443 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.076 seconds
[0m04:33:45.400499 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m04:33:45.401568 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m04:33:45.401964 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m04:33:45.442727 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.040 seconds
[0m04:33:45.445239 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m04:33:45.445619 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m04:33:45.447308 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa517c0>]}
[0m04:33:45.448532 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 4.58s]
[0m04:33:45.451497 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m04:33:45.453376 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m04:33:45.454659 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m04:33:45.457231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m04:33:45.457741 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m04:33:45.469057 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m04:33:45.471066 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m04:33:45.475617 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m04:33:45.495272 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m04:33:45.496598 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m04:33:45.497568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:47.827278 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.328 seconds
[0m04:33:47.847972 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m04:33:47.848854 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m04:33:47.926087 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.077 seconds
[0m04:33:47.931650 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m04:33:47.932320 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m04:33:47.988310 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.055 seconds
[0m04:33:47.992077 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m04:33:47.992914 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m04:33:47.993307 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m04:33:48.043548 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.050 seconds
[0m04:33:48.049788 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m04:33:48.050781 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m04:33:48.052666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7725c4fa-ca76-469e-a75d-f556bd664957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2cce30>]}
[0m04:33:48.053900 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 2.60s]
[0m04:33:48.054643 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m04:33:48.075310 [debug] [MainThread]: On master: COMMIT
[0m04:33:48.076353 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:33:48.076689 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m04:33:48.079731 [info ] [MainThread]: 
[0m04:33:48.080705 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 21.45 seconds (21.45s).
[0m04:33:48.087476 [debug] [MainThread]: Command end result
[0m04:33:48.133690 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:33:48.148924 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:33:48.188202 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m04:33:48.188919 [info ] [MainThread]: 
[0m04:33:48.189704 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:33:48.190205 [info ] [MainThread]: 
[0m04:33:48.191278 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m04:33:48.194907 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 22.530027, "process_in_blocks": "41152", "process_kernel_time": 0.919895, "process_mem_max_rss": "287924", "process_out_blocks": "2421", "process_user_time": 3.766708}
[0m04:33:48.196453 [debug] [MainThread]: Command `cli run` succeeded at 04:33:48.196323 after 22.53 seconds
[0m04:33:48.197280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0503860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c6d280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c6c0e0>]}
[0m04:33:48.197821 [debug] [MainThread]: Flushing usage events
[0m04:33:48.866245 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:33:53.873179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0f06ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06990a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1b2bce0>]}


============================== 04:33:53.906227 | e2ef6754-2c66-44cd-aea3-050f9363deec ==============================
[0m04:33:53.906227 [info ] [MainThread]: Running with dbt=1.10.10
[0m04:33:53.907347 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m04:33:54.219654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff63329f0>]}
[0m04:33:54.299824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff10945f0>]}
[0m04:33:54.300975 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m04:33:54.702110 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m04:33:54.916509 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:33:54.917585 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:33:54.982902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd59850>]}
[0m04:33:55.109830 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:33:55.115523 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:33:55.135682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83e450>]}
[0m04:33:55.136819 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m04:33:55.138467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7080>]}
[0m04:33:55.142210 [info ] [MainThread]: 
[0m04:33:55.143031 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m04:33:55.144030 [info ] [MainThread]: 
[0m04:33:55.145247 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m04:33:55.154604 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m04:33:55.185337 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m04:33:55.185787 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m04:33:55.186060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:33:55.186320 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m04:33:55.187128 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52ca70>]}
[0m04:33:55.669386 [debug] [ThreadPool]: SQL status: SUCCESS in 0.482 seconds
[0m04:33:55.674088 [debug] [ThreadPool]: On list_iceberg: Close
[0m04:33:55.681831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m04:33:55.723829 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m04:33:55.724752 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m04:33:55.725170 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:33:56.243868 [debug] [ThreadPool]: SQL status: SUCCESS in 0.518 seconds
[0m04:33:56.247412 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m04:33:56.247783 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m04:33:56.248948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m04:33:56.266804 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m04:33:56.267383 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m04:33:56.267736 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:33:56.578320 [debug] [ThreadPool]: SQL status: SUCCESS in 0.310 seconds
[0m04:33:56.580652 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m04:33:56.581052 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m04:33:56.582194 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m04:33:56.586230 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m04:33:56.589134 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m04:33:56.589518 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:33:56.954060 [debug] [ThreadPool]: SQL status: SUCCESS in 0.364 seconds
[0m04:33:56.957118 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m04:33:56.957572 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m04:33:56.960546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff198e9c0>]}
[0m04:33:56.962416 [debug] [MainThread]: On master: COMMIT
[0m04:33:56.973467 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m04:33:56.974700 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m04:33:56.978150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m04:33:56.978866 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m04:33:56.989052 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m04:33:56.991035 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m04:33:57.080397 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m04:33:57.084962 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m04:33:57.085529 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m04:33:57.086038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:33:59.700724 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 2.609 seconds
[0m04:33:59.755615 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m04:33:59.756439 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m04:33:59.829032 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.072 seconds
[0m04:33:59.833808 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m04:33:59.834526 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m04:33:59.936978 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.102 seconds
[0m04:33:59.946889 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m04:33:59.951903 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m04:33:59.952568 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m04:34:00.004028 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.051 seconds
[0m04:34:00.052805 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m04:34:00.053709 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m04:34:00.065779 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c42420>]}
[0m04:34:00.073419 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 3.08s]
[0m04:34:00.078471 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m04:34:00.080522 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:00.083632 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m04:34:00.085155 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m04:34:00.086496 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:00.096306 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:00.098693 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:00.102170 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:00.109836 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:00.110335 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m04:34:00.110782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:34:02.441423 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.329 seconds
[0m04:34:02.458076 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:02.458852 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m04:34:02.539588 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.080 seconds
[0m04:34:02.543084 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:02.543457 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m04:34:02.619478 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.075 seconds
[0m04:34:02.622778 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m04:34:02.623638 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:02.623971 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m04:34:02.663538 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.039 seconds
[0m04:34:02.666199 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m04:34:02.667655 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m04:34:02.669720 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef697320>]}
[0m04:34:02.671599 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.58s]
[0m04:34:02.674191 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:02.675364 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m04:34:02.677085 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m04:34:02.677993 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m04:34:02.678733 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m04:34:02.688246 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m04:34:02.690473 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m04:34:02.694683 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m04:34:02.699779 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m04:34:02.700342 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m04:34:02.700812 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:34:03.608324 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 0.907 seconds
[0m04:34:03.611809 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m04:34:03.612165 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m04:34:03.671796 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.059 seconds
[0m04:34:03.676477 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m04:34:03.676850 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m04:34:03.727596 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.050 seconds
[0m04:34:03.731438 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m04:34:03.733637 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m04:34:03.734729 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m04:34:03.775787 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.040 seconds
[0m04:34:03.777773 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m04:34:03.778168 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m04:34:03.778884 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2ef6754-2c66-44cd-aea3-050f9363deec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef495940>]}
[0m04:34:03.779533 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.10s]
[0m04:34:03.780079 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m04:34:03.785109 [debug] [MainThread]: On master: COMMIT
[0m04:34:03.786576 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:34:03.787024 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m04:34:03.791550 [info ] [MainThread]: 
[0m04:34:03.792917 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 8.64 seconds (8.64s).
[0m04:34:03.794702 [debug] [MainThread]: Command end result
[0m04:34:03.817938 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:34:03.822809 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:34:03.838163 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m04:34:03.838600 [info ] [MainThread]: 
[0m04:34:03.839045 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:34:03.839798 [info ] [MainThread]: 
[0m04:34:03.840548 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m04:34:03.842644 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.0466, "process_in_blocks": "55456", "process_kernel_time": 1.397181, "process_mem_max_rss": "289376", "process_out_blocks": "2297", "process_user_time": 3.675708}
[0m04:34:03.843343 [debug] [MainThread]: Command `cli run` succeeded at 04:34:03.843227 after 10.05 seconds
[0m04:34:03.844043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff083e240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c6d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3e7bc0>]}
[0m04:34:03.844414 [debug] [MainThread]: Flushing usage events
[0m04:34:04.380577 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:34:09.528371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff16b2ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff16b0200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a1d220>]}


============================== 04:34:09.546368 | c2b213d4-0399-4ce4-a912-fc3242b27f97 ==============================
[0m04:34:09.546368 [info ] [MainThread]: Running with dbt=1.10.10
[0m04:34:09.548813 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m04:34:09.827572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff00a2e70>]}
[0m04:34:09.920456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c48d10>]}
[0m04:34:09.921617 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m04:34:10.255617 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m04:34:10.393883 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:34:10.394823 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:34:10.467388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefceba10>]}
[0m04:34:10.482797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef8dc1d0>]}
[0m04:34:10.483852 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m04:34:10.484727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa58bf0>]}
[0m04:34:10.488106 [info ] [MainThread]: 
[0m04:34:10.488563 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m04:34:10.488869 [info ] [MainThread]: 
[0m04:34:10.489886 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m04:34:10.497195 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m04:34:10.541808 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m04:34:10.542457 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m04:34:10.542836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:34:10.543144 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m04:34:10.545110 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83f320>]}
[0m04:34:12.605186 [debug] [ThreadPool]: SQL status: SUCCESS in 2.051 seconds
[0m04:34:12.625889 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m04:34:12.626756 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m04:34:12.631759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m04:34:12.660433 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m04:34:12.661345 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m04:34:12.661868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:34:13.263262 [debug] [ThreadPool]: SQL status: SUCCESS in 0.601 seconds
[0m04:34:13.265987 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m04:34:13.266532 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m04:34:13.268742 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m04:34:13.277570 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m04:34:13.278233 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m04:34:13.278650 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:34:13.590969 [debug] [ThreadPool]: SQL status: SUCCESS in 0.312 seconds
[0m04:34:13.592749 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m04:34:13.593488 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m04:34:13.604745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2b213d4-0399-4ce4-a912-fc3242b27f97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff18bc0>]}
[0m04:34:13.619590 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m04:34:13.620424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m04:34:13.620942 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m04:34:13.623951 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m04:34:13.626689 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m04:34:13.628706 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m04:34:13.630045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m04:34:13.630759 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m04:34:13.634084 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m04:34:13.635063 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m04:34:13.635564 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m04:34:13.636110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m04:34:13.636642 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m04:34:13.640130 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m04:34:13.641603 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m04:34:13.642537 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m04:34:13.643939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m04:34:13.644441 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m04:34:13.646472 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m04:34:13.647175 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m04:34:13.647586 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m04:34:13.648146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m04:34:13.648625 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m04:34:13.662071 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m04:34:13.663760 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m04:34:13.664830 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m04:34:13.665338 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:34:13.665953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m04:34:13.666633 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:34:13.670555 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m04:34:13.671648 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:34:13.672421 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m04:34:13.672863 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m04:34:13.673421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m04:34:13.674170 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m04:34:13.678063 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m04:34:13.679113 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m04:34:13.680083 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m04:34:13.680816 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m04:34:13.682653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m04:34:13.683412 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m04:34:13.687515 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m04:34:13.688495 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m04:34:13.689301 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m04:34:13.689956 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m04:34:13.690682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m04:34:13.691108 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m04:34:13.695697 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m04:34:13.696634 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m04:34:13.697294 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m04:34:13.697748 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m04:34:13.698211 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m04:34:13.698566 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m04:34:13.716238 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m04:34:13.718631 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m04:34:13.720045 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m04:34:13.720562 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m04:34:13.721191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m04:34:13.722169 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m04:34:13.726793 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m04:34:13.727747 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m04:34:13.728624 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m04:34:13.729437 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m04:34:13.730181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m04:34:13.730701 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m04:34:13.735086 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m04:34:13.736229 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m04:34:13.737024 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m04:34:13.737461 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m04:34:13.737977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m04:34:13.738366 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m04:34:13.745149 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m04:34:13.746118 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m04:34:13.747078 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m04:34:13.747550 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m04:34:13.748018 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m04:34:13.748405 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m04:34:13.751819 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m04:34:13.752587 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m04:34:13.753217 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m04:34:13.753616 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m04:34:13.754307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m04:34:13.754731 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m04:34:13.758726 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m04:34:13.759558 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m04:34:13.760232 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m04:34:13.760626 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m04:34:13.761029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m04:34:13.761355 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m04:34:13.764604 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m04:34:13.765321 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m04:34:13.765993 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m04:34:13.766895 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m04:34:13.767346 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m04:34:13.767671 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m04:34:13.773623 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m04:34:13.774630 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m04:34:13.775436 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m04:34:13.775886 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m04:34:13.776541 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m04:34:13.776998 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m04:34:13.782617 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m04:34:13.783603 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m04:34:13.784456 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m04:34:13.784951 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m04:34:13.785564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m04:34:13.786073 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m04:34:13.791082 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m04:34:13.792363 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m04:34:13.793384 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m04:34:13.793988 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m04:34:13.794698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m04:34:13.795185 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m04:34:13.803027 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m04:34:13.807719 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m04:34:13.808908 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m04:34:13.809452 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m04:34:13.809977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m04:34:13.810453 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m04:34:13.815091 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m04:34:13.816063 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m04:34:13.816770 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m04:34:13.817132 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m04:34:13.817570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m04:34:13.817903 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m04:34:13.821715 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m04:34:13.823072 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m04:34:13.823721 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m04:34:13.824090 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m04:34:13.824518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m04:34:13.824873 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m04:34:13.828138 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m04:34:13.828801 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m04:34:13.829439 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m04:34:13.829852 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m04:34:13.830530 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m04:34:13.831047 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m04:34:13.836322 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m04:34:13.837307 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m04:34:13.838077 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m04:34:13.838514 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m04:34:13.838963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m04:34:13.839497 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m04:34:13.843145 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m04:34:13.844030 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m04:34:13.844646 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m04:34:13.844993 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m04:34:13.845411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m04:34:13.845719 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m04:34:13.849166 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m04:34:13.849942 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m04:34:13.850552 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m04:34:13.850997 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m04:34:13.851445 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m04:34:13.851863 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m04:34:13.855303 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m04:34:13.856209 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m04:34:13.856867 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m04:34:13.857245 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m04:34:13.857674 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m04:34:13.858071 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m04:34:13.863217 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m04:34:13.864163 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m04:34:13.864946 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m04:34:13.865426 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:13.865910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m04:34:13.866352 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:13.870283 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m04:34:13.871094 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:13.871728 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m04:34:13.875055 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:34:13.877419 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m04:34:13.884589 [debug] [MainThread]: Command end result
[0m04:34:14.073541 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:34:14.088258 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:34:14.108458 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m04:34:14.158272 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m04:34:14.161030 [info ] [MainThread]: Building catalog
[0m04:34:14.178112 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m04:34:14.290772 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m04:34:14.293134 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m04:34:14.294807 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:34:18.886565 [debug] [ThreadPool]: SQL status: SUCCESS in 4.583 seconds
[0m04:34:18.901668 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m04:34:18.946441 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m04:34:18.975291 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m04:34:18.981039 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m04:34:18.981518 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m04:34:18.985497 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.563124, "process_in_blocks": "3392", "process_kernel_time": 1.176308, "process_mem_max_rss": "290456", "process_out_blocks": "5916", "process_user_time": 3.970825}
[0m04:34:18.987553 [debug] [MainThread]: Command `cli docs generate` succeeded at 04:34:18.987325 after 9.57 seconds
[0m04:34:18.988515 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m04:34:18.988787 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m04:34:18.989405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0966240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef425d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffffebcb1a0>]}
[0m04:34:18.990045 [debug] [MainThread]: Flushing usage events
[0m04:34:19.507789 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:32:51.570953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c1e0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0a18a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c3b60>]}


============================== 10:32:51.608783 | 45b049fb-0b63-4eef-984e-9c6d2933f020 ==============================
[0m10:32:51.608783 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:32:51.613251 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:32:51.952609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0b052e0>]}
[0m10:32:52.029400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefceed80>]}
[0m10:32:52.030685 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:32:52.391924 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:32:52.550090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:32:52.550993 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:32:52.619226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01bab40>]}
[0m10:32:52.711815 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:32:52.715531 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:32:52.728984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83cfb0>]}
[0m10:32:52.730617 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:32:52.732511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02379e0>]}
[0m10:32:52.737500 [info ] [MainThread]: 
[0m10:32:52.738309 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:32:52.738826 [info ] [MainThread]: 
[0m10:32:52.739808 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:32:52.755135 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:32:52.807855 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:32:52.810594 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:32:52.811101 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:52.811466 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:32:52.812888 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52ca10>]}
[0m10:32:54.054794 [debug] [ThreadPool]: SQL status: SUCCESS in 1.242 seconds
[0m10:32:54.058851 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:32:54.065328 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m10:32:54.087364 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m10:32:54.087845 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m10:32:54.088153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:55.458256 [debug] [ThreadPool]: SQL status: SUCCESS in 1.370 seconds
[0m10:32:55.461508 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m10:32:55.461961 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m10:32:55.462916 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m10:32:55.470704 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m10:32:55.473350 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m10:32:55.473722 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:56.763660 [debug] [ThreadPool]: SQL status: SUCCESS in 1.289 seconds
[0m10:32:56.767131 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m10:32:56.767596 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m10:32:56.768716 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m10:32:56.775268 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m10:32:56.775612 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m10:32:56.775941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:57.615761 [debug] [ThreadPool]: SQL status: SUCCESS in 0.840 seconds
[0m10:32:57.617761 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m10:32:57.618083 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m10:32:57.620650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff198ea20>]}
[0m10:32:57.622418 [debug] [MainThread]: On master: COMMIT
[0m10:32:57.641569 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m10:32:57.642724 [info ] [Thread-1 (]: 1 of 4 START sql table model bronze.bronze_customer_events ..................... [RUN]
[0m10:32:57.643624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.bronze_customer_events)
[0m10:32:57.644202 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m10:32:57.650235 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m10:32:57.651754 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m10:32:57.696768 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_customer_events"
[0m10:32:57.699669 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m10:32:57.700075 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

  
    

    create table "iceberg"."bronze"."bronze_customer_events__dbt_tmp"
      
      
    as (
      

SELECT
    event_id,
    customer_id,
    session_id,
    event_type,
    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,
    page_url,
    NULLIF(product_id, '') as product_id,
    NULLIF(category_id, '') as category_id,
    referrer_source,
    device_type,
    user_agent,
    ip_address,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_customer_events' as source_system
FROM "iceberg"."bronze"."raw_customer_events"
--WHERE event_id IS NOT NULL
--AND customer_id IS NOT NULL
--AND event_timestamp IS NOT NULL
    )
[0m10:32:57.700398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:02.689498 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 4.987 seconds
[0m10:33:02.721641 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m10:33:02.722776 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events" rename to "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m10:33:03.030083 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.307 seconds
[0m10:33:03.033727 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m10:33:03.034115 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */
alter table "iceberg"."bronze"."bronze_customer_events__dbt_tmp" rename to "iceberg"."bronze"."bronze_customer_events"
[0m10:33:03.247356 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.213 seconds
[0m10:33:03.257194 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m10:33:03.259152 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_customer_events"
[0m10:33:03.259572 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_customer_events"} */

    drop table if exists "iceberg"."bronze"."bronze_customer_events__dbt_backup"
[0m10:33:03.356066 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.096 seconds
[0m10:33:03.375749 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: ROLLBACK
[0m10:33:03.376291 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_customer_events: Close
[0m10:33:03.380553 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefef7dd0>]}
[0m10:33:03.381673 [info ] [Thread-1 (]: 1 of 4 OK created sql table model bronze.bronze_customer_events ................ [[32mCREATE TABLE (12_000 rows)[0m in 5.73s]
[0m10:33:03.383928 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m10:33:03.384453 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:33:03.385365 [info ] [Thread-1 (]: 2 of 4 START sql table model bronze.bronze_inventory_snapshots ................. [RUN]
[0m10:33:03.385928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m10:33:03.386549 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:33:03.392022 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:33:03.393692 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:33:03.396866 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:33:03.399248 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:33:03.399603 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

  
    

    create table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp"
      
      
    as (
      

SELECT
    snapshot_id,
    product_id,
    warehouse_id,
    CAST(snapshot_date AS DATE) as snapshot_date,
    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,
    CAST(quantity_reserved AS INTEGER) as quantity_reserved,
    CAST(quantity_available AS INTEGER) as quantity_available,
    CAST(reorder_point AS INTEGER) as reorder_point,
    CAST(reorder_quantity AS INTEGER) as reorder_quantity,
    supplier_id,
    CAST(last_received_date AS DATE) as last_received_date,
    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_inventory_snapshots' as source_system
FROM "iceberg"."bronze"."raw_inventory_snapshots"
    )
[0m10:33:03.399970 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:06.744007 [debug] [Thread-1 (]: SQL status: CREATE TABLE (10_000 rows) in 3.342 seconds
[0m10:33:06.764592 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:33:06.765279 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots" rename to "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m10:33:07.031511 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.266 seconds
[0m10:33:07.035791 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:33:07.036182 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */
alter table "iceberg"."bronze"."bronze_inventory_snapshots__dbt_tmp" rename to "iceberg"."bronze"."bronze_inventory_snapshots"
[0m10:33:07.216252 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.180 seconds
[0m10:33:07.221628 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m10:33:07.222804 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:33:07.223192 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_inventory_snapshots"} */

    drop table if exists "iceberg"."bronze"."bronze_inventory_snapshots__dbt_backup"
[0m10:33:07.339976 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.116 seconds
[0m10:33:07.343533 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: ROLLBACK
[0m10:33:07.344127 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_inventory_snapshots: Close
[0m10:33:07.346323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85ee10>]}
[0m10:33:07.348547 [info ] [Thread-1 (]: 2 of 4 OK created sql table model bronze.bronze_inventory_snapshots ............ [[32mCREATE TABLE (10_000 rows)[0m in 3.96s]
[0m10:33:07.350691 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:33:07.351598 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m10:33:07.353150 [info ] [Thread-1 (]: 3 of 4 START sql table model bronze.bronze_payment_transactions ................ [RUN]
[0m10:33:07.353990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m10:33:07.354439 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m10:33:07.366199 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:33:07.367951 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m10:33:07.371975 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:33:07.375840 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:33:07.376288 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

  
    

    create table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp"
      
      
    as (
      

SELECT
    transaction_id,
    order_id,
    customer_id,
    payment_method,
    payment_status,
    CAST(amount AS DECIMAL(10,2)) as amount,
    currency,
    CAST(transaction_timestamp as timestamp) as transaction_timestamp,
    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,
    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,
    merchant_id,
    billing_country,
    risk_score,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_payment_transactions' as source_system
FROM "iceberg"."bronze"."raw_payment_transactions"
    )
[0m10:33:07.379933 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:10.190061 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 2.806 seconds
[0m10:33:10.213032 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:33:10.213682 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions" rename to "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m10:33:10.374464 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.160 seconds
[0m10:33:10.378986 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:33:10.379475 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */
alter table "iceberg"."bronze"."bronze_payment_transactions__dbt_tmp" rename to "iceberg"."bronze"."bronze_payment_transactions"
[0m10:33:10.554306 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.174 seconds
[0m10:33:10.559349 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m10:33:10.561600 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:33:10.562305 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_payment_transactions"} */

    drop table if exists "iceberg"."bronze"."bronze_payment_transactions__dbt_backup"
[0m10:33:10.654895 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.092 seconds
[0m10:33:10.657878 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: ROLLBACK
[0m10:33:10.658445 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_payment_transactions: Close
[0m10:33:10.660624 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef4705c0>]}
[0m10:33:10.662336 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bronze.bronze_payment_transactions ........... [[32mCREATE TABLE (15_000 rows)[0m in 3.31s]
[0m10:33:10.667452 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m10:33:10.676700 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m10:33:10.677699 [info ] [Thread-1 (]: 4 of 4 START sql table model bronze.bronze_support_tickets ..................... [RUN]
[0m10:33:10.679470 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m10:33:10.682341 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m10:33:10.693102 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m10:33:10.694808 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m10:33:10.699775 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.bronze_support_tickets"
[0m10:33:10.705756 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m10:33:10.706615 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

  
    

    create table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp"
      
      
    as (
      

SELECT
    ticket_id,
    customer_id,
    NULLIF(order_id, '') as order_id,
    ticket_type,
    priority,
    status,
    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,
    CASE
        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL
        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,
    resolution_timestamp,
    agent_id,
    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,
    subject,
    channel,
    CURRENT_TIMESTAMP as ingested_at,
    'raw_support_tickets' as source_system
FROM "iceberg"."bronze"."raw_support_tickets"
    )
[0m10:33:10.707445 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:17.680797 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 6.972 seconds
[0m10:33:17.703193 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m10:33:17.704181 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets" rename to "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m10:33:17.865752 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.161 seconds
[0m10:33:17.870435 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m10:33:17.871039 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */
alter table "iceberg"."bronze"."bronze_support_tickets__dbt_tmp" rename to "iceberg"."bronze"."bronze_support_tickets"
[0m10:33:18.085185 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.214 seconds
[0m10:33:18.089282 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m10:33:18.090504 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.bronze_support_tickets"
[0m10:33:18.090917 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.bronze_support_tickets"} */

    drop table if exists "iceberg"."bronze"."bronze_support_tickets__dbt_backup"
[0m10:33:18.169345 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.078 seconds
[0m10:33:18.173385 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: ROLLBACK
[0m10:33:18.175176 [debug] [Thread-1 (]: On model.ecommerce_dbt.bronze_support_tickets: Close
[0m10:33:18.181234 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45b049fb-0b63-4eef-984e-9c6d2933f020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4cabd10>]}
[0m10:33:18.182931 [info ] [Thread-1 (]: 4 of 4 OK created sql table model bronze.bronze_support_tickets ................ [[32mCREATE TABLE (8_000 rows)[0m in 7.50s]
[0m10:33:18.183767 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m10:33:18.194878 [debug] [MainThread]: On master: COMMIT
[0m10:33:18.196429 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:33:18.196793 [debug] [MainThread]: Connection 'model.ecommerce_dbt.bronze_support_tickets' was properly closed.
[0m10:33:18.200286 [info ] [MainThread]: 
[0m10:33:18.201906 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 25.46 seconds (25.46s).
[0m10:33:18.209301 [debug] [MainThread]: Command end result
[0m10:33:18.267196 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:33:18.283324 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:33:18.327842 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m10:33:18.328545 [info ] [MainThread]: 
[0m10:33:18.329628 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:33:18.330310 [info ] [MainThread]: 
[0m10:33:18.331205 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m10:33:18.334891 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 26.921276, "process_in_blocks": "134248", "process_kernel_time": 2.093824, "process_mem_max_rss": "289272", "process_out_blocks": "2286", "process_user_time": 4.196024}
[0m10:33:18.336471 [debug] [MainThread]: Command `cli run` succeeded at 10:33:18.336258 after 26.92 seconds
[0m10:33:18.338922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff02ee240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef52c8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd55d7e00>]}
[0m10:33:18.339858 [debug] [MainThread]: Flushing usage events
[0m10:33:19.020044 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:33:25.084572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0697020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0694b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1a29af0>]}


============================== 10:33:25.113185 | 377a0185-a11d-4f10-b97f-1d4d901c1250 ==============================
[0m10:33:25.113185 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:33:25.114729 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:33:25.365632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06c3bf0>]}
[0m10:33:25.442689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff244d0>]}
[0m10:33:25.443754 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:33:25.777482 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:33:25.908861 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:25.909629 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:25.968961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0177d10>]}
[0m10:33:26.063811 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:33:26.066648 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:33:26.077650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef83d340>]}
[0m10:33:26.078567 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:33:26.079357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef831df0>]}
[0m10:33:26.081818 [info ] [MainThread]: 
[0m10:33:26.082439 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:33:26.082874 [info ] [MainThread]: 
[0m10:33:26.083700 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:33:26.091133 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:33:26.126711 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:33:26.127223 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:33:26.127545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:26.127827 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:33:26.129216 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85fc20>]}
[0m10:33:27.457321 [debug] [ThreadPool]: SQL status: SUCCESS in 1.328 seconds
[0m10:33:27.461265 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:33:27.467400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m10:33:27.492333 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m10:33:27.492866 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m10:33:27.493220 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:28.153436 [debug] [ThreadPool]: SQL status: SUCCESS in 0.660 seconds
[0m10:33:28.156091 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m10:33:28.156442 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m10:33:28.157235 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m10:33:28.162848 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m10:33:28.163175 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m10:33:28.163493 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:28.567625 [debug] [ThreadPool]: SQL status: SUCCESS in 0.404 seconds
[0m10:33:28.569459 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m10:33:28.569848 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m10:33:28.570659 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m10:33:28.575484 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m10:33:28.575947 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m10:33:28.576305 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:28.880841 [debug] [ThreadPool]: SQL status: SUCCESS in 0.304 seconds
[0m10:33:28.882574 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m10:33:28.882890 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m10:33:28.885014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff074d130>]}
[0m10:33:28.888435 [debug] [MainThread]: On master: COMMIT
[0m10:33:28.903100 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m10:33:28.904327 [info ] [Thread-1 (]: 1 of 4 START sql table model silver.silver_customer_sessions ................... [RUN]
[0m10:33:28.908973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.silver_customer_sessions)
[0m10:33:28.909539 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m10:33:28.920439 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m10:33:28.922012 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m10:33:29.003663 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_customer_sessions"
[0m10:33:29.011402 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m10:33:29.011942 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

  
    

    create table "iceberg"."silver"."silver_customer_sessions__dbt_tmp"
      
      
    as (
      

-- Silver layer: Customer session analysis with event aggregations
WITH session_events AS (
    SELECT
        customer_id,
        session_id,
        MIN(event_timestamp) as session_start,
        MAX(event_timestamp) as session_end,
        COUNT(*) as total_events,
        COUNT(DISTINCT event_type) as unique_event_types,
        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,
        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,
        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,
        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,
        COUNT(DISTINCT product_id) as unique_products_viewed,
        device_type,
        referrer_source
    FROM "iceberg"."bronze"."bronze_customer_events"
    GROUP BY customer_id, session_id, device_type, referrer_source
),

session_metrics AS (
    SELECT
        *,
        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,
        CASE
            WHEN purchases > 0 THEN TRUE
            ELSE FALSE
        END as converted,
        CASE
            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE
            ELSE FALSE
        END as abandoned_cart,
        CASE
            WHEN total_events = 1 THEN TRUE
            ELSE FALSE
        END as bounce_session
    FROM session_events
)

SELECT
    customer_id,
    session_id,
    session_start,
    session_end,
    session_duration_seconds,
    CASE
        WHEN session_duration_seconds < 30 THEN 'Very Short'
        WHEN session_duration_seconds < 300 THEN 'Short'
        WHEN session_duration_seconds < 1800 THEN 'Medium'
        ELSE 'Long'
    END as session_length_category,
    total_events,
    unique_event_types,
    page_views,
    product_views,
    cart_adds,
    purchases,
    unique_products_viewed,
    converted,
    abandoned_cart,
    bounce_session,
    device_type,
    referrer_source,
    CURRENT_TIMESTAMP as processed_at
FROM session_metrics
    )
[0m10:33:29.012403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:31.316540 [debug] [Thread-1 (]: SQL status: CREATE TABLE (12_000 rows) in 2.302 seconds
[0m10:33:31.337075 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m10:33:31.337641 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions" rename to "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m10:33:31.434755 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.097 seconds
[0m10:33:31.438537 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m10:33:31.438977 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */
alter table "iceberg"."silver"."silver_customer_sessions__dbt_tmp" rename to "iceberg"."silver"."silver_customer_sessions"
[0m10:33:31.518908 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.079 seconds
[0m10:33:31.528073 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m10:33:31.530268 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_customer_sessions"
[0m10:33:31.530619 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_customer_sessions"} */

    drop table if exists "iceberg"."silver"."silver_customer_sessions__dbt_backup"
[0m10:33:31.575665 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.045 seconds
[0m10:33:31.596409 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: ROLLBACK
[0m10:33:31.596919 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_customer_sessions: Close
[0m10:33:31.609895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef3fa060>]}
[0m10:33:31.612702 [info ] [Thread-1 (]: 1 of 4 OK created sql table model silver.silver_customer_sessions .............. [[32mCREATE TABLE (12_000 rows)[0m in 2.69s]
[0m10:33:31.617567 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m10:33:31.618620 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m10:33:31.619400 [info ] [Thread-1 (]: 2 of 4 START sql table model silver.silver_inventory_health .................... [RUN]
[0m10:33:31.620443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now model.ecommerce_dbt.silver_inventory_health)
[0m10:33:31.621474 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m10:33:31.626983 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m10:33:31.628870 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m10:33:31.634567 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_inventory_health"
[0m10:33:31.649216 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m10:33:31.650336 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

  
    

    create table "iceberg"."silver"."silver_inventory_health__dbt_tmp"
      
      
    as (
      

-- Silver layer: Inventory health analysis with stock level classifications
WITH latest_inventory AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,
        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn
    FROM "iceberg"."bronze"."bronze_inventory_snapshots"
),

inventory_metrics AS (
    SELECT
        product_id,
        warehouse_id,
        snapshot_date,
        quantity_on_hand,
        quantity_reserved,
        quantity_available,
        reorder_point,
        reorder_quantity,
        supplier_id,
        unit_cost,

        -- Stock health classifications
        CASE
            WHEN quantity_available <= 0 THEN 'Out of Stock'
            WHEN quantity_available <= reorder_point THEN 'Low Stock'
            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'
            ELSE 'High Stock'
        END as stock_status,

        -- Days of inventory calculation
        CASE
            WHEN quantity_available > 0 THEN
                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30
            ELSE 0
        END as estimated_days_of_inventory,

        -- Reorder recommendation
        CASE
            WHEN quantity_available <= reorder_point THEN TRUE
            ELSE FALSE
        END as needs_reorder,

        -- Stock turn rate estimate (simplified)
        CASE
            WHEN quantity_on_hand > 0 THEN
                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12
            ELSE 0
        END as estimated_annual_turns,

        -- Inventory value
        quantity_on_hand * unit_cost as inventory_value,
        quantity_available * unit_cost as available_inventory_value

    FROM latest_inventory
    WHERE rn = 1
)

SELECT
    product_id,
    warehouse_id,
    snapshot_date,
    quantity_on_hand,
    quantity_reserved,
    quantity_available,
    reorder_point,
    reorder_quantity,
    supplier_id,
    unit_cost,
    stock_status,
    estimated_days_of_inventory,
    needs_reorder,
    estimated_annual_turns,
    inventory_value,
    available_inventory_value,

    -- Risk classifications
    CASE
        WHEN stock_status = 'Out of Stock' THEN 'Critical'
        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'
        WHEN stock_status = 'Low Stock' THEN 'Medium'
        ELSE 'Low'
    END as inventory_risk_level,

    CURRENT_TIMESTAMP as processed_at
FROM inventory_metrics
    )
[0m10:33:31.651230 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:33.436140 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_957 rows) in 1.780 seconds
[0m10:33:33.455428 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m10:33:33.456937 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health" rename to "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m10:33:33.557462 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.099 seconds
[0m10:33:33.562326 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m10:33:33.563585 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */
alter table "iceberg"."silver"."silver_inventory_health__dbt_tmp" rename to "iceberg"."silver"."silver_inventory_health"
[0m10:33:33.648608 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.084 seconds
[0m10:33:33.655186 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m10:33:33.656365 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_inventory_health"
[0m10:33:33.656765 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_inventory_health"} */

    drop table if exists "iceberg"."silver"."silver_inventory_health__dbt_backup"
[0m10:33:33.711652 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.054 seconds
[0m10:33:33.714318 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: ROLLBACK
[0m10:33:33.714749 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_inventory_health: Close
[0m10:33:33.716767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef2b9b80>]}
[0m10:33:33.718353 [info ] [Thread-1 (]: 2 of 4 OK created sql table model silver.silver_inventory_health ............... [[32mCREATE TABLE (8_957 rows)[0m in 2.10s]
[0m10:33:33.719380 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m10:33:33.720265 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m10:33:33.721582 [info ] [Thread-1 (]: 3 of 4 START sql table model silver.silver_payment_analysis .................... [RUN]
[0m10:33:33.722377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now model.ecommerce_dbt.silver_payment_analysis)
[0m10:33:33.722945 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m10:33:33.734620 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m10:33:33.737839 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m10:33:33.741553 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_payment_analysis"
[0m10:33:33.749358 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m10:33:33.749854 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

  
    

    create table "iceberg"."silver"."silver_payment_analysis__dbt_tmp"
      
      
    as (
      

-- Silver layer: Payment transaction analysis with fraud detection features
WITH payment_enriched AS (
    SELECT
        transaction_id,
        order_id,
        customer_id,
        payment_method,
        payment_status,
        amount,
        currency,
        transaction_timestamp,
        processor_response_code,
        gateway_fee,
        merchant_id,
        billing_country,
        risk_score,

        -- Time-based features
        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,
        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,
        DATE(transaction_timestamp) as transaction_date,

        -- Payment success indicator
        CASE
            WHEN payment_status = 'completed' THEN TRUE
            ELSE FALSE
        END as is_successful,

        -- High-risk transaction indicator
        CASE
            WHEN risk_score >= 80 THEN TRUE
            ELSE FALSE
        END as is_high_risk,

        -- Failed payment indicator
        CASE
            WHEN payment_status = 'failed' THEN TRUE
            ELSE FALSE
        END as is_failed,

        -- Refunded transaction indicator
        CASE
            WHEN payment_status = 'refunded' THEN TRUE
            ELSE FALSE
        END as is_refunded,

        -- Net payment amount (after gateway fees)
        amount - gateway_fee as net_amount

    FROM "iceberg"."bronze"."bronze_payment_transactions"
),

customer_payment_patterns AS (
    SELECT
        customer_id,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,
        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,
        AVG(amount) as avg_transaction_amount,
        MAX(amount) as max_transaction_amount,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,
        COUNT(DISTINCT payment_method) as unique_payment_methods
    FROM payment_enriched
    GROUP BY customer_id
)

SELECT
    p.transaction_id,
    p.order_id,
    p.customer_id,
    p.payment_method,
    p.payment_status,
    p.amount,
    p.currency,
    p.transaction_timestamp,
    p.transaction_hour,
    p.transaction_day_of_week,
    p.transaction_date,
    p.processor_response_code,
    p.gateway_fee,
    p.net_amount,
    p.merchant_id,
    p.billing_country,
    p.risk_score,
    p.is_successful,
    p.is_high_risk,
    p.is_failed,
    p.is_refunded,

    -- Customer behavior features
    cp.total_transactions as customer_total_transactions,
    cp.successful_transactions as customer_successful_transactions,
    cp.failed_transactions as customer_failed_transactions,
    cp.avg_transaction_amount as customer_avg_amount,
    cp.max_transaction_amount as customer_max_amount,

    -- Customer risk indicators
    CASE
        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE
        ELSE FALSE
    END as is_high_failure_rate_customer,

    CASE
        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE
        ELSE FALSE
    END as is_unusually_large_transaction,

    -- Payment method risk classification
    CASE
        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'
        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'
        ELSE 'High Risk'
    END as payment_method_risk_category,

    CURRENT_TIMESTAMP as processed_at

FROM payment_enriched p
LEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id
    )
[0m10:33:33.750348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:37.989724 [debug] [Thread-1 (]: SQL status: CREATE TABLE (15_000 rows) in 4.237 seconds
[0m10:33:38.029691 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m10:33:38.031323 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis" rename to "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m10:33:38.215048 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.183 seconds
[0m10:33:38.219355 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m10:33:38.219790 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */
alter table "iceberg"."silver"."silver_payment_analysis__dbt_tmp" rename to "iceberg"."silver"."silver_payment_analysis"
[0m10:33:38.336299 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.116 seconds
[0m10:33:38.341165 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m10:33:38.343871 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_payment_analysis"
[0m10:33:38.344305 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_payment_analysis"} */

    drop table if exists "iceberg"."silver"."silver_payment_analysis__dbt_backup"
[0m10:33:38.401471 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.057 seconds
[0m10:33:38.404830 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: ROLLBACK
[0m10:33:38.405284 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_payment_analysis: Close
[0m10:33:38.407498 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef85ea50>]}
[0m10:33:38.409216 [info ] [Thread-1 (]: 3 of 4 OK created sql table model silver.silver_payment_analysis ............... [[32mCREATE TABLE (15_000 rows)[0m in 4.68s]
[0m10:33:38.410126 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m10:33:38.412560 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m10:33:38.413857 [info ] [Thread-1 (]: 4 of 4 START sql table model silver.silver_support_metrics ..................... [RUN]
[0m10:33:38.414653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now model.ecommerce_dbt.silver_support_metrics)
[0m10:33:38.415142 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m10:33:38.423184 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m10:33:38.425189 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m10:33:38.428589 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.silver_support_metrics"
[0m10:33:38.447454 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m10:33:38.448393 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

  
    

    create table "iceberg"."silver"."silver_support_metrics__dbt_tmp"
      
      
    as (
      

-- Silver layer: Support ticket analysis with SLA tracking and agent performance
WITH ticket_enriched AS (
    SELECT
        ticket_id,
        customer_id,
        order_id,
        ticket_type,
        priority,
        status,
        created_timestamp,
        first_response_timestamp,
        resolution_timestamp,
        agent_id,
        satisfaction_score,
        subject,
        channel,

        -- Response time calculations (in minutes)
        CASE
            WHEN first_response_timestamp IS NOT NULL THEN
                DATE_DIFF('minute', created_timestamp, first_response_timestamp)
            ELSE NULL
        END as first_response_time_minutes,

        -- Resolution time calculations (in hours)
        CASE
            WHEN resolution_timestamp IS NOT NULL THEN
                DATE_DIFF('hour', created_timestamp, resolution_timestamp)
            ELSE NULL
        END as resolution_time_hours,

        -- SLA compliance indicators
        CASE
            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE
            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE
            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE
            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE
            ELSE FALSE
        END as meets_response_sla,

        CASE
            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE
            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE
            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE
            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL
                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE
            ELSE FALSE
        END as meets_resolution_sla,

        -- Ticket age for open tickets
        CASE
            WHEN status IN ('open', 'in_progress') THEN
                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)
            ELSE NULL
        END as current_age_hours,

        -- Customer satisfaction indicators
        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE
            ELSE FALSE
        END as is_satisfied_customer,

        CASE
            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE
            ELSE FALSE
        END as is_unsatisfied_customer

    FROM "iceberg"."bronze"."bronze_support_tickets"
),

agent_performance AS (
    SELECT
        agent_id,
        COUNT(*) as total_tickets_handled,
        AVG(first_response_time_minutes) as avg_first_response_time,
        AVG(resolution_time_hours) as avg_resolution_time,
        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,
        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,
        AVG(satisfaction_score) as avg_satisfaction_score,
        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,
        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers
    FROM ticket_enriched
    WHERE agent_id IS NOT NULL
    GROUP BY agent_id
)

SELECT
    t.ticket_id,
    t.customer_id,
    t.order_id,
    t.ticket_type,
    t.priority,
    t.status,
    t.created_timestamp,
    t.first_response_timestamp,
    t.resolution_timestamp,
    t.agent_id,
    t.satisfaction_score,
    t.subject,
    t.channel,
    t.first_response_time_minutes,
    t.resolution_time_hours,
    t.meets_response_sla,
    t.meets_resolution_sla,
    t.current_age_hours,
    t.is_satisfied_customer,
    t.is_unsatisfied_customer,

    -- Agent performance context
    a.avg_first_response_time as agent_avg_response_time,
    a.avg_resolution_time as agent_avg_resolution_time,
    a.avg_satisfaction_score as agent_avg_satisfaction,

    -- Ticket urgency classification
    CASE
        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'
        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'
        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'
        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'
        WHEN t.status IN ('open', 'in_progress') THEN 'Active'
        ELSE 'Resolved'
    END as ticket_urgency_status,

    -- Channel efficiency indicator
    CASE
        WHEN t.channel = 'chat' THEN 'Real-time'
        WHEN t.channel = 'phone' THEN 'Real-time'
        WHEN t.channel = 'email' THEN 'Asynchronous'
        WHEN t.channel = 'social_media' THEN 'Public'
        ELSE 'Other'
    END as channel_type,

    CURRENT_TIMESTAMP as processed_at

FROM ticket_enriched t
LEFT JOIN agent_performance a ON t.agent_id = a.agent_id
    )
[0m10:33:38.449146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:41.307029 [debug] [Thread-1 (]: SQL status: CREATE TABLE (8_000 rows) in 2.856 seconds
[0m10:33:41.322988 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m10:33:41.323510 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics" rename to "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m10:33:41.434401 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.110 seconds
[0m10:33:41.438727 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m10:33:41.440863 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */
alter table "iceberg"."silver"."silver_support_metrics__dbt_tmp" rename to "iceberg"."silver"."silver_support_metrics"
[0m10:33:41.557908 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.116 seconds
[0m10:33:41.562208 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m10:33:41.563313 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.silver_support_metrics"
[0m10:33:41.563744 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.silver_support_metrics"} */

    drop table if exists "iceberg"."silver"."silver_support_metrics__dbt_backup"
[0m10:33:41.617261 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.053 seconds
[0m10:33:41.620081 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: ROLLBACK
[0m10:33:41.620573 [debug] [Thread-1 (]: On model.ecommerce_dbt.silver_support_metrics: Close
[0m10:33:41.622674 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377a0185-a11d-4f10-b97f-1d4d901c1250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffd4c9ecc0>]}
[0m10:33:41.624801 [info ] [Thread-1 (]: 4 of 4 OK created sql table model silver.silver_support_metrics ................ [[32mCREATE TABLE (8_000 rows)[0m in 3.21s]
[0m10:33:41.625767 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m10:33:41.643248 [debug] [MainThread]: On master: COMMIT
[0m10:33:41.645517 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:33:41.646083 [debug] [MainThread]: Connection 'model.ecommerce_dbt.silver_support_metrics' was properly closed.
[0m10:33:41.648884 [info ] [MainThread]: 
[0m10:33:41.649958 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.56 seconds (15.56s).
[0m10:33:41.653762 [debug] [MainThread]: Command end result
[0m10:33:41.704317 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:33:41.726652 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:33:41.756170 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m10:33:41.756626 [info ] [MainThread]: 
[0m10:33:41.757767 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:33:41.758377 [info ] [MainThread]: 
[0m10:33:41.759837 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m10:33:41.766155 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 16.788462, "process_in_blocks": "464", "process_kernel_time": 0.899277, "process_mem_max_rss": "289368", "process_out_blocks": "2421", "process_user_time": 4.098412}
[0m10:33:41.770431 [debug] [MainThread]: Command `cli run` succeeded at 10:33:41.769500 after 16.80 seconds
[0m10:33:41.772602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff021c800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff045de20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01bd550>]}
[0m10:33:41.773345 [debug] [MainThread]: Flushing usage events
[0m10:33:42.457582 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:33:47.782037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b7da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b7d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b5a30>]}


============================== 10:33:47.800609 | 9874d143-1931-48e2-a688-5ce062dbb8ee ==============================
[0m10:33:47.800609 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:33:47.802880 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:33:48.146654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff07c0f80>]}
[0m10:33:48.233856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeffc7b30>]}
[0m10:33:48.234822 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:33:48.573675 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:33:48.706409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:48.707513 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:48.799440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd569c0>]}
[0m10:33:48.911183 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:33:48.914670 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:33:48.931660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef821070>]}
[0m10:33:48.933203 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:33:48.934276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef810620>]}
[0m10:33:48.937832 [info ] [MainThread]: 
[0m10:33:48.939283 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:33:48.939947 [info ] [MainThread]: 
[0m10:33:48.940792 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:33:48.949957 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg'
[0m10:33:48.983113 [debug] [ThreadPool]: Using trino connection "list_iceberg"
[0m10:33:48.983586 [debug] [ThreadPool]: On list_iceberg: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg"} */

    select schema_name
    from "iceberg".INFORMATION_SCHEMA.schemata
[0m10:33:48.983908 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:48.984181 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:33:48.985520 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef524980>]}
[0m10:33:50.723327 [debug] [ThreadPool]: SQL status: SUCCESS in 1.737 seconds
[0m10:33:50.732804 [debug] [ThreadPool]: On list_iceberg: Close
[0m10:33:50.746759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg, now list_iceberg_gold)
[0m10:33:50.786353 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m10:33:50.787044 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m10:33:50.787498 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:51.805226 [debug] [ThreadPool]: SQL status: SUCCESS in 1.017 seconds
[0m10:33:51.807678 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m10:33:51.808129 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m10:33:51.809785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m10:33:51.818544 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m10:33:51.819187 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m10:33:51.819533 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:52.256975 [debug] [ThreadPool]: SQL status: SUCCESS in 0.436 seconds
[0m10:33:52.264072 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m10:33:52.264758 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m10:33:52.268112 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m10:33:52.287641 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m10:33:52.288752 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m10:33:52.289500 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:53.519193 [debug] [ThreadPool]: SQL status: SUCCESS in 1.228 seconds
[0m10:33:53.535661 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m10:33:53.538281 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m10:33:53.555923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff1967320>]}
[0m10:33:53.567738 [debug] [MainThread]: On master: COMMIT
[0m10:33:53.623147 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m10:33:53.628111 [info ] [Thread-1 (]: 1 of 3 START sql table model gold.gold_customer_summary ........................ [RUN]
[0m10:33:53.633963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now model.ecommerce_dbt.gold_customer_summary)
[0m10:33:53.639239 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m10:33:53.670226 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m10:33:53.674377 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m10:33:53.760187 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_customer_summary"
[0m10:33:53.769017 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m10:33:53.769701 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

  
    

    create table "iceberg"."gold"."gold_customer_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer customer summary
SELECT
    cs.customer_id,

    -- Session metrics
    COUNT(DISTINCT cs.session_id) as total_sessions,
    AVG(cs.session_duration_seconds) as avg_session_duration,
    SUM(cs.total_events) as total_events,

    -- Payment metrics
    COUNT(DISTINCT pa.transaction_id) as total_transactions,
    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,
    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,

    -- Support metrics
    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,
    AVG(sm.satisfaction_score) as avg_satisfaction_score,

    CURRENT_TIMESTAMP as calculated_at

FROM "iceberg"."silver"."silver_customer_sessions" cs
LEFT JOIN "iceberg"."silver"."silver_payment_analysis" pa ON cs.customer_id = pa.customer_id
LEFT JOIN "iceberg"."silver"."silver_support_metrics" sm ON cs.customer_id = sm.customer_id
GROUP BY cs.customer_id
    )
[0m10:33:53.771282 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:58.469419 [debug] [Thread-1 (]: SQL status: CREATE TABLE (11_232 rows) in 4.697 seconds
[0m10:33:58.519422 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m10:33:58.520355 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary" rename to "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m10:33:58.677570 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.156 seconds
[0m10:33:58.684014 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m10:33:58.685218 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */
alter table "iceberg"."gold"."gold_customer_summary__dbt_tmp" rename to "iceberg"."gold"."gold_customer_summary"
[0m10:33:58.779701 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.094 seconds
[0m10:33:58.796882 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m10:33:58.800620 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_customer_summary"
[0m10:33:58.801252 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_customer_summary"} */

    drop table if exists "iceberg"."gold"."gold_customer_summary__dbt_backup"
[0m10:33:58.969306 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.167 seconds
[0m10:33:59.040626 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: ROLLBACK
[0m10:33:59.041311 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_customer_summary: Close
[0m10:33:59.060764 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0c13dd0>]}
[0m10:33:59.062269 [info ] [Thread-1 (]: 1 of 3 OK created sql table model gold.gold_customer_summary ................... [[32mCREATE TABLE (11_232 rows)[0m in 5.41s]
[0m10:33:59.065039 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m10:33:59.066807 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m10:33:59.067950 [info ] [Thread-1 (]: 2 of 3 START sql table model gold.gold_daily_metrics ........................... [RUN]
[0m10:33:59.070284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m10:33:59.073747 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m10:33:59.083288 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m10:33:59.095666 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m10:33:59.101894 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_daily_metrics"
[0m10:33:59.114419 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m10:33:59.115377 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

  
    

    create table "iceberg"."gold"."gold_daily_metrics__dbt_tmp"
      
      
    as (
      

-- Simple gold layer daily metrics
WITH daily_sessions AS (
    SELECT
        DATE(session_start) as metric_date,
        COUNT(DISTINCT session_id) as total_sessions,
        COUNT(DISTINCT customer_id) as unique_visitors,
        AVG(session_duration_seconds) as avg_session_duration
    FROM "iceberg"."silver"."silver_customer_sessions"
    GROUP BY DATE(session_start)
),

daily_payments AS (
    SELECT
        DATE(transaction_timestamp) as metric_date,
        COUNT(*) as total_transactions,
        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,
        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,
        AVG(risk_score) as avg_risk_score
    FROM "iceberg"."silver"."silver_payment_analysis"
    GROUP BY DATE(transaction_timestamp)
),

daily_support AS (
    SELECT
        DATE(created_timestamp) as metric_date,
        COUNT(*) as total_tickets,
        AVG(first_response_time_minutes/60.0) as avg_response_time,
        AVG(resolution_time_hours) as avg_resolution_time
    FROM "iceberg"."silver"."silver_support_metrics"
    GROUP BY DATE(created_timestamp)
)

SELECT
    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,

    -- Session metrics
    COALESCE(ds.total_sessions, 0) as total_sessions,
    COALESCE(ds.unique_visitors, 0) as unique_visitors,
    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,

    -- Payment metrics
    COALESCE(dp.total_transactions, 0) as total_transactions,
    COALESCE(dp.successful_transactions, 0) as successful_transactions,
    COALESCE(dp.daily_revenue, 0) as daily_revenue,
    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,

    -- Support metrics
    COALESCE(dsu.total_tickets, 0) as total_tickets,
    COALESCE(dsu.avg_response_time, 0) as avg_response_time,
    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,

    CURRENT_TIMESTAMP as calculated_at

FROM daily_sessions ds
FULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date
FULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date
    )
[0m10:33:59.116390 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:34:01.688181 [debug] [Thread-1 (]: SQL status: CREATE TABLE (61 rows) in 2.570 seconds
[0m10:34:01.705122 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m10:34:01.706361 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics" rename to "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m10:34:01.788649 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.082 seconds
[0m10:34:01.792473 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m10:34:01.792826 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */
alter table "iceberg"."gold"."gold_daily_metrics__dbt_tmp" rename to "iceberg"."gold"."gold_daily_metrics"
[0m10:34:01.860608 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.067 seconds
[0m10:34:01.864175 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m10:34:01.865066 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_daily_metrics"
[0m10:34:01.865411 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_daily_metrics"} */

    drop table if exists "iceberg"."gold"."gold_daily_metrics__dbt_backup"
[0m10:34:01.903660 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.038 seconds
[0m10:34:01.906122 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: ROLLBACK
[0m10:34:01.906595 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_daily_metrics: Close
[0m10:34:01.908360 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff7942690>]}
[0m10:34:01.909646 [info ] [Thread-1 (]: 2 of 3 OK created sql table model gold.gold_daily_metrics ...................... [[32mCREATE TABLE (61 rows)[0m in 2.84s]
[0m10:34:01.911010 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m10:34:01.912861 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m10:34:01.913793 [info ] [Thread-1 (]: 3 of 3 START sql table model gold.gold_product_summary ......................... [RUN]
[0m10:34:01.917861 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_daily_metrics, now model.ecommerce_dbt.gold_product_summary)
[0m10:34:01.918378 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m10:34:01.926547 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m10:34:01.928214 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m10:34:01.931228 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecommerce_dbt.gold_product_summary"
[0m10:34:01.935651 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m10:34:01.936109 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

  
    

    create table "iceberg"."gold"."gold_product_summary__dbt_tmp"
      
      
    as (
      

-- Simple gold layer product summary
WITH product_events AS (
    SELECT
        product_id,
        COUNT(*) as total_events,
        COUNT(DISTINCT customer_id) as unique_viewers,
        COUNT(DISTINCT session_id) as unique_sessions
    FROM "iceberg"."bronze"."bronze_customer_events"
    WHERE product_id IS NOT NULL
    GROUP BY product_id
),

product_inventory AS (
    SELECT
        product_id,
        AVG(quantity_on_hand) as avg_stock_level,
        AVG(reorder_point) as avg_reorder_point,
        MAX(needs_reorder) as ever_out_of_stock
    FROM "iceberg"."silver"."silver_inventory_health"
    GROUP BY product_id
)

SELECT
    COALESCE(pe.product_id, pi.product_id) as product_id,

    -- Event metrics
    COALESCE(pe.total_events, 0) as total_events,
    COALESCE(pe.unique_viewers, 0) as unique_viewers,
    COALESCE(pe.unique_sessions, 0) as unique_sessions,

    -- Inventory metrics
    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,
    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,
    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,

    CURRENT_TIMESTAMP as calculated_at

FROM product_events pe
FULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id
    )
[0m10:34:01.936538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:34:03.139404 [debug] [Thread-1 (]: SQL status: CREATE TABLE (7_861 rows) in 1.202 seconds
[0m10:34:03.151098 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m10:34:03.152301 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary" rename to "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m10:34:03.231009 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.078 seconds
[0m10:34:03.236826 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m10:34:03.237295 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */
alter table "iceberg"."gold"."gold_product_summary__dbt_tmp" rename to "iceberg"."gold"."gold_product_summary"
[0m10:34:03.311625 [debug] [Thread-1 (]: SQL status: RENAME TABLE in 0.074 seconds
[0m10:34:03.315343 [debug] [Thread-1 (]: Applying DROP to: "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m10:34:03.316341 [debug] [Thread-1 (]: Using trino connection "model.ecommerce_dbt.gold_product_summary"
[0m10:34:03.316731 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "node_id": "model.ecommerce_dbt.gold_product_summary"} */

    drop table if exists "iceberg"."gold"."gold_product_summary__dbt_backup"
[0m10:34:03.364920 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.048 seconds
[0m10:34:03.367094 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: ROLLBACK
[0m10:34:03.367484 [debug] [Thread-1 (]: On model.ecommerce_dbt.gold_product_summary: Close
[0m10:34:03.369107 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9874d143-1931-48e2-a688-5ce062dbb8ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef496b40>]}
[0m10:34:03.370102 [info ] [Thread-1 (]: 3 of 3 OK created sql table model gold.gold_product_summary .................... [[32mCREATE TABLE (7_861 rows)[0m in 1.45s]
[0m10:34:03.372294 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m10:34:03.381694 [debug] [MainThread]: On master: COMMIT
[0m10:34:03.382983 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:34:03.383356 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m10:34:03.385521 [info ] [MainThread]: 
[0m10:34:03.386130 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 14.44 seconds (14.44s).
[0m10:34:03.388271 [debug] [MainThread]: Command end result
[0m10:34:03.422212 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:34:03.428746 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:34:03.453965 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m10:34:03.454468 [info ] [MainThread]: 
[0m10:34:03.455406 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:34:03.455976 [info ] [MainThread]: 
[0m10:34:03.456831 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m10:34:03.461091 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.779656, "process_in_blocks": "49560", "process_kernel_time": 1.012026, "process_mem_max_rss": "288488", "process_out_blocks": "2297", "process_user_time": 3.904263}
[0m10:34:03.462891 [debug] [MainThread]: Command `cli run` succeeded at 10:34:03.462755 after 15.78 seconds
[0m10:34:03.463717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0bc2f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff032d4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef811cd0>]}
[0m10:34:03.464128 [debug] [MainThread]: Flushing usage events
[0m10:34:04.045763 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:34:09.214350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b7dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b5be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff06b7b30>]}


============================== 10:34:09.242605 | 9a3d0e4a-0aae-4281-947f-75d3f8870bda ==============================
[0m10:34:09.242605 [info ] [MainThread]: Running with dbt=1.10.10
[0m10:34:09.243932 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'version_check': 'True', 'empty': 'None', 'target_path': 'None', 'log_format': 'default', 'invocation_command': 'dbt celery worker', 'profiles_dir': '/opt/airflow/dags/ecommerce_dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dags/ecommerce_dbt/logs', 'partial_parse': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'debug': 'False'}
[0m10:34:09.458453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0166990>]}
[0m10:34:09.574985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0094260>]}
[0m10:34:09.577642 [info ] [MainThread]: Registered adapter: trino=1.9.3
[0m10:34:09.949941 [debug] [MainThread]: checksum: 502a0dc23e9052e1ae09f7c44ee219ef7a02dfea7e7d66580d54c304c14d553b, vars: {}, profile: , target: , version: 1.10.10
[0m10:34:10.104342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:34:10.105385 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:34:10.180113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefd55100>]}
[0m10:34:10.197002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffefa96870>]}
[0m10:34:10.199696 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m10:34:10.200455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0411eb0>]}
[0m10:34:10.205241 [info ] [MainThread]: 
[0m10:34:10.206018 [info ] [MainThread]: Concurrency: 1 threads (target='trino')
[0m10:34:10.206502 [info ] [MainThread]: 
[0m10:34:10.207450 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:34:10.214886 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m10:34:10.253919 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m10:34:10.254462 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m10:34:10.254798 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:34:10.255061 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m10:34:10.256428 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffef82afc0>]}
[0m10:34:10.827426 [debug] [ThreadPool]: SQL status: SUCCESS in 0.572 seconds
[0m10:34:10.832089 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m10:34:10.832607 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m10:34:10.833897 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_gold, now list_iceberg_bronze)
[0m10:34:10.839209 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m10:34:10.841068 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m10:34:10.841467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:34:11.166342 [debug] [ThreadPool]: SQL status: SUCCESS in 0.325 seconds
[0m10:34:11.169213 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m10:34:11.169654 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m10:34:11.170977 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now list_iceberg_silver)
[0m10:34:11.181120 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m10:34:11.181649 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m10:34:11.181967 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:34:11.396059 [debug] [ThreadPool]: SQL status: SUCCESS in 0.214 seconds
[0m10:34:11.397917 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m10:34:11.398368 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m10:34:11.402149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a3d0e4a-0aae-4281-947f-75d3f8870bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fffeff0cd10>]}
[0m10:34:11.413439 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m10:34:11.414247 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_customer_events)
[0m10:34:11.414664 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m10:34:11.417369 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m10:34:11.418408 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m10:34:11.418947 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m10:34:11.419507 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m10:34:11.419837 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m10:34:11.421559 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m10:34:11.422448 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m10:34:11.422929 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m10:34:11.423297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now seed.ecommerce_dbt.raw_payment_transactions)
[0m10:34:11.423768 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m10:34:11.425325 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m10:34:11.425885 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m10:34:11.426219 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m10:34:11.426648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now seed.ecommerce_dbt.raw_support_tickets)
[0m10:34:11.426946 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m10:34:11.428318 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m10:34:11.428804 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m10:34:11.429118 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m10:34:11.429457 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_customer_events)
[0m10:34:11.429735 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m10:34:11.434590 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m10:34:11.435493 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m10:34:11.436041 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m10:34:11.436370 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:34:11.436740 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m10:34:11.437261 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:34:11.439640 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m10:34:11.440193 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:34:11.441980 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m10:34:11.442376 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m10:34:11.442848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m10:34:11.443310 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m10:34:11.445827 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m10:34:11.446446 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m10:34:11.446994 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m10:34:11.447472 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m10:34:11.448081 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m10:34:11.448571 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m10:34:11.451106 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m10:34:11.451836 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m10:34:11.452354 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m10:34:11.452666 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m10:34:11.453073 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now model.ecommerce_dbt.silver_customer_sessions)
[0m10:34:11.453387 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m10:34:11.455693 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m10:34:11.456436 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m10:34:11.457015 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m10:34:11.457397 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m10:34:11.457780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m10:34:11.458080 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m10:34:11.469773 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m10:34:11.470838 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m10:34:11.471430 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m10:34:11.471771 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m10:34:11.472127 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m10:34:11.472434 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m10:34:11.475149 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m10:34:11.475697 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m10:34:11.476224 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m10:34:11.476542 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m10:34:11.476987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m10:34:11.477441 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m10:34:11.480944 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m10:34:11.482322 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m10:34:11.483566 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m10:34:11.483964 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m10:34:11.484407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m10:34:11.484755 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m10:34:11.490652 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m10:34:11.491608 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m10:34:11.492401 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m10:34:11.492916 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m10:34:11.493431 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now model.ecommerce_dbt.silver_inventory_health)
[0m10:34:11.493748 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m10:34:11.497464 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m10:34:11.498431 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m10:34:11.499128 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m10:34:11.499694 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m10:34:11.500316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m10:34:11.500900 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m10:34:11.505359 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m10:34:11.506311 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m10:34:11.507237 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m10:34:11.507709 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m10:34:11.508221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m10:34:11.508617 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m10:34:11.512741 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m10:34:11.514256 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m10:34:11.515245 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m10:34:11.515839 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m10:34:11.516338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m10:34:11.516678 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m10:34:11.520867 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m10:34:11.521714 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m10:34:11.522494 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m10:34:11.522928 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m10:34:11.523489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m10:34:11.523831 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m10:34:11.528401 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m10:34:11.529255 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m10:34:11.529956 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m10:34:11.530392 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m10:34:11.530764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now model.ecommerce_dbt.silver_payment_analysis)
[0m10:34:11.531087 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m10:34:11.534229 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m10:34:11.534921 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m10:34:11.535575 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m10:34:11.535952 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m10:34:11.536345 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m10:34:11.537370 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m10:34:11.540248 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m10:34:11.540788 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m10:34:11.541325 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m10:34:11.541658 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m10:34:11.542016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m10:34:11.542387 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m10:34:11.546746 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m10:34:11.547435 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m10:34:11.548355 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m10:34:11.548752 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m10:34:11.549274 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m10:34:11.549639 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m10:34:11.553117 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m10:34:11.553916 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m10:34:11.554525 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m10:34:11.554864 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m10:34:11.556045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now model.ecommerce_dbt.silver_support_metrics)
[0m10:34:11.556401 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m10:34:11.560120 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m10:34:11.560850 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m10:34:11.561420 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m10:34:11.561755 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m10:34:11.562228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m10:34:11.562548 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m10:34:11.565391 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m10:34:11.565947 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m10:34:11.566461 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m10:34:11.566789 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m10:34:11.567137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m10:34:11.567439 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m10:34:11.570197 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m10:34:11.570995 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m10:34:11.571514 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m10:34:11.571847 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m10:34:11.572223 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m10:34:11.572511 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m10:34:11.575288 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m10:34:11.575912 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m10:34:11.576438 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m10:34:11.576763 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m10:34:11.577112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_product_summary)
[0m10:34:11.577411 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m10:34:11.580081 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m10:34:11.580717 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m10:34:11.581246 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m10:34:11.581574 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m10:34:11.581913 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_product_summary, now model.ecommerce_dbt.gold_customer_summary)
[0m10:34:11.582201 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m10:34:11.584727 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m10:34:11.585243 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m10:34:11.585719 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m10:34:11.586015 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m10:34:11.586336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.gold_customer_summary, now model.ecommerce_dbt.gold_daily_metrics)
[0m10:34:11.586609 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m10:34:11.589194 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m10:34:11.589655 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m10:34:11.590134 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m10:34:11.591913 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:34:11.592793 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m10:34:11.597690 [debug] [MainThread]: Command end result
[0m10:34:11.690438 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:34:11.694461 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:34:11.706331 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/airflow/dags/ecommerce_dbt/target/run_results.json
[0m10:34:11.714685 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m10:34:11.715137 [info ] [MainThread]: Building catalog
[0m10:34:11.721254 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m10:34:11.766876 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m10:34:11.767898 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.10", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m10:34:11.768851 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:34:15.136903 [debug] [ThreadPool]: SQL status: SUCCESS in 3.367 seconds
[0m10:34:15.158671 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m10:34:15.191740 [debug] [MainThread]: Wrote artifact CatalogArtifact to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m10:34:15.225105 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/airflow/dags/ecommerce_dbt/target/manifest.json
[0m10:34:15.230277 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/airflow/dags/ecommerce_dbt/target/semantic_manifest.json
[0m10:34:15.230690 [info ] [MainThread]: Catalog written to /opt/airflow/dags/ecommerce_dbt/target/catalog.json
[0m10:34:15.235618 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 6.1005354, "process_in_blocks": "14280", "process_kernel_time": 1.029123, "process_mem_max_rss": "289624", "process_out_blocks": "5916", "process_user_time": 3.111632}
[0m10:34:15.241498 [debug] [MainThread]: Command `cli docs generate` succeeded at 10:34:15.240446 after 6.11 seconds
[0m10:34:15.243991 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m10:34:15.244749 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m10:34:15.245744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff0266150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01c7590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffff01c6150>]}
[0m10:34:15.246667 [debug] [MainThread]: Flushing usage events
[0m10:34:15.718836 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:17:36.849546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10845a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099f3b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099f3d90>]}


============================== 15:17:36.852334 | f7a1c80e-6f94-4189-9f25-cd94c1c1806b ==============================
[0m15:17:36.852334 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:17:36.852642 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'profiles_dir': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt', 'log_cache_events': 'False', 'invocation_command': 'dbt docs generate', 'introspect': 'True', 'target_path': 'None', 'version_check': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'no_print': 'None', 'cache_selected_only': 'False', 'quiet': 'False', 'log_path': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs', 'static_parser': 'True', 'fail_fast': 'False', 'log_format': 'default', 'partial_parse': 'True', 'empty': 'None', 'debug': 'False', 'write_json': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m15:17:37.457821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d4c640>]}
[0m15:17:37.493401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d3aad0>]}
[0m15:17:37.493740 [info ] [MainThread]: Registered adapter: trino=1.10.0
[0m15:17:37.547278 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:17:37.593140 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m15:17:37.593385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b6e950>]}
[0m15:17:38.268775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3ebe30>]}
[0m15:17:38.283721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a612190>]}
[0m15:17:38.283966 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:17:38.284136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2f8fc0>]}
[0m15:17:38.285309 [info ] [MainThread]: 
[0m15:17:38.285484 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m15:17:38.285614 [info ] [MainThread]: 
[0m15:17:38.285827 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:17:38.288294 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_bronze'
[0m15:17:38.296473 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:17:38.297395 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_silver'
[0m15:17:38.360504 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:17:38.361684 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:17:38.362752 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:17:38.362918 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:17:38.363108 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:17:38.363297 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:17:38.363450 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:38.363580 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:38.363698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:38.363816 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:17:38.363975 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:17:38.364168 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:17:38.364373 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a583f50>]}
[0m15:17:38.364538 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a890100>]}
[0m15:17:38.364714 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': 'f7a1c80e-6f94-4189-9f25-cd94c1c1806b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8901b0>]}
[0m15:17:39.178795 [debug] [ThreadPool]: Trino adapter: Trino error: failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:17:39.179514 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:17:39.179835 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:17:39.250019 [debug] [ThreadPool]: Trino adapter: Trino error: failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:17:39.251109 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:17:39.251534 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:17:39.464416 [debug] [ThreadPool]: Trino adapter: Trino error: failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:17:39.465875 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:17:39.466458 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:17:39.467618 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:39.468076 [debug] [MainThread]: Connection 'list_iceberg_bronze' was properly closed.
[0m15:17:39.468471 [debug] [MainThread]: Connection 'list_iceberg_gold' was properly closed.
[0m15:17:39.468837 [debug] [MainThread]: Connection 'list_iceberg_silver' was properly closed.
[0m15:17:39.469631 [error] [MainThread]: Encountered an error:
Database Error
  failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:17:39.479236 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": false, "command_wall_clock_time": 2.674315, "process_in_blocks": "0", "process_kernel_time": 0.292321, "process_mem_max_rss": "145506304", "process_out_blocks": "0", "process_user_time": 1.706443}
[0m15:17:39.480169 [debug] [MainThread]: Command `dbt docs generate` failed at 15:17:39.480032 after 2.68 seconds
[0m15:17:39.480707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a957450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a957650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a6a350>]}
[0m15:17:39.481207 [debug] [MainThread]: Flushing usage events
[0m15:17:41.301884 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:18:09.195139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8263c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ddef890>]}


============================== 15:18:09.197834 | 9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675 ==============================
[0m15:18:09.197834 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:18:09.198153 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'no_print': 'None', 'debug': 'False', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'profiles_dir': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt', 'invocation_command': 'dbt docs generate', 'empty': 'None', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'printer_width': '80', 'use_colors': 'True', 'log_path': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'write_json': 'True', 'warn_error': 'None'}
[0m15:18:09.336452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0ce8b0>]}
[0m15:18:09.375441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c116360>]}
[0m15:18:09.375848 [info ] [MainThread]: Registered adapter: trino=1.10.0
[0m15:18:09.470531 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:18:09.537177 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:18:09.537372 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:18:09.559311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df73c50>]}
[0m15:18:09.566821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e355220>]}
[0m15:18:09.567051 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:18:09.567229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e54e890>]}
[0m15:18:09.568417 [info ] [MainThread]: 
[0m15:18:09.568608 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m15:18:09.568736 [info ] [MainThread]: 
[0m15:18:09.568956 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:18:09.571234 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:18:09.578003 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_bronze'
[0m15:18:09.582983 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_silver'
[0m15:18:09.629538 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:18:09.630681 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:18:09.631774 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:18:09.631962 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:18:09.632168 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:18:09.632356 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:18:09.632508 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:09.632639 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:09.632754 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:09.632868 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:18:09.633031 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:18:09.633219 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:18:09.633427 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e84e5b0>]}
[0m15:18:09.633597 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6e10d0>]}
[0m15:18:09.633743 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '9c03b0c1-7dc3-4e17-9bf9-e1b5449cd675', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6e1250>]}
[0m15:18:10.416923 [debug] [ThreadPool]: Trino adapter: Trino error: failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:18:10.418517 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:18:10.419047 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:18:10.449074 [debug] [ThreadPool]: Trino adapter: Trino error: failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:18:10.450062 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:18:10.450600 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:18:10.532168 [debug] [ThreadPool]: Trino adapter: Trino error: failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:18:10.532812 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:18:10.533168 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:18:10.533965 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:18:10.534386 [debug] [MainThread]: Connection 'list_iceberg_gold' was properly closed.
[0m15:18:10.534725 [debug] [MainThread]: Connection 'list_iceberg_bronze' was properly closed.
[0m15:18:10.535045 [debug] [MainThread]: Connection 'list_iceberg_silver' was properly closed.
[0m15:18:10.535667 [error] [MainThread]: Encountered an error:
Database Error
  failed to execute: HTTPConnectionPool(host='host.docker.internal', port=9080): Max retries exceeded with url: /v1/statement (Caused by NameResolutionError("HTTPConnection(host='host.docker.internal', port=9080): Failed to resolve 'host.docker.internal' ([Errno 8] nodename nor servname provided, or not known)"))
[0m15:18:10.541125 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": false, "command_wall_clock_time": 1.3884542, "process_in_blocks": "0", "process_kernel_time": 0.226465, "process_mem_max_rss": "131989504", "process_out_blocks": "0", "process_user_time": 1.025884}
[0m15:18:10.541711 [debug] [MainThread]: Command `dbt docs generate` failed at 15:18:10.541609 after 1.39 seconds
[0m15:18:10.542108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e29c0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e95e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e28a1d0>]}
[0m15:18:10.542522 [debug] [MainThread]: Flushing usage events
[0m15:18:11.748616 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:18:34.167411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6163c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbe3610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbe3890>]}


============================== 15:18:34.169988 | 951981b7-165b-4791-a340-c4f4685b2e0d ==============================
[0m15:18:34.169988 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:18:34.170289 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt', 'empty': 'None', 'static_parser': 'True', 'quiet': 'False', 'log_path': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs', 'introspect': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'no_print': 'None', 'version_check': 'True', 'write_json': 'True', 'invocation_command': 'dbt docs generate', 'log_format': 'default', 'debug': 'False', 'partial_parse': 'True'}
[0m15:18:34.285008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aebe8b0>]}
[0m15:18:34.320622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f06360>]}
[0m15:18:34.320967 [info ] [MainThread]: Registered adapter: trino=1.10.0
[0m15:18:34.376121 [debug] [MainThread]: checksum: a50d730a31f4c1af850aa8110f398f1e1657a0325ec5753dae2929b817189a3e, vars: {}, profile: , target: , version: 1.10.17
[0m15:18:34.422753 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m15:18:34.422999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd65b50>]}
[0m15:18:35.050728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2818b0>]}
[0m15:18:35.057430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c7b5630>]}
[0m15:18:35.057649 [info ] [MainThread]: Found 11 models, 4 seeds, 14 data tests, 456 macros
[0m15:18:35.057812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c32a410>]}
[0m15:18:35.058941 [info ] [MainThread]: 
[0m15:18:35.059119 [info ] [MainThread]: Concurrency: 3 threads (target='trino')
[0m15:18:35.059250 [info ] [MainThread]: 
[0m15:18:35.059453 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:18:35.061723 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_gold'
[0m15:18:35.068168 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_bronze'
[0m15:18:35.071273 [debug] [ThreadPool]: Acquiring new trino connection 'list_iceberg_silver'
[0m15:18:35.102033 [debug] [ThreadPool]: Using trino connection "list_iceberg_gold"
[0m15:18:35.103140 [debug] [ThreadPool]: Using trino connection "list_iceberg_bronze"
[0m15:18:35.104184 [debug] [ThreadPool]: Using trino connection "list_iceberg_silver"
[0m15:18:35.104340 [debug] [ThreadPool]: On list_iceberg_gold: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_gold"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'gold') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'gold'
[0m15:18:35.104517 [debug] [ThreadPool]: On list_iceberg_bronze: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_bronze"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'bronze') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'bronze'
[0m15:18:35.104701 [debug] [ThreadPool]: On list_iceberg_silver: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "list_iceberg_silver"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "iceberg".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'iceberg'
              and schema_name = 'silver') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'silver'
[0m15:18:35.104846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:35.104975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:35.105086 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:35.105201 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:18:35.105354 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:18:35.105539 [warn ] [ThreadPool]: [[33mWARNING[0m]: SSL certificate validation is disabled by default. It is legacy behavior which will be changed in future releases. It is strongly advised to enable `require_certificate_validation` flag or explicitly set `cert` configuration to `True` for security reasons. You may receive an error after that if your SSL setup is incorrect.
You may opt into the new behavior sooner by setting `flags.require_certificate_validation` to `True` in `dbt_project.yml`.
Visit https://docs.getdbt.com/reference/global-configs/behavior-changes for more information.
[0m15:18:35.105750 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c75af90>]}
[0m15:18:35.105921 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca48890>]}
[0m15:18:35.106077 [debug] [ThreadPool]: Sending event: {'category': 'dbt', 'action': 'BehaviorChangeEvent', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca48940>]}
[0m15:18:35.399920 [debug] [ThreadPool]: SQL status: SUCCESS in 0.295 seconds
[0m15:18:35.402167 [debug] [ThreadPool]: On list_iceberg_gold: ROLLBACK
[0m15:18:35.402684 [debug] [ThreadPool]: On list_iceberg_gold: Close
[0m15:18:35.404862 [debug] [ThreadPool]: SQL status: SUCCESS in 0.300 seconds
[0m15:18:35.405592 [debug] [ThreadPool]: On list_iceberg_silver: ROLLBACK
[0m15:18:35.405758 [debug] [ThreadPool]: On list_iceberg_silver: Close
[0m15:18:35.417702 [debug] [ThreadPool]: SQL status: SUCCESS in 0.313 seconds
[0m15:18:35.419596 [debug] [ThreadPool]: On list_iceberg_bronze: ROLLBACK
[0m15:18:35.419982 [debug] [ThreadPool]: On list_iceberg_bronze: Close
[0m15:18:35.422076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '951981b7-165b-4791-a340-c4f4685b2e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf34e50>]}
[0m15:18:35.426671 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_customer_events
[0m15:18:35.427167 [debug] [Thread-3 (]: Began running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:18:35.427449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_iceberg_gold, now seed.ecommerce_dbt.raw_customer_events)
[0m15:18:35.427637 [debug] [Thread-2 (]: Began running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:18:35.427839 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_iceberg_silver, now seed.ecommerce_dbt.raw_payment_transactions)
[0m15:18:35.428217 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_customer_events
[0m15:18:35.428614 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_iceberg_bronze, now seed.ecommerce_dbt.raw_inventory_snapshots)
[0m15:18:35.428849 [debug] [Thread-3 (]: Began compiling node seed.ecommerce_dbt.raw_payment_transactions
[0m15:18:35.430582 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_customer_events
[0m15:18:35.431110 [debug] [Thread-2 (]: Began compiling node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:18:35.432717 [debug] [Thread-3 (]: Began executing node seed.ecommerce_dbt.raw_payment_transactions
[0m15:18:35.433226 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_customer_events
[0m15:18:35.434781 [debug] [Thread-2 (]: Began executing node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:18:35.435210 [debug] [Thread-3 (]: Finished running node seed.ecommerce_dbt.raw_payment_transactions
[0m15:18:35.435468 [debug] [Thread-1 (]: Began running node seed.ecommerce_dbt.raw_support_tickets
[0m15:18:35.435742 [debug] [Thread-2 (]: Finished running node seed.ecommerce_dbt.raw_inventory_snapshots
[0m15:18:35.435980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_customer_events, now seed.ecommerce_dbt.raw_support_tickets)
[0m15:18:35.436297 [debug] [Thread-1 (]: Began compiling node seed.ecommerce_dbt.raw_support_tickets
[0m15:18:35.437042 [debug] [Thread-1 (]: Began executing node seed.ecommerce_dbt.raw_support_tickets
[0m15:18:35.437367 [debug] [Thread-1 (]: Finished running node seed.ecommerce_dbt.raw_support_tickets
[0m15:18:35.437574 [debug] [Thread-2 (]: Began running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:18:35.437726 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_inventory_snapshots, now model.ecommerce_dbt.bronze_payment_transactions)
[0m15:18:35.437876 [debug] [Thread-2 (]: Began compiling node model.ecommerce_dbt.bronze_payment_transactions
[0m15:18:35.439661 [debug] [Thread-2 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_payment_transactions"
[0m15:18:35.440014 [debug] [Thread-3 (]: Began running node model.ecommerce_dbt.bronze_customer_events
[0m15:18:35.440230 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_payment_transactions, now model.ecommerce_dbt.bronze_customer_events)
[0m15:18:35.440904 [debug] [Thread-3 (]: Began compiling node model.ecommerce_dbt.bronze_customer_events
[0m15:18:35.443325 [debug] [Thread-3 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_customer_events"
[0m15:18:35.443633 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:18:35.443820 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.ecommerce_dbt.raw_support_tickets, now model.ecommerce_dbt.bronze_inventory_snapshots)
[0m15:18:35.443984 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:18:35.445416 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_inventory_snapshots"
[0m15:18:35.445861 [debug] [Thread-2 (]: Began executing node model.ecommerce_dbt.bronze_payment_transactions
[0m15:18:35.446283 [debug] [Thread-2 (]: Finished running node model.ecommerce_dbt.bronze_payment_transactions
[0m15:18:35.446508 [debug] [Thread-2 (]: Began running node model.ecommerce_dbt.bronze_support_tickets
[0m15:18:35.446709 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_payment_transactions, now model.ecommerce_dbt.bronze_support_tickets)
[0m15:18:35.446900 [debug] [Thread-2 (]: Began compiling node model.ecommerce_dbt.bronze_support_tickets
[0m15:18:35.449111 [debug] [Thread-2 (]: Writing injected SQL for node "model.ecommerce_dbt.bronze_support_tickets"
[0m15:18:35.449944 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:18:35.450354 [debug] [Thread-3 (]: Began executing node model.ecommerce_dbt.bronze_customer_events
[0m15:18:35.450912 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.bronze_inventory_snapshots
[0m15:18:35.451454 [debug] [Thread-3 (]: Finished running node model.ecommerce_dbt.bronze_customer_events
[0m15:18:35.451610 [debug] [Thread-2 (]: Began executing node model.ecommerce_dbt.bronze_support_tickets
[0m15:18:35.451801 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_payment_analysis
[0m15:18:35.451986 [debug] [Thread-3 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:18:35.452805 [debug] [Thread-2 (]: Finished running node model.ecommerce_dbt.bronze_support_tickets
[0m15:18:35.453263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_inventory_snapshots, now model.ecommerce_dbt.silver_payment_analysis)
[0m15:18:35.453782 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_customer_events, now test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac)
[0m15:18:35.454298 [debug] [Thread-2 (]: Began running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:18:35.454970 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_payment_analysis
[0m15:18:35.455429 [debug] [Thread-3 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:18:35.455861 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.bronze_support_tickets, now test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835)
[0m15:18:35.459719 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_payment_analysis"
[0m15:18:35.471365 [debug] [Thread-3 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac"
[0m15:18:35.471769 [debug] [Thread-2 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:18:35.475183 [debug] [Thread-2 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835"
[0m15:18:35.475957 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_payment_analysis
[0m15:18:35.476853 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_payment_analysis
[0m15:18:35.477326 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:18:35.477644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_payment_analysis, now test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9)
[0m15:18:35.477837 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:18:35.478119 [debug] [Thread-3 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:18:35.484557 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9"
[0m15:18:35.484925 [debug] [Thread-2 (]: Began executing node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:18:35.485296 [debug] [Thread-3 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac
[0m15:18:35.486016 [debug] [Thread-2 (]: Finished running node test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835
[0m15:18:35.486359 [debug] [Thread-3 (]: Began running node model.ecommerce_dbt.silver_customer_sessions
[0m15:18:35.486549 [debug] [Thread-2 (]: Began running node model.ecommerce_dbt.silver_inventory_health
[0m15:18:35.486696 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:18:35.487002 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac, now model.ecommerce_dbt.silver_customer_sessions)
[0m15:18:35.487205 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835, now model.ecommerce_dbt.silver_inventory_health)
[0m15:18:35.487500 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9
[0m15:18:35.487714 [debug] [Thread-3 (]: Began compiling node model.ecommerce_dbt.silver_customer_sessions
[0m15:18:35.487871 [debug] [Thread-2 (]: Began compiling node model.ecommerce_dbt.silver_inventory_health
[0m15:18:35.488048 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:18:35.490065 [debug] [Thread-3 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_customer_sessions"
[0m15:18:35.493906 [debug] [Thread-2 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_inventory_health"
[0m15:18:35.494606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9, now test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958)
[0m15:18:35.495376 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:18:35.497568 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958"
[0m15:18:35.498526 [debug] [Thread-2 (]: Began executing node model.ecommerce_dbt.silver_inventory_health
[0m15:18:35.499033 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:18:35.499822 [debug] [Thread-2 (]: Finished running node model.ecommerce_dbt.silver_inventory_health
[0m15:18:35.500460 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958
[0m15:18:35.500804 [debug] [Thread-2 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:18:35.501031 [debug] [Thread-3 (]: Began executing node model.ecommerce_dbt.silver_customer_sessions
[0m15:18:35.501281 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:18:35.501586 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_inventory_health, now test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918)
[0m15:18:35.501889 [debug] [Thread-3 (]: Finished running node model.ecommerce_dbt.silver_customer_sessions
[0m15:18:35.502064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958, now test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe)
[0m15:18:35.502233 [debug] [Thread-2 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:18:35.502415 [debug] [Thread-3 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:18:35.504637 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:18:35.510370 [debug] [Thread-2 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918"
[0m15:18:35.510826 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_customer_sessions, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360)
[0m15:18:35.512858 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe"
[0m15:18:35.514107 [debug] [Thread-3 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:18:35.518651 [debug] [Thread-3 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360"
[0m15:18:35.519144 [debug] [Thread-2 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:18:35.519488 [debug] [Thread-2 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918
[0m15:18:35.519681 [debug] [Thread-2 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:18:35.519858 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418)
[0m15:18:35.520057 [debug] [Thread-2 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:18:35.520217 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:18:35.521833 [debug] [Thread-2 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418"
[0m15:18:35.522161 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe
[0m15:18:35.522315 [debug] [Thread-3 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:18:35.522510 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:18:35.522833 [debug] [Thread-3 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360
[0m15:18:35.523066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe, now test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762)
[0m15:18:35.523375 [debug] [Thread-3 (]: Began running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:18:35.523572 [debug] [Thread-2 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:18:35.523764 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:18:35.524096 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360, now test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5)
[0m15:18:35.524493 [debug] [Thread-2 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418
[0m15:18:35.526298 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762"
[0m15:18:35.526506 [debug] [Thread-3 (]: Began compiling node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:18:35.526699 [debug] [Thread-2 (]: Began running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:18:35.528717 [debug] [Thread-3 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5"
[0m15:18:35.528942 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418, now test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede)
[0m15:18:35.529145 [debug] [Thread-2 (]: Began compiling node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:18:35.529303 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:18:35.530805 [debug] [Thread-2 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede"
[0m15:18:35.531113 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762
[0m15:18:35.531338 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.silver_support_metrics
[0m15:18:35.531506 [debug] [Thread-3 (]: Began executing node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:18:35.531666 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762, now model.ecommerce_dbt.silver_support_metrics)
[0m15:18:35.531988 [debug] [Thread-3 (]: Finished running node test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5
[0m15:18:35.532164 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.silver_support_metrics
[0m15:18:35.532314 [debug] [Thread-2 (]: Began executing node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:18:35.532465 [debug] [Thread-3 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:18:35.533959 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.silver_support_metrics"
[0m15:18:35.534243 [debug] [Thread-2 (]: Finished running node test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede
[0m15:18:35.534411 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5, now test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4)
[0m15:18:35.534614 [debug] [Thread-2 (]: Began running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:18:35.534776 [debug] [Thread-3 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:18:35.534933 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede, now test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b)
[0m15:18:35.536742 [debug] [Thread-3 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4"
[0m15:18:35.536933 [debug] [Thread-2 (]: Began compiling node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:18:35.537094 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.silver_support_metrics
[0m15:18:35.538560 [debug] [Thread-2 (]: Writing injected SQL for node "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b"
[0m15:18:35.538847 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.silver_support_metrics
[0m15:18:35.539109 [debug] [Thread-1 (]: Began running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:18:35.539282 [debug] [Thread-3 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:18:35.539513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecommerce_dbt.silver_support_metrics, now test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51)
[0m15:18:35.539939 [debug] [Thread-3 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4
[0m15:18:35.540096 [debug] [Thread-1 (]: Began compiling node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:18:35.540238 [debug] [Thread-2 (]: Began executing node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:18:35.540397 [debug] [Thread-3 (]: Began running node model.ecommerce_dbt.gold_product_summary
[0m15:18:35.542096 [debug] [Thread-1 (]: Writing injected SQL for node "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51"
[0m15:18:35.542386 [debug] [Thread-2 (]: Finished running node test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b
[0m15:18:35.542559 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4, now model.ecommerce_dbt.gold_product_summary)
[0m15:18:35.542765 [debug] [Thread-2 (]: Began running node model.ecommerce_dbt.gold_customer_summary
[0m15:18:35.542926 [debug] [Thread-3 (]: Began compiling node model.ecommerce_dbt.gold_product_summary
[0m15:18:35.543094 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b, now model.ecommerce_dbt.gold_customer_summary)
[0m15:18:35.544447 [debug] [Thread-3 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_product_summary"
[0m15:18:35.544621 [debug] [Thread-1 (]: Began executing node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:18:35.544762 [debug] [Thread-2 (]: Began compiling node model.ecommerce_dbt.gold_customer_summary
[0m15:18:35.545033 [debug] [Thread-1 (]: Finished running node test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51
[0m15:18:35.546372 [debug] [Thread-2 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_customer_summary"
[0m15:18:35.546571 [debug] [Thread-1 (]: Began running node model.ecommerce_dbt.gold_daily_metrics
[0m15:18:35.546726 [debug] [Thread-3 (]: Began executing node model.ecommerce_dbt.gold_product_summary
[0m15:18:35.546921 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51, now model.ecommerce_dbt.gold_daily_metrics)
[0m15:18:35.547200 [debug] [Thread-3 (]: Finished running node model.ecommerce_dbt.gold_product_summary
[0m15:18:35.547354 [debug] [Thread-1 (]: Began compiling node model.ecommerce_dbt.gold_daily_metrics
[0m15:18:35.547499 [debug] [Thread-2 (]: Began executing node model.ecommerce_dbt.gold_customer_summary
[0m15:18:35.549226 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecommerce_dbt.gold_daily_metrics"
[0m15:18:35.549518 [debug] [Thread-2 (]: Finished running node model.ecommerce_dbt.gold_customer_summary
[0m15:18:35.549792 [debug] [Thread-1 (]: Began executing node model.ecommerce_dbt.gold_daily_metrics
[0m15:18:35.550035 [debug] [Thread-1 (]: Finished running node model.ecommerce_dbt.gold_daily_metrics
[0m15:18:35.550517 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:18:35.550649 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_daily_metrics' was properly closed.
[0m15:18:35.550764 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_customer_summary' was properly closed.
[0m15:18:35.550868 [debug] [MainThread]: Connection 'model.ecommerce_dbt.gold_product_summary' was properly closed.
[0m15:18:35.552433 [debug] [MainThread]: Command end result
[0m15:18:35.589811 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/manifest.json
[0m15:18:35.595259 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/semantic_manifest.json
[0m15:18:35.598863 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/run_results.json
[0m15:18:35.600785 [debug] [MainThread]: Acquiring new trino connection 'generate_catalog'
[0m15:18:35.600939 [info ] [MainThread]: Building catalog
[0m15:18:35.602448 [debug] [ThreadPool]: Acquiring new trino connection 'iceberg.information_schema'
[0m15:18:35.629581 [debug] [ThreadPool]: Using trino connection "iceberg.information_schema"
[0m15:18:35.630266 [debug] [ThreadPool]: On iceberg.information_schema: /* {"app": "dbt", "dbt_version": "1.10.17", "profile_name": "ecommerce_dbt", "target_name": "trino", "connection_name": "iceberg.information_schema"} */

    
        with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        table_type as "table_type",
        null as "table_owner"
    from "iceberg".INFORMATION_SCHEMA.tables
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from "iceberg".INFORMATION_SCHEMA.columns
            where
        table_schema != 'information_schema'
        and
        (
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_support_metrics'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_payment_analysis'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_product_summary'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_daily_metrics'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_customer_events'
                    )
                 or 
                    (
                        table_schema = 'gold'
                        and table_name = 'gold_customer_summary'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_support_tickets'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_payment_transactions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_inventory_snapshots'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_inventory_health'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'raw_customer_events'
                    )
                 or 
                    (
                        table_schema = 'silver'
                        and table_name = 'silver_customer_sessions'
                    )
                 or 
                    (
                        table_schema = 'bronze'
                        and table_name = 'bronze_support_tickets'
                    )
                )
        ),
        table_comment as (
            
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_support_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_payment_analysis'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_product_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_daily_metrics'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'gold'
                    and table_name = 'gold_customer_summary'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_support_tickets'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_payment_transactions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_inventory_snapshots'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_inventory_health'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'raw_customer_events'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'silver'
                    and table_name = 'silver_customer_sessions'
                )
            
    union all
    
    select
        catalog_name as "table_database",
        schema_name as "table_schema",
        table_name as "table_name",
        comment as "table_comment"
    from system.metadata.table_comments
    where
        catalog_name = 'iceberg'
        and
        schema_name != 'information_schema'
        and
        
                (
                    schema_name = 'bronze'
                    and table_name = 'bronze_support_tickets'
                )
            
        )
        select
            table_database,
            table_schema,
            table_name,
            table_type,
            table_owner,
            column_name,
            column_index,
            column_type,
            column_comment,
            table_comment
        from tables
        join columns using ("table_database", "table_schema", "table_name")
        join table_comment using ("table_database", "table_schema", "table_name")
        order by "column_index"
[0m15:18:35.630895 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:36.624001 [debug] [ThreadPool]: SQL status: SUCCESS in 0.993 seconds
[0m15:18:36.634685 [debug] [ThreadPool]: On iceberg.information_schema: Close
[0m15:18:36.652022 [debug] [MainThread]: Wrote artifact CatalogArtifact to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/catalog.json
[0m15:18:36.665675 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/manifest.json
[0m15:18:36.667463 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/semantic_manifest.json
[0m15:18:36.667744 [info ] [MainThread]: Catalog written to /Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/target/catalog.json
[0m15:18:36.670715 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 2.544791, "process_in_blocks": "0", "process_kernel_time": 0.238636, "process_mem_max_rss": "141852672", "process_out_blocks": "0", "process_user_time": 1.76966}
[0m15:18:36.671024 [debug] [MainThread]: Command `dbt docs generate` succeeded at 15:18:36.670976 after 2.55 seconds
[0m15:18:36.671195 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:18:36.671442 [debug] [MainThread]: Connection 'iceberg.information_schema' was properly closed.
[0m15:18:36.671607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc542f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ba83d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a016090>]}
[0m15:18:36.671794 [debug] [MainThread]: Flushing usage events
[0m15:18:37.833170 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:18:56.842327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5a23c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb63610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb63890>]}


============================== 15:18:56.844907 | e5fa48e7-6a98-401d-ab42-82f15c9d6785 ==============================
[0m15:18:56.844907 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:18:56.845212 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt', 'invocation_command': 'dbt docs serve', 'static_parser': 'True', 'introspect': 'True', 'log_path': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs', 'use_experimental_parser': 'False', 'debug': 'False', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'no_print': 'None', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'empty': 'None', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'printer_width': '80'}
[0m15:18:56.959924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e5fa48e7-6a98-401d-ab42-82f15c9d6785', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae4a8b0>]}
[0m15:18:56.994955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e5fa48e7-6a98-401d-ab42-82f15c9d6785', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e8e360>]}
[0m15:18:57.200808 [error] [MainThread]: Encountered an error:
[Errno 48] Address already in use
[0m15:18:57.203462 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
                      ~~~~^^^^^^^^^^^^^^^^^
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 272, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 317, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 364, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/main.py", line 307, in docs_serve
    results = task.run()
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/task/docs/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 457, in __init__
    self.server_bind()
    ~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
OSError: [Errno 48] Address already in use

[0m15:18:57.206020 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 0.40688342, "process_in_blocks": "0", "process_kernel_time": 0.147254, "process_mem_max_rss": "120733696", "process_out_blocks": "0", "process_user_time": 0.787087}
[0m15:18:57.206519 [debug] [MainThread]: Command `dbt docs serve` failed at 15:18:57.206447 after 0.41 seconds
[0m15:18:57.206850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bce6350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bce6450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bccb5c0>]}
[0m15:18:57.207550 [debug] [MainThread]: Flushing usage events
[0m15:18:58.960925 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:19:08.924417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e2e3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093ef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093ef890>]}


============================== 15:19:08.927014 | fb16bca7-4e67-41e8-abef-427bc73ba628 ==============================
[0m15:19:08.927014 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:19:08.927324 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_path': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs', 'indirect_selection': 'eager', 'debug': 'False', 'printer_width': '80', 'log_format': 'default', 'cache_selected_only': 'False', 'no_print': 'None', 'write_json': 'True', 'version_check': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'empty': 'None', 'introspect': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m15:19:09.039947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb16bca7-4e67-41e8-abef-427bc73ba628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086da8b0>]}
[0m15:19:09.075358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb16bca7-4e67-41e8-abef-427bc73ba628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771a360>]}
[0m15:19:09.223394 [error] [MainThread]: Encountered an error:
[Errno 48] Address already in use
[0m15:19:09.228551 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
                      ~~~~^^^^^^^^^^^^^^^^^
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 272, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 317, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 364, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/main.py", line 307, in docs_serve
    results = task.run()
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/task/docs/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 457, in __init__
    self.server_bind()
    ~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
OSError: [Errno 48] Address already in use

[0m15:19:09.235427 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 0.3522532, "process_in_blocks": "0", "process_kernel_time": 0.139542, "process_mem_max_rss": "121061376", "process_out_blocks": "0", "process_user_time": 0.787397}
[0m15:19:09.237349 [debug] [MainThread]: Command `dbt docs serve` failed at 15:19:09.237238 after 0.35 seconds
[0m15:19:09.237703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109572450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109572550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095575c0>]}
[0m15:19:09.237955 [debug] [MainThread]: Flushing usage events
[0m15:19:10.290132 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:19:19.294253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3823c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d943610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d943890>]}


============================== 15:19:19.296958 | 2623396c-60df-425e-b755-1a5eac174c4c ==============================
[0m15:19:19.296958 [info ] [MainThread]: Running with dbt=1.10.17
[0m15:19:19.297272 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'log_path': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'printer_width': '80', 'quiet': 'False', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'target_path': 'None', 'indirect_selection': 'eager', 'introspect': 'True', 'invocation_command': 'dbt docs serve --port 8081', 'version_check': 'True', 'write_json': 'True'}
[0m15:19:19.411023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2623396c-60df-425e-b755-1a5eac174c4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc2a8b0>]}
[0m15:19:19.446081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2623396c-60df-425e-b755-1a5eac174c4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc72360>]}
[0m15:23:02.208626 [error] [MainThread]: Encountered an error:

[0m15:23:02.226095 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 178, in wrapper
    result, success = func(*args, **kwargs)
                      ~~~~^^^^^^^^^^^^^^^^^
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 128, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 272, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 317, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/requires.py", line 364, in wrapper
    return func(*args, **kwargs)
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/cli/main.py", line 307, in docs_serve
    results = task.run()
  File "/Users/khanhvu/Documents/Code/LakeHouse/.venv/lib/python3.13/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
    ~~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/selectors.py", line 398, in select
    fd_event_list = self._selector.poll(timeout)
KeyboardInterrupt

[0m15:23:02.231008 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 222.97705, "process_in_blocks": "0", "process_kernel_time": 0.162359, "process_mem_max_rss": "120258560", "process_out_blocks": "0", "process_user_time": 0.81243}
[0m15:23:02.231840 [debug] [MainThread]: Command `dbt docs serve` failed at 15:23:02.231672 after 222.98 seconds
[0m15:23:02.234807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dac6550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dac6450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daab5c0>]}
[0m15:23:02.237052 [debug] [MainThread]: Flushing usage events
