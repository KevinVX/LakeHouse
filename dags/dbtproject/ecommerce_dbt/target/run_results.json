{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.17", "generated_at": "2025-12-21T07:18:35.550968Z", "invocation_id": "951981b7-165b-4791-a340-c4f4685b2e0d", "invocation_started_at": "2025-12-21T07:18:34.154688Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.428996Z", "completed_at": "2025-12-21T07:18:35.430387Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.432933Z", "completed_at": "2025-12-21T07:18:35.432946Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00568699836730957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.ecommerce_dbt.raw_customer_events", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.431418Z", "completed_at": "2025-12-21T07:18:35.432621Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.434958Z", "completed_at": "2025-12-21T07:18:35.434964Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007257938385009766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.ecommerce_dbt.raw_payment_transactions", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.433397Z", "completed_at": "2025-12-21T07:18:35.434704Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.435585Z", "completed_at": "2025-12-21T07:18:35.435587Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007109165191650391, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.ecommerce_dbt.raw_inventory_snapshots", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.436443Z", "completed_at": "2025-12-21T07:18:35.436995Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.437180Z", "completed_at": "2025-12-21T07:18:35.437184Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0013132095336914062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.ecommerce_dbt.raw_support_tickets", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.437979Z", "completed_at": "2025-12-21T07:18:35.445776Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.446037Z", "completed_at": "2025-12-21T07:18:35.446044Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008439064025878906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.bronze_payment_transactions", "compiled": true, "compiled_code": "\n\nSELECT\n    transaction_id,\n    order_id,\n    customer_id,\n    payment_method,\n    payment_status,\n    CAST(amount AS DECIMAL(10,2)) as amount,\n    currency,\n    CAST(transaction_timestamp as timestamp) as transaction_timestamp,\n    CAST(processor_response_code AS VARCHAR(2)) as processor_response_code,\n    CAST(gateway_fee AS decimal(10,2)) as gateway_fee,\n    merchant_id,\n    billing_country,\n    risk_score,\n    CURRENT_TIMESTAMP as ingested_at,\n    'raw_payment_transactions' as source_system\nFROM \"iceberg\".\"bronze\".\"raw_payment_transactions\"", "relation_name": "\"iceberg\".\"bronze\".\"bronze_payment_transactions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.444091Z", "completed_at": "2025-12-21T07:18:35.449824Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.450567Z", "completed_at": "2025-12-21T07:18:35.450579Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006968021392822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.bronze_inventory_snapshots", "compiled": true, "compiled_code": "\n\nSELECT\n    snapshot_id,\n    product_id,\n    warehouse_id,\n    CAST(snapshot_date AS DATE) as snapshot_date,\n    CAST(quantity_on_hand AS INTEGER) as quantity_on_hand,\n    CAST(quantity_reserved AS INTEGER) as quantity_reserved,\n    CAST(quantity_available AS INTEGER) as quantity_available,\n    CAST(reorder_point AS INTEGER) as reorder_point,\n    CAST(reorder_quantity AS INTEGER) as reorder_quantity,\n    supplier_id,\n    CAST(last_received_date AS DATE) as last_received_date,\n    CAST(unit_cost AS DECIMAL(10,2)) as unit_cost,\n    CURRENT_TIMESTAMP as ingested_at,\n    'raw_inventory_snapshots' as source_system\nFROM \"iceberg\".\"bronze\".\"raw_inventory_snapshots\"", "relation_name": "\"iceberg\".\"bronze\".\"bronze_inventory_snapshots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.441246Z", "completed_at": "2025-12-21T07:18:35.450244Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.451212Z", "completed_at": "2025-12-21T07:18:35.451219Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011160135269165039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.bronze_customer_events", "compiled": true, "compiled_code": "\n\nSELECT\n    event_id,\n    customer_id,\n    session_id,\n    event_type,\n    CAST(event_timestamp AS TIMESTAMP) as event_timestamp,\n    page_url,\n    NULLIF(product_id, '') as product_id,\n    NULLIF(category_id, '') as category_id,\n    referrer_source,\n    device_type,\n    user_agent,\n    ip_address,\n    CURRENT_TIMESTAMP as ingested_at,\n    'raw_customer_events' as source_system\nFROM \"iceberg\".\"bronze\".\"raw_customer_events\"\n--WHERE event_id IS NOT NULL\n--AND customer_id IS NOT NULL\n--AND event_timestamp IS NOT NULL", "relation_name": "\"iceberg\".\"bronze\".\"bronze_customer_events\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.447024Z", "completed_at": "2025-12-21T07:18:35.451561Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.452595Z", "completed_at": "2025-12-21T07:18:35.452599Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006021022796630859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.bronze_support_tickets", "compiled": true, "compiled_code": "\n\nSELECT\n    ticket_id,\n    customer_id,\n    NULLIF(order_id, '') as order_id,\n    ticket_type,\n    priority,\n    status,\n    CAST(created_timestamp AS TIMESTAMP) as created_timestamp,\n    CASE\n        WHEN first_response_timestamp IS NULL OR CAST(first_response_timestamp as VARCHAR) = '' THEN NULL\n        ELSE CAST(first_response_timestamp AS TIMESTAMP) END as first_response_timestamp,\n    resolution_timestamp,\n    agent_id,\n    CAST(NULLIF(satisfaction_score, 0) AS INTEGER) as satisfaction_score,\n    subject,\n    channel,\n    CURRENT_TIMESTAMP as ingested_at,\n    'raw_support_tickets' as source_system\nFROM \"iceberg\".\"bronze\".\"raw_support_tickets\"", "relation_name": "\"iceberg\".\"bronze\".\"bronze_support_tickets\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.456186Z", "completed_at": "2025-12-21T07:18:35.475810Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.476293Z", "completed_at": "2025-12-21T07:18:35.476308Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.023398876190185547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.silver_payment_analysis", "compiled": true, "compiled_code": "\n\n-- Silver layer: Payment transaction analysis with fraud detection features\nWITH payment_enriched AS (\n    SELECT\n        transaction_id,\n        order_id,\n        customer_id,\n        payment_method,\n        payment_status,\n        amount,\n        currency,\n        transaction_timestamp,\n        processor_response_code,\n        gateway_fee,\n        merchant_id,\n        billing_country,\n        risk_score,\n\n        -- Time-based features\n        EXTRACT(HOUR FROM transaction_timestamp) as transaction_hour,\n        EXTRACT(DOW FROM transaction_timestamp) as transaction_day_of_week,\n        DATE(transaction_timestamp) as transaction_date,\n\n        -- Payment success indicator\n        CASE\n            WHEN payment_status = 'completed' THEN TRUE\n            ELSE FALSE\n        END as is_successful,\n\n        -- High-risk transaction indicator\n        CASE\n            WHEN risk_score >= 80 THEN TRUE\n            ELSE FALSE\n        END as is_high_risk,\n\n        -- Failed payment indicator\n        CASE\n            WHEN payment_status = 'failed' THEN TRUE\n            ELSE FALSE\n        END as is_failed,\n\n        -- Refunded transaction indicator\n        CASE\n            WHEN payment_status = 'refunded' THEN TRUE\n            ELSE FALSE\n        END as is_refunded,\n\n        -- Net payment amount (after gateway fees)\n        amount - gateway_fee as net_amount\n\n    FROM \"iceberg\".\"bronze\".\"bronze_payment_transactions\"\n),\n\ncustomer_payment_patterns AS (\n    SELECT\n        customer_id,\n        COUNT(*) as total_transactions,\n        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,\n        COUNT(CASE WHEN is_failed THEN 1 END) as failed_transactions,\n        COUNT(CASE WHEN is_high_risk THEN 1 END) as high_risk_transactions,\n        AVG(amount) as avg_transaction_amount,\n        MAX(amount) as max_transaction_amount,\n        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as total_successful_amount,\n        COUNT(DISTINCT payment_method) as unique_payment_methods\n    FROM payment_enriched\n    GROUP BY customer_id\n)\n\nSELECT\n    p.transaction_id,\n    p.order_id,\n    p.customer_id,\n    p.payment_method,\n    p.payment_status,\n    p.amount,\n    p.currency,\n    p.transaction_timestamp,\n    p.transaction_hour,\n    p.transaction_day_of_week,\n    p.transaction_date,\n    p.processor_response_code,\n    p.gateway_fee,\n    p.net_amount,\n    p.merchant_id,\n    p.billing_country,\n    p.risk_score,\n    p.is_successful,\n    p.is_high_risk,\n    p.is_failed,\n    p.is_refunded,\n\n    -- Customer behavior features\n    cp.total_transactions as customer_total_transactions,\n    cp.successful_transactions as customer_successful_transactions,\n    cp.failed_transactions as customer_failed_transactions,\n    cp.avg_transaction_amount as customer_avg_amount,\n    cp.max_transaction_amount as customer_max_amount,\n\n    -- Customer risk indicators\n    CASE\n        WHEN CAST(cp.failed_transactions AS DOUBLE) / NULLIF(cp.total_transactions, 0) > 0.3 THEN TRUE\n        ELSE FALSE\n    END as is_high_failure_rate_customer,\n\n    CASE\n        WHEN p.amount > cp.avg_transaction_amount * 3 THEN TRUE\n        ELSE FALSE\n    END as is_unusually_large_transaction,\n\n    -- Payment method risk classification\n    CASE\n        WHEN p.payment_method IN ('credit_card', 'debit_card') THEN 'Low Risk'\n        WHEN p.payment_method IN ('paypal', 'apple_pay', 'google_pay') THEN 'Medium Risk'\n        ELSE 'High Risk'\n    END as payment_method_risk_category,\n\n    CURRENT_TIMESTAMP as processed_at\n\nFROM payment_enriched p\nLEFT JOIN customer_payment_patterns cp ON p.customer_id = cp.customer_id", "relation_name": "\"iceberg\".\"silver\".\"silver_payment_analysis\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.460221Z", "completed_at": "2025-12-21T07:18:35.478059Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.485073Z", "completed_at": "2025-12-21T07:18:35.485079Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03150796890258789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_payment_transactions_amount.5476f423ac", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect amount\nfrom \"iceberg\".\"bronze\".\"bronze_payment_transactions\"\nwhere amount is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.472125Z", "completed_at": "2025-12-21T07:18:35.484855Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.485551Z", "completed_at": "2025-12-21T07:18:35.485566Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.029949188232421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_payment_transactions_transaction_id.35eeded835", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_id\nfrom \"iceberg\".\"bronze\".\"bronze_payment_transactions\"\nwhere transaction_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.478264Z", "completed_at": "2025-12-21T07:18:35.486647Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.487330Z", "completed_at": "2025-12-21T07:18:35.487334Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009811878204345703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.unique_bronze_payment_transactions_transaction_id.987e6122c9", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    transaction_id as unique_field,\n    count(*) as n_records\n\nfrom \"iceberg\".\"bronze\".\"bronze_payment_transactions\"\nwhere transaction_id is not null\ngroup by transaction_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.490314Z", "completed_at": "2025-12-21T07:18:35.498098Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.499303Z", "completed_at": "2025-12-21T07:18:35.499316Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012323856353759766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.silver_inventory_health", "compiled": true, "compiled_code": "\n\n-- Silver layer: Inventory health analysis with stock level classifications\nWITH latest_inventory AS (\n    SELECT\n        product_id,\n        warehouse_id,\n        snapshot_date,\n        quantity_on_hand,\n        quantity_reserved,\n        quantity_available,\n        reorder_point,\n        reorder_quantity,\n        supplier_id,\n        unit_cost,\n        ROW_NUMBER() OVER (PARTITION BY product_id, warehouse_id ORDER BY snapshot_date DESC) as rn\n    FROM \"iceberg\".\"bronze\".\"bronze_inventory_snapshots\"\n),\n\ninventory_metrics AS (\n    SELECT\n        product_id,\n        warehouse_id,\n        snapshot_date,\n        quantity_on_hand,\n        quantity_reserved,\n        quantity_available,\n        reorder_point,\n        reorder_quantity,\n        supplier_id,\n        unit_cost,\n\n        -- Stock health classifications\n        CASE\n            WHEN quantity_available <= 0 THEN 'Out of Stock'\n            WHEN quantity_available <= reorder_point THEN 'Low Stock'\n            WHEN quantity_available <= reorder_point * 2 THEN 'Medium Stock'\n            ELSE 'High Stock'\n        END as stock_status,\n\n        -- Days of inventory calculation\n        CASE\n            WHEN quantity_available > 0 THEN\n                CAST(quantity_available AS DOUBLE) / GREATEST(1, reorder_point) * 30\n            ELSE 0\n        END as estimated_days_of_inventory,\n\n        -- Reorder recommendation\n        CASE\n            WHEN quantity_available <= reorder_point THEN TRUE\n            ELSE FALSE\n        END as needs_reorder,\n\n        -- Stock turn rate estimate (simplified)\n        CASE\n            WHEN quantity_on_hand > 0 THEN\n                CAST(reorder_quantity AS DOUBLE) / quantity_on_hand * 12\n            ELSE 0\n        END as estimated_annual_turns,\n\n        -- Inventory value\n        quantity_on_hand * unit_cost as inventory_value,\n        quantity_available * unit_cost as available_inventory_value\n\n    FROM latest_inventory\n    WHERE rn = 1\n)\n\nSELECT\n    product_id,\n    warehouse_id,\n    snapshot_date,\n    quantity_on_hand,\n    quantity_reserved,\n    quantity_available,\n    reorder_point,\n    reorder_quantity,\n    supplier_id,\n    unit_cost,\n    stock_status,\n    estimated_days_of_inventory,\n    needs_reorder,\n    estimated_annual_turns,\n    inventory_value,\n    available_inventory_value,\n\n    -- Risk classifications\n    CASE\n        WHEN stock_status = 'Out of Stock' THEN 'Critical'\n        WHEN stock_status = 'Low Stock' AND estimated_days_of_inventory < 7 THEN 'High'\n        WHEN stock_status = 'Low Stock' THEN 'Medium'\n        ELSE 'Low'\n    END as inventory_risk_level,\n\n    CURRENT_TIMESTAMP as processed_at\nFROM inventory_metrics", "relation_name": "\"iceberg\".\"silver\".\"silver_inventory_health\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.495591Z", "completed_at": "2025-12-21T07:18:35.498913Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.500182Z", "completed_at": "2025-12-21T07:18:35.500189Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005882978439331055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_customer_events_customer_id.5d178f0958", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect customer_id\nfrom \"iceberg\".\"bronze\".\"bronze_customer_events\"\nwhere customer_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.488158Z", "completed_at": "2025-12-21T07:18:35.500969Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.501722Z", "completed_at": "2025-12-21T07:18:35.501726Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.01485586166381836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.silver_customer_sessions", "compiled": true, "compiled_code": "\n\n-- Silver layer: Customer session analysis with event aggregations\nWITH session_events AS (\n    SELECT\n        customer_id,\n        session_id,\n        MIN(event_timestamp) as session_start,\n        MAX(event_timestamp) as session_end,\n        COUNT(*) as total_events,\n        COUNT(DISTINCT event_type) as unique_event_types,\n        COUNT(CASE WHEN event_type = 'page_view' THEN 1 END) as page_views,\n        COUNT(CASE WHEN event_type = 'product_view' THEN 1 END) as product_views,\n        COUNT(CASE WHEN event_type = 'add_to_cart' THEN 1 END) as cart_adds,\n        COUNT(CASE WHEN event_type = 'purchase' THEN 1 END) as purchases,\n        COUNT(DISTINCT product_id) as unique_products_viewed,\n        device_type,\n        referrer_source\n    FROM \"iceberg\".\"bronze\".\"bronze_customer_events\"\n    GROUP BY customer_id, session_id, device_type, referrer_source\n),\n\nsession_metrics AS (\n    SELECT\n        *,\n        DATE_DIFF('second', session_start, session_end) as session_duration_seconds,\n        CASE\n            WHEN purchases > 0 THEN TRUE\n            ELSE FALSE\n        END as converted,\n        CASE\n            WHEN cart_adds > 0 AND purchases = 0 THEN TRUE\n            ELSE FALSE\n        END as abandoned_cart,\n        CASE\n            WHEN total_events = 1 THEN TRUE\n            ELSE FALSE\n        END as bounce_session\n    FROM session_events\n)\n\nSELECT\n    customer_id,\n    session_id,\n    session_start,\n    session_end,\n    session_duration_seconds,\n    CASE\n        WHEN session_duration_seconds < 30 THEN 'Very Short'\n        WHEN session_duration_seconds < 300 THEN 'Short'\n        WHEN session_duration_seconds < 1800 THEN 'Medium'\n        ELSE 'Long'\n    END as session_length_category,\n    total_events,\n    unique_event_types,\n    page_views,\n    product_views,\n    cart_adds,\n    purchases,\n    unique_products_viewed,\n    converted,\n    abandoned_cart,\n    bounce_session,\n    device_type,\n    referrer_source,\n    CURRENT_TIMESTAMP as processed_at\nFROM session_metrics", "relation_name": "\"iceberg\".\"silver\".\"silver_customer_sessions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.504839Z", "completed_at": "2025-12-21T07:18:35.519075Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.519284Z", "completed_at": "2025-12-21T07:18:35.519289Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01785111427307129, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_customer_events_event_id.37eabd4918", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect event_id\nfrom \"iceberg\".\"bronze\".\"bronze_customer_events\"\nwhere event_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.511005Z", "completed_at": "2025-12-21T07:18:35.520161Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.521987Z", "completed_at": "2025-12-21T07:18:35.521992Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.020027875900268555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_customer_events_event_timestamp.752a9f5bfe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect event_timestamp\nfrom \"iceberg\".\"bronze\".\"bronze_customer_events\"\nwhere event_timestamp is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.514592Z", "completed_at": "2025-12-21T07:18:35.522270Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.522636Z", "completed_at": "2025-12-21T07:18:35.522640Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011963129043579102, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_product_id.b3ae3a3360", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect product_id\nfrom \"iceberg\".\"bronze\".\"bronze_inventory_snapshots\"\nwhere product_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.520334Z", "completed_at": "2025-12-21T07:18:35.523521Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.524299Z", "completed_at": "2025-12-21T07:18:35.524313Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004572868347167969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_quantity_on_hand.6992e51418", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect quantity_on_hand\nfrom \"iceberg\".\"bronze\".\"bronze_inventory_snapshots\"\nwhere quantity_on_hand is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.524744Z", "completed_at": "2025-12-21T07:18:35.529255Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.530943Z", "completed_at": "2025-12-21T07:18:35.530947Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007999181747436523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_inventory_snapshots_snapshot_id.5da1aad762", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect snapshot_id\nfrom \"iceberg\".\"bronze\".\"bronze_inventory_snapshots\"\nwhere snapshot_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.526993Z", "completed_at": "2025-12-21T07:18:35.531458Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.531798Z", "completed_at": "2025-12-21T07:18:35.531802Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007817983627319336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.unique_bronze_customer_events_event_id.e51b6f8de5", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    event_id as unique_field,\n    count(*) as n_records\n\nfrom \"iceberg\".\"bronze\".\"bronze_customer_events\"\nwhere event_id is not null\ngroup by event_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.529410Z", "completed_at": "2025-12-21T07:18:35.532270Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.534084Z", "completed_at": "2025-12-21T07:18:35.534087Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005254030227661133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.unique_bronze_inventory_snapshots_snapshot_id.7e6f781ede", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    snapshot_id as unique_field,\n    count(*) as n_records\n\nfrom \"iceberg\".\"bronze\".\"bronze_inventory_snapshots\"\nwhere snapshot_id is not null\ngroup by snapshot_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.532583Z", "completed_at": "2025-12-21T07:18:35.537045Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.538689Z", "completed_at": "2025-12-21T07:18:35.538692Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007117033004760742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.silver_support_metrics", "compiled": true, "compiled_code": "\n\n-- Silver layer: Support ticket analysis with SLA tracking and agent performance\nWITH ticket_enriched AS (\n    SELECT\n        ticket_id,\n        customer_id,\n        order_id,\n        ticket_type,\n        priority,\n        status,\n        created_timestamp,\n        first_response_timestamp,\n        resolution_timestamp,\n        agent_id,\n        satisfaction_score,\n        subject,\n        channel,\n\n        -- Response time calculations (in minutes)\n        CASE\n            WHEN first_response_timestamp IS NOT NULL THEN\n                DATE_DIFF('minute', created_timestamp, first_response_timestamp)\n            ELSE NULL\n        END as first_response_time_minutes,\n\n        -- Resolution time calculations (in hours)\n        CASE\n            WHEN resolution_timestamp IS NOT NULL THEN\n                DATE_DIFF('hour', created_timestamp, resolution_timestamp)\n            ELSE NULL\n        END as resolution_time_hours,\n\n        -- SLA compliance indicators\n        CASE\n            WHEN priority = 'urgent' AND first_response_timestamp IS NOT NULL\n                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 15 THEN TRUE\n            WHEN priority = 'high' AND first_response_timestamp IS NOT NULL\n                AND DATE_DIFF('minute', created_timestamp, first_response_timestamp) <= 60 THEN TRUE\n            WHEN priority = 'medium' AND first_response_timestamp IS NOT NULL\n                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 4 THEN TRUE\n            WHEN priority = 'low' AND first_response_timestamp IS NOT NULL\n                AND DATE_DIFF('hour', created_timestamp, first_response_timestamp) <= 24 THEN TRUE\n            ELSE FALSE\n        END as meets_response_sla,\n\n        CASE\n            WHEN priority = 'urgent' AND resolution_timestamp IS NOT NULL\n                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 4 THEN TRUE\n            WHEN priority = 'high' AND resolution_timestamp IS NOT NULL\n                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 24 THEN TRUE\n            WHEN priority = 'medium' AND resolution_timestamp IS NOT NULL\n                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 72 THEN TRUE\n            WHEN priority = 'low' AND resolution_timestamp IS NOT NULL\n                AND DATE_DIFF('hour', created_timestamp, resolution_timestamp) <= 168 THEN TRUE\n            ELSE FALSE\n        END as meets_resolution_sla,\n\n        -- Ticket age for open tickets\n        CASE\n            WHEN status IN ('open', 'in_progress') THEN\n                DATE_DIFF('hour', created_timestamp, CURRENT_TIMESTAMP)\n            ELSE NULL\n        END as current_age_hours,\n\n        -- Customer satisfaction indicators\n        CASE\n            WHEN satisfaction_score IS NOT NULL AND satisfaction_score >= 4 THEN TRUE\n            ELSE FALSE\n        END as is_satisfied_customer,\n\n        CASE\n            WHEN satisfaction_score IS NOT NULL AND satisfaction_score <= 2 THEN TRUE\n            ELSE FALSE\n        END as is_unsatisfied_customer\n\n    FROM \"iceberg\".\"bronze\".\"bronze_support_tickets\"\n),\n\nagent_performance AS (\n    SELECT\n        agent_id,\n        COUNT(*) as total_tickets_handled,\n        AVG(first_response_time_minutes) as avg_first_response_time,\n        AVG(resolution_time_hours) as avg_resolution_time,\n        COUNT(CASE WHEN meets_response_sla THEN 1 END) as response_sla_met_count,\n        COUNT(CASE WHEN meets_resolution_sla THEN 1 END) as resolution_sla_met_count,\n        AVG(satisfaction_score) as avg_satisfaction_score,\n        COUNT(CASE WHEN is_satisfied_customer THEN 1 END) as satisfied_customers,\n        COUNT(CASE WHEN is_unsatisfied_customer THEN 1 END) as unsatisfied_customers\n    FROM ticket_enriched\n    WHERE agent_id IS NOT NULL\n    GROUP BY agent_id\n)\n\nSELECT\n    t.ticket_id,\n    t.customer_id,\n    t.order_id,\n    t.ticket_type,\n    t.priority,\n    t.status,\n    t.created_timestamp,\n    t.first_response_timestamp,\n    t.resolution_timestamp,\n    t.agent_id,\n    t.satisfaction_score,\n    t.subject,\n    t.channel,\n    t.first_response_time_minutes,\n    t.resolution_time_hours,\n    t.meets_response_sla,\n    t.meets_resolution_sla,\n    t.current_age_hours,\n    t.is_satisfied_customer,\n    t.is_unsatisfied_customer,\n\n    -- Agent performance context\n    a.avg_first_response_time as agent_avg_response_time,\n    a.avg_resolution_time as agent_avg_resolution_time,\n    a.avg_satisfaction_score as agent_avg_satisfaction,\n\n    -- Ticket urgency classification\n    CASE\n        WHEN t.priority = 'urgent' AND t.current_age_hours > 4 THEN 'Overdue Critical'\n        WHEN t.priority = 'high' AND t.current_age_hours > 24 THEN 'Overdue High'\n        WHEN t.priority = 'medium' AND t.current_age_hours > 72 THEN 'Overdue Medium'\n        WHEN t.priority = 'low' AND t.current_age_hours > 168 THEN 'Overdue Low'\n        WHEN t.status IN ('open', 'in_progress') THEN 'Active'\n        ELSE 'Resolved'\n    END as ticket_urgency_status,\n\n    -- Channel efficiency indicator\n    CASE\n        WHEN t.channel = 'chat' THEN 'Real-time'\n        WHEN t.channel = 'phone' THEN 'Real-time'\n        WHEN t.channel = 'email' THEN 'Asynchronous'\n        WHEN t.channel = 'social_media' THEN 'Public'\n        ELSE 'Other'\n    END as channel_type,\n\n    CURRENT_TIMESTAMP as processed_at\n\nFROM ticket_enriched t\nLEFT JOIN agent_performance a ON t.agent_id = a.agent_id", "relation_name": "\"iceberg\".\"silver\".\"silver_support_metrics\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.535052Z", "completed_at": "2025-12-21T07:18:35.539237Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.539770Z", "completed_at": "2025-12-21T07:18:35.539773Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.005461215972900391, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_support_tickets_customer_id.ca7da6d0f4", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect customer_id\nfrom \"iceberg\".\"bronze\".\"bronze_support_tickets\"\nwhere customer_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.537216Z", "completed_at": "2025-12-21T07:18:35.540198Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.542226Z", "completed_at": "2025-12-21T07:18:35.542229Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007387876510620117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.not_null_bronze_support_tickets_ticket_id.d51e9eb74b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ticket_id\nfrom \"iceberg\".\"bronze\".\"bronze_support_tickets\"\nwhere ticket_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.540520Z", "completed_at": "2025-12-21T07:18:35.544574Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.544886Z", "completed_at": "2025-12-21T07:18:35.544888Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005470991134643555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ecommerce_dbt.unique_bronze_support_tickets_ticket_id.24d1940f51", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ticket_id as unique_field,\n    count(*) as n_records\n\nfrom \"iceberg\".\"bronze\".\"bronze_support_tickets\"\nwhere ticket_id is not null\ngroup by ticket_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.543252Z", "completed_at": "2025-12-21T07:18:35.546680Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.547055Z", "completed_at": "2025-12-21T07:18:35.547058Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.004591703414916992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.gold_product_summary", "compiled": true, "compiled_code": "\n\n-- Simple gold layer product summary\nWITH product_events AS (\n    SELECT\n        product_id,\n        COUNT(*) as total_events,\n        COUNT(DISTINCT customer_id) as unique_viewers,\n        COUNT(DISTINCT session_id) as unique_sessions\n    FROM \"iceberg\".\"bronze\".\"bronze_customer_events\"\n    WHERE product_id IS NOT NULL\n    GROUP BY product_id\n),\n\nproduct_inventory AS (\n    SELECT\n        product_id,\n        AVG(quantity_on_hand) as avg_stock_level,\n        AVG(reorder_point) as avg_reorder_point,\n        MAX(needs_reorder) as ever_out_of_stock\n    FROM \"iceberg\".\"silver\".\"silver_inventory_health\"\n    GROUP BY product_id\n)\n\nSELECT\n    COALESCE(pe.product_id, pi.product_id) as product_id,\n\n    -- Event metrics\n    COALESCE(pe.total_events, 0) as total_events,\n    COALESCE(pe.unique_viewers, 0) as unique_viewers,\n    COALESCE(pe.unique_sessions, 0) as unique_sessions,\n\n    -- Inventory metrics\n    COALESCE(pi.avg_stock_level, 0) as avg_stock_level,\n    COALESCE(pi.avg_reorder_point, 0) as avg_reorder_point,\n    COALESCE(pi.ever_out_of_stock, FALSE) as ever_out_of_stock,\n\n    CURRENT_TIMESTAMP as calculated_at\n\nFROM product_events pe\nFULL OUTER JOIN product_inventory pi ON pe.product_id = pi.product_id", "relation_name": "\"iceberg\".\"gold\".\"gold_product_summary\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.545153Z", "completed_at": "2025-12-21T07:18:35.547456Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.549351Z", "completed_at": "2025-12-21T07:18:35.549353Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006367921829223633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.gold_customer_summary", "compiled": true, "compiled_code": "\n\n-- Simple gold layer customer summary\nSELECT\n    cs.customer_id,\n\n    -- Session metrics\n    COUNT(DISTINCT cs.session_id) as total_sessions,\n    AVG(cs.session_duration_seconds) as avg_session_duration,\n    SUM(cs.total_events) as total_events,\n\n    -- Payment metrics\n    COUNT(DISTINCT pa.transaction_id) as total_transactions,\n    SUM(CASE WHEN pa.is_successful THEN pa.amount ELSE 0 END) as total_revenue,\n    AVG(CASE WHEN pa.is_successful THEN pa.amount END) as avg_transaction_amount,\n\n    -- Support metrics\n    COUNT(DISTINCT sm.ticket_id) as total_support_tickets,\n    AVG(sm.satisfaction_score) as avg_satisfaction_score,\n\n    CURRENT_TIMESTAMP as calculated_at\n\nFROM \"iceberg\".\"silver\".\"silver_customer_sessions\" cs\nLEFT JOIN \"iceberg\".\"silver\".\"silver_payment_analysis\" pa ON cs.customer_id = pa.customer_id\nLEFT JOIN \"iceberg\".\"silver\".\"silver_support_metrics\" sm ON cs.customer_id = sm.customer_id\nGROUP BY cs.customer_id", "relation_name": "\"iceberg\".\"gold\".\"gold_customer_summary\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-21T07:18:35.547629Z", "completed_at": "2025-12-21T07:18:35.549744Z"}, {"name": "execute", "started_at": "2025-12-21T07:18:35.549895Z", "completed_at": "2025-12-21T07:18:35.549897Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0030641555786132812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ecommerce_dbt.gold_daily_metrics", "compiled": true, "compiled_code": "\n\n-- Simple gold layer daily metrics\nWITH daily_sessions AS (\n    SELECT\n        DATE(session_start) as metric_date,\n        COUNT(DISTINCT session_id) as total_sessions,\n        COUNT(DISTINCT customer_id) as unique_visitors,\n        AVG(session_duration_seconds) as avg_session_duration\n    FROM \"iceberg\".\"silver\".\"silver_customer_sessions\"\n    GROUP BY DATE(session_start)\n),\n\ndaily_payments AS (\n    SELECT\n        DATE(transaction_timestamp) as metric_date,\n        COUNT(*) as total_transactions,\n        COUNT(CASE WHEN is_successful THEN 1 END) as successful_transactions,\n        SUM(CASE WHEN is_successful THEN amount ELSE 0 END) as daily_revenue,\n        AVG(risk_score) as avg_risk_score\n    FROM \"iceberg\".\"silver\".\"silver_payment_analysis\"\n    GROUP BY DATE(transaction_timestamp)\n),\n\ndaily_support AS (\n    SELECT\n        DATE(created_timestamp) as metric_date,\n        COUNT(*) as total_tickets,\n        AVG(first_response_time_minutes/60.0) as avg_response_time,\n        AVG(resolution_time_hours) as avg_resolution_time\n    FROM \"iceberg\".\"silver\".\"silver_support_metrics\"\n    GROUP BY DATE(created_timestamp)\n)\n\nSELECT\n    COALESCE(ds.metric_date, dp.metric_date, dsu.metric_date) as metric_date,\n\n    -- Session metrics\n    COALESCE(ds.total_sessions, 0) as total_sessions,\n    COALESCE(ds.unique_visitors, 0) as unique_visitors,\n    COALESCE(ds.avg_session_duration, 0) as avg_session_duration,\n\n    -- Payment metrics\n    COALESCE(dp.total_transactions, 0) as total_transactions,\n    COALESCE(dp.successful_transactions, 0) as successful_transactions,\n    COALESCE(dp.daily_revenue, 0) as daily_revenue,\n    COALESCE(dp.avg_risk_score, 0) as avg_risk_score,\n\n    -- Support metrics\n    COALESCE(dsu.total_tickets, 0) as total_tickets,\n    COALESCE(dsu.avg_response_time, 0) as avg_response_time,\n    COALESCE(dsu.avg_resolution_time, 0) as avg_resolution_time,\n\n    CURRENT_TIMESTAMP as calculated_at\n\nFROM daily_sessions ds\nFULL OUTER JOIN daily_payments dp ON ds.metric_date = dp.metric_date\nFULL OUTER JOIN daily_support dsu ON COALESCE(ds.metric_date, dp.metric_date) = dsu.metric_date", "relation_name": "\"iceberg\".\"gold\".\"gold_daily_metrics\"", "batch_results": null}], "elapsed_time": 0.4916059970855713, "args": {"warn_error_options": {"error": [], "warn": [], "silence": []}, "compile": true, "log_file_max_bytes": 10485760, "project_dir": "/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt", "require_generic_test_arguments_property": true, "static_parser": true, "show_all_deprecations": false, "print": true, "require_nested_cumulative_type_params": false, "log_path": "/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt/logs", "write_json": true, "state_modified_compare_vars": false, "require_resource_names_without_spaces": true, "printer_width": 80, "skip_nodes_if_on_run_start_fails": false, "use_colors": true, "source_freshness_run_project_hooks": true, "version_check": true, "partial_parse_file_diff": true, "quiet": false, "vars": {}, "empty_catalog": false, "use_fast_test_edges": false, "favor_state": false, "state_modified_compare_more_unrendered_values": false, "which": "generate", "log_format": "default", "partial_parse": true, "require_batched_execution_for_custom_microbatch_strategy": false, "validate_macro_args": false, "log_level_file": "debug", "show_resource_report": false, "introspect": true, "cache_selected_only": false, "populate_cache": true, "log_format_file": "debug", "macro_debugging": false, "defer": false, "require_all_warnings_handled_by_warn_error": false, "require_yaml_configuration_for_mf_time_spines": false, "log_level": "info", "invocation_command": "dbt docs generate", "send_anonymous_usage_stats": true, "strict_mode": false, "upload_to_artifacts_ingest_api": false, "static": false, "indirect_selection": "eager", "profiles_dir": "/Users/khanhvu/Documents/Code/LakeHouse/dags/dbtproject/ecommerce_dbt", "require_explicit_package_overrides_for_builtin_materializations": true, "exclude": [], "select": [], "use_colors_file": true}}